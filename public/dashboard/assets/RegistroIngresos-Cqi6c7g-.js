import{c as In,r as h,a as $n,f as $s,e as xs,j as e,b as ot,P as Bt,d as Lt,B as L,C as zt,g as Ut,h as Wt,u as Tn,i as An,k as kn,l as En,m as Mn,n as Vn,o as Rn,p as On,q as Bn,s as Ln,D as vs,t as ys,v as ws,w as Ss,x as U,y as Cs,S as qe,z as wa,R as Ve,A as G,L as j,I as W,E as at,F as ce,T as Sa,G as Ca,H as ds,J as ms,K as H,M as K,N as J,O as de,Q,U as _a,V as Re,W as Pa,X as _s,Y as Ye,Z as Ge,_ as ve,$ as ye,a0 as Fe,a1 as we,a2 as E,a3 as us,a4 as zn,a5 as Un,a6 as Fa,a7 as Ps,a8 as Wn,a9 as Da,aa as Ia,ab as $a,ac as Fs,ad as qn,ae as nt,af as Ds,ag as Ta,ah as Aa,ai as rt,aj as Yn,ak as Gn,al as Hn,am as Kn,an as Rt}from"./index-E10RyCSa.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jn=In("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),Qn=u=>{const P=(u==null?void 0:u.data)??u??[];return Array.isArray(P)?P:[]},Xn=(u=10)=>{const[P,F]=h.useState([]),[w,k]=h.useState(!0),[me,ge]=h.useState(null),ae=async()=>{try{k(!0),ge(null);const re=await $n(`/api/transacciones/ingresos/recientes?limit=${encodeURIComponent(String(u))}`,{method:"GET"}),Ie=Qn(re).map(Ce=>{var ns;return{...Ce,asiento_fecha:Ce.asiento_fecha??(Array.isArray(Ce.asiento)&&Ce.asiento.length>0?((ns=Ce.asiento[0])==null?void 0:ns.fecha)??null:null)}});F(Ie)}catch(re){console.error("Error fetching transacciones recientes:",re),ge((re==null?void 0:re.message)||"Error desconocido")}finally{k(!1)}};return h.useEffect(()=>{let re=!0;ae();const Ie=window.setInterval(()=>{re&&ae()},3e4);return()=>{re=!1,window.clearInterval(Ie)}},[u]),{transacciones:P,loading:w,error:me,refetch:ae}};function Zn({value:u,onChange:P,className:F,placeholder:w="Selecciona un rango",disabled:k}){const me=h.useMemo(()=>u!=null&&u.from?u.to?`${$s(u.from,"dd/MM/yyyy",{locale:xs})} ‚Äì ${$s(u.to,"dd/MM/yyyy",{locale:xs})}`:$s(u.from,"dd/MM/yyyy",{locale:xs}):w,[u,w]);return e.jsx("div",{className:ot("grid gap-2",F),children:e.jsxs(Bt,{children:[e.jsx(Lt,{asChild:!0,children:e.jsxs(L,{type:"button",variant:"outline",disabled:k,className:ot("w-full justify-start text-left font-normal",!(u!=null&&u.from)&&"text-muted-foreground"),children:[e.jsx(zt,{className:"mr-2 h-4 w-4"}),me]})}),e.jsxs(Ut,{className:"w-auto p-0",align:"start",children:[e.jsx(Wt,{initialFocus:!0,mode:"range",numberOfMonths:2,selected:u,onSelect:P,locale:xs,defaultMonth:(u==null?void 0:u.from)??new Date}),e.jsxs("div",{className:"flex items-center justify-between gap-2 border-t p-2",children:[e.jsx(L,{type:"button",variant:"ghost",size:"sm",onClick:()=>P(void 0),children:"Limpiar"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:u!=null&&u.from&&!(u!=null&&u.to)?"Elige la fecha fin":" "})]})]})]})})}async function De(u,P={}){const F=await fetch(u,{credentials:"include",headers:{"Content-Type":"application/json",...P.headers||{}},...P}),w=await F.json().catch(()=>({}));if(!F.ok){const k=(w==null?void 0:w.error)||(w==null?void 0:w.message)||`HTTP ${F.status}`;throw new Error(k)}return(w==null?void 0:w.data)??w}async function Ot(u,P={}){const F=(P==null?void 0:P.body)??{};try{if(u==="registrar-ingreso")return{data:await De("/api/ingresos",{method:"POST",body:JSON.stringify(F)}),error:null};if(u==="cancelar-ingreso"){const k=F==null?void 0:F.transaccionId;return{data:await De(`/api/ingresos/${encodeURIComponent(k)}/cancelar`,{method:"POST",body:JSON.stringify({motivoCancelacion:F==null?void 0:F.motivoCancelacion})}),error:null}}return{data:await De(`/api/functions/${encodeURIComponent(u)}`,{method:"POST",body:JSON.stringify(F)}),error:null}}catch(w){return{data:null,error:{message:(w==null?void 0:w.message)||String(w)}}}}const as=u=>{if(u==null)return 0;const P=typeof u=="string"?Number(u):u;return Number.isFinite(P)?P:0},D=u=>as(u).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),T=(u,P)=>{const F=as(u);let w=F,k="";return P==="miles"?(w=F/1e3,k=" K"):P==="millones"&&(w=F/1e6,k=" M"),w.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})+k},Is=u=>{if(!u)return u;const P=u.id??u._id,F=u.fecha??u.createdAt??u.created_at??u.updatedAt??u.updated_at,w=F?String(F):void 0,k=w?w.slice(0,10):u.created_at,me=as(u.monto_total??u.montoTotal??u.total??u.monto_total),ge=as(u.monto_descuento??u.montoDescuento??u.descuento),ae=as(u.monto_neto??u.montoNeto??u.neto??me-ge),re=as(u.monto_pagado??u.montoPagado??u.pagado??ae),Se=as(u.saldo_pendiente??u.saldoPendiente??u.pendiente??Math.max(0,ae-re)),Ie=u.tipo_ingreso??u.tipoIngreso??u.tipo,Ce=u.metodo_pago??u.metodoPago,ns=u.tipo_pago??u.tipoPago;return{...u,id:P,_id:u._id??P,created_at:u.created_at??k,fecha:u.fecha??w,tipo_ingreso:Ie,tipoIngreso:u.tipoIngreso??Ie,metodo_pago:Ce,metodoPago:u.metodoPago??Ce,tipo_pago:ns,tipoPago:u.tipoPago??ns,monto_total:me,montoTotal:u.montoTotal??me,total:u.total??me,monto_descuento:ge,montoDescuento:u.montoDescuento??ge,monto_neto:ae,montoNeto:u.montoNeto??ae,neto:u.neto??ae,monto_pagado:re,montoPagado:u.montoPagado??re,pagado:u.pagado??re,saldo_pendiente:Se,saldoPendiente:u.saldoPendiente??Se,pendiente:u.pendiente??Se}},xe=(u,P)=>{const F=Is(u);return P==="brutas"?F.monto_total||0:P==="descuentos"?F.monto_descuento||0:P==="netas"&&(F.monto_neto||F.monto_total)||0},ts=u=>{const P=(u??"").toString().slice(0,10),[F,w,k]=P.split("-").map(Number);return new Date(F,(w||1)-1,k||1)},er=u=>{const{x:P,y:F,width:w,height:k,name:me,value:ge,porcentaje:ae}=u,Se=me==="Efectivo"?"hsl(180 50% 55%)":"hsl(180 45% 45%)",Ie=w>100&&k>70;return e.jsxs("g",{children:[e.jsx("rect",{x:P,y:F,width:w,height:k,fill:Se,stroke:"#fff",strokeWidth:2}),Ie&&e.jsxs(e.Fragment,{children:[e.jsx("text",{x:P+w/2,y:F+k/2-20,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontWeight:"bold",fontSize:"16px",style:{userSelect:"none"},children:me}),e.jsxs("text",{x:P+w/2,y:F+k/2+5,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:["$",T(ge,"general")]}),e.jsxs("text",{x:P+w/2,y:F+k/2+25,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:[ae,"%"]})]})]})},sr=({active:u,payload:P,scaleFormat:F})=>{if(u&&P&&P.length){const w=P[0].payload,k=w.name==="Efectivo";return e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-lg p-3",children:[e.jsx("p",{className:"font-bold text-foreground mb-1",children:w.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Monto: ",e.jsxs("span",{className:"font-semibold text-foreground",children:["$",T(w.value,F)]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Porcentaje: ",e.jsxs("span",{className:"font-semibold text-foreground",children:[w.porcentaje,"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2 italic",children:k?"Se registra en Efectivo (Caja)":"Se registra en Bancos"})]})}return null},rr=()=>{const{ventasResumen:u,loading:P,refetch:F}=Tn(),{transacciones:w,loading:k,refetch:me}=Xn(1e3),ge=(w??[]).map(Is),{data:ae=[]}=An(),{data:re}=kn(),Se=(re==null?void 0:re.cuentasFlat)||[],{data:Ie=[],isLoading:Ce,refetch:ns}=En(),{data:$e=[],isLoading:it,refetch:ka}=Mn(),{data:Le=[],isLoading:Ea}=Vn(),Ma=Rn(),Va=On(),qt=Bn(),Ra=Ln(),[O,rs]=h.useState(""),[Oa,Ba]=h.useState(!1),[La,za]=h.useState(""),[Ts,Yt]=h.useState(""),[M,Gt]=h.useState(""),[_e,He]=h.useState(""),[As,os]=h.useState(""),[Ht,ks]=h.useState(!1),[ne,Kt]=h.useState(""),[Pe,ct]=h.useState(""),[is,Es]=h.useState(""),[Te,Ms]=h.useState(""),[Ae,Vs]=h.useState(""),[Oe,Rs]=h.useState(""),[Os,Jt]=h.useState(""),[ke,Qt]=h.useState(""),[Bs,lt]=h.useState(""),[ze,Ls]=h.useState([]),[Ua,hs]=h.useState(!1),[y,zs]=h.useState(null),[cs,dt]=h.useState("historico"),[ue,ps]=h.useState(""),[ee,Wa]=h.useState("diario"),[$,qa]=h.useState("general"),[b,Ya]=h.useState("brutas"),[B,Ga]=h.useState("ventas"),[he,Ha]=h.useState(new Date),[V,Ka]=h.useState(new Date),[gs,Ja]=h.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[js,Qa]=h.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[fs,Xa]=h.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[R,mt]=h.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]}),[tr,Us]=h.useState([]),[ls,Za]=h.useState([]),[Xt,Zt]=h.useState(""),[ea,sa]=h.useState(""),[en,ta]=h.useState(void 0);function aa(s){const t=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),i=String(s.getDate()).padStart(2,"0");return`${t}-${r}-${i}`}function sn(s){const[t,r,i]=String(s).split("-").map(Number);return!t||!r||!i?null:new Date(t,r-1,i,0,0,0,0)}function tn(s){const[t,r,i]=String(s).split("-").map(Number);return!t||!r||!i?null:new Date(t,r-1,i,23,59,59,999)}const Ws=s=>{const t=ts(s),r=Xt?sn(Xt):null,i=ea?tn(ea):null;return!(r&&t<r||i&&t>i)},an=s=>{ta(s);const t=s==null?void 0:s.from,r=s==null?void 0:s.to;Zt(t?aa(t):""),sa(r?aa(r):"")},[je,na]=h.useState("todos"),[fe,ra]=h.useState("todas"),[ie,oa]=h.useState(""),[Ns,nn]=h.useState("subcuenta"),[Ke,qs]=h.useState(null),[rn,ut]=h.useState(!1),[le,xt]=h.useState(""),[Je,bs]=h.useState(""),[Ue,ht]=h.useState("1"),[Ys,pt]=h.useState(0),[gt,Gs]=h.useState(!0),[jt,ft]=h.useState("0"),[Qe,Nt]=h.useState("monto"),[X,Hs]=h.useState([]),[Xe,bt]=h.useState(""),[Ks,vt]=h.useState(""),[Js,yt]=h.useState("1"),[wt,ia]=h.useState("0"),[Ze,on]=h.useState("monto"),[oe,Qs]=h.useState([]),[cn,St]=h.useState(!1),[Ct,ca]=h.useState(""),[_t,la]=h.useState(""),[da,ma]=h.useState(""),[ar,ln]=h.useState("4001"),[ua,xa]=h.useState(""),[dn,ha]=h.useState(null);h.useState(null);const[Xs,Zs]=h.useState(!1),[mn,et]=h.useState(!1),[es,Pt]=h.useState(null),[st,Ft]=h.useState(""),[Dt,pa]=h.useState(!1),[un,tt]=h.useState(!1),[xn,ga]=h.useState(null),[It,$t]=h.useState(""),[Tt,At]=h.useState(""),[ja,kt]=h.useState(""),[hn,Et]=h.useState(null),[fa,Mt]=h.useState(null),[Na,ba]=h.useState(""),Ee=Ie||[],pn=s=>{var r;xt(s);const t=Ee.find(i=>i.id===s);if(t){const i=t.precio_venta,a=i&&i>0?i.toString():((r=t.costo_unitario)==null?void 0:r.toString())||"0",n=i&&i>0;Gs(n),bs(a),pt(t.cantidad_stock||0),os(`Venta de ${t.nombre}`);const d=((i&&i>0?i:t.costo_unitario||0)*parseFloat(Ue)).toFixed(2);He(d)}},gn=s=>{if(bs(s),le&&s){const t=(parseFloat(s)*parseFloat(Ue||"1")).toFixed(2);He(t)}},jn=()=>{if(!Xe)return;const s=$e.find(d=>d.id===Xe);if(!s)return;const t=parseFloat(Js)||1,r=parseFloat(wt)||0,i=s.precio*t,a=Ze==="porcentaje"?i*(r/100):r,n=Math.max(0,i-a),l=oe.findIndex(d=>d.id===Xe);if(l!==-1){const d=[...oe];d[l].cantidad+=t,d[l].descuento+=a;const x=d[l].precio*d[l].cantidad;d[l].subtotal=Math.max(0,x-d[l].descuento),Qs(d)}else Qs([...oe,{id:s.id,nombre:s.nombre,precio:s.precio,cantidad:t,descuento:a,subtotal:n,imagen_url:s.imagen_url}]);bt(""),yt("1"),vt(""),ia("0")},fn=s=>{Qs(oe.filter(t=>t.id!==s))},Nn=()=>{if(!le)return;const s=Ee.find(x=>x.id===le);if(!s)return;const t=parseFloat(Ue)||1,r=parseFloat(Je)||0,i=parseFloat(jt)||0,a=r*t,n=Qe==="porcentaje"?a*(i/100):i,l=Math.max(0,a-n),d=X.findIndex(x=>x.id===le);if(d!==-1){const x=[...X];x[d].cantidad+=t,x[d].descuento+=n;const p=x[d].precioUnitario*x[d].cantidad;x[d].subtotal=Math.max(0,p-x[d].descuento),Hs(x)}else Hs([...X,{id:le,nombre:s.nombre,precioUnitario:r,cantidad:t,descuento:n,subtotal:l,stockDisponible:s.cantidad_stock||0,costoUnitario:s.costo_unitario||0,imagen_url:s.imagen_url}]);xt(""),ht("1"),bs(""),ft("0"),Nt("monto"),pt(0),Gs(!0),ce({title:"‚úÖ Producto agregado",description:`${s.nombre} agregado a la venta`})},bn=s=>{Hs(X.filter(t=>t.id!==s)),ce({title:"Producto eliminado",description:"El producto ha sido removido de la venta"})};h.useEffect(()=>{if(O==="precargados"&&oe.length>0){const s=oe.reduce((t,r)=>t+r.subtotal,0).toFixed(2);He(s),os(`Venta de ${oe.length} producto(s)`)}},[oe,O]),h.useEffect(()=>{if(O==="inventariados"&&X.length>0){const s=X.reduce((t,r)=>t+r.subtotal,0).toFixed(2);He(s),os(`Venta de ${X.length} producto(s) de inventario`)}},[X,O]);const vn=s=>{bt(s);const t=$e.find(r=>r.id===s);t&&vt(t.precio.toString())},va=()=>{const s=[];return O||s.push("Tipo de Ingreso"),O==="precargados"?oe.length===0&&s.push("Debe agregar al menos un producto"):O==="inventariados"?X.length===0&&s.push("Debe agregar al menos un producto del inventario"):(O==="general"||O==="otros")&&(As.trim()||s.push("Descripci√≥n")),O!=="precargados"&&O!=="inventariados"&&(!_e||parseFloat(_e)<=0)&&s.push("Monto Total"),(M==="credito"||M==="parcial")&&(ne||s.push("Tipo de Cliente"),ne==="recurrente"&&!Pe&&s.push("Cliente Seleccionado"),ne==="nuevo"&&(is.trim()||s.push("Nombre del Cliente"),Te.trim()||s.push("Tel√©fono del Cliente"),Ae.trim()||s.push("Email del Cliente")),Os||s.push("Fecha de Vencimiento"),M==="parcial"&&((!ke||parseFloat(ke)<=0)&&s.push("Monto Abonado"),_e&&ke&&parseFloat(ke)>=parseFloat(_e)&&s.push("Monto Abonado debe ser menor al total"))),(M==="contado"||M==="parcial")&&!Ts&&s.push("M√©todo de Pago"),M||s.push("Tipo de Pago"),s},se=s=>va().includes(s),yn=(s,t,r)=>{const i=[];return!Le||Le.length===0||Le.forEach(a=>{a.telefono&&s&&a.telefono.trim()===s.trim()&&i.push(`El tel√©fono ${s} ya est√° registrado para el cliente "${a.nombre}"`),a.email&&t&&a.email.trim().toLowerCase()===t.trim().toLowerCase()&&i.push(`El correo ${t} ya est√° registrado para el cliente "${a.nombre}"`),a.rfc&&r&&a.rfc.trim().toUpperCase()===r.trim().toUpperCase()&&i.push(`El RFC ${r} ya est√° registrado para el cliente "${a.nombre}"`)}),i};h.useEffect(()=>{if(ne==="nuevo"&&(Te||Ae||Oe)){const s=yn(Te,Ae,Oe);Ls(s)}else Ls([])},[Te,Ae,Oe,ne,Le]),h.useEffect(()=>{(async()=>{var t;try{const r=await De("/api/ingresos/asientos-directos"),i=(r==null?void 0:r.asientos)??((t=r==null?void 0:r.data)==null?void 0:t.asientos)??r??[],a=null;if(!i)return;const n=i.filter(l=>l.detalle_asientos.some(d=>d.cuenta_codigo.startsWith("4")&&d.cuenta_codigo!=="4003"&&Number(d.haber)>0));Za(n)}catch(r){console.error("Error al cargar asientos directos:",r)}})()},[]),h.useEffect(()=>{(async()=>{var t,r,i;try{let a,n;ee==="diario"?(a=new Date(he),a.setHours(0,0,0,0),n=new Date(he),n.setHours(23,59,59,999)):ee==="mensual"?(a=new Date(V.getFullYear(),V.getMonth(),1),n=new Date(V.getFullYear(),V.getMonth()+1,0,23,59,59,999)):(a=new Date(new Date().getFullYear(),0,1),n=new Date(new Date().getFullYear(),11,31,23,59,59,999));const l=a.toISOString().split("T")[0],d=n.toISOString().split("T")[0],x=g=>{const q=Number(g);return Number.isFinite(q)?q:0},p=g=>String((g==null?void 0:g.cuenta_codigo)??(g==null?void 0:g.cuentaCodigo)??(g==null?void 0:g.cuenta)??""),o=g=>ts((g==null?void 0:g.fecha)??(g==null?void 0:g.createdAt)??(g==null?void 0:g.created_at)),c=g=>String((g==null?void 0:g.id)??(g==null?void 0:g._id)??""),m=g=>String((g==null?void 0:g.asiento_id)??(g==null?void 0:g.asientoId)??(g==null?void 0:g.asiento)??""),f=g=>ts((g==null?void 0:g.fecha)??(g==null?void 0:g.createdAt)??(g==null?void 0:g.created_at)),S=g=>ee==="diario"?"Hoy":ee==="mensual"?`D√≠a ${g.getDate()}`:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][g.getMonth()];let _=0,v=0,I=0;const A={},C=g=>{A[g]||(A[g]={ventasBrutas:0,descuentos:0,otrosIngresos:0})},N=await De(`/api/ingresos/asientos?start=${encodeURIComponent(l)}&end=${encodeURIComponent(d)}`),z=(N==null?void 0:N.asientos)??((t=N==null?void 0:N.data)==null?void 0:t.asientos)??[],te=(N==null?void 0:N.detalles)??((r=N==null?void 0:N.data)==null?void 0:r.detalles)??[];if(!z||z.length===0){const g=await De(`/api/ingresos/detalles?start=${encodeURIComponent(l)}&end=${encodeURIComponent(d)}`),q=(g==null?void 0:g.detalles)??((i=g==null?void 0:g.data)==null?void 0:i.detalles)??[];if(!q||q.length===0){mt({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]});return}for(const Y of q){const Ne=o(Y);if(!Ne||isNaN(Ne.getTime()))continue;const Be=S(Ne);C(Be);const Z=p(Y),Me=x(Y==null?void 0:Y.debe),ss=x(Y==null?void 0:Y.haber);if(Z){if(B==="ventas"){if(Z==="4001"){const be=ss-Me;_+=be,A[Be].ventasBrutas+=be}if(Z==="4003"){const be=Me-ss;v+=be,A[Be].descuentos+=be}}else if(Z.startsWith("4")&&Z!=="4001"&&Z!=="4003"){const be=ss-Me;I+=be,A[Be].otrosIngresos+=be}}}}else for(const g of z){const q=c(g),Y=f(g);if(!Y||isNaN(Y.getTime()))continue;const Ne=S(Y);C(Ne);const Be=(te||[]).filter(Z=>m(Z)===q);for(const Z of Be){const Me=p(Z),ss=x(Z==null?void 0:Z.debe),be=x(Z==null?void 0:Z.haber);if(Me){if(B==="ventas"){if(Me==="4001"){const We=be-ss;_+=We,A[Ne].ventasBrutas+=We}if(Me==="4003"){const We=ss-be;v+=We,A[Ne].descuentos+=We}}else if(Me.startsWith("4")&&Me!=="4001"&&Me!=="4003"){const We=be-ss;I+=We,A[Ne].otrosIngresos+=We}}}}let pe=[];if(ee==="diario"){const g=A.Hoy||{ventasBrutas:0,descuentos:0,otrosIngresos:0};pe=[{periodo:"Hoy",ventasBrutas:g.ventasBrutas,descuentos:g.descuentos,ventasNetas:g.ventasBrutas-g.descuentos,otrosIngresos:g.otrosIngresos}]}else if(ee==="mensual"){const g=new Date(V.getFullYear(),V.getMonth()+1,0).getDate();pe=Array.from({length:g},(q,Y)=>{const Be=`D√≠a ${Y+1}`,Z=A[Be]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:Be,ventasBrutas:Z.ventasBrutas,descuentos:Z.descuentos,ventasNetas:Z.ventasBrutas-Z.descuentos,otrosIngresos:Z.otrosIngresos}})}else pe=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"].map(q=>{const Y=A[q]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:q,ventasBrutas:Y.ventasBrutas,descuentos:Y.descuentos,ventasNetas:Y.ventasBrutas-Y.descuentos,otrosIngresos:Y.otrosIngresos}});mt({ventasBrutas:_,descuentos:v,ventasNetas:_-v,otrosIngresos:I,detallesPorPeriodo:pe})}catch(a){console.error("Error calculando anal√≠ticas desde asientos:",a),mt({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]})}})()},[ee,he,V,B]),h.useEffect(()=>{(async()=>{try{const r=async d=>{var C;const x=new Date;let p,o;if(d==="dia")p=he.toISOString().split("T")[0],o=p;else if(d==="mes"){const N=V.getMonth(),z=V.getFullYear(),te=new Date(z,N,1),pe=new Date(z,N+1,0);p=te.toISOString().split("T")[0],o=pe.toISOString().split("T")[0]}else{const N=x.getFullYear();p=`${N}-01-01`,o=`${N}-12-31`}const c=await De(`/api/ingresos/detalles?start=${encodeURIComponent(p)}&end=${encodeURIComponent(o)}`),m=(c==null?void 0:c.detalles)??((C=c==null?void 0:c.data)==null?void 0:C.detalles)??c??[],f=null;let S=0,_=0,v=0;(m||[]).forEach(N=>{const z=Number(N.debe)||0,te=Number(N.haber)||0,pe=N.cuenta_codigo;pe==="4001"?S+=te-z:pe==="4003"?_+=z-te:pe!=null&&pe.startsWith("4")&&(v+=te-z)});const I=S-_,A=I+v;return{ventasBrutas:S,descuentos:_,ventasNetas:I,otrosIngresos:v,totalIngresos:A}},i=async()=>{var d;try{let x,p=new Date;ee==="diario"?(x=new Date(he),x.setHours(0,0,0,0),p=new Date(he),p.setHours(23,59,59,999)):ee==="mensual"?(x=new Date(V.getFullYear(),V.getMonth(),1),p=new Date(V.getFullYear(),V.getMonth()+1,0,23,59,59,999)):(x=new Date(V.getFullYear(),0,1),p=new Date(V.getFullYear(),11,31,23,59,59,999));const o=await De(`/api/inventario/movimientos?tipo=venta&start=${encodeURIComponent(x.toISOString())}&end=${encodeURIComponent(p.toISOString())}`),c=(o==null?void 0:o.movimientos)??((d=o==null?void 0:o.data)==null?void 0:d.movimientos)??o??[],m=null;Us(c||[])}catch(x){console.error("Error en cargarMovimientosInventario:",x),Us([])}},[a,n,l]=await Promise.all([r("dia"),r("mes"),r("ano")]);Ja(a),Qa(n),Xa(l)}catch(r){console.error("Error calculando totales:",r)}})(),(async()=>{var r;try{let i,a=new Date;ee==="diario"?(i=new Date(he),i.setHours(0,0,0,0),a=new Date(he),a.setHours(23,59,59,999)):ee==="mensual"?(i=new Date(V.getFullYear(),V.getMonth(),1),a=new Date(V.getFullYear(),V.getMonth()+1,0,23,59,59,999)):(i=new Date(V.getFullYear(),0,1),a=new Date(V.getFullYear(),11,31,23,59,59,999));const n=await De(`/api/inventario/movimientos?tipo=venta&start=${encodeURIComponent(i.toISOString())}&end=${encodeURIComponent(a.toISOString())}`),l=(n==null?void 0:n.movimientos)??((r=n==null?void 0:n.data)==null?void 0:r.movimientos)??n??[],d=null;Us(l||[])}catch(i){console.error("Error en loadMovimientos:",i),Us([])}})()},[he,V,ee,w]);const wn=async s=>{var r,i;const t=String(s??"").trim();if(ut(!0),qs(null),!t||t==="undefined"||t==="null"){ut(!1);return}try{const a=await De(`/api/asientos/by-transaccion?source=ingreso&id=${encodeURIComponent(t)}`),n=(a==null?void 0:a.asiento)??((r=a==null?void 0:a.data)==null?void 0:r.asiento)??a??null;qs(n)}catch(a){const n=String((a==null?void 0:a.message)??"");(a==null?void 0:a.status)===404||((i=a==null?void 0:a.response)==null?void 0:i.status)===404||n.includes("404")||(console.error("Error en loadAsientosContables:",a),ce({title:"Error",description:"Error inesperado al cargar asientos",variant:"destructive"})),qs(null)}finally{ut(!1)}},Sn=async()=>{var t;const s=va();if(s.length>0){ce({title:"‚ö†Ô∏è Campos requeridos faltantes",description:`Debes completar: ${s.join(", ")}`,variant:"destructive"});return}if(O==="inventariados"){if(X.length===0){ce({title:"‚ö†Ô∏è No hay productos",description:"Debes agregar al menos un producto del inventario a la venta",variant:"destructive"});return}for(const r of X)if(r.cantidad>r.stockDisponible){const i=Ee.find(a=>a.id===r.id);zs({productName:r.nombre,requested:r.cantidad,available:r.stockDisponible,costoPorUnidad:(i==null?void 0:i.costo_unitario)||0,costoTotal:((i==null?void 0:i.costo_unitario)||0)*r.cantidad}),hs(!0);return}await Vt();return}if(O==="inventariados"&&le){const r=parseFloat(Ue||"1");if(r>Ys){const i=Ee.find(d=>d.id===le);let a=(i==null?void 0:i.costo_unitario)||0;if(a===0){const d=await De(`/api/inventario/productos/${encodeURIComponent(le)}/movimientos?tipo=compra`),x=(d==null?void 0:d.movimientos)??((t=d==null?void 0:d.data)==null?void 0:t.movimientos)??d??[];if(x&&x.length>0){let p=0,o=0;for(const c of x)c.costo_unitario>0&&c.cantidad>0&&(p+=c.costo_unitario*c.cantidad,o+=c.cantidad);o>0&&(a=p/o)}}const n=r-Ys,l=a*n;zs({productName:(i==null?void 0:i.nombre)||"Producto",requested:r,available:Ys,costoPorUnidad:a,costoTotal:l}),hs(!0);return}}ne==="nuevo"&&ze.length>0&&!confirm(`Se detectaron posibles duplicados:

${ze.join(`
`)}

¬øDeseas continuar registrando este cliente de todas formas?`)||await Vt()},Vt=async()=>{ks(!0);try{let s=null;if(ne==="nuevo"&&is.trim())try{s=(await Ra.mutateAsync({nombre:is.trim(),email:Ae.trim()||void 0,telefono:Te.trim()||void 0,rfc:Oe.trim()||void 0})).id}catch(p){console.error("Error creating client:",p),ce({title:"Error al crear cliente",description:"No se pudo crear el cliente nuevo",variant:"destructive"}),ks(!1);return}else ne==="recurrente"&&Pe&&(s=Pe);const t=Ee.find(p=>p.id===le);let r=As,i=Number(_e||"0"),a=null,n=0;if(O==="precargados"&&oe.length>0){const p=$e.find(m=>m.id===oe[0].id);a=(p==null?void 0:p.subcuenta_id)||null;const o=oe.reduce((m,f)=>m+f.precio*f.cantidad,0),c=oe.reduce((m,f)=>m+f.descuento,0);i=o,n=c,r=`Venta: ${oe.map(m=>`${m.nombre} (x${m.cantidad})`).join(", ")}`}else O==="inventariados"&&(r="Venta de productos inventariados",i=0,a=null);O!=="precargados"&&(n=Oa?Number(La||"0"):0);const l=Math.max(0,Number((i-n).toFixed(2)));let d=0,x=0;if(M==="contado"?(d=l,x=0):M==="parcial"?(d=Number(ke||"0"),x=Math.max(0,l-d)):M==="credito"&&(d=0,x=l),O==="inventariados"&&X.length>0){const p=X.reduce((S,_)=>S+_.precioUnitario*_.cantidad,0),o=X.reduce((S,_)=>S+_.descuento,0),c=p-o;let m=0,f=0;M==="contado"?(m=c,f=0):M==="parcial"?(m=Number(ke||"0"),f=Math.max(0,c-m)):M==="credito"&&(m=0,f=c);for(const S of X){const _=Ee.find(te=>te.id===S.id);if(!_)continue;const v=X.length===1?`Venta de ${S.nombre}`:`Venta m√∫ltiple (${X.length} productos): ${S.nombre}`,I=S.subtotal/c,A=m*I,C=f*I,{data:N,error:z}=await Ot("registrar-ingreso",{body:{tipoIngreso:"inventariados",descripcion:v,montoTotal:S.precioUnitario*S.cantidad,montoDescuento:S.descuento,cuentaPrincipalCodigo:"4001",subcuentaId:_.subcuenta_id||null,metodoPago:Ts,tipoPago:M,montoPagado:A,montoPendiente:C,clienteNombre:is.trim()||null,clienteTelefono:Te.trim()||null,clienteEmail:Ae.trim()||null,clienteRFC:Oe.trim()||null,clienteId:s,fechaVencimiento:Os||null,comentarios:Bs.trim()||null,productoId:S.id,cantidadVendida:S.cantidad,precioVenta:S.precioUnitario,costoPersonalizado:cs==="personalizado"&&ue?parseFloat(ue):void 0}});if(z)throw z}ce({title:"‚úÖ Venta registrada exitosamente",description:`Se registraron ${X.length} productos del inventario`,duration:5e3})}else{if(!r||i<=0){ce({title:"‚ö†Ô∏è Datos incompletos",description:"Selecciona un producto v√°lido o ingresa una descripci√≥n y monto.",variant:"destructive"}),ks(!1);return}const{data:p,error:o}=await Ot("registrar-ingreso",{body:{tipoIngreso:O,descripcion:r,montoTotal:i,montoDescuento:n,cuentaPrincipalCodigo:O==="otros"?"4102":"4001",subcuentaId:a||void 0,metodoPago:Ts,tipoPago:M,montoPagado:d,montoPendiente:x,clienteNombre:is.trim()||null,clienteTelefono:Te.trim()||null,clienteEmail:Ae.trim()||null,clienteRFC:Oe.trim()||null,clienteId:s,fechaVencimiento:Os||null,comentarios:Bs.trim()||null,...O==="inventariados"&&t?{productoId:t.id,cantidadVendida:Number(Ue||"1"),precioVenta:Number(Je||"0"),costoPersonalizado:cs==="personalizado"&&ue?Number(ue):void 0}:{}}});if(o)throw o;ce({title:"Ingreso registrado",description:`Asiento ${p.numeroAsiento} creado correctamente`})}await Promise.all([F(),me()]),O==="inventariados"&&window.location.reload(),rs(""),os(""),He(""),za(""),Ba(!1),Yt(""),Gt(""),Kt(""),ct(""),Es(""),Ms(""),Vs(""),Rs(""),Jt(""),Qt(""),lt(""),Ls([]),bt(""),vt(""),yt("1"),Qs([]),xt(""),bs(""),ht("1"),pt(0),Gs(!0),Hs([]),ft("0"),Nt("monto")}catch(s){ce({title:"Error",description:s.message||"Error al registrar el ingreso",variant:"destructive"})}finally{ks(!1)}},Cn=async()=>{if(!es||!st.trim()){ce({title:"‚ö†Ô∏è Motivo requerido",description:"Debes ingresar el motivo de la cancelaci√≥n",variant:"destructive"});return}pa(!0);try{console.log("Cancelando transacci√≥n:",es.id);const{data:s,error:t}=await Ot("cancelar-ingreso",{body:{transaccionId:es.id,motivoCancelacion:st.trim()}});if(console.log("Respuesta de edge function:",{data:s,error:t}),t)throw console.error("Error de edge function:",t),new Error(t.message||JSON.stringify(t));if(s!=null&&s.error)throw console.error("Error en data:",s),new Error(s.error);ce({title:"‚úì Transacci√≥n cancelada",description:`Asiento de reversi√≥n ${(s==null?void 0:s.numeroAsientoReversion)||"creado"} correctamente`}),await Promise.all([F(),me()]),Ft(""),Pt(null),et(!1)}catch(s){console.error("Error completo al cancelar:",s),ce({title:"‚ùå Error al cancelar",description:(s==null?void 0:s.message)||(s==null?void 0:s.toString())||"No se pudo cancelar la transacci√≥n",variant:"destructive"})}finally{pa(!1)}},_n=s=>{switch(s){case"precargados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ye,{children:[e.jsx(U,{className:"h-4 w-4"}),e.jsxs(Ge,{children:[e.jsx("strong",{children:"Recordatorio:"}),' Para registrar ventas de productos precargados, primero debes agregar los productos al cat√°logo desde la pesta√±a "Cat√°logo de Productos".']})]}),e.jsxs(H,{className:"bg-muted/50",children:[e.jsx(K,{className:"pb-3",children:e.jsx(J,{className:"text-base",children:"Agregar Productos a la Venta"})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"producto-precargado",children:"Seleccionar Producto"}),e.jsxs(ve,{value:Xe,onValueChange:vn,children:[e.jsx(ye,{children:e.jsx(Fe,{placeholder:it?"Cargando productos...":"Seleccionar producto del cat√°logo"})}),e.jsx(we,{className:"max-h-80 z-50 bg-background border border-border w-full",children:it?e.jsx(E,{value:"loading",disabled:!0,children:"Cargando productos..."}):$e.length===0?e.jsx(E,{value:"empty",disabled:!0,children:"No hay productos de servicios registrados"}):$e.map(t=>e.jsx(E,{value:t.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Re,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate mb-1",children:t.nombre}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",D(t.precio)]})]})]})},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cantidad",children:"Cantidad"}),e.jsx(W,{id:"cantidad",type:"number",placeholder:"1",min:"1",value:Js,onChange:t=>yt(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"precio-unitario",children:"Precio Unitario"}),e.jsx(W,{id:"precio-unitario",type:"number",placeholder:"0.00",value:Ks,readOnly:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"descuento-producto",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(Ve,{value:Ze,onValueChange:t=>on(t),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"monto",id:"descuento-monto"}),e.jsx(j,{htmlFor:"descuento-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"porcentaje",id:"descuento-porcentaje"}),e.jsx(j,{htmlFor:"descuento-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(W,{id:"descuento-producto",type:"number",placeholder:Ze==="porcentaje"?"0":"0.00",min:"0",max:Ze==="porcentaje"?"100":void 0,step:Ze==="porcentaje"?"1":"0.01",value:wt,onChange:t=>ia(t.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Ze==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Subtotal con Descuento"}),e.jsx(W,{type:"text",value:Xe&&Ks?(()=>{const t=parseFloat(Ks)*parseFloat(Js||"1"),r=parseFloat(wt||"0"),i=Ze==="porcentaje"?Math.max(0,t-t*r/100):Math.max(0,t-r);return`$${D(i)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(L,{type:"button",onClick:jn,disabled:!Xe,className:"w-full",variant:"secondary",children:[e.jsx(Rt,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),oe.length>0&&e.jsxs(H,{children:[e.jsx(K,{className:"pb-3",children:e.jsxs(J,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",oe.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",D(oe.reduce((t,r)=>t+r.subtotal,0))]})]})}),e.jsx(Q,{children:e.jsx("div",{className:"space-y-2",children:oe.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Re,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[t.cantidad," x $",D(t.precio)," = $",D(t.cantidad*t.precio)]}),t.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",D(t.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",D(t.subtotal)]})]})]})]}),e.jsx(L,{type:"button",variant:"ghost",size:"sm",onClick:()=>fn(t.id),className:"text-destructive hover:text-destructive",children:e.jsx(U,{className:"h-4 w-4"})})]},`${t.id}-${r}`))})})]}),se("Debe agregar al menos un producto")&&e.jsxs(Ye,{variant:"destructive",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(Ge,{children:"Debes agregar al menos un producto a la venta"})]})]});case"inventariados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ye,{children:[e.jsx(U,{className:"h-4 w-4"}),e.jsxs(Ge,{children:[e.jsx("strong",{children:"Ventas desde Inventario:"})," Selecciona productos, aplica descuentos opcionales y agr√©galos a la venta. Si vendes m√°s de lo disponible, se te pedir√° confirmar la sobreventa."]})]}),e.jsxs(H,{className:"bg-muted/50",children:[e.jsx(K,{className:"pb-3",children:e.jsx(J,{className:"text-base",children:"Agregar Productos del Inventario"})}),e.jsxs(Q,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"producto-inventario",children:"Seleccionar Producto"}),e.jsxs(ve,{value:le,onValueChange:pn,children:[e.jsx(ye,{children:e.jsx(Fe,{placeholder:Ce?"Cargando inventario...":"Seleccionar producto del inventario"})}),e.jsx(we,{className:"max-h-80 z-50 bg-background border border-border w-full",children:Ce?e.jsx(E,{value:"loading",disabled:!0,children:"Cargando inventario..."}):Ee.length===0?e.jsx(E,{value:"empty",disabled:!0,children:"No hay productos con stock disponible"}):Ee.map(t=>e.jsx(E,{value:t.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Re,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.nombre}),e.jsxs("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full flex-shrink-0 ml-2",children:["Stock: ",t.cantidad_stock||0]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Costo: $",t.costo_unitario||0]}),t.precio_venta&&t.precio_venta>0?e.jsxs("span",{className:"text-xs text-green-600 font-medium",children:["Venta: $",t.precio_venta]}):e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"‚ö†Ô∏è Sin precio"})]})]})]})},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cantidad-inv",children:"Cantidad a Vender"}),e.jsx(W,{id:"cantidad-inv",type:"number",min:"1",value:Ue,onChange:t=>ht(t.target.value)}),le&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Stock disponible: ",Ys," unidades"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"precio-inv",children:"Precio Unitario"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Ve,{value:gt?"registrado":"personalizado",onValueChange:t=>{const r=t==="registrado";if(Gs(r),r&&le){const i=Ee.find(a=>a.id===le);if(i){const a=i.precio_venta||i.costo_unitario||0;bs(a.toString())}}},className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"registrado",id:"precio-registrado"}),e.jsx(j,{htmlFor:"precio-registrado",className:"text-sm cursor-pointer",children:"Precio registrado"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"personalizado",id:"precio-personalizado"}),e.jsx(j,{htmlFor:"precio-personalizado",className:"text-sm cursor-pointer",children:"Personalizado"})]})]}),e.jsx(W,{id:"precio-inv",type:"number",step:"0.01",min:"0",value:Je,onChange:t=>gn(t.target.value),readOnly:gt,className:gt?"bg-muted":""})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"descuento-inv",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(Ve,{value:Qe,onValueChange:t=>Nt(t),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"monto",id:"descuento-inv-monto"}),e.jsx(j,{htmlFor:"descuento-inv-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"porcentaje",id:"descuento-inv-porcentaje"}),e.jsx(j,{htmlFor:"descuento-inv-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(W,{id:"descuento-inv",type:"number",placeholder:Qe==="porcentaje"?"0":"0.00",min:"0",max:Qe==="porcentaje"?"100":void 0,step:Qe==="porcentaje"?"1":"0.01",value:jt,onChange:t=>ft(t.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Qe==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Subtotal con Descuento"}),e.jsx(W,{type:"text",value:le&&Je?(()=>{const t=parseFloat(Je)*parseFloat(Ue||"1"),r=parseFloat(jt||"0"),i=Qe==="porcentaje"?Math.max(0,t-t*r/100):Math.max(0,t-r);return`$${D(i)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(L,{type:"button",onClick:Nn,disabled:!le||!Je,className:"w-full",variant:"secondary",children:[e.jsx(Rt,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),X.length>0&&e.jsxs(H,{children:[e.jsx(K,{className:"pb-3",children:e.jsxs(J,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",X.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",D(X.reduce((t,r)=>t+r.subtotal,0))]})]})}),e.jsx(Q,{children:e.jsx("div",{className:"space-y-2",children:X.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Re,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[t.cantidad," x $",D(t.precioUnitario)," = $",D(t.cantidad*t.precioUnitario)]}),t.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",D(t.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",D(t.subtotal)]}),e.jsxs("span",{className:"text-xs",children:["Stock disponible: ",t.stockDisponible]})]})]})]}),e.jsx(L,{type:"button",variant:"ghost",size:"sm",onClick:()=>bn(t.id),className:"text-destructive hover:text-destructive",children:e.jsx(U,{className:"h-4 w-4"})})]},`${t.id}-${r}`))})})]})]});case"general":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"descripcion-general",children:"Descripci√≥n del Ingreso"}),se("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(W,{id:"descripcion-general",placeholder:"Ej: Servicio de consultor√≠a",value:As,onChange:t=>os(t.target.value),className:se("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cuenta-contable",children:"Cuenta Contable"}),e.jsxs(ve,{defaultValue:"4001",children:[e.jsx(ye,{children:e.jsx(Fe,{placeholder:"4001 - Ventas"})}),e.jsx(we,{children:e.jsx(E,{value:"4001",children:"4001 - Ventas"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"subcuenta",children:"Subcuenta (Opcional)"}),e.jsxs(ve,{children:[e.jsx(ye,{children:e.jsx(Fe,{placeholder:"Seleccionar subcuenta"})}),e.jsx(we,{children:e.jsx(E,{value:"sub1",children:"Subcuenta ejemplo"})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"monto-general",children:"Monto"}),se("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(W,{id:"monto-general",type:"number",placeholder:"0.00",value:_e,onChange:t=>He(t.target.value),className:se("Monto Total")?"border-destructive":""})]})]});case"otros":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ye,{children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(Ge,{children:"Este ingreso se ligar√° a la cuenta 4102 - Otros Productos."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"descripcion-otros",children:"Descripci√≥n del Ingreso Extraordinario"}),se("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(us,{id:"descripcion-otros",placeholder:"Ej: Venta extraordinaria de equipo usado, donaci√≥n recibida, etc.",value:As,onChange:t=>os(t.target.value),className:se("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"monto-otros",children:"Monto"}),se("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(W,{id:"monto-otros",type:"number",placeholder:"0.00",value:_e,onChange:t=>He(t.target.value),className:se("Monto Total")?"border-destructive":""})]})]});default:return null}},Pn=async()=>{if(!Ct.trim()||!_t.trim()){ce({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}Zs(!0);try{await Ma.mutateAsync({nombre:Ct.trim(),precio:parseFloat(_t),descripcion:da.trim()||void 0,subcuentaId:ua||void 0,imagen:dn||void 0}),ca(""),la(""),ma(""),ln("4001"),xa(""),ha(null),St(!1)}catch{}finally{Zs(!1)}},ya=s=>{var t;ga(s),$t(s.nombre),At(((t=s.precio)==null?void 0:t.toString())||""),kt(s.descripcion||""),Mt(s.imagen_url||null),Et(null),ba(s.subcuenta_id||""),tt(!0)},Fn=s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];if(t){Et(t);const i=new FileReader;i.onloadend=()=>{Mt(i.result)},i.readAsDataURL(t)}},Dn=async()=>{if(!It.trim()||!Tt.trim()){ce({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}Zs(!0);try{await Va.mutateAsync({id:xn.id,nombre:It.trim(),precio:parseFloat(Tt),descripcion:ja.trim()||void 0,imagen:hn||void 0,subcuentaId:Na||null}),tt(!1),ga(null),$t(""),At(""),kt(""),Et(null),Mt(null)}catch{}finally{Zs(!1)}};return e.jsxs("div",{className:"h-full overflow-hidden flex flex-col",children:[e.jsx(vs,{open:Ua,onOpenChange:hs,children:e.jsxs(ys,{children:[e.jsxs(ws,{children:[e.jsxs(Ss,{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(U,{className:"h-5 w-5"}),"Advertencia: Inventario Insuficiente"]}),e.jsxs(Cs,{className:"space-y-3 pt-4",children:[e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-950/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx("p",{className:"font-medium mb-2",children:"Est√°s a punto de vender un producto sin suficiente inventario:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Producto:"}),e.jsx("span",{className:"font-medium",children:y==null?void 0:y.productName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cantidad solicitada:"}),e.jsx("span",{className:"font-medium",children:y==null?void 0:y.requested})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Stock disponible:"}),e.jsx("span",{className:"font-medium",children:y==null?void 0:y.available})]}),e.jsx(qe,{}),e.jsxs("div",{className:"flex justify-between text-orange-600",children:[e.jsx("span",{className:"font-medium",children:"Faltante:"}),e.jsx("span",{className:"font-bold",children:((y==null?void 0:y.requested)||0)-((y==null?void 0:y.available)||0)})]})]})]}),(y==null?void 0:y.costoPorUnidad)&&y.costoPorUnidad>0&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border-2 border-blue-300 dark:border-blue-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(wa,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),e.jsx("p",{className:"font-bold text-blue-700 dark:text-blue-300",children:"üìä Costo Promedio Hist√≥rico"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Costo promedio calculado:"}),e.jsxs("span",{className:"text-lg font-bold text-blue-700 dark:text-blue-300",children:["$",D(y.costoPorUnidad)," por unidad"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Este costo se calcul√≥ autom√°ticamente del promedio ponderado de todas tus compras anteriores de este producto. Puedes usar este costo sugerido o ingresar uno personalizado si conoces el costo real de esta venta."})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"font-medium mb-3 text-blue-700 dark:text-blue-400",children:"Impacto en el inventario:"}),y!=null&&y.costoPorUnidad&&y.costoPorUnidad>0?e.jsxs(e.Fragment,{children:[e.jsxs(Ve,{value:cs,onValueChange:s=>{dt(s),s==="historico"&&ps("")},className:"space-y-3 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"historico",id:"costo-historico"}),e.jsxs(j,{htmlFor:"costo-historico",className:"text-sm cursor-pointer",children:["Usar costo hist√≥rico: ",e.jsxs("strong",{className:"text-blue-700 dark:text-blue-400",children:["$",D(y.costoPorUnidad)]})," por unidad"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"personalizado",id:"costo-personalizado"}),e.jsx(j,{htmlFor:"costo-personalizado",className:"text-sm cursor-pointer",children:"Ingresar costo personalizado"})]})]}),cs==="personalizado"&&e.jsxs("div",{className:"mb-3",children:[e.jsx(j,{htmlFor:"costo-custom",className:"text-xs",children:"Costo unitario personalizado"}),e.jsx(W,{id:"costo-custom",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:ue,onChange:s=>ps(s.target.value),className:"mt-1"})]}),e.jsx(qe,{className:"my-3"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Costo por unidad aplicado:"}),e.jsxs("span",{className:"font-medium",children:["$",D(cs==="personalizado"&&ue?ue:y.costoPorUnidad)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",D((cs==="personalizado"&&ue?Number(ue):y.costoPorUnidad)*(((y==null?void 0:y.requested)||0)-((y==null?void 0:y.available)||0)))]})]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"‚ö†Ô∏è Este producto no tiene costo hist√≥rico registrado."}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"costo-requerido",className:"text-xs",children:"Ingresa el costo unitario para esta transacci√≥n"}),e.jsx(W,{id:"costo-requerido",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:ue,onChange:s=>ps(s.target.value),className:"mt-1"})]}),ue&&Number(ue)>0&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",D(Number(ue)*(((y==null?void 0:y.requested)||0)-((y==null?void 0:y.available)||0)))]})]})]})]})]}),e.jsxs("p",{className:"text-sm",children:["Si contin√∫as, el inventario quedar√° en ",e.jsxs("strong",{className:"text-destructive",children:["negativo (",((y==null?void 0:y.available)||0)-((y==null?void 0:y.requested)||0)," unidades)"]}),". Esto se reflejar√° en tu control de inventario con el valor mostrado arriba."]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"¬øDeseas continuar con la venta de todas formas?"})]})]}),e.jsxs(at,{className:"gap-2 sm:gap-0",children:[e.jsx(L,{variant:"outline",onClick:()=>{hs(!1),zs(null),dt("historico"),ps("")},children:"Cancelar"}),e.jsxs(L,{variant:"destructive",onClick:async()=>{if((!(y!=null&&y.costoPorUnidad)||y.costoPorUnidad===0)&&(!ue||Number(ue)<=0)){ce({title:"Costo requerido",description:"Debes ingresar un costo unitario para continuar",variant:"destructive"});return}hs(!1),zs(null),await Vt(),dt("historico"),ps("")},children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Continuar con la Venta"]})]})]})}),e.jsxs("div",{className:"p-6 border-b bg-background",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Registro de Ingresos"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Registra ventas, gestiona cat√°logos y analiza ingresos de la empresa"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[e.jsxs(Sa,{defaultValue:"registro",className:"w-full",children:[e.jsxs(Ca,{className:"grid w-full grid-cols-4",children:[e.jsx(ds,{value:"registro",children:"Registro de Ingresos"}),e.jsx(ds,{value:"resumen",children:"Resumen de Ventas"}),e.jsx(ds,{value:"analitica",children:"Anal√≠tica de Ventas"}),e.jsx(ds,{value:"catalogo",children:"Cat√°logo de Productos"})]}),e.jsx(ms,{value:"registro",className:"mt-6 space-y-6",children:e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsx(J,{children:"Nuevo Registro de Ingreso"}),e.jsx(de,{children:"Selecciona el tipo de ingreso y completa la informaci√≥n requerida"})]}),e.jsxs(Q,{className:"space-y-6",children:[!O&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(j,{className:"text-base font-semibold",children:"Selecciona el tipo de ingreso que deseas registrar"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6",children:[e.jsxs("button",{type:"button",onClick:()=>rs("precargados"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(_a,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Productos Precargados"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Del cat√°logo de servicios/productos"})]}),e.jsxs("button",{type:"button",onClick:()=>rs("inventariados"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Re,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Productos Inventariados"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Del inventario registrado"})]}),e.jsxs("button",{type:"button",onClick:()=>rs("general"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Pa,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Ingreso General"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Operaci√≥n no inventariada"})]}),e.jsxs("button",{type:"button",onClick:()=>rs("otros"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Jn,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Otros Ingresos"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Extraordinarios, donaciones"})]})]})]}),O&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(L,{type:"button",variant:"ghost",size:"sm",className:"px-0",onClick:()=>rs(""),children:"‚Üê Volver al men√∫ de selecci√≥n"}),e.jsxs("div",{className:"space-y-6 p-4 border rounded-lg bg-muted/20",children:[_n(O),e.jsx(qe,{}),e.jsx("div",{className:"space-y-4",children:O==="precargados"&&Xe||O==="inventariados"&&le?e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"C√°lculo Autom√°tico"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cantidad:"}),e.jsx("span",{children:O==="precargados"?Js:Ue})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Precio Unitario:"}),e.jsxs("span",{children:["$",O==="precargados"?Ks:Je]})]}),e.jsx(qe,{}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",_e]})]})]})]}):null}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"font-medium",children:"Estado del Pago"}),se("Tipo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(Ve,{value:M,onValueChange:Gt,className:se("Tipo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(G,{value:"contado",id:"contado"}),e.jsx(j,{htmlFor:"contado",className:"cursor-pointer",children:"Pago Total"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(G,{value:"parcial",id:"parcial"}),e.jsx(j,{htmlFor:"parcial",className:"cursor-pointer",children:"Pago parcial"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(G,{value:"credito",id:"credito"}),e.jsx(j,{htmlFor:"credito",className:"cursor-pointer",children:"Adeudo Total"})]})]}),M==="parcial"&&e.jsxs("div",{className:"ml-6 p-4 border rounded-lg bg-blue-50 dark:bg-blue-950/20 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"monto-abonado",children:"Monto que se va a pagar"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),se("Monto Abonado")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(W,{id:"monto-abonado",type:"number",step:"0.01",placeholder:"0.00",value:ke,onChange:s=>Qt(s.target.value),className:se("Monto Abonado")?"border-destructive":""})]}),_e&&ke&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-3 bg-white dark:bg-gray-900 rounded border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de la venta"}),e.jsxs("p",{className:"text-lg font-semibold text-primary",children:["$",D(_e)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Se pagar√° ahora"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:["$",D(ke)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Queda pendiente"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["$",D(parseFloat(_e)-parseFloat(ke))]})]})]})]})]}),e.jsx(qe,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_s,{className:"h-5 w-5"}),e.jsx(j,{className:"font-medium",children:"Datos del Cliente"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:M==="contado"?"Opcional - Para anal√≠ticas y comentarios":"Obligatorio para cuentas por cobrar"})]}),M==="contado"&&e.jsxs(Ye,{children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(Ge,{children:"Asignar cliente es opcional para pagos totales. √ötil para anal√≠ticas de ventas y seguimiento de clientes."})]}),(M==="parcial"||M==="credito")&&e.jsxs(Ye,{children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(Ge,{children:"Se registrar√° en Cuentas por Cobrar para an√°lisis de vencimientos"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"font-medium",children:"Tipo de Cliente"}),e.jsxs(ve,{value:ne,onValueChange:s=>{Kt(s),ct(""),Es(""),Ms(""),Vs(""),Rs(""),Ls([])},children:[e.jsx(ye,{children:e.jsx(Fe,{placeholder:M==="contado"?"Opcional - Selecciona para anal√≠ticas":"Selecciona el tipo de cliente"})}),e.jsxs(we,{children:[e.jsx(E,{value:"nuevo",children:"Cliente Nuevo"}),e.jsx(E,{value:"recurrente",children:"Cliente Recurrente"})]})]})]}),ne==="recurrente"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cliente-existente",children:"Seleccionar Cliente"}),(()=>{const s=Le.find(t=>t.id===Pe);return e.jsxs(ve,{value:Pe??"",onValueChange:t=>{ct(t);const r=Le.find(i=>i.id===t);r&&(Es(r.nombre),Ms(r.telefono||""),Vs(r.email||""),Rs(r.rfc||""))},children:[e.jsx(ye,{className:"h-auto py-2",children:s?e.jsxs("div",{className:"flex flex-col text-left leading-tight",children:[e.jsx("span",{className:"font-medium",children:s.nombre}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.telefono?`Tel: ${s.telefono}`:"",s.telefono&&s.email?" ‚Ä¢ ":"",s.email?`Email: ${s.email}`:"",s.source==="transaction"?" ‚Ä¢ (De transacci√≥n)":""]})]}):e.jsx("span",{className:"text-muted-foreground",children:"Buscar cliente existente..."})}),e.jsx(we,{className:"p-1",children:Ea?e.jsx("div",{className:"px-2 py-2 text-sm text-muted-foreground",children:"Cargando clientes..."}):Le.length===0?e.jsx("div",{className:"px-2 py-2 text-sm text-muted-foreground",children:"No hay clientes registrados"}):Le.map(t=>e.jsx(E,{value:t.id,className:"py-2",children:e.jsxs("div",{className:"flex flex-col text-left leading-tight",children:[e.jsx("span",{className:"font-medium",children:t.nombre}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.telefono?`Tel: ${t.telefono}`:"",t.telefono&&t.email?" ‚Ä¢ ":"",t.email?`Email: ${t.email}`:"",t.source==="transaction"?" ‚Ä¢ (De transacci√≥n)":""]})]})},t.id))})]})})(),!!Pe&&e.jsx("p",{className:"text-xs text-green-600",children:"‚úì Datos del cliente cargados autom√°ticamente"})]}),(ne==="nuevo"||ne==="recurrente"&&Pe)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cliente-nombre",children:"Nombre del Cliente"}),e.jsx(W,{id:"cliente-nombre",type:"text",placeholder:"Nombre completo",value:is,onChange:s=>Es(s.target.value),disabled:ne==="recurrente"&&Pe!==""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"cliente-telefono",children:"N√∫mero de Tel√©fono"}),(M==="parcial"||M==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),se("Tel√©fono del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(W,{id:"cliente-telefono",type:"tel",placeholder:"Ej: +52 55 1234 5678",value:Te,onChange:s=>Ms(s.target.value),className:se("Tel√©fono del Cliente")?"border-destructive":"",disabled:ne==="recurrente"&&Pe!==""}),ne==="nuevo"&&ze.some(s=>s.includes(Te)&&s.includes("tel√©fono"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:ze.find(s=>s.includes(Te)&&s.includes("tel√©fono"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"cliente-email",children:"Correo Electr√≥nico"}),(M==="parcial"||M==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),se("Email del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(W,{id:"cliente-email",type:"email",placeholder:"cliente@ejemplo.com",value:Ae,onChange:s=>Vs(s.target.value),className:se("Email del Cliente")?"border-destructive":"",disabled:ne==="recurrente"&&Pe!==""}),ne==="nuevo"&&ze.some(s=>s.includes(Ae)&&s.includes("correo"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:ze.find(s=>s.includes(Ae)&&s.includes("correo"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cliente-rfc",children:"RFC (ID Fiscal) - Opcional"}),e.jsx(W,{id:"cliente-rfc",type:"text",placeholder:"RFC123456ABC1",value:Oe,onChange:s=>Rs(s.target.value.toUpperCase()),maxLength:13,disabled:ne==="recurrente"&&Pe!==""}),ne==="nuevo"&&ze.some(s=>s.includes(Oe)&&s.includes("RFC"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:ze.find(s=>s.includes(Oe)&&s.includes("RFC"))})]})]}),(M==="parcial"||M==="credito")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"fecha-vencimiento",children:"Fecha de Vencimiento"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),se("Fecha de Vencimiento")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(W,{id:"fecha-vencimiento",type:"date",value:Os,onChange:s=>Jt(s.target.value),className:se("Fecha de Vencimiento")?"border-destructive":"",min:new Date().toISOString().split("T")[0]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Fecha l√≠mite para el pago"," ",M==="parcial"?"del monto pendiente":"completo"]})]}),M==="contado"&&ne&&e.jsxs("div",{className:"col-span-full space-y-2",children:[e.jsx(j,{htmlFor:"comentario-venta",children:"Comentarios de la venta (Opcional)"}),e.jsx(us,{id:"comentario-venta",placeholder:"Detalles adicionales sobre esta venta, preferencias del cliente, etc.",value:Bs,onChange:s=>lt(s.target.value),rows:2}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Informaci√≥n √∫til para futuras ventas y an√°lisis del cliente"})]})]})]}),e.jsx(qe,{}),(M==="contado"||M==="parcial")&&e.jsxs(e.Fragment,{children:[e.jsx(qe,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"font-medium",children:"M√©todo de Pago"}),se("M√©todo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(Ve,{value:Ts,onValueChange:Yt,className:se("M√©todo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(G,{value:"efectivo",id:"efectivo"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(zn,{className:"h-4 w-4 text-green-600"}),e.jsxs(j,{htmlFor:"efectivo",className:"cursor-pointer",children:["Efectivo"," ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Caja)"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(G,{value:"tarjeta",id:"tarjeta"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Un,{className:"h-4 w-4 text-blue-800"}),e.jsxs(j,{htmlFor:"tarjeta",className:"cursor-pointer",children:["Tarjeta"," ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Bancos)"})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"comentarios",children:"Comentarios de la venta (Opcional)"}),e.jsx(us,{id:"comentarios",placeholder:"Agrega cualquier comentario o nota sobre esta venta...",value:Bs,onChange:s=>lt(s.target.value),rows:3,className:"resize-none"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(L,{size:"lg",className:"px-8",onClick:Sn,disabled:Ht,children:[e.jsx(wa,{className:"mr-2 h-4 w-4"}),Ht?"Registrando...":"Registrar Ingreso"]})})]})]})]})]})}),e.jsx(ms,{value:"resumen",className:"mt-6",children:e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsx(J,{children:"Registro Detallado de Ventas"}),e.jsx(de,{children:"Historial completo de transacciones de ingresos"})]}),e.jsxs(Q,{children:[e.jsxs("div",{className:"mb-6 p-4 border rounded-lg bg-muted/30 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2 lg:col-span-2",children:[e.jsx(j,{children:"Rango de fechas"}),e.jsx(Zn,{value:en,onChange:an})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"filtro-tipo",children:"Tipo de Ingreso"}),e.jsxs(ve,{value:je,onValueChange:na,children:[e.jsx(ye,{id:"filtro-tipo",children:e.jsx(Fe,{placeholder:"Todos"})}),e.jsxs(we,{children:[e.jsx(E,{value:"todos",children:"Todos"}),e.jsx(E,{value:"precargados",children:"Precargados"}),e.jsx(E,{value:"inventariados",children:"Inventariados"}),e.jsx(E,{value:"general",children:"General"}),e.jsx(E,{value:"otros",children:"Otros"}),e.jsx(E,{value:"asiento_directo",children:"Venta de activo fijo"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"filtro-cuenta",children:"Cuenta"}),e.jsxs(ve,{value:fe,onValueChange:ra,children:[e.jsx(ye,{id:"filtro-cuenta",children:e.jsx(Fe,{placeholder:"Todas"})}),e.jsxs(we,{children:[e.jsx(E,{value:"todas",children:"Todas"}),e.jsx(E,{value:"4001",children:"4001 - Ventas"}),e.jsx(E,{value:"4004",children:"4004 - Ventas Inventarios"}),e.jsx(E,{value:"4101",children:"4101 - Productos Financieros"}),e.jsx(E,{value:"4102",children:"4102 - Otros Productos"}),e.jsx(E,{value:"4103",children:"4103 - Ganancia en Venta de Activos"}),e.jsx(E,{value:"4103",children:"4002 - Devoluciones sobre ventas"}),e.jsx(E,{value:"4103",children:"4002 - Descuentos sobre ventas"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"filtro-subcuenta",children:"Subcuenta"}),e.jsxs(ve,{value:ie,onValueChange:oa,children:[e.jsx(ye,{id:"filtro-subcuenta",children:e.jsx(Fe,{placeholder:"Todas"})}),e.jsxs(we,{children:[e.jsx(E,{value:"todas",children:"Todas"}),e.jsx(E,{value:"sin-subcuenta",children:"Sin subcuenta"}),ae.map(s=>e.jsx(E,{value:s.id,children:s.nombre},s.id))]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>{ta(void 0),Zt(""),sa(""),na("todos"),ra("todas"),oa("")},children:"Limpiar Filtros"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Resultados:"," ",(()=>{const s=ls.map(a=>{const n=a.detalle_asientos.find(l=>l.cuenta_codigo.startsWith("4")&&Number(l.haber)>0);return{created_at:a.fecha,fecha:a.fecha,fecha_fixed:a.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(n==null?void 0:n.cuenta_codigo)||"",subcuenta_id:n==null?void 0:n.subcuenta_id}});return[...w??[],...s??[]].map(Is).filter(a=>{const n=a.fecha_fixed??a.fecha??a.created_at,l=Ws(n),d=!je||je==="todos"||a.tipo_ingreso===je,x=!fe||fe==="todas"||a.cuenta_principal_codigo===fe,p=!ie||ie==="todas"||ie==="sin-subcuenta"&&!a.subcuenta_id||a.subcuenta_id===ie;return l&&d&&x&&p}).length})()]}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["Total: $",(()=>{const s=ls.map(i=>{const a=i.detalle_asientos.find(n=>n.cuenta_codigo.startsWith("4")&&Number(n.haber)>0);return{created_at:i.fecha,fecha:i.fecha,fecha_fixed:i.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(a==null?void 0:a.cuenta_codigo)||"",subcuenta_id:a==null?void 0:a.subcuenta_id,monto_total:Number(a==null?void 0:a.haber)||0}}),r=[...ge,...s].filter(i=>{const a=i.fecha_fixed??i.fecha??i.created_at,n=Ws(a),l=!je||je==="todos"||i.tipo_ingreso===je,d=!fe||fe==="todas"||i.cuenta_principal_codigo===fe,x=!ie||ie==="todas"||ie==="sin-subcuenta"&&!i.subcuenta_id||i.subcuenta_id===ie;return n&&l&&d&&x});return D(r.reduce((i,a)=>i+Number(a.monto_total||0),0))})()]}),e.jsxs("p",{className:"text-sm font-medium text-green-600",children:["Neto: $",(()=>{const s=ls.map(i=>{const a=i.detalle_asientos.find(n=>n.cuenta_codigo.startsWith("4")&&Number(n.haber)>0);return{created_at:i.fecha,fecha:i.fecha,fecha_fixed:i.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(a==null?void 0:a.cuenta_codigo)||"",subcuenta_id:a==null?void 0:a.subcuenta_id,monto_neto:Number(a==null?void 0:a.haber)||0}}),r=[...ge,...s].filter(i=>{const a=i.fecha_fixed??i.fecha??i.created_at,n=Ws(a),l=!je||je==="todos"||i.tipo_ingreso===je,d=!fe||fe==="todas"||i.cuenta_principal_codigo===fe,x=!ie||ie==="todas"||ie==="sin-subcuenta"&&!i.subcuenta_id||i.subcuenta_id===ie;return n&&l&&d&&x});return D(r.reduce((i,a)=>i+Number(a.monto_neto||0),0))})()]})]})]})]}),k?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando transacciones..."}):(()=>{const s=ls.map(a=>{const n=a.detalle_asientos.find(l=>l.cuenta_codigo.startsWith("4")&&Number(l.haber)>0);return{id:a.id??a._id,descripcion:a.descripcion,monto_total:Number(n==null?void 0:n.haber)||0,monto_neto:Number(n==null?void 0:n.haber)||0,monto_descuento:0,monto_pagado:Number(n==null?void 0:n.haber)||0,monto_pendiente:0,tipo_ingreso:"asiento_directo",metodo_pago:"N/A",tipo_pago:"contado",cuenta_principal_codigo:(n==null?void 0:n.cuenta_codigo)||"",subcuenta_id:n==null?void 0:n.subcuenta_id,created_at:a.fecha,fecha:a.fecha,fecha_fixed:a.fecha,asiento_fecha:a.fecha,es_asiento_directo:!0,estado:"activo"}}),i=[...ge,...s.map(Is)].filter(a=>{const n=a.fecha_fixed??a.fecha??a.created_at,l=Ws(n),d=!je||je==="todos"||a.tipo_ingreso===je,x=!fe||fe==="todas"||a.cuenta_principal_codigo===fe,p=!ie||ie==="todas"||ie==="sin-subcuenta"&&!a.subcuenta_id||a.subcuenta_id===ie;return l&&d&&x&&p}).filter(a=>!String(a.descripcion||"").includes("CANCELACI√ìN:")).map(a=>{const n=a.estado==="cancelado";let l=null;return n&&a.transaccion_cancelacion_id&&(l=ge.find(d=>d.id===a.transaccion_cancelacion_id)),{...a,esCancelada:n,transaccionReversion:l}});return i.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay transacciones que coincidan con los filtros"}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"text-sm font-medium text-muted-foreground",children:["Mostrando ",i.length," transacci√≥n(es)"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Tip: da clic en el √≠cono üìÑ para ver ‚ÄúInformaci√≥n general‚Äù y ‚ÄúRegistro contable‚Äù"})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-background",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/60",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap",children:"Fecha"}),e.jsx("th",{className:"text-left p-3 font-medium min-w-[320px]",children:"Descripci√≥n"}),e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap hidden md:table-cell",children:"Tipo"}),e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap hidden lg:table-cell",children:"Cuenta"}),e.jsx("th",{className:"text-right p-3 font-medium whitespace-nowrap",children:"Total"}),e.jsx("th",{className:"text-right p-3 font-medium whitespace-nowrap hidden md:table-cell",children:"Neto"}),e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap hidden md:table-cell",children:"Estado"}),e.jsx("th",{className:"text-right p-3 font-medium whitespace-nowrap",children:"Acciones"})]})}),e.jsx("tbody",{children:i.map(a=>{var c,m,f,S,_;const n=a,l=a.esCancelada,d=!1,x=n.fecha_fixed??n.fecha??n.created_at,p=(()=>{try{return new Date(x).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return String(x||"")}})(),o=Number(xe(n,"netas")||0);return e.jsxs("tr",{className:`border-t hover:bg-muted/30 ${l?"bg-red-50/60 dark:bg-red-950/20":""}`,children:[e.jsx("td",{className:"p-3 whitespace-nowrap text-muted-foreground",children:p}),e.jsxs("td",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium",children:n.descripcion}),n.es_asiento_directo&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200",children:"üìã Asiento Directo"}),l&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200",children:"‚ùå Cancelada"}),d]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("span",{className:"capitalize",children:n.metodo_pago||"N/A"})," ","‚Ä¢"," ",e.jsx("span",{className:"capitalize",children:n.tipo_pago||"N/A"}),n.subcuenta_id?e.jsxs(e.Fragment,{children:[" ","‚Ä¢"," ",e.jsxs("span",{className:"text-muted-foreground",children:["Subcuenta:"," ",((c=n.subcuentas)==null?void 0:c.nombre)||(()=>{const v=ae.find(I=>I.id===n.subcuenta_id);return(v==null?void 0:v.nombre)||"Subcuenta no encontrada"})()]})]}):null]}),n.comentarios&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 dark:bg-blue-950/30 rounded text-xs",children:[e.jsxs("span",{className:"font-medium text-blue-700 dark:text-blue-300",children:["üí¨"," "]}),e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:String(n.comentarios).length>80?`${String(n.comentarios).substring(0,80)}...`:String(n.comentarios)})]}),l&&n.motivo_cancelacion&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"p-3 bg-red-100 dark:bg-red-950/40 rounded-md border border-red-300 dark:border-red-800",children:[e.jsx("p",{className:"text-xs font-medium text-red-700 dark:text-red-300 mb-1",children:"üìã Motivo de cancelaci√≥n:"}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:n.motivo_cancelacion}),e.jsxs("p",{className:"text-xs text-red-500 dark:text-red-500 mt-1",children:["Cancelada el:"," ",new Date(n.fecha_cancelacion).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),a.transaccionReversion&&e.jsxs("div",{className:"p-3 bg-orange-100 dark:bg-orange-950/40 rounded-md border border-orange-300 dark:border-orange-800",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-orange-700 dark:text-orange-300",children:"‚Ü©Ô∏è Asiento de Reversi√≥n Generado"})}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",a.transaccionReversion.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Monto reversado:"})," $",D(Math.abs(a.transaccionReversion.monto_total))]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",(()=>{const v=a.transaccionReversion.fecha_fixed??a.transaccionReversion.fecha??a.transaccionReversion.created_at;return new Date(v).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})()]})]})]})]})]}),e.jsx("td",{className:"p-3 hidden md:table-cell",children:e.jsx("span",{className:"capitalize",children:n.tipo_ingreso})}),e.jsx("td",{className:"p-3 hidden lg:table-cell",children:n.cuenta_principal_codigo||"-"}),e.jsxs("td",{className:"p-3 text-right font-bold text-primary whitespace-nowrap",children:["$",D(n.monto_total),n.monto_descuento>0&&e.jsxs("div",{className:"text-xs text-red-600 font-medium",children:["-$",D(n.monto_descuento)," desc."]})]}),e.jsx("td",{className:"p-3 text-right hidden md:table-cell whitespace-nowrap",children:e.jsxs("span",{className:"font-medium text-green-600",children:["$",D(o)]})}),e.jsx("td",{className:"p-3 hidden md:table-cell",children:l?e.jsx("span",{className:"text-red-600 font-medium",children:"Cancelada"}):e.jsx("span",{className:"text-muted-foreground",children:"Activa"})}),e.jsx("td",{className:"p-3 text-right whitespace-nowrap",children:e.jsxs("div",{className:"inline-flex items-center gap-2 justify-end",children:[e.jsxs(vs,{onOpenChange:v=>{if(v){const I=String(n._id??n.id??"");wn(I)}else qs(null)},children:[e.jsx(Fa,{asChild:!0,children:e.jsx(L,{variant:"outline",size:"sm",className:"h-8 px-2",children:e.jsx(Pa,{className:"h-4 w-4"})})}),e.jsxs(ys,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ws,{children:[e.jsx(Ss,{children:"Detalles de la Transacci√≥n"}),e.jsx(Cs,{children:"Informaci√≥n completa y asientos contables en balanza"})]}),e.jsxs(Sa,{defaultValue:"general",className:"w-full",children:[e.jsxs(Ca,{className:"grid w-full grid-cols-2",children:[e.jsx(ds,{value:"general",children:"Informaci√≥n General"}),e.jsx(ds,{value:"contable",children:"Registros Contables"})]}),e.jsxs(ms,{value:"general",className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Informaci√≥n General"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",n.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",n.tipo_ingreso]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"M√©todo de Pago:"})," ",n.metodo_pago||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo de Pago:"})," ",n.tipo_pago]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",(()=>{const v=n.fecha_fixed??n.fecha??n.created_at;try{return new Date(v).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return String(v||"")}})()]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Montos"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total:"})," $",D(n.monto_total)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descuento:"})," $",D(n.monto_descuento)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Neto:"})," $",D(n.monto_neto)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pagado:"})," $",D(n.monto_pagado||0)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pendiente:"})," $",D(n.monto_pendiente||0)]})]})]})]}),(n.cliente_nombre||n.cliente_telefono||n.cliente_email)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n del Cliente"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[n.cliente_nombre&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",n.cliente_nombre]}),n.cliente_telefono&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tel√©fono:"})," ",n.cliente_telefono]}),n.cliente_email&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",n.cliente_email]}),n.cliente_rfc&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"RFC:"})," ",n.cliente_rfc]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n Contable"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Cuenta Principal:"})," ",n.cuenta_principal??`${n.cuenta_principal_codigo}`]}),n.subcuenta_id?e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," ",((m=n.subcuentas)==null?void 0:m.nombre)||(()=>{const v=ae.find(I=>I.id===n.subcuenta_id);return(v==null?void 0:v.nombre)||"Subcuenta no encontrada"})()]}):e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," Sin subcuenta asignada"]})]})]}),n.comentarios&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Comentarios"}),e.jsx("div",{className:"p-3 bg-muted rounded-md",children:e.jsx("p",{className:"text-sm",children:n.comentarios})})]})]}),e.jsxs(ms,{value:"contable",className:"mt-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3",children:"Asientos en Balanza de Comprobaci√≥n"}),rn?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando asientos contables..."}):Ke?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"N√∫mero de Asiento:"})," ",Ke.numero_asiento]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(Ke.fecha).toLocaleDateString("es-ES")]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",Ke.descripcion]})]})}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Cuenta"}),e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Descripci√≥n"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Debe"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Haber"})]})}),e.jsxs("tbody",{children:[(f=Ke.detalles)==null?void 0:f.map((v,I)=>e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"p-3 text-sm",children:[e.jsx("div",{className:"font-medium",children:v.cuenta_codigo}),e.jsx("div",{className:"text-xs text-muted-foreground",children:v.cuenta_nombre})]}),e.jsx("td",{className:"p-3 text-sm",children:v.descripcion}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:v.debe>0?`$${D(v.debe)}`:"-"}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:v.haber>0?`$${D(v.haber)}`:"-"})]},I)),e.jsxs("tr",{className:"border-t-2 bg-muted/50 font-bold",children:[e.jsx("td",{colSpan:2,className:"p-3 text-sm",children:"TOTALES"}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",D((S=Ke.detalles)==null?void 0:S.reduce((v,I)=>v+Number(I.debe),0))]}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",D((_=Ke.detalles)==null?void 0:_.reduce((v,I)=>v+Number(I.haber),0))]})]})]})]})}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/30 rounded-md text-sm",children:[e.jsx("p",{className:"font-medium text-blue-700 dark:text-blue-300 mb-1",children:"üí° Informaci√≥n"}),e.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:"Este asiento contable refleja c√≥mo esta transacci√≥n afecta a las diferentes cuentas en la balanza de comprobaci√≥n y posteriormente en los estados financieros."})]})]}):e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg text-sm text-muted-foreground text-center",children:"No se encontraron asientos contables para esta transacci√≥n"})]})]})]})]}),!l&&!d&&e.jsx(L,{variant:"outline",size:"sm",className:"h-8 px-2 border-red-300 text-red-600 hover:bg-red-50 dark:border-red-800 dark:text-red-400 dark:hover:bg-red-950/30",onClick:()=>{Pt(Is(n)),et(!0)},children:"‚ùå"})]})})]},n.id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t bg-muted/40",children:[e.jsx("td",{className:"p-3 text-sm font-medium",colSpan:4,children:"TOTALES"}),e.jsxs("td",{className:"p-3 text-right font-bold text-primary whitespace-nowrap",children:["$",D(i.reduce((a,n)=>a+Number(n.monto_total||0),0))]}),e.jsx("td",{className:"p-3 text-right hidden md:table-cell whitespace-nowrap",children:e.jsxs("span",{className:"font-bold text-green-600",children:["$",D(i.reduce((a,n)=>a+Number(xe(n,"netas")||0),0))]})}),e.jsx("td",{className:"p-3 hidden md:table-cell"}),e.jsx("td",{className:"p-3"})]})})]})})})]})})()]})]})}),e.jsx(ms,{value:"analitica",className:"mt-6",children:(()=>{const s=Array.isArray(ls)?ls:[],r=(()=>{const d=new Date().getFullYear();let x=w.filter(p=>{var o;return p.estado!=="cancelado"&&!((o=p.descripcion)!=null&&o.includes("CANCELACI√ìN:"))});if(ee==="diario"){const p=he.toISOString().split("T")[0];x=x.filter(o=>o.asiento_fecha===p)}else if(ee==="mensual"){const p=V.getMonth(),o=V.getFullYear();x=x.filter(c=>{const m=c.asiento_fecha;if(!m)return!1;const f=ts(m);return f.getMonth()===p&&f.getFullYear()===o})}else x=x.filter(p=>{const o=p.asiento_fecha;return o?ts(o).getFullYear()===d:!1});return B==="ventas"?x.filter(p=>p.cuenta_principal_codigo==="4001"):x.filter(p=>{var o;return((o=p.cuenta_principal_codigo)==null?void 0:o.startsWith("4"))&&p.cuenta_principal_codigo!=="4001"&&p.cuenta_principal_codigo!=="4003"})})(),a=(()=>{const l=r.filter(p=>p.tipo_pago==="contado"||p.tipo_pago==="parcial");if(l.length===0)return[];const d={};l.forEach(p=>{const o=p.metodo_pago==="efectivo"?"Efectivo":"Tarjeta";d[o]=(d[o]||0)+(Number(xe(p,b))||0)});const x=Object.values(d).reduce((p,o)=>p+(Number(o)||0),0);return Object.entries(d).map(([p,o])=>({name:p,value:o,porcentaje:x>0?(o/x*100).toFixed(1):"0.0"}))})(),n=()=>B==="ventas"?r.length>0||(Number(R.ventasBrutas)||0)>0||(Number(R.descuentos)||0)>0:r.length>0||(Number(R.otrosIngresos)||0)>0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground mb-4",children:"Highlights de Ingresos"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(H,{children:[e.jsx(K,{className:"pb-3",children:e.jsx(J,{className:"text-lg font-semibold text-primary",children:"Resumen del D√≠a"})}),e.jsxs(Q,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",T(gs.ventasBrutas,$)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",T(gs.descuentos,$)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",T(gs.ventasNetas,$)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",T(gs.otrosIngresos,$)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",T(gs.totalIngresos,$)]})]})]})]}),e.jsxs(H,{children:[e.jsx(K,{className:"pb-3",children:e.jsx(J,{className:"text-lg font-semibold text-primary",children:"Resumen del Mes"})}),e.jsxs(Q,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",T(js.ventasBrutas,$)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",T(js.descuentos,$)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",T(js.ventasNetas,$)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",T(js.otrosIngresos,$)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",T(js.totalIngresos,$)]})]})]})]}),e.jsxs(H,{children:[e.jsx(K,{className:"pb-3",children:e.jsx(J,{className:"text-lg font-semibold text-primary",children:"Resumen del A√±o"})}),e.jsxs(Q,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",T(fs.ventasBrutas,$)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",T(fs.descuentos,$)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",T(fs.ventasNetas,$)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",T(fs.otrosIngresos,$)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",T(fs.totalIngresos,$)]})]})]})]})]})]}),e.jsx("div",{className:"my-8 border-t-2 border-primary/20"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-foreground mb-6",children:["Anal√≠tica de ",B==="ventas"?"Ventas":"Otros Ingresos"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsx(J,{children:"Tipo de Ingreso"}),e.jsx(de,{children:"Selecciona qu√© analizar"})]}),e.jsx(Q,{children:e.jsxs(Ve,{value:B,onValueChange:l=>Ga(l),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"ventas",id:"tipo-ventas"}),e.jsx(j,{htmlFor:"tipo-ventas",className:"cursor-pointer",children:"Ventas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"otros",id:"tipo-otros"}),e.jsx(j,{htmlFor:"tipo-otros",className:"cursor-pointer",children:"Otros Ingresos"})]})]})})]}),e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsx(J,{children:"Per√≠odo de An√°lisis"}),e.jsx(de,{children:"Selecciona el per√≠odo"})]}),e.jsxs(Q,{className:"space-y-3",children:[e.jsxs(Ve,{value:ee,onValueChange:l=>Wa(l),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"diario",id:"period-daily"}),e.jsx(j,{htmlFor:"period-daily",className:"cursor-pointer",children:"Diario"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"mensual",id:"period-monthly"}),e.jsx(j,{htmlFor:"period-monthly",className:"cursor-pointer",children:"Mensual"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"anual",id:"period-annual"}),e.jsx(j,{htmlFor:"period-annual",className:"cursor-pointer",children:"Anual"})]})]}),ee==="diario"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(j,{className:"text-xs text-muted-foreground mb-2 block",children:"Fecha espec√≠fica"}),e.jsxs(Bt,{children:[e.jsx(Lt,{asChild:!0,children:e.jsxs(L,{variant:"outline",className:ot("w-full justify-start text-left font-normal",!he&&"text-muted-foreground"),size:"sm",children:[e.jsx(zt,{className:"mr-2 h-4 w-4"}),$s(he,"PPP",{locale:xs})]})}),e.jsx(Ut,{className:"w-auto p-0",align:"start",children:e.jsx(Wt,{mode:"single",selected:he,onSelect:l=>l&&Ha(l),initialFocus:!0,className:"pointer-events-auto"})})]})]}),ee==="mensual"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(j,{className:"text-xs text-muted-foreground mb-2 block",children:"Mes espec√≠fico"}),e.jsxs(Bt,{children:[e.jsx(Lt,{asChild:!0,children:e.jsxs(L,{variant:"outline",className:ot("w-full justify-start text-left font-normal",!V&&"text-muted-foreground"),size:"sm",children:[e.jsx(zt,{className:"mr-2 h-4 w-4"}),$s(V,"MMMM yyyy",{locale:xs})]})}),e.jsx(Ut,{className:"w-auto p-0",align:"start",children:e.jsx(Wt,{mode:"single",selected:V,onSelect:l=>l&&Ka(l),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsx(J,{children:"Formato de Cifras"}),e.jsx(de,{children:"Visualizaci√≥n de montos"})]}),e.jsx(Q,{children:e.jsxs(Ve,{value:$,onValueChange:l=>qa(l),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"general",id:"scale-general"}),e.jsx(j,{htmlFor:"scale-general",className:"cursor-pointer",children:"General"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"miles",id:"scale-thousands"}),e.jsx(j,{htmlFor:"scale-thousands",className:"cursor-pointer",children:"Miles (K)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"millones",id:"scale-millions"}),e.jsx(j,{htmlFor:"scale-millions",className:"cursor-pointer",children:"Millones (M)"})]})]})})]}),e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsx(J,{children:"Tipo de M√©trica"}),e.jsx(de,{children:"Datos a visualizar"})]}),e.jsx(Q,{children:e.jsxs(Ve,{value:b,onValueChange:l=>Ya(l),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"brutas",id:"metric-brutas"}),e.jsx(j,{htmlFor:"metric-brutas",className:"cursor-pointer",children:"Ventas Brutas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"descuentos",id:"metric-descuentos"}),e.jsx(j,{htmlFor:"metric-descuentos",className:"cursor-pointer",children:"Descuentos"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{value:"netas",id:"metric-netas"}),e.jsx(j,{htmlFor:"metric-netas",className:"cursor-pointer",children:"Ventas Netas"})]})]})})]})]}),e.jsxs(H,{className:"mb-6",children:[e.jsxs(K,{children:[e.jsxs(J,{children:["Evoluci√≥n de"," ",b==="descuentos"?"Descuentos":B==="otros"?"Otros Ingresos":b==="brutas"?"Ventas Brutas":"Ventas Netas"]}),e.jsx(de,{children:(b==="descuentos"?"Descuentos aplicados":B==="otros"?"Otros ingresos":b==="brutas"?"Ventas brutas":"Ventas netas")+" - "+(ee==="diario"?"del d√≠a":ee==="mensual"?"por d√≠a del mes":"por mes del a√±o")})]}),e.jsx(Q,{children:(()=>{const l=Number(B==="ventas"?b==="brutas"?R.ventasBrutas||0:b==="descuentos"?R.descuentos||0:R.ventasNetas||0:R.otrosIngresos||0),d=()=>{const m=r||[],f=(C,N)=>{if(B==="otros"){C.otrosIngresos+=N;return}b==="brutas"?C.ventasBrutas+=N:b==="descuentos"?C.descuentos+=N:C.ventasNetas+=N};if(ee==="diario"){const C=he.toISOString().split("T")[0],N={periodo:C,ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0};return m.forEach(z=>{const te=z.asiento_fecha;!te||String(te).slice(0,10)!==C||f(N,Number(xe(z,b)||0))}),m.length===0&&l>0&&N.ventasBrutas+N.descuentos+N.ventasNetas+N.otrosIngresos===0&&f(N,l),[N]}if(ee==="mensual"){const C=V.getMonth(),N=V.getFullYear(),z=new Date(N,C+1,0).getDate(),te=Array.from({length:z},(g,q)=>({periodo:`D√≠a ${q+1}`,ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,__day:q+1}));if(m.forEach(g=>{const q=g.asiento_fecha;if(!q)return;const Y=ts(q);if(Y.getFullYear()!==N||Y.getMonth()!==C)return;const Ne=Y.getDate()-1;Ne<0||Ne>=te.length||f(te[Ne],Number(xe(g,b)||0))}),te.reduce((g,q)=>g+q.ventasBrutas+q.descuentos+q.ventasNetas+q.otrosIngresos,0)===0&&l>0){const g={periodo:`Mes ${C+1}/${N}`,ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0};return f(g,l),[g]}return te}const _=new Date().getFullYear(),v=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],I=Array.from({length:12},(C,N)=>({periodo:v[N],ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,__month:N}));if(m.forEach(C=>{const N=C.asiento_fecha;if(!N)return;const z=ts(N);if(z.getFullYear()!==_)return;const te=z.getMonth();f(I[te],Number(xe(C,b)||0))}),I.reduce((C,N)=>C+N.ventasBrutas+N.descuentos+N.ventasNetas+N.otrosIngresos,0)===0&&l>0){const C={periodo:`${_}`,ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0};return f(C,l),[C]}return I},x=Array.isArray(R.detallesPorPeriodo)?R.detallesPorPeriodo:[],o=((x.length>0?x:d())||[]).map(m=>({periodo:m.periodo,ventas:Number(m.ventasBrutas||0),descuentos:Number(m.descuentos||0),neto:Number(m.ventasNetas||0),otrosIngresos:Number(m.otrosIngresos||0),__day:m.__day,__month:m.__month})),c=o.some(m=>(m.ventas||0)+(m.descuentos||0)+(m.neto||0)+(m.otrosIngresos||0)>0);return k?e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"Cargando datos..."}):!c&&l<=0?e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"}):e.jsx("div",{className:"h-80",children:e.jsx(Ps,{width:"100%",height:"100%",children:e.jsxs(Wn,{data:o,children:[e.jsx(Da,{strokeDasharray:"3 3"}),e.jsx(Ia,{dataKey:"periodo"}),e.jsx($a,{tickFormatter:m=>T(m,$)}),e.jsx(Fs,{formatter:m=>[`$${T(Number(m),$)}`,""],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"10px"},wrapperStyle:{zIndex:1e3}}),e.jsx(qn,{}),b==="descuentos"&&e.jsx(nt,{type:"monotone",dataKey:"descuentos",stroke:"hsl(180 60% 70%)",name:"Descuentos",strokeWidth:2,dot:!1,children:e.jsx(Ds,{dataKey:"descuentos",position:"top",formatter:m=>Number(m)>0?`$${T(m,$)}`:"",style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),b==="brutas"&&B==="ventas"&&e.jsx(nt,{type:"monotone",dataKey:"ventas",stroke:"hsl(180 50% 55%)",name:"Ventas Brutas",strokeWidth:2,dot:!1,children:e.jsx(Ds,{dataKey:"ventas",position:"top",formatter:m=>Number(m)>0?`$${T(m,$)}`:"",style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),b==="netas"&&B==="ventas"&&e.jsx(nt,{type:"monotone",dataKey:"neto",stroke:"hsl(180 45% 45%)",name:"Ventas Netas",strokeWidth:2,dot:!1,children:e.jsx(Ds,{dataKey:"neto",position:"top",formatter:m=>Number(m)>0?`$${T(m,$)}`:"",style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),B==="otros"&&b!=="descuentos"&&e.jsx(nt,{type:"monotone",dataKey:"otrosIngresos",stroke:"hsl(140 50% 50%)",name:"Otros Ingresos",strokeWidth:2,dot:!1,children:e.jsx(Ds,{dataKey:"otrosIngresos",position:"top",formatter:m=>Number(m)>0?`$${T(m,$)}`:"",style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})})]})})})})()})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsxs(J,{children:[b==="brutas"?"Ventas Brutas":b==="descuentos"?"Descuentos":"Ventas Netas"," por Tipo"]}),e.jsxs(de,{children:["Distribuci√≥n de"," ",b==="brutas"?"ventas brutas":b==="descuentos"?"descuentos":"ventas netas"," por categor√≠a"]})]}),e.jsx(Q,{children:k?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):n()?B==="otros"&&b==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(Ps,{width:"100%",height:"100%",children:e.jsxs(Ta,{children:[e.jsx(Aa,{data:(()=>{const l=B==="ventas"?b==="brutas"?R.ventasBrutas:b==="descuentos"?R.descuentos:R.ventasNetas:R.otrosIngresos;if(r.length===0&&(Number(l)||0)>0)return[{tipo:"Otros Ingresos",monto:Number(l)||0,porcentaje:"100.0"}];const d=r.reduce((p,o)=>{const c=(o==null?void 0:o.tipo_ingreso)||"sin_tipo";return p[c]=(p[c]||0)+(Number(xe(o,b))||0),p},{}),x=Object.values(d).reduce((p,o)=>p+(Number(o)||0),0);return Object.entries(d).map(([p,o])=>({tipo:String(p).charAt(0).toUpperCase()+String(p).slice(1),monto:Number(o)||0,porcentaje:x>0?((Number(o)||0)/x*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({tipo:l,porcentaje:d,monto:x})=>`${l}
${d}%
$${T(Number(x)||0,$)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:Object.keys(r.reduce((l,d)=>(l[(d==null?void 0:d.tipo_ingreso)||"sin_tipo"]=!0,l),{})).map((l,d)=>{const x=["hsl(180 50% 55%)","hsl(180 45% 45%)","hsl(180 55% 65%)","hsl(180 40% 40%)"];return e.jsx(rt,{fill:x[d%4]},`cell-${d}`)})}),e.jsx(Fs,{formatter:l=>[`$${T(Number(l),$)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsxs(J,{children:["Estado de Pagos - ",b==="brutas"?"Ventas Brutas":b==="descuentos"?"Descuentos":"Ventas Netas"]}),e.jsx(de,{children:"Distribuci√≥n por estado de pago"})]}),e.jsx(Q,{children:k?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):n()?B==="otros"&&b==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(Ps,{width:"100%",height:"100%",children:e.jsxs(Ta,{children:[e.jsxs(Aa,{data:(()=>{const l=B==="ventas"?b==="brutas"?R.ventasBrutas:b==="descuentos"?R.descuentos:R.ventasNetas:R.otrosIngresos;if(r.length===0&&(Number(l)||0)>0)return[{estado:"Pagado Total",monto:Number(l)||0,porcentaje:"100.0"}];const d=r.reduce((p,o)=>{let c="Por Cobrar";return o.tipo_pago==="contado"||o.monto_pagado&&o.monto_pendiente===0?c="Pagado Total":(o.tipo_pago==="parcial"||o.monto_pagado>0&&o.monto_pendiente>0)&&(c="Pago Parcial"),p[c]=(p[c]||0)+(Number(xe(o,b))||0),p},{}),x=Object.values(d).reduce((p,o)=>p+(Number(o)||0),0);return Object.entries(d).map(([p,o])=>({estado:p,monto:Number(o)||0,porcentaje:x>0?((Number(o)||0)/x*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({estado:l,porcentaje:d,monto:x})=>`${l}
${d}%
$${T(Number(x)||0,$)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:[e.jsx(rt,{fill:"hsl(180 50% 55%)"}),e.jsx(rt,{fill:"hsl(180 55% 65%)"}),e.jsx(rt,{fill:"hsl(180 45% 45%)"})]}),e.jsx(Fs,{formatter:l=>[`$${T(Number(l),$)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(H,{children:[e.jsxs(K,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(J,{children:[b==="brutas"?"Ventas Brutas":b==="descuentos"?"Descuentos":"Ventas Netas"," por"," ",Ns==="subcuenta"?"Subcuenta":"Cuenta"]}),e.jsxs(de,{children:["Distribuci√≥n por ",Ns==="subcuenta"?"subcuentas":"cuentas"," contables"]})]}),e.jsxs(ve,{value:Ns,onValueChange:l=>nn(l),children:[e.jsx(ye,{className:"w-[150px]",children:e.jsx(Fe,{})}),e.jsxs(we,{children:[e.jsx(E,{value:"subcuenta",children:"Por Subcuenta"}),e.jsx(E,{value:"cuenta",children:"Por Cuenta"})]})]})]}),e.jsx(Q,{children:k?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):n()?B==="otros"&&b==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(Ps,{width:"100%",height:"100%",children:e.jsxs(Yn,{data:(()=>{const l=B==="ventas"?b==="brutas"?R.ventasBrutas:b==="descuentos"?R.descuentos:R.ventasNetas:R.otrosIngresos;if(r.length===0&&(Number(l)||0)>0)return[{subcuenta:"Sin detalle",monto:Number(l)||0}];const d=r.reduce((o,c)=>{var f;let m;if(Ns==="subcuenta")m=c.subcuenta_id?((f=ae.find(S=>S.id===c.subcuenta_id))==null?void 0:f.nombre)||"Subcuenta desconocida":"Sin subcuenta asignada";else{const S=Se.find(_=>_.codigo===c.cuenta_principal_codigo);m=S?`${c.cuenta_principal_codigo} - ${S.nombre}`:c.cuenta_principal_codigo||"Sin cuenta"}return o[m]=(o[m]||0)+(Number(xe(c,b))||0),o},{}),x=Object.values(d).reduce((o,c)=>o+(Number(c)||0),0);if((Number(l)||0)-x>.01){const o={};s.forEach(c=>{const f=(Array.isArray(c.detalle_asientos)?c.detalle_asientos:[]).find(C=>String(C.cuenta_codigo||"").startsWith("4")&&Number(C.haber)>0);if(!f)return;const S=Number(f.haber)||0,_=String(f.cuenta_codigo||""),v=Se.find(C=>C.codigo===_),I=(v==null?void 0:v.nombre)||"Otros ingresos";let A;if(Ns==="cuenta")A=`${_} - ${I}`;else{const C=f.subcuenta_id,N=ae.find(z=>z.id===C);A=(N==null?void 0:N.nombre)||"Sin subcuenta asignada"}o[A]=(o[A]||0)+S}),Object.entries(o).forEach(([c,m])=>{d[c]=(d[c]||0)+(Number(m)||0)})}return Object.entries(d).map(([o,c])=>({subcuenta:o,monto:Number(c)||0}))})(),layout:"vertical",children:[e.jsx(Da,{strokeDasharray:"3 3"}),e.jsx(Ia,{type:"number",tickFormatter:l=>T(l,$),tick:{fill:"#000000"},domain:[0,l=>l*1.2]}),e.jsx($a,{type:"category",dataKey:"subcuenta",width:150,tick:{fill:"#000000"}}),e.jsx(Fs,{formatter:l=>[`$${T(Number(l),$)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}}),e.jsx(Gn,{dataKey:"monto",fill:"hsl(180 50% 55%)",children:e.jsx(Ds,{dataKey:"monto",position:"right",formatter:l=>`$${T(l,$)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsx(J,{children:"M√©todos de Pago Recibidos"}),e.jsxs(de,{children:["Distribuci√≥n de"," ",b==="brutas"?"ventas brutas":b==="descuentos"?"descuentos":"ventas netas"," por m√©todo de pago"]})]}),e.jsx(Q,{children:k?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):n()?B==="otros"&&b==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):a.length===0?e.jsxs("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:["No hay transacciones con m√©todo de pago en este per√≠odo",e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-2 block",children:"Las ventas a cr√©dito no tienen m√©todo de pago asignado"})]}):e.jsx("div",{className:"h-64",children:e.jsx(Ps,{width:"100%",height:"100%",children:e.jsx(Hn,{data:a,dataKey:"value",aspectRatio:4/3,stroke:"#fff",fill:"#8884d8",content:e.jsx(er,{}),children:e.jsx(Fs,{content:e.jsx(sr,{scaleFormat:$})})})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsxs(J,{children:[b==="brutas"?"Ventas Brutas":b==="descuentos"?"Descuentos":"Ventas Netas"," por Producto"]}),e.jsxs(de,{children:["Ranking de productos ",b==="descuentos"?"con m√°s descuentos":"m√°s vendidos"]})]}),e.jsx(Q,{children:k?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):n()?e.jsx("div",{className:"space-y-3",children:(()=>{if(B==="otros"&&b==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const l=B==="ventas"?b==="brutas"?R.ventasBrutas:b==="descuentos"?R.descuentos:R.ventasNetas:R.otrosIngresos;if(r.length===0&&(Number(l)||0)>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(Re,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin detalle de producto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",T(Number(l)||0,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Re,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",T(Number(l)||0,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const d={};r.forEach(o=>{if(o.tipo_ingreso==="inventariados"&&String(o.descripcion||"").startsWith("Venta de ")){const c=String(o.descripcion).replace("Venta de ","").trim(),m=Ee.find(f=>f.nombre.toLowerCase()===c.toLowerCase());d[c]||(d[c]={nombre:c,transacciones:0,monto:0,imagen:m==null?void 0:m.imagen_url,tieneAsignacion:!0}),d[c].transacciones+=1,d[c].monto+=Number(xe(o,b))||0}}),r.forEach(o=>{if(o.tipo_ingreso==="precargados"){let c=[];String(o.descripcion||"").startsWith("Venta: ")?c=String(o.descripcion).replace("Venta: ","").split(", ").map(v=>{const I=v.match(/^(.+?) \(x(\d+)\)$/);return I?{nombre:I[1].trim(),cantidad:parseInt(I[2])}:{nombre:v.trim(),cantidad:1}}):String(o.descripcion||"").startsWith("Venta de ")?c=[{nombre:String(o.descripcion).replace("Venta de ","").trim(),cantidad:1}]:c=[{nombre:String(o.descripcion||"Sin descripci√≥n"),cantidad:1}];const m=Number(xe(o,b))||0,f=[];let S=0;c.forEach(({nombre:_,cantidad:v})=>{const I=$e.find(C=>C.nombre.toLowerCase()===_.toLowerCase()),A=Number(I==null?void 0:I.precio)||0;f.push({nombre:_,cantidad:v,precioBase:A}),S+=A*v}),f.forEach(({nombre:_,cantidad:v,precioBase:I})=>{const A=$e.find(te=>te.nombre.toLowerCase()===_.toLowerCase()),C=I*v,N=S>0?C/S:1/Math.max(f.length,1),z=m*N;d[_]||(d[_]={nombre:_,transacciones:0,monto:0,imagen:A==null?void 0:A.imagen_url,tieneAsignacion:!!A}),d[_].transacciones+=1,d[_].monto+=Number(z)||0})}if(o.tipo_ingreso==="general"||o.tipo_ingreso==="inventariados"&&!String(o.descripcion||"").startsWith("Venta de ")){const c="Ingresos sin producto asignado";d[c]||(d[c]={nombre:c,transacciones:0,monto:0,tieneAsignacion:!1}),d[c].transacciones+=1,d[c].monto+=Number(xe(o,b))||0}if(o.tipo_ingreso==="otros"){const c=String(o.descripcion||"Otros ingresos");d[c]||(d[c]={nombre:c,transacciones:0,monto:0,tieneAsignacion:!1}),d[c].transacciones+=1,d[c].monto+=Number(xe(o,b))||0}});const x=Object.values(d).sort((o,c)=>(Number(c.monto)||0)-(Number(o.monto)||0));if(B==="otros"){const o=r.filter(m=>m.tipo_ingreso==="otros").reduce((m,f)=>m+(Number(xe(f,b))||0),0);if((Number(l)||0)-o>.01){const m={};s.forEach(f=>{const _=(Array.isArray(f.detalle_asientos)?f.detalle_asientos:[]).find(N=>String(N.cuenta_codigo||"").startsWith("4")&&Number(N.haber)>0);if(!_)return;const v=Number(_.haber)||0,I=String(_.cuenta_codigo||""),A=Se.find(N=>N.codigo===I);let C;String(f.numero_asiento||"").startsWith("BAJA-")?C=(A==null?void 0:A.nombre)||"Ganancia en Venta de Activos":C=String(f.descripcion||(A==null?void 0:A.nombre)||"Otros ingresos"),m[C]||(m[C]={monto:0,count:0}),m[C].monto+=v,m[C].count+=1}),Object.entries(m).forEach(([f,S])=>{(Number(S.monto)||0)>.01&&x.push({nombre:f,transacciones:S.count,monto:S.monto,tieneAsignacion:!1})})}}const p=x.slice(0,10);return e.jsxs(e.Fragment,{children:[p.map(o=>{const c=x.reduce((f,S)=>f+(Number(S.monto)||0),0),m=c>0?((Number(o.monto)||0)/c*100).toFixed(1):"0.0";return e.jsxs("div",{className:`flex items-center gap-3 p-3 border rounded-lg ${o.tieneAsignacion?"":"border-amber-500/50 bg-amber-50/50 dark:bg-amber-950/20"}`,children:[o.imagen?e.jsx("img",{src:o.imagen,alt:o.nombre,className:"w-12 h-12 rounded-md object-cover flex-shrink-0"}):e.jsx("div",{className:`w-12 h-12 rounded-md flex items-center justify-center flex-shrink-0 ${o.tieneAsignacion?"bg-muted":"bg-amber-100 dark:bg-amber-900/30"}`,children:e.jsx(Re,{className:`w-5 h-5 ${o.tieneAsignacion?"text-muted-foreground":"text-amber-600 dark:text-amber-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium truncate",children:o.nombre}),!o.tieneAsignacion&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-200 flex-shrink-0",children:"Sin asignar"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[o.transacciones," ",o.transacciones===1?"transacci√≥n":"transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",T(Number(o.monto)||0,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[m,"%"]})})]},o.nombre)}),(()=>{const o=x.reduce((c,m)=>c+(Number(m.monto)||0),0);return o>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Re,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x.reduce((c,m)=>c+(Number(m.transacciones)||0),0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",T(o,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsxs(J,{children:[b==="brutas"?"Ventas Brutas":b==="descuentos"?"Descuentos":"Ventas Netas"," por Cliente"]}),e.jsxs(de,{children:["Ranking de ",b==="descuentos"?"clientes con m√°s descuentos":"mejores clientes"]})]}),e.jsx(Q,{children:k?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):n()?e.jsx("div",{className:"space-y-3",children:(()=>{if(B==="otros"&&b==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const l=B==="ventas"?b==="brutas"?R.ventasBrutas:b==="descuentos"?R.descuentos:R.ventasNetas:R.otrosIngresos;if(r.length===0&&(Number(l)||0)>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(_s,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin cliente asignado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",T(Number(l)||0,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(_s,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",T(Number(l)||0,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const d=r.reduce((c,m)=>{const f=String((m==null?void 0:m.cliente_nombre)||"Sin cliente asignado");return c[f]||(c[f]={nombre:f,transacciones:0,monto:0,email:m==null?void 0:m.cliente_email,telefono:m==null?void 0:m.cliente_telefono}),c[f].transacciones+=1,c[f].monto+=Number(xe(m,b))||0,c},{}),x=Object.values(d).sort((c,m)=>(Number(m.monto)||0)-(Number(c.monto)||0)),p=x.reduce((c,m)=>c+(Number(m.monto)||0),0);if(B==="otros"){const c=(Number(l)||0)-p;if(c>.01){const m=x.find(f=>f.nombre==="Sin cliente asignado");m?(m.monto+=c,m.transacciones+=s.length):x.push({nombre:"Sin cliente asignado",transacciones:s.length,monto:c}),x.sort((f,S)=>(Number(S.monto)||0)-(Number(f.monto)||0))}}const o=x.slice(0,10);return e.jsxs(e.Fragment,{children:[o.map(c=>{const m=x.reduce((S,_)=>S+(Number(_.monto)||0),0),f=m>0?((Number(c.monto)||0)/m*100).toFixed(1):"0.0";return e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(_s,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:c.nombre}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-0.5",children:[e.jsxs("p",{children:[c.transacciones," ",c.transacciones===1?"compra":"compras"]}),c.telefono&&e.jsx("p",{className:"text-xs",children:c.telefono}),c.email&&e.jsx("p",{className:"text-xs truncate",children:c.email})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",T(Number(c.monto)||0,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[f,"%"]})})]},c.nombre)}),(()=>{const c=x.reduce((m,f)=>m+(Number(f.monto)||0),0);return c>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(_s,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x.reduce((m,f)=>m+(Number(f.transacciones)||0),0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",T(c,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]})]})]})]})})()}),e.jsx(ms,{value:"catalogo",className:"mt-6",children:e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsxs(J,{className:"flex items-center justify-between",children:["Cat√°logo de Productos",e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>{ka(),ce({title:"Actualizado",description:"La lista de productos se ha actualizado correctamente"})},children:[e.jsx(Kn,{className:"mr-2 h-4 w-4"}),"Actualizar"]}),e.jsxs(vs,{open:cn,onOpenChange:St,children:[e.jsx(Fa,{asChild:!0,children:e.jsxs(L,{children:[e.jsx(Rt,{className:"mr-2 h-4 w-4"}),"Nuevo Producto"]})}),e.jsxs(ys,{className:"sm:max-w-[425px]",children:[e.jsxs(ws,{children:[e.jsx(Ss,{children:"Agregar Nuevo Producto"}),e.jsx(Cs,{children:"Completa la informaci√≥n del producto para agregarlo al cat√°logo."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-name",className:"text-right",children:"Nombre"}),e.jsx(W,{id:"product-name",value:Ct,onChange:s=>ca(s.target.value),className:"col-span-3",placeholder:"Nombre del producto"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-image",className:"text-right",children:"Imagen"}),e.jsx(W,{id:"product-image",type:"file",accept:"image/*",onChange:s=>{var t;return ha(((t=s.target.files)==null?void 0:t[0])||null)},className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-price",className:"text-right",children:"Precio"}),e.jsx(W,{id:"product-price",type:"number",value:_t,onChange:s=>la(s.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-account",className:"text-right",children:"Cuenta"}),e.jsxs("div",{className:"col-span-3 flex items-center p-2 border rounded-md bg-muted/50",children:[e.jsx("span",{className:"text-sm font-medium",children:"4001 - Ventas"}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"(cuenta fija)"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(ve,{value:ua,onValueChange:s=>xa(s==="none"?"":s),children:[e.jsx(ye,{className:"col-span-3",children:e.jsx(Fe,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(we,{children:[e.jsx(E,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),ae.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>e.jsx(E,{value:s.id,children:s.nombre},s.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(us,{id:"product-description",value:da,onChange:s=>ma(s.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]})]}),e.jsxs(at,{children:[e.jsx(L,{type:"button",variant:"outline",onClick:()=>St(!1),children:"Cancelar"}),e.jsx(L,{onClick:Pn,disabled:Xs,children:Xs?"Guardando...":"Guardar Producto"})]})]})]}),e.jsx(vs,{open:un,onOpenChange:tt,children:e.jsxs(ys,{className:"sm:max-w-[425px]",children:[e.jsxs(ws,{children:[e.jsx(Ss,{children:"Editar Producto"}),e.jsx(Cs,{children:"Modifica la informaci√≥n del producto."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-name",className:"text-right",children:"Nombre *"}),e.jsx(W,{id:"edit-product-name",value:It,onChange:s=>$t(s.target.value),className:"col-span-3",placeholder:"Ej: Consultor√≠a, Producto X"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-price",className:"text-right",children:"Precio *"}),e.jsx(W,{id:"edit-product-price",type:"number",value:Tt,onChange:s=>At(s.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-image",className:"text-right",children:"Imagen"}),e.jsxs("div",{className:"col-span-3 space-y-2",children:[e.jsx(W,{id:"edit-product-image",type:"file",accept:"image/*",onChange:Fn}),fa&&e.jsx("div",{className:"aspect-square w-24 mx-auto",children:e.jsx("img",{src:fa,alt:"Preview",className:"w-full h-full object-cover rounded-md"})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(us,{id:"edit-product-description",value:ja,onChange:s=>kt(s.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(ve,{value:Na||"none",onValueChange:s=>ba(s==="none"?"":s),children:[e.jsx(ye,{className:"col-span-3",children:e.jsx(Fe,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(we,{children:[e.jsx(E,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),ae.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>e.jsx(E,{value:s.id,children:s.nombre},s.id))]})]})]})]}),e.jsxs(at,{children:[e.jsx(L,{type:"button",variant:"outline",onClick:()=>tt(!1),children:"Cancelar"}),e.jsx(L,{onClick:Dn,disabled:Xs,children:Xs?"Actualizando...":"Actualizar Producto"})]})]})})]})]}),e.jsx(de,{children:"Gestiona el cat√°logo de productos y servicios con cuentas contables asignadas"})]}),e.jsxs(Q,{children:[e.jsxs(Ye,{className:"mb-6",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsxs(Ge,{children:[e.jsx("strong",{children:"Recomendaci√≥n:"}),' Asignar subcuentas a cada producto ayuda a llevar un mejor control contable. La cuenta predeterminada es "4001 - Ventas".']})]}),e.jsx("div",{className:"space-y-6",children:it?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):$e.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay productos de servicios registrados a√∫n"}):e.jsxs("div",{className:"space-y-6",children:[ae.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>{const t=$e.filter(r=>r.subcuenta_id===s.id);return t.length===0?null:e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsxs(J,{className:"text-lg flex items-center",children:[e.jsx(Re,{className:"mr-2 h-5 w-5"}),"Subcuenta: ",s.nombre]}),e.jsxs(de,{children:[t.length," producto",t.length!==1?"s":""]})]}),e.jsx(Q,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(r=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[r.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:r.imagen_url,alt:r.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:r.nombre}),r.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:r.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",r.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>ya(r),className:"flex-1",children:"Editar"}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>qt.mutate(r.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},r.id))})})]},s.id)}),(()=>{const s=$e.filter(t=>!t.subcuenta_id);return s.length===0?null:e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsxs(J,{className:"text-lg flex items-center",children:[e.jsx(_a,{className:"mr-2 h-5 w-5"}),"Cuenta General: 4001 - Ventas"]}),e.jsxs(de,{children:[s.length," producto",s.length!==1?"s":""," sin subcuenta espec√≠fica"]})]}),e.jsx(Q,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(t=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[t.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:t.nombre}),t.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",t.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>ya(t),className:"flex-1",children:"Editar"}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>qt.mutate(t.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},t.id))})})]})})()]})})]})]})})]}),e.jsx(vs,{open:mn,onOpenChange:et,children:e.jsxs(ys,{children:[e.jsxs(ws,{children:[e.jsx(Ss,{children:"‚ùå Cancelar Transacci√≥n"}),e.jsx(Cs,{children:"Esta acci√≥n crear√° un asiento contable de reversi√≥n. La transacci√≥n original quedar√° marcada como cancelada pero mantendr√° toda su trazabilidad."})]}),e.jsxs("div",{className:"space-y-4",children:[es&&e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Transacci√≥n a cancelar:"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",es.descripcion]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Monto:"})," $",D(es.monto_total)]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(es.created_at).toLocaleDateString("es-ES")]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"motivo-cancelacion",children:"Motivo de la Cancelaci√≥n *"}),e.jsx(us,{id:"motivo-cancelacion",placeholder:"Ej: Error en registro, cliente cancel√≥ pedido, etc.",value:st,onChange:s=>Ft(s.target.value),rows:3})]}),e.jsxs(Ye,{children:[e.jsx(U,{className:"h-4 w-4"}),e.jsxs(Ge,{className:"text-xs",children:[e.jsx("strong",{children:"¬øQu√© suceder√°?"}),e.jsxs("ul",{className:"list-disc ml-4 mt-1 space-y-1",children:[e.jsx("li",{children:"Se crear√° un asiento de reversi√≥n autom√°ticamente"}),e.jsx("li",{children:'La transacci√≥n original se marcar√° como "cancelada"'}),e.jsx("li",{children:"Si es venta de inventario, el stock se restaurar√°"}),e.jsx("li",{children:"Ambas transacciones quedar√°n visibles para auditor√≠a"})]})]})]})]}),e.jsxs(at,{children:[e.jsx(L,{variant:"outline",onClick:()=>{et(!1),Ft(""),Pt(null)},disabled:Dt,children:"Cancelar"}),e.jsx(L,{variant:"destructive",onClick:Cn,disabled:Dt||!st.trim(),children:Dt?"Cancelando...":"Confirmar Cancelaci√≥n"})]})]})})]})]})};export{rr as default};
