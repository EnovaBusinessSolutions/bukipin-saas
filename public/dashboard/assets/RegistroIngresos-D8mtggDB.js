import{c as cn,r as m,a as ln,u as dn,b as mn,d as un,e as xn,f as hn,g as pn,h as jn,i as gn,j as fn,k as vn,l as e,D as is,m as os,n as cs,o as ls,C as M,p as ds,S as Ve,q as ea,R as fe,s as k,L as h,I as E,t as Rs,B as L,v as ee,T as Nn,w as bn,x as Os,y as zs,z as W,A as q,E as G,F as ae,G as Y,H as sa,P as ve,J as vt,U as ms,K as Me,M as Re,N as xe,O as he,Q as pe,V as je,W as F,X as Ze,Y as yn,Z as wn,_ as ta,$ as aa,a0 as na,a1 as ra,a2 as ia,a3 as oa,a4 as ca,a5 as la,a6 as us,a7 as Cn,a8 as da,a9 as ma,aa as ua,ab as xs,ac as Sn,ad as Ls,ae as hs,af as xa,ag as ha,ah as Bs,ai as _n,aj as Pn,ak as Fn,al as Dn,am as Nt,an as pa}from"./index-BxFHA0Co.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const In=cn("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),Tn=P=>{const D=(P==null?void 0:P.data)??P??[];return Array.isArray(D)?D:[]},$n=(P=10)=>{const[D,T]=m.useState([]),[b,R]=m.useState(!0),[Te,ce]=m.useState(null),Pe=async()=>{try{R(!0),ce(null);const ie=await ln(`/api/transacciones/ingresos/recientes?limit=${encodeURIComponent(String(P))}`,{method:"GET"}),$e=Tn(ie).map(Ke=>{var oe;return{...Ke,asiento_fecha:Ke.asiento_fecha??(Array.isArray(Ke.asiento)&&Ke.asiento.length>0?((oe=Ke.asiento[0])==null?void 0:oe.fecha)??null:null)}});T($e)}catch(ie){console.error("Error fetching transacciones recientes:",ie),ce((ie==null?void 0:ie.message)||"Error desconocido")}finally{R(!1)}};return m.useEffect(()=>{let ie=!0;Pe();const $e=window.setInterval(()=>{ie&&Pe()},3e4);return()=>{ie=!1,window.clearInterval($e)}},[P]),{transacciones:D,loading:b,error:Te,refetch:Pe}};async function _e(P,D={}){const T=await fetch(P,{credentials:"include",headers:{"Content-Type":"application/json",...D.headers||{}},...D}),b=await T.json().catch(()=>({}));if(!T.ok){const R=(b==null?void 0:b.error)||(b==null?void 0:b.message)||`HTTP ${T.status}`;throw new Error(R)}return(b==null?void 0:b.data)??b}async function bt(P,D={}){const T=(D==null?void 0:D.body)??{};try{if(P==="registrar-ingreso")return{data:await _e("/api/ingresos",{method:"POST",body:JSON.stringify(T)}),error:null};if(P==="cancelar-ingreso"){const R=T==null?void 0:T.transaccionId;return{data:await _e(`/api/ingresos/${encodeURIComponent(R)}/cancelar`,{method:"POST",body:JSON.stringify({motivoCancelacion:T==null?void 0:T.motivoCancelacion})}),error:null}}return{data:await _e(`/api/functions/${encodeURIComponent(P)}`,{method:"POST",body:JSON.stringify(T)}),error:null}}catch(b){return{data:null,error:{message:(b==null?void 0:b.message)||String(b)}}}}const _=P=>(typeof P=="string"?parseFloat(P):P).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),S=(P,D)=>{let T=P,b="";return D==="miles"?(T=P/1e3,b=" K"):D==="millones"&&(T=P/1e6,b=" M"),T.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})+b},Se=(P,D)=>D==="brutas"?P.monto_total||0:D==="descuentos"?P.monto_descuento||0:D==="netas"&&(P.monto_neto||P.monto_total)||0,yt=P=>{const[D,T,b]=P.split("-").map(Number);return new Date(D,T-1,b)},kn=P=>{const{x:D,y:T,width:b,height:R,name:Te,value:ce,porcentaje:Pe}=P,Ye=Te==="Efectivo"?"hsl(180 50% 55%)":"hsl(180 45% 45%)",$e=b>100&&R>70;return e.jsxs("g",{children:[e.jsx("rect",{x:D,y:T,width:b,height:R,fill:Ye,stroke:"#fff",strokeWidth:2}),$e&&e.jsxs(e.Fragment,{children:[e.jsx("text",{x:D+b/2,y:T+R/2-20,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontWeight:"bold",fontSize:"16px",style:{userSelect:"none"},children:Te}),e.jsxs("text",{x:D+b/2,y:T+R/2+5,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:["$",S(ce,"general")]}),e.jsxs("text",{x:D+b/2,y:T+R/2+25,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:[Pe,"%"]})]})]})},An=({active:P,payload:D,scaleFormat:T})=>{if(P&&D&&D.length){const b=D[0].payload,R=b.name==="Efectivo";return e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-lg p-3",children:[e.jsx("p",{className:"font-bold text-foreground mb-1",children:b.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Monto: ",e.jsxs("span",{className:"font-semibold text-foreground",children:["$",S(b.value,T)]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Porcentaje: ",e.jsxs("span",{className:"font-semibold text-foreground",children:[b.porcentaje,"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2 italic",children:R?"Se registra en Efectivo (Caja)":"Se registra en Bancos"})]})}return null},Rn=()=>{const{ventasResumen:P,loading:D,refetch:T}=dn(),{transacciones:b,loading:R,refetch:Te}=$n(1e3),{data:ce=[]}=mn(),{data:Pe}=un(),ie=(Pe==null?void 0:Pe.cuentasFlat)||[],{data:Ye=[],isLoading:$e,refetch:Ke}=xn(),{data:oe=[],isLoading:Us,refetch:ja}=hn(),{data:Oe=[],isLoading:ga}=pn(),fa=jn(),va=gn(),wt=fn(),Na=vn(),[$,Ct]=m.useState(""),[ba,ya]=m.useState(!1),[wa,Ca]=m.useState(""),[ps,St]=m.useState(""),[I,_t]=m.useState(""),[ge,ze]=m.useState(""),[js,He]=m.useState(""),[Pt,gs]=m.useState(!1),[J,Ft]=m.useState(""),[Ne,Ws]=m.useState(""),[Je,fs]=m.useState(""),[be,vs]=m.useState(""),[ye,Ns]=m.useState(""),[Fe,bs]=m.useState(""),[ys,Dt]=m.useState(""),[we,It]=m.useState(""),[ws,qs]=m.useState(""),[ke,Cs]=m.useState([]),[Sa,es]=m.useState(!1),[v,Ss]=m.useState(null),[Qe,Gs]=m.useState("historico"),[ne,ss]=m.useState(""),[Q,_a]=m.useState("diario"),[y,Pa]=m.useState("general"),[f,Fa]=m.useState("brutas"),[O,Da]=m.useState("ventas"),[le,Ia]=m.useState(new Date),[A,Ta]=m.useState(new Date),[ts,$a]=m.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[as,ka]=m.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[ns,Aa]=m.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[V,Tt]=m.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]}),[En,_s]=m.useState([]),[Ae,Ea]=m.useState([]),[De,$t]=m.useState(""),[Ie,kt]=m.useState(""),[de,At]=m.useState("todos"),[me,Et]=m.useState("todas"),[Z,Vt]=m.useState(""),[Xe,Va]=m.useState("subcuenta"),[Le,Ys]=m.useState(null),[Ma,Mt]=m.useState(!1),[se,Ks]=m.useState(""),[Be,rs]=m.useState(""),[Ee,Hs]=m.useState("1"),[Ps,Js]=m.useState(0),[Qs,Fs]=m.useState(!0),[Xs,Zs]=m.useState("0"),[Ue,et]=m.useState("monto"),[K,Ds]=m.useState([]),[We,st]=m.useState(""),[Is,tt]=m.useState(""),[Ts,at]=m.useState("1"),[nt,Rt]=m.useState("0"),[qe,Ra]=m.useState("monto"),[X,$s]=m.useState([]),[Oa,rt]=m.useState(!1),[it,Ot]=m.useState(""),[ot,zt]=m.useState(""),[Lt,Bt]=m.useState(""),[Vn,za]=m.useState("4001"),[Ut,Wt]=m.useState(""),[La,qt]=m.useState(null);m.useState(null);const[ks,As]=m.useState(!1),[Ba,Es]=m.useState(!1),[Ge,ct]=m.useState(null),[Vs,lt]=m.useState(""),[dt,Gt]=m.useState(!1),[Ua,Ms]=m.useState(!1),[Wa,Yt]=m.useState(null),[mt,ut]=m.useState(""),[xt,ht]=m.useState(""),[Kt,pt]=m.useState(""),[qa,jt]=m.useState(null),[Ht,gt]=m.useState(null),[Jt,Qt]=m.useState(""),Ce=Ye||[],Ga=s=>{var c;Ks(s);const a=Ce.find(o=>o.id===s);if(a){const o=a.precio_venta,r=o&&o>0?o.toString():((c=a.costo_unitario)==null?void 0:c.toString())||"0",t=o&&o>0;Fs(t),rs(r),Js(a.cantidad_stock||0),He(`Venta de ${a.nombre}`);const l=((o&&o>0?o:a.costo_unitario||0)*parseFloat(Ee)).toFixed(2);ze(l)}},Ya=s=>{if(rs(s),se&&s){const a=(parseFloat(s)*parseFloat(Ee||"1")).toFixed(2);ze(a)}},Ka=()=>{if(!We)return;const s=oe.find(l=>l.id===We);if(!s)return;const a=parseFloat(Ts)||1,c=parseFloat(nt)||0,o=s.precio*a,r=qe==="porcentaje"?o*(c/100):c,t=Math.max(0,o-r),d=X.findIndex(l=>l.id===We);if(d!==-1){const l=[...X];l[d].cantidad+=a,l[d].descuento+=r;const u=l[d].precio*l[d].cantidad;l[d].subtotal=Math.max(0,u-l[d].descuento),$s(l)}else $s([...X,{id:s.id,nombre:s.nombre,precio:s.precio,cantidad:a,descuento:r,subtotal:t,imagen_url:s.imagen_url}]);st(""),at("1"),tt(""),Rt("0")},Ha=s=>{$s(X.filter(a=>a.id!==s))},Ja=()=>{if(!se)return;const s=Ce.find(u=>u.id===se);if(!s)return;const a=parseFloat(Ee)||1,c=parseFloat(Be)||0,o=parseFloat(Xs)||0,r=c*a,t=Ue==="porcentaje"?r*(o/100):o,d=Math.max(0,r-t),l=K.findIndex(u=>u.id===se);if(l!==-1){const u=[...K];u[l].cantidad+=a,u[l].descuento+=t;const n=u[l].precioUnitario*u[l].cantidad;u[l].subtotal=Math.max(0,n-u[l].descuento),Ds(u)}else Ds([...K,{id:se,nombre:s.nombre,precioUnitario:c,cantidad:a,descuento:t,subtotal:d,stockDisponible:s.cantidad_stock||0,costoUnitario:s.costo_unitario||0,imagen_url:s.imagen_url}]);Ks(""),Hs("1"),rs(""),Zs("0"),et("monto"),Js(0),Fs(!0),ee({title:"‚úÖ Producto agregado",description:`${s.nombre} agregado a la venta`})},Qa=s=>{Ds(K.filter(a=>a.id!==s)),ee({title:"Producto eliminado",description:"El producto ha sido removido de la venta"})};m.useEffect(()=>{if($==="precargados"&&X.length>0){const s=X.reduce((a,c)=>a+c.subtotal,0).toFixed(2);ze(s),He(`Venta de ${X.length} producto(s)`)}},[X,$]),m.useEffect(()=>{if($==="inventariados"&&K.length>0){const s=K.reduce((a,c)=>a+c.subtotal,0).toFixed(2);ze(s),He(`Venta de ${K.length} producto(s) de inventario`)}},[K,$]);const Xa=s=>{st(s);const a=oe.find(c=>c.id===s);a&&tt(a.precio.toString())},Xt=()=>{const s=[];return $||s.push("Tipo de Ingreso"),$==="precargados"?X.length===0&&s.push("Debe agregar al menos un producto"):$==="inventariados"?K.length===0&&s.push("Debe agregar al menos un producto del inventario"):($==="general"||$==="otros")&&(js.trim()||s.push("Descripci√≥n")),$!=="precargados"&&$!=="inventariados"&&(!ge||parseFloat(ge)<=0)&&s.push("Monto Total"),(I==="credito"||I==="parcial")&&(J||s.push("Tipo de Cliente"),J==="recurrente"&&!Ne&&s.push("Cliente Seleccionado"),J==="nuevo"&&(Je.trim()||s.push("Nombre del Cliente"),be.trim()||s.push("Tel√©fono del Cliente"),ye.trim()||s.push("Email del Cliente")),ys||s.push("Fecha de Vencimiento"),I==="parcial"&&((!we||parseFloat(we)<=0)&&s.push("Monto Abonado"),ge&&we&&parseFloat(we)>=parseFloat(ge)&&s.push("Monto Abonado debe ser menor al total"))),(I==="contado"||I==="parcial")&&!ps&&s.push("M√©todo de Pago"),I||s.push("Tipo de Pago"),s},H=s=>Xt().includes(s),Za=(s,a,c)=>{const o=[];return!Oe||Oe.length===0||Oe.forEach(r=>{r.telefono&&s&&r.telefono.trim()===s.trim()&&o.push(`El tel√©fono ${s} ya est√° registrado para el cliente "${r.nombre}"`),r.email&&a&&r.email.trim().toLowerCase()===a.trim().toLowerCase()&&o.push(`El correo ${a} ya est√° registrado para el cliente "${r.nombre}"`),r.rfc&&c&&r.rfc.trim().toUpperCase()===c.trim().toUpperCase()&&o.push(`El RFC ${c} ya est√° registrado para el cliente "${r.nombre}"`)}),o};m.useEffect(()=>{if(J==="nuevo"&&(be||ye||Fe)){const s=Za(be,ye,Fe);Cs(s)}else Cs([])},[be,ye,Fe,J,Oe]),m.useEffect(()=>{(async()=>{var a;try{const c=await _e("/api/ingresos/asientos-directos"),o=(c==null?void 0:c.asientos)??((a=c==null?void 0:c.data)==null?void 0:a.asientos)??c??[],r=null;if(!o)return;const t=o.filter(d=>d.detalle_asientos.some(l=>l.cuenta_codigo.startsWith("4")&&l.cuenta_codigo!=="4003"&&Number(l.haber)>0));Ea(t)}catch(c){console.error("Error al cargar asientos directos:",c)}})()},[]),m.useEffect(()=>{(async()=>{var a,c;try{let o,r;Q==="diario"?(o=new Date(le),o.setHours(0,0,0,0),r=new Date(le),r.setHours(23,59,59,999)):Q==="mensual"?(o=new Date(A.getFullYear(),A.getMonth(),1),r=new Date(A.getFullYear(),A.getMonth()+1,0,23,59,59,999)):(o=new Date(new Date().getFullYear(),0,1),r=new Date(new Date().getFullYear(),11,31,23,59,59,999));const t=await _e(`/api/ingresos/asientos?start=${encodeURIComponent(o.toISOString().split("T")[0])}&end=${encodeURIComponent(r.toISOString().split("T")[0])}`),d=(t==null?void 0:t.asientos)??((a=t==null?void 0:t.data)==null?void 0:a.asientos)??[],l=(t==null?void 0:t.detalles)??((c=t==null?void 0:t.data)==null?void 0:c.detalles)??[],u=null;if(!d||d.length===0){Tt({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]});return}const n=d.map(N=>N.id);let i=0,x=0,j=0;const p={};d.forEach(N=>{const w=l.filter(B=>B.asiento_id===N.id),C=yt(N.fecha);let z;Q==="diario"?z="Hoy":Q==="mensual"?z=`D√≠a ${C.getDate()}`:z=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][C.getMonth()],p[z]||(p[z]={ventasBrutas:0,descuentos:0,otrosIngresos:0}),w.forEach(B=>{const U=B.debe||0,re=B.haber||0,ue=B.cuenta_codigo;if(O==="ventas"){if(ue==="4001"){const te=re-U;i+=te,p[z].ventasBrutas+=te}if(ue==="4003"){const te=U-re;x+=te,p[z].descuentos+=te}}else if(ue.startsWith("4")&&ue!=="4001"&&ue!=="4003"){const te=re-U;j+=te,p[z].otrosIngresos+=te}})});let g=[];if(Q==="diario"){const N=p.Hoy||{ventasBrutas:0,descuentos:0,otrosIngresos:0};g=[{periodo:"Hoy",ventasBrutas:N.ventasBrutas,descuentos:N.descuentos,ventasNetas:N.ventasBrutas-N.descuentos,otrosIngresos:N.otrosIngresos}]}else if(Q==="mensual"){const N=new Date(A.getFullYear(),A.getMonth()+1,0).getDate();g=Array.from({length:N},(w,C)=>{const B=`D√≠a ${C+1}`,U=p[B]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:B,ventasBrutas:U.ventasBrutas,descuentos:U.descuentos,ventasNetas:U.ventasBrutas-U.descuentos,otrosIngresos:U.otrosIngresos}})}else g=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"].map(w=>{const C=p[w]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:w,ventasBrutas:C.ventasBrutas,descuentos:C.descuentos,ventasNetas:C.ventasBrutas-C.descuentos,otrosIngresos:C.otrosIngresos}});Tt({ventasBrutas:i,descuentos:x,ventasNetas:i-x,otrosIngresos:j,detallesPorPeriodo:g})}catch(o){console.error("Error calculando anal√≠ticas desde asientos:",o)}})()},[Q,le,A,O]),m.useEffect(()=>{(async()=>{try{const c=async l=>{var B;const u=new Date;let n,i;if(l==="dia")n=le.toISOString().split("T")[0],i=n;else if(l==="mes"){const U=A.getMonth(),re=A.getFullYear(),ue=new Date(re,U,1),te=new Date(re,U+1,0);n=ue.toISOString().split("T")[0],i=te.toISOString().split("T")[0]}else{const U=u.getFullYear();n=`${U}-01-01`,i=`${U}-12-31`}const x=await _e(`/api/ingresos/detalles?start=${encodeURIComponent(n)}&end=${encodeURIComponent(i)}`),j=(x==null?void 0:x.detalles)??((B=x==null?void 0:x.data)==null?void 0:B.detalles)??x??[],p=null;let g=0,N=0,w=0;(j||[]).forEach(U=>{const re=Number(U.debe)||0,ue=Number(U.haber)||0,te=U.cuenta_codigo;te==="4001"?g+=ue-re:te==="4003"?N+=re-ue:te!=null&&te.startsWith("4")&&(w+=ue-re)});const C=g-N,z=C+w;return{ventasBrutas:g,descuentos:N,ventasNetas:C,otrosIngresos:w,totalIngresos:z}},o=async()=>{var l;try{let u,n=new Date;Q==="diario"?(u=new Date(le),u.setHours(0,0,0,0),n=new Date(le),n.setHours(23,59,59,999)):Q==="mensual"?(u=new Date(A.getFullYear(),A.getMonth(),1),n=new Date(A.getFullYear(),A.getMonth()+1,0,23,59,59,999)):(u=new Date(A.getFullYear(),0,1),n=new Date(A.getFullYear(),11,31,23,59,59,999));const i=await _e(`/api/inventario/movimientos?tipo=venta&start=${encodeURIComponent(u.toISOString())}&end=${encodeURIComponent(n.toISOString())}`),x=(i==null?void 0:i.movimientos)??((l=i==null?void 0:i.data)==null?void 0:l.movimientos)??i??[],j=null;_s(x||[])}catch(u){console.error("Error en cargarMovimientosInventario:",u),_s([])}},[r,t,d]=await Promise.all([c("dia"),c("mes"),c("ano")]);$a(r),ka(t),Aa(d)}catch(c){console.error("Error calculando totales:",c)}})(),(async()=>{var c;try{let o,r=new Date;Q==="diario"?(o=new Date(le),o.setHours(0,0,0,0),r=new Date(le),r.setHours(23,59,59,999)):Q==="mensual"?(o=new Date(A.getFullYear(),A.getMonth(),1),r=new Date(A.getFullYear(),A.getMonth()+1,0,23,59,59,999)):(o=new Date(A.getFullYear(),0,1),r=new Date(A.getFullYear(),11,31,23,59,59,999));const t=await _e(`/api/inventario/movimientos?tipo=venta&start=${encodeURIComponent(o.toISOString())}&end=${encodeURIComponent(r.toISOString())}`),d=(t==null?void 0:t.movimientos)??((c=t==null?void 0:t.data)==null?void 0:c.movimientos)??t??[],l=null;_s(d||[])}catch(o){console.error("Error en loadMovimientos:",o),_s([])}})()},[le,A,Q,b]);const en=async s=>{var a;Mt(!0),Ys(null);try{const c=await _e(`/api/asientos/by-transaccion?source=ingreso&id=${encodeURIComponent(s)}`),o=(c==null?void 0:c.asiento)??((a=c==null?void 0:c.data)==null?void 0:a.asiento)??c;Ys(o)}catch(c){console.error("Error en loadAsientosContables:",c),ee({title:"Error",description:"Error inesperado al cargar asientos",variant:"destructive"})}finally{Mt(!1)}},sn=async()=>{var a;const s=Xt();if(s.length>0){ee({title:"‚ö†Ô∏è Campos requeridos faltantes",description:`Debes completar: ${s.join(", ")}`,variant:"destructive"});return}if($==="inventariados"){if(K.length===0){ee({title:"‚ö†Ô∏è No hay productos",description:"Debes agregar al menos un producto del inventario a la venta",variant:"destructive"});return}for(const c of K)if(c.cantidad>c.stockDisponible){const o=Ce.find(r=>r.id===c.id);Ss({productName:c.nombre,requested:c.cantidad,available:c.stockDisponible,costoPorUnidad:(o==null?void 0:o.costo_unitario)||0,costoTotal:((o==null?void 0:o.costo_unitario)||0)*c.cantidad}),es(!0);return}await ft();return}if($==="inventariados"&&se){const c=parseFloat(Ee||"1");if(c>Ps){const o=Ce.find(l=>l.id===se);let r=(o==null?void 0:o.costo_unitario)||0;if(r===0){const l=await _e(`/api/inventario/productos/${encodeURIComponent(se)}/movimientos?tipo=compra`),u=(l==null?void 0:l.movimientos)??((a=l==null?void 0:l.data)==null?void 0:a.movimientos)??l??[];if(u&&u.length>0){let n=0,i=0;for(const x of u)x.costo_unitario>0&&x.cantidad>0&&(n+=x.costo_unitario*x.cantidad,i+=x.cantidad);i>0&&(r=n/i)}}const t=c-Ps,d=r*t;Ss({productName:(o==null?void 0:o.nombre)||"Producto",requested:c,available:Ps,costoPorUnidad:r,costoTotal:d}),es(!0);return}}J==="nuevo"&&ke.length>0&&!confirm(`Se detectaron posibles duplicados:

${ke.join(`
`)}

¬øDeseas continuar registrando este cliente de todas formas?`)||await ft()},ft=async()=>{gs(!0);try{let s=null;if(J==="nuevo"&&Je.trim())try{s=(await Na.mutateAsync({nombre:Je.trim(),email:ye.trim()||void 0,telefono:be.trim()||void 0,rfc:Fe.trim()||void 0})).id}catch(n){console.error("Error creating client:",n),ee({title:"Error al crear cliente",description:"No se pudo crear el cliente nuevo",variant:"destructive"}),gs(!1);return}else J==="recurrente"&&Ne&&(s=Ne);const a=Ce.find(n=>n.id===se);let c=js,o=Number(ge||"0"),r=null,t=0;if($==="precargados"&&X.length>0){const n=oe.find(j=>j.id===X[0].id);r=(n==null?void 0:n.subcuenta_id)||null;const i=X.reduce((j,p)=>j+p.precio*p.cantidad,0),x=X.reduce((j,p)=>j+p.descuento,0);o=i,t=x,c=`Venta: ${X.map(j=>`${j.nombre} (x${j.cantidad})`).join(", ")}`}else $==="inventariados"&&(c="Venta de productos inventariados",o=0,r=null);$!=="precargados"&&(t=ba?Number(wa||"0"):0);const d=Math.max(0,Number((o-t).toFixed(2)));let l=0,u=0;if(I==="contado"?(l=d,u=0):I==="parcial"?(l=Number(we||"0"),u=Math.max(0,d-l)):I==="credito"&&(l=0,u=d),$==="inventariados"&&K.length>0){const n=K.reduce((g,N)=>g+N.precioUnitario*N.cantidad,0),i=K.reduce((g,N)=>g+N.descuento,0),x=n-i;let j=0,p=0;I==="contado"?(j=x,p=0):I==="parcial"?(j=Number(we||"0"),p=Math.max(0,x-j)):I==="credito"&&(j=0,p=x);for(const g of K){const N=Ce.find(ue=>ue.id===g.id);if(!N)continue;const w=K.length===1?`Venta de ${g.nombre}`:`Venta m√∫ltiple (${K.length} productos): ${g.nombre}`,C=g.subtotal/x,z=j*C,B=p*C,{data:U,error:re}=await bt("registrar-ingreso",{body:{tipoIngreso:"inventariados",descripcion:w,montoTotal:g.precioUnitario*g.cantidad,montoDescuento:g.descuento,cuentaPrincipalCodigo:"4001",subcuentaId:N.subcuenta_id||null,metodoPago:ps,tipoPago:I,montoPagado:z,montoPendiente:B,clienteNombre:Je.trim()||null,clienteTelefono:be.trim()||null,clienteEmail:ye.trim()||null,clienteRFC:Fe.trim()||null,clienteId:s,fechaVencimiento:ys||null,comentarios:ws.trim()||null,productoId:g.id,cantidadVendida:g.cantidad,precioVenta:g.precioUnitario,costoPersonalizado:Qe==="personalizado"&&ne?parseFloat(ne):void 0}});if(re)throw re}ee({title:"‚úÖ Venta registrada exitosamente",description:`Se registraron ${K.length} productos del inventario`,duration:5e3})}else{if(!c||o<=0){ee({title:"‚ö†Ô∏è Datos incompletos",description:"Selecciona un producto v√°lido o ingresa una descripci√≥n y monto.",variant:"destructive"}),gs(!1);return}const{data:n,error:i}=await bt("registrar-ingreso",{body:{tipoIngreso:$,descripcion:c,montoTotal:o,montoDescuento:t,cuentaPrincipalCodigo:$==="otros"?"4102":"4001",subcuentaId:r||void 0,metodoPago:ps,tipoPago:I,montoPagado:l,montoPendiente:u,clienteNombre:Je.trim()||null,clienteTelefono:be.trim()||null,clienteEmail:ye.trim()||null,clienteRFC:Fe.trim()||null,clienteId:s,fechaVencimiento:ys||null,comentarios:ws.trim()||null,...$==="inventariados"&&a&&{productoId:a.id,cantidadVendida:Number(Ee||"1"),precioVenta:Number(Be||"0"),costoPersonalizado:Qe==="personalizado"&&ne?Number(ne):void 0}}});if(i)throw i;ee({title:"Ingreso registrado",description:`Asiento ${n.numeroAsiento} creado correctamente`})}await Promise.all([T(),Te()]),$==="inventariados"&&window.location.reload(),Ct(""),He(""),ze(""),Ca(""),ya(!1),St(""),_t(""),Ft(""),Ws(""),fs(""),vs(""),Ns(""),bs(""),Dt(""),It(""),qs(""),Cs([]),st(""),tt(""),at("1"),$s([]),Ks(""),rs(""),Hs("1"),Js(0),Fs(!0),Ds([]),Zs("0"),et("monto")}catch(s){ee({title:"Error",description:s.message||"Error al registrar el ingreso",variant:"destructive"})}finally{gs(!1)}},tn=async()=>{if(!Ge||!Vs.trim()){ee({title:"‚ö†Ô∏è Motivo requerido",description:"Debes ingresar el motivo de la cancelaci√≥n",variant:"destructive"});return}Gt(!0);try{console.log("Cancelando transacci√≥n:",Ge.id);const{data:s,error:a}=await bt("cancelar-ingreso",{body:{transaccionId:Ge.id,motivoCancelacion:Vs.trim()}});if(console.log("Respuesta de edge function:",{data:s,error:a}),a)throw console.error("Error de edge function:",a),new Error(a.message||JSON.stringify(a));if(s!=null&&s.error)throw console.error("Error en data:",s),new Error(s.error);ee({title:"‚úì Transacci√≥n cancelada",description:`Asiento de reversi√≥n ${(s==null?void 0:s.numeroAsientoReversion)||"creado"} correctamente`}),await Promise.all([T(),Te()]),lt(""),ct(null),Es(!1)}catch(s){console.error("Error completo al cancelar:",s),ee({title:"‚ùå Error al cancelar",description:(s==null?void 0:s.message)||(s==null?void 0:s.toString())||"No se pudo cancelar la transacci√≥n",variant:"destructive"})}finally{Gt(!1)}},an=s=>{switch(s){case"precargados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Me,{children:[e.jsx(M,{className:"h-4 w-4"}),e.jsxs(Re,{children:[e.jsx("strong",{children:"Recordatorio:"}),' Para registrar ventas de productos precargados, primero debes agregar los productos al cat√°logo desde la pesta√±a "Cat√°logo de Productos".']})]}),e.jsxs(W,{className:"bg-muted/50",children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-base",children:"Agregar Productos a la Venta"})}),e.jsxs(Y,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"producto-precargado",children:"Seleccionar Producto"}),e.jsxs(xe,{value:We,onValueChange:Xa,children:[e.jsx(he,{children:e.jsx(pe,{placeholder:Us?"Cargando productos...":"Seleccionar producto del cat√°logo"})}),e.jsx(je,{className:"max-h-80 z-50 bg-background border border-border w-full",children:Us?e.jsx(F,{value:"loading",disabled:!0,children:"Cargando productos..."}):oe.length===0?e.jsx(F,{value:"empty",disabled:!0,children:"No hay productos de servicios registrados"}):oe.map(a=>e.jsx(F,{value:a.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:a.imagen_url?e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate mb-1",children:a.nombre}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",_(a.precio)]})]})]})},a.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cantidad",children:"Cantidad"}),e.jsx(E,{id:"cantidad",type:"number",placeholder:"1",min:"1",value:Ts,onChange:a=>at(a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"precio-unitario",children:"Precio Unitario"}),e.jsx(E,{id:"precio-unitario",type:"number",placeholder:"0.00",value:Is,readOnly:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"descuento-producto",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(fe,{value:qe,onValueChange:a=>Ra(a),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"monto",id:"descuento-monto"}),e.jsx(h,{htmlFor:"descuento-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"porcentaje",id:"descuento-porcentaje"}),e.jsx(h,{htmlFor:"descuento-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(E,{id:"descuento-producto",type:"number",placeholder:qe==="porcentaje"?"0":"0.00",min:"0",max:qe==="porcentaje"?"100":void 0,step:qe==="porcentaje"?"1":"0.01",value:nt,onChange:a=>Rt(a.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:qe==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Subtotal con Descuento"}),e.jsx(E,{type:"text",value:We&&Is?(()=>{const a=parseFloat(Is)*parseFloat(Ts||"1"),c=parseFloat(nt||"0"),o=qe==="porcentaje"?Math.max(0,a-a*c/100):Math.max(0,a-c);return`$${_(o)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(L,{type:"button",onClick:Ka,disabled:!We,className:"w-full",variant:"secondary",children:[e.jsx(Nt,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),X.length>0&&e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsxs(G,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",X.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",_(X.reduce((a,c)=>a+c.subtotal,0))]})]})}),e.jsx(Y,{children:e.jsx("div",{className:"space-y-2",children:X.map((a,c)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:a.imagen_url?e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:a.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[a.cantidad," x $",_(a.precio)," = $",_(a.cantidad*a.precio)]}),a.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",_(a.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",_(a.subtotal)]})]})]})]}),e.jsx(L,{type:"button",variant:"ghost",size:"sm",onClick:()=>Ha(a.id),className:"text-destructive hover:text-destructive",children:e.jsx(M,{className:"h-4 w-4"})})]},`${a.id}-${c}`))})})]}),H("Debe agregar al menos un producto")&&e.jsxs(Me,{variant:"destructive",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx(Re,{children:"Debes agregar al menos un producto a la venta"})]})]});case"inventariados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Me,{children:[e.jsx(M,{className:"h-4 w-4"}),e.jsxs(Re,{children:[e.jsx("strong",{children:"Ventas desde Inventario:"})," Selecciona productos, aplica descuentos opcionales y agr√©galos a la venta. Si vendes m√°s de lo disponible, se te pedir√° confirmar la sobreventa."]})]}),e.jsxs(W,{className:"bg-muted/50",children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-base",children:"Agregar Productos del Inventario"})}),e.jsxs(Y,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"producto-inventario",children:"Seleccionar Producto"}),e.jsxs(xe,{value:se,onValueChange:Ga,children:[e.jsx(he,{children:e.jsx(pe,{placeholder:$e?"Cargando inventario...":"Seleccionar producto del inventario"})}),e.jsx(je,{className:"max-h-80 z-50 bg-background border border-border w-full",children:$e?e.jsx(F,{value:"loading",disabled:!0,children:"Cargando inventario..."}):Ce.length===0?e.jsx(F,{value:"empty",disabled:!0,children:"No hay productos con stock disponible"}):Ce.map(a=>e.jsx(F,{value:a.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:a.imagen_url?e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:a.nombre}),e.jsxs("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full flex-shrink-0 ml-2",children:["Stock: ",a.cantidad_stock||0]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Costo: $",a.costo_unitario||0]}),a.precio_venta&&a.precio_venta>0?e.jsxs("span",{className:"text-xs text-green-600 font-medium",children:["Venta: $",a.precio_venta]}):e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"‚ö†Ô∏è Sin precio"})]})]})]})},a.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cantidad-inv",children:"Cantidad a Vender"}),e.jsx(E,{id:"cantidad-inv",type:"number",min:"1",value:Ee,onChange:a=>Hs(a.target.value)}),se&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Stock disponible: ",Ps," unidades"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"precio-inv",children:"Precio Unitario"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(fe,{value:Qs?"registrado":"personalizado",onValueChange:a=>{const c=a==="registrado";if(Fs(c),c&&se){const o=Ce.find(r=>r.id===se);if(o){const r=o.precio_venta||o.costo_unitario||0;rs(r.toString())}}},className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"registrado",id:"precio-registrado"}),e.jsx(h,{htmlFor:"precio-registrado",className:"text-sm cursor-pointer",children:"Precio registrado"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"personalizado",id:"precio-personalizado"}),e.jsx(h,{htmlFor:"precio-personalizado",className:"text-sm cursor-pointer",children:"Personalizado"})]})]}),e.jsx(E,{id:"precio-inv",type:"number",step:"0.01",min:"0",value:Be,onChange:a=>Ya(a.target.value),readOnly:Qs,className:Qs?"bg-muted":""})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"descuento-inv",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(fe,{value:Ue,onValueChange:a=>et(a),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"monto",id:"descuento-inv-monto"}),e.jsx(h,{htmlFor:"descuento-inv-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"porcentaje",id:"descuento-inv-porcentaje"}),e.jsx(h,{htmlFor:"descuento-inv-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(E,{id:"descuento-inv",type:"number",placeholder:Ue==="porcentaje"?"0":"0.00",min:"0",max:Ue==="porcentaje"?"100":void 0,step:Ue==="porcentaje"?"1":"0.01",value:Xs,onChange:a=>Zs(a.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Ue==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Subtotal con Descuento"}),e.jsx(E,{type:"text",value:se&&Be?(()=>{const a=parseFloat(Be)*parseFloat(Ee||"1"),c=parseFloat(Xs||"0"),o=Ue==="porcentaje"?Math.max(0,a-a*c/100):Math.max(0,a-c);return`$${_(o)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(L,{type:"button",onClick:Ja,disabled:!se||!Be,className:"w-full",variant:"secondary",children:[e.jsx(Nt,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),K.length>0&&e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsxs(G,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",K.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",_(K.reduce((a,c)=>a+c.subtotal,0))]})]})}),e.jsx(Y,{children:e.jsx("div",{className:"space-y-2",children:K.map((a,c)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:a.imagen_url?e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:a.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[a.cantidad," x $",_(a.precioUnitario)," = $",_(a.cantidad*a.precioUnitario)]}),a.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",_(a.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",_(a.subtotal)]}),e.jsxs("span",{className:"text-xs",children:["Stock disponible: ",a.stockDisponible]})]})]})]}),e.jsx(L,{type:"button",variant:"ghost",size:"sm",onClick:()=>Qa(a.id),className:"text-destructive hover:text-destructive",children:e.jsx(M,{className:"h-4 w-4"})})]},`${a.id}-${c}`))})})]})]});case"general":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"descripcion-general",children:"Descripci√≥n del Ingreso"}),H("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(E,{id:"descripcion-general",placeholder:"Ej: Servicio de consultor√≠a",value:js,onChange:a=>He(a.target.value),className:H("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cuenta-contable",children:"Cuenta Contable"}),e.jsxs(xe,{defaultValue:"4001",children:[e.jsx(he,{children:e.jsx(pe,{placeholder:"4001 - Ventas"})}),e.jsx(je,{children:e.jsx(F,{value:"4001",children:"4001 - Ventas"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"subcuenta",children:"Subcuenta (Opcional)"}),e.jsxs(xe,{children:[e.jsx(he,{children:e.jsx(pe,{placeholder:"Seleccionar subcuenta"})}),e.jsx(je,{children:e.jsx(F,{value:"sub1",children:"Subcuenta ejemplo"})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"monto-general",children:"Monto"}),H("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(E,{id:"monto-general",type:"number",placeholder:"0.00",value:ge,onChange:a=>ze(a.target.value),className:H("Monto Total")?"border-destructive":""})]})]});case"otros":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Me,{children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx(Re,{children:"Este ingreso se ligar√° a la cuenta 4102 - Otros Productos."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"descripcion-otros",children:"Descripci√≥n del Ingreso Extraordinario"}),H("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(Ze,{id:"descripcion-otros",placeholder:"Ej: Venta extraordinaria de equipo usado, donaci√≥n recibida, etc.",value:js,onChange:a=>He(a.target.value),className:H("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"monto-otros",children:"Monto"}),H("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(E,{id:"monto-otros",type:"number",placeholder:"0.00",value:ge,onChange:a=>ze(a.target.value),className:H("Monto Total")?"border-destructive":""})]})]});default:return null}},nn=async()=>{if(!it.trim()||!ot.trim()){ee({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}As(!0);try{await fa.mutateAsync({nombre:it.trim(),precio:parseFloat(ot),descripcion:Lt.trim()||void 0,subcuentaId:Ut||void 0,imagen:La||void 0}),Ot(""),zt(""),Bt(""),za("4001"),Wt(""),qt(null),rt(!1)}catch{}finally{As(!1)}},Zt=s=>{var a;Yt(s),ut(s.nombre),ht(((a=s.precio)==null?void 0:a.toString())||""),pt(s.descripcion||""),gt(s.imagen_url||null),jt(null),Qt(s.subcuenta_id||""),Ms(!0)},rn=s=>{var c;const a=(c=s.target.files)==null?void 0:c[0];if(a){jt(a);const o=new FileReader;o.onloadend=()=>{gt(o.result)},o.readAsDataURL(a)}},on=async()=>{if(!mt.trim()||!xt.trim()){ee({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}As(!0);try{await va.mutateAsync({id:Wa.id,nombre:mt.trim(),precio:parseFloat(xt),descripcion:Kt.trim()||void 0,imagen:qa||void 0,subcuentaId:Jt||null}),Ms(!1),Yt(null),ut(""),ht(""),pt(""),jt(null),gt(null)}catch{}finally{As(!1)}};return e.jsxs("div",{className:"h-full overflow-hidden flex flex-col",children:[e.jsx(is,{open:Sa,onOpenChange:es,children:e.jsxs(os,{children:[e.jsxs(cs,{children:[e.jsxs(ls,{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(M,{className:"h-5 w-5"}),"Advertencia: Inventario Insuficiente"]}),e.jsxs(ds,{className:"space-y-3 pt-4",children:[e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-950/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx("p",{className:"font-medium mb-2",children:"Est√°s a punto de vender un producto sin suficiente inventario:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Producto:"}),e.jsx("span",{className:"font-medium",children:v==null?void 0:v.productName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cantidad solicitada:"}),e.jsx("span",{className:"font-medium",children:v==null?void 0:v.requested})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Stock disponible:"}),e.jsx("span",{className:"font-medium",children:v==null?void 0:v.available})]}),e.jsx(Ve,{}),e.jsxs("div",{className:"flex justify-between text-orange-600",children:[e.jsx("span",{className:"font-medium",children:"Faltante:"}),e.jsx("span",{className:"font-bold",children:((v==null?void 0:v.requested)||0)-((v==null?void 0:v.available)||0)})]})]})]}),(v==null?void 0:v.costoPorUnidad)&&v.costoPorUnidad>0&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border-2 border-blue-300 dark:border-blue-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ea,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),e.jsx("p",{className:"font-bold text-blue-700 dark:text-blue-300",children:"üìä Costo Promedio Hist√≥rico"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Costo promedio calculado:"}),e.jsxs("span",{className:"text-lg font-bold text-blue-700 dark:text-blue-300",children:["$",_(v.costoPorUnidad)," por unidad"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Este costo se calcul√≥ autom√°ticamente del promedio ponderado de todas tus compras anteriores de este producto. Puedes usar este costo sugerido o ingresar uno personalizado si conoces el costo real de esta venta."})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"font-medium mb-3 text-blue-700 dark:text-blue-400",children:"Impacto en el inventario:"}),v!=null&&v.costoPorUnidad&&v.costoPorUnidad>0?e.jsxs(e.Fragment,{children:[e.jsxs(fe,{value:Qe,onValueChange:s=>{Gs(s),s==="historico"&&ss("")},className:"space-y-3 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"historico",id:"costo-historico"}),e.jsxs(h,{htmlFor:"costo-historico",className:"text-sm cursor-pointer",children:["Usar costo hist√≥rico: ",e.jsxs("strong",{className:"text-blue-700 dark:text-blue-400",children:["$",_(v.costoPorUnidad)]})," por unidad"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"personalizado",id:"costo-personalizado"}),e.jsx(h,{htmlFor:"costo-personalizado",className:"text-sm cursor-pointer",children:"Ingresar costo personalizado"})]})]}),Qe==="personalizado"&&e.jsxs("div",{className:"mb-3",children:[e.jsx(h,{htmlFor:"costo-custom",className:"text-xs",children:"Costo unitario personalizado"}),e.jsx(E,{id:"costo-custom",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:ne,onChange:s=>ss(s.target.value),className:"mt-1"})]}),e.jsx(Ve,{className:"my-3"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Costo por unidad aplicado:"}),e.jsxs("span",{className:"font-medium",children:["$",_(Qe==="personalizado"&&ne?ne:v.costoPorUnidad)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",_((Qe==="personalizado"&&ne?Number(ne):v.costoPorUnidad)*(((v==null?void 0:v.requested)||0)-((v==null?void 0:v.available)||0)))]})]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"‚ö†Ô∏è Este producto no tiene costo hist√≥rico registrado."}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"costo-requerido",className:"text-xs",children:"Ingresa el costo unitario para esta transacci√≥n"}),e.jsx(E,{id:"costo-requerido",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:ne,onChange:s=>ss(s.target.value),className:"mt-1"})]}),ne&&Number(ne)>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ve,{}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",_(Number(ne)*(((v==null?void 0:v.requested)||0)-((v==null?void 0:v.available)||0)))]})]})]})]})]}),e.jsxs("p",{className:"text-sm",children:["Si contin√∫as, el inventario quedar√° en ",e.jsxs("strong",{className:"text-destructive",children:["negativo (",((v==null?void 0:v.available)||0)-((v==null?void 0:v.requested)||0)," unidades)"]}),". Esto se reflejar√° en tu control de inventario con el valor mostrado arriba."]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"¬øDeseas continuar con la venta de todas formas?"})]})]}),e.jsxs(Rs,{className:"gap-2 sm:gap-0",children:[e.jsx(L,{variant:"outline",onClick:()=>{es(!1),Ss(null),Gs("historico"),ss("")},children:"Cancelar"}),e.jsxs(L,{variant:"destructive",onClick:async()=>{if((!(v!=null&&v.costoPorUnidad)||v.costoPorUnidad===0)&&(!ne||Number(ne)<=0)){ee({title:"Costo requerido",description:"Debes ingresar un costo unitario para continuar",variant:"destructive"});return}es(!1),Ss(null),await ft(),Gs("historico"),ss("")},children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Continuar con la Venta"]})]})]})}),e.jsxs("div",{className:"p-6 border-b bg-background",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Registro de Ingresos"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Registra ventas, gestiona cat√°logos y analiza ingresos de la empresa"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[e.jsxs(Nn,{defaultValue:"registro",className:"w-full",children:[e.jsxs(bn,{className:"grid w-full grid-cols-4",children:[e.jsx(Os,{value:"registro",children:"Registro de Ingresos"}),e.jsx(Os,{value:"resumen",children:"Resumen de Ventas"}),e.jsx(Os,{value:"analitica",children:"Anal√≠tica de Ventas"}),e.jsx(Os,{value:"catalogo",children:"Cat√°logo de Productos"})]}),e.jsx(zs,{value:"registro",className:"mt-6 space-y-6",children:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Nuevo Registro de Ingreso"}),e.jsx(ae,{children:"Selecciona el tipo de ingreso y completa la informaci√≥n requerida"})]}),e.jsxs(Y,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(h,{className:"text-base font-semibold",children:"Tipo de Ingreso"}),e.jsx(fe,{value:$,onValueChange:Ct,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50",children:[e.jsx(k,{value:"precargados",id:"precargados"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(sa,{className:"h-5 w-5 text-primary"}),e.jsx(h,{htmlFor:"precargados",className:"cursor-pointer flex-1",children:e.jsx("div",{className:"font-medium",children:"Productos Precargados"})})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50",children:[e.jsx(k,{value:"inventariados",id:"inventariados"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ve,{className:"h-5 w-5 text-primary"}),e.jsxs(h,{htmlFor:"inventariados",className:"cursor-pointer flex-1",children:[e.jsx("div",{className:"font-medium",children:"Productos Inventariados"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Del inventario registrado"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50",children:[e.jsx(k,{value:"general",id:"general"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(vt,{className:"h-5 w-5 text-primary"}),e.jsxs(h,{htmlFor:"general",className:"cursor-pointer flex-1",children:[e.jsx("div",{className:"font-medium",children:"Ingreso General"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Operaci√≥n no inventariada"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50",children:[e.jsx(k,{value:"otros",id:"otros"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(In,{className:"h-5 w-5 text-primary"}),e.jsxs(h,{htmlFor:"otros",className:"cursor-pointer flex-1",children:[e.jsx("div",{className:"font-medium",children:"Otros Ingresos"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Extraordinarios, donaciones"})]})]})]})]})})]}),$&&e.jsxs("div",{className:"space-y-6 p-4 border rounded-lg bg-muted/20",children:[an($),e.jsx(Ve,{}),e.jsx("div",{className:"space-y-4",children:($==="precargados"&&We||$==="inventariados"&&se)&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"C√°lculo Autom√°tico"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cantidad:"}),e.jsx("span",{children:$==="precargados"?Ts:Ee})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Precio Unitario:"}),e.jsxs("span",{children:["$",$==="precargados"?Is:Be]})]}),e.jsx(Ve,{}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",ge]})]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"font-medium",children:"Estado del Pago"}),H("Tipo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(fe,{value:I,onValueChange:_t,className:H("Tipo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{value:"contado",id:"contado"}),e.jsx(h,{htmlFor:"contado",className:"cursor-pointer",children:"Pago Total"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{value:"parcial",id:"parcial"}),e.jsx(h,{htmlFor:"parcial",className:"cursor-pointer",children:"Pago parcial"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{value:"credito",id:"credito"}),e.jsx(h,{htmlFor:"credito",className:"cursor-pointer",children:"Adeudo Total"})]})]}),I==="parcial"&&e.jsxs("div",{className:"ml-6 p-4 border rounded-lg bg-blue-50 dark:bg-blue-950/20 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"monto-abonado",children:"Monto que se va a pagar"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Monto Abonado")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(E,{id:"monto-abonado",type:"number",step:"0.01",placeholder:"0.00",value:we,onChange:s=>It(s.target.value),className:H("Monto Abonado")?"border-destructive":""})]}),ge&&we&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-3 bg-white dark:bg-gray-900 rounded border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de la venta"}),e.jsxs("p",{className:"text-lg font-semibold text-primary",children:["$",_(ge)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Se pagar√° ahora"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:["$",_(we)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Queda pendiente"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["$",_(parseFloat(ge)-parseFloat(we))]})]})]})]})]}),e.jsx(Ve,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ms,{className:"h-5 w-5"}),e.jsx(h,{className:"font-medium",children:"Datos del Cliente"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:I==="contado"?"Opcional - Para anal√≠ticas y comentarios":"Obligatorio para cuentas por cobrar"})]}),I==="contado"&&e.jsxs(Me,{children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx(Re,{children:"Asignar cliente es opcional para pagos totales. √ötil para anal√≠ticas de ventas y seguimiento de clientes."})]}),(I==="parcial"||I==="credito")&&e.jsxs(Me,{children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx(Re,{children:"Se registrar√° en Cuentas por Cobrar para an√°lisis de vencimientos"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"font-medium",children:"Tipo de Cliente"}),e.jsxs(xe,{value:J,onValueChange:s=>{Ft(s),Ws(""),fs(""),vs(""),Ns(""),bs(""),Cs([])},children:[e.jsx(he,{children:e.jsx(pe,{placeholder:I==="contado"?"Opcional - Selecciona para anal√≠ticas":"Selecciona el tipo de cliente"})}),e.jsxs(je,{children:[e.jsx(F,{value:"nuevo",children:"Cliente Nuevo"}),e.jsx(F,{value:"recurrente",children:"Cliente Recurrente"})]})]})]}),J==="recurrente"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cliente-existente",children:"Seleccionar Cliente"}),e.jsxs(xe,{value:Ne,onValueChange:s=>{Ws(s);const a=Oe.find(c=>c.id===s);a&&(fs(a.nombre),vs(a.telefono||""),Ns(a.email||""),bs(a.rfc||""))},children:[e.jsx(he,{children:e.jsx(pe,{placeholder:"Buscar cliente existente"})}),e.jsx(je,{children:ga?e.jsx("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:"Cargando clientes..."}):Oe.length===0?e.jsx("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:"No hay clientes registrados"}):Oe.map(s=>e.jsx(F,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.nombre}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.telefono&&`Tel: ${s.telefono}`,s.email&&` ‚Ä¢ Email: ${s.email}`,s.source==="transaction"&&" ‚Ä¢ (De transacci√≥n)"]})]})},s.id))})]}),Ne&&e.jsx("p",{className:"text-xs text-muted-foreground text-green-600",children:"‚úì Datos del cliente cargados autom√°ticamente"})]}),(J==="nuevo"||J==="recurrente"&&Ne)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cliente-nombre",children:"Nombre del Cliente"}),e.jsx(E,{id:"cliente-nombre",type:"text",placeholder:"Nombre completo",value:Je,onChange:s=>fs(s.target.value),disabled:J==="recurrente"&&Ne!==""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"cliente-telefono",children:"N√∫mero de Tel√©fono"}),(I==="parcial"||I==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Tel√©fono del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(E,{id:"cliente-telefono",type:"tel",placeholder:"Ej: +52 55 1234 5678",value:be,onChange:s=>vs(s.target.value),className:H("Tel√©fono del Cliente")?"border-destructive":"",disabled:J==="recurrente"&&Ne!==""}),J==="nuevo"&&ke.some(s=>s.includes(be)&&s.includes("tel√©fono"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:ke.find(s=>s.includes(be)&&s.includes("tel√©fono"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"cliente-email",children:"Correo Electr√≥nico"}),(I==="parcial"||I==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Email del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(E,{id:"cliente-email",type:"email",placeholder:"cliente@ejemplo.com",value:ye,onChange:s=>Ns(s.target.value),className:H("Email del Cliente")?"border-destructive":"",disabled:J==="recurrente"&&Ne!==""}),J==="nuevo"&&ke.some(s=>s.includes(ye)&&s.includes("correo"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:ke.find(s=>s.includes(ye)&&s.includes("correo"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cliente-rfc",children:"RFC (ID Fiscal) - Opcional"}),e.jsx(E,{id:"cliente-rfc",type:"text",placeholder:"RFC123456ABC1",value:Fe,onChange:s=>bs(s.target.value.toUpperCase()),maxLength:13,disabled:J==="recurrente"&&Ne!==""}),J==="nuevo"&&ke.some(s=>s.includes(Fe)&&s.includes("RFC"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:ke.find(s=>s.includes(Fe)&&s.includes("RFC"))})]})]}),(I==="parcial"||I==="credito")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"fecha-vencimiento",children:"Fecha de Vencimiento"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Fecha de Vencimiento")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(E,{id:"fecha-vencimiento",type:"date",value:ys,onChange:s=>Dt(s.target.value),className:H("Fecha de Vencimiento")?"border-destructive":"",min:new Date().toISOString().split("T")[0]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Fecha l√≠mite para el pago ",I==="parcial"?"del monto pendiente":"completo"]})]}),I==="contado"&&J&&e.jsxs("div",{className:"col-span-full space-y-2",children:[e.jsx(h,{htmlFor:"comentario-venta",children:"Comentarios de la venta (Opcional)"}),e.jsx(Ze,{id:"comentario-venta",placeholder:"Detalles adicionales sobre esta venta, preferencias del cliente, etc.",value:ws,onChange:s=>qs(s.target.value),rows:2}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Informaci√≥n √∫til para futuras ventas y an√°lisis del cliente"})]})]})]}),e.jsx(Ve,{}),(I==="contado"||I==="parcial")&&e.jsxs(e.Fragment,{children:[e.jsx(Ve,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"font-medium",children:"M√©todo de Pago"}),H("M√©todo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(fe,{value:ps,onValueChange:St,className:H("M√©todo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{value:"efectivo",id:"efectivo"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(yn,{className:"h-4 w-4 text-green-600"}),e.jsxs(h,{htmlFor:"efectivo",className:"cursor-pointer",children:["Efectivo ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Caja)"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{value:"tarjeta",id:"tarjeta"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(wn,{className:"h-4 w-4 text-blue-800"}),e.jsxs(h,{htmlFor:"tarjeta",className:"cursor-pointer",children:["Tarjeta ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Bancos)"})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"comentarios",children:"Comentarios de la venta (Opcional)"}),e.jsx(Ze,{id:"comentarios",placeholder:"Agrega cualquier comentario o nota sobre esta venta...",value:ws,onChange:s=>qs(s.target.value),rows:3,className:"resize-none"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(L,{size:"lg",className:"px-8",onClick:sn,disabled:Pt,children:[e.jsx(ea,{className:"mr-2 h-4 w-4"}),Pt?"Registrando...":"Registrar Ingreso"]})})]})]})]})}),e.jsx(zs,{value:"resumen",className:"mt-6",children:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Registro Detallado de Ventas"}),e.jsx(ae,{children:"Historial completo de transacciones de ingresos"})]}),e.jsxs(Y,{children:[e.jsxs("div",{className:"mb-6 p-4 border rounded-lg bg-muted/30 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"filtro-fecha-inicio",children:"Fecha Inicio"}),e.jsx(E,{id:"filtro-fecha-inicio",type:"date",value:De,onChange:s=>$t(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"filtro-fecha-fin",children:"Fecha Fin"}),e.jsx(E,{id:"filtro-fecha-fin",type:"date",value:Ie,onChange:s=>kt(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"filtro-tipo",children:"Tipo de Ingreso"}),e.jsxs(xe,{value:de,onValueChange:At,children:[e.jsx(he,{id:"filtro-tipo",children:e.jsx(pe,{placeholder:"Todos"})}),e.jsxs(je,{children:[e.jsx(F,{value:"todos",children:"Todos"}),e.jsx(F,{value:"precargados",children:"Precargados"}),e.jsx(F,{value:"inventariados",children:"Inventariados"}),e.jsx(F,{value:"general",children:"General"}),e.jsx(F,{value:"otros",children:"Otros"}),e.jsx(F,{value:"asiento_directo",children:"Asientos Directos"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"filtro-cuenta",children:"Cuenta"}),e.jsxs(xe,{value:me,onValueChange:Et,children:[e.jsx(he,{id:"filtro-cuenta",children:e.jsx(pe,{placeholder:"Todas"})}),e.jsxs(je,{children:[e.jsx(F,{value:"todas",children:"Todas"}),e.jsx(F,{value:"4001",children:"4001 - Ventas"}),e.jsx(F,{value:"4004",children:"4004 - Ventas Inventarios"}),e.jsx(F,{value:"4101",children:"4101 - Productos Financieros"}),e.jsx(F,{value:"4102",children:"4102 - Otros Productos"}),e.jsx(F,{value:"4103",children:"4103 - Ganancia en Venta de Activos"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"filtro-subcuenta",children:"Subcuenta"}),e.jsxs(xe,{value:Z,onValueChange:Vt,children:[e.jsx(he,{id:"filtro-subcuenta",children:e.jsx(pe,{placeholder:"Todas"})}),e.jsxs(je,{children:[e.jsx(F,{value:"todas",children:"Todas"}),e.jsx(F,{value:"sin-subcuenta",children:"Sin subcuenta"}),ce.map(s=>e.jsx(F,{value:s.id,children:s.nombre},s.id))]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>{$t(""),kt(""),At("todos"),Et("todas"),Vt("")},children:"Limpiar Filtros"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Resultados: ",(()=>{const s=Ae.map(o=>{const r=o.detalle_asientos.find(t=>t.cuenta_codigo.startsWith("4")&&Number(t.haber)>0);return{created_at:o.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(r==null?void 0:r.cuenta_codigo)||"",subcuenta_id:r==null?void 0:r.subcuenta_id}});return[...b,...s].filter(o=>{const r=(!De||new Date(o.created_at)>=new Date(De))&&(!Ie||new Date(o.created_at)<=new Date(Ie+"T23:59:59")),t=!de||de==="todos"||o.tipo_ingreso===de,d=!me||me==="todas"||o.cuenta_principal_codigo===me,l=!Z||Z==="todas"||Z==="sin-subcuenta"&&!o.subcuenta_id||o.subcuenta_id===Z;return r&&t&&d&&l}).length})()]}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["Total: $",(()=>{const s=Ae.map(o=>{const r=o.detalle_asientos.find(t=>t.cuenta_codigo.startsWith("4")&&Number(t.haber)>0);return{created_at:o.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(r==null?void 0:r.cuenta_codigo)||"",subcuenta_id:r==null?void 0:r.subcuenta_id,monto_total:Number(r==null?void 0:r.haber)||0}}),c=[...b,...s].filter(o=>{const r=(!De||new Date(o.created_at)>=new Date(De))&&(!Ie||new Date(o.created_at)<=new Date(Ie+"T23:59:59")),t=!de||de==="todos"||o.tipo_ingreso===de,d=!me||me==="todas"||o.cuenta_principal_codigo===me,l=!Z||Z==="todas"||Z==="sin-subcuenta"&&!o.subcuenta_id||o.subcuenta_id===Z;return r&&t&&d&&l});return _(c.reduce((o,r)=>o+r.monto_total,0))})()]}),e.jsxs("p",{className:"text-sm font-medium text-green-600",children:["Neto: $",(()=>{const s=Ae.map(o=>{const r=o.detalle_asientos.find(t=>t.cuenta_codigo.startsWith("4")&&Number(t.haber)>0);return{created_at:o.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(r==null?void 0:r.cuenta_codigo)||"",subcuenta_id:r==null?void 0:r.subcuenta_id,monto_neto:Number(r==null?void 0:r.haber)||0}}),c=[...b,...s].filter(o=>{const r=(!De||new Date(o.created_at)>=new Date(De))&&(!Ie||new Date(o.created_at)<=new Date(Ie+"T23:59:59")),t=!de||de==="todos"||o.tipo_ingreso===de,d=!me||me==="todas"||o.cuenta_principal_codigo===me,l=!Z||Z==="todas"||Z==="sin-subcuenta"&&!o.subcuenta_id||o.subcuenta_id===Z;return r&&t&&d&&l});return _(c.reduce((o,r)=>o+r.monto_neto,0))})()]})]})]})]}),R?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando transacciones..."}):(()=>{const s=Ae.map(r=>{const t=r.detalle_asientos.find(d=>d.cuenta_codigo.startsWith("4")&&Number(d.haber)>0);return{id:r.id,descripcion:r.descripcion,monto_total:Number(t==null?void 0:t.haber)||0,monto_neto:Number(t==null?void 0:t.haber)||0,monto_descuento:0,monto_pagado:Number(t==null?void 0:t.haber)||0,monto_pendiente:0,tipo_ingreso:"asiento_directo",metodo_pago:"N/A",tipo_pago:"contado",cuenta_principal_codigo:(t==null?void 0:t.cuenta_codigo)||"",subcuenta_id:t==null?void 0:t.subcuenta_id,created_at:r.fecha,asiento_fecha:r.fecha,es_asiento_directo:!0,estado:"activo"}}),o=[...b,...s].filter(r=>{const t=(!De||new Date(r.created_at)>=new Date(De))&&(!Ie||new Date(r.created_at)<=new Date(Ie+"T23:59:59")),d=!de||de==="todos"||r.tipo_ingreso===de,l=!me||me==="todas"||r.cuenta_principal_codigo===me,u=!Z||Z==="todas"||Z==="sin-subcuenta"&&!r.subcuenta_id||r.subcuenta_id===Z;return t&&d&&l&&u}).filter(r=>!r.descripcion.includes("CANCELACI√ìN:")).map(r=>{const t=r.estado==="cancelado";let d=null;return t&&r.transaccion_cancelacion_id&&(d=b.find(l=>l.id===r.transaccion_cancelacion_id)),{...r,esCancelada:t,transaccionReversion:d}});return o.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay transacciones que coincidan con los filtros"}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm font-medium text-muted-foreground mb-4",children:["Mostrando ",o.length," transacci√≥n(es)"]}),e.jsx("div",{className:"space-y-3",children:o.map(r=>{var u,n,i,x,j;const t=r,d=r.esCancelada,l=!1;return e.jsxs("div",{className:`border rounded-lg p-4 ${d?"bg-red-50 dark:bg-red-950/20 border-red-300 dark:border-red-800":"hover:bg-muted/50"}`,children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[t.es_asiento_directo&&e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-purple-100 dark:bg-purple-900/30 flex-shrink-0 flex items-center justify-center",children:e.jsx(vt,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),!t.es_asiento_directo&&(t.tipo_ingreso==="precargados"||t.tipo_ingreso==="inventariados")&&(()=>{const p=t.descripcion.replace("Venta de ","").replace("Venta: ",""),N=[...oe,...Ye].find(w=>w.nombre===t.descripcion||w.nombre===p||t.descripcion.includes(w.nombre));return N!=null&&N.imagen_url?e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:e.jsx("img",{src:N.imagen_url,alt:N.nombre,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0 flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5 text-muted-foreground"})})})(),e.jsxs("div",{className:"flex justify-between items-start flex-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("p",{className:"font-medium",children:t.descripcion}),t.es_asiento_directo&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200",children:"üìã Asiento Directo"}),d&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200",children:"‚ùå Cancelada"}),l,e.jsxs(is,{onOpenChange:p=>{p?en(t.id):Ys(null)},children:[e.jsx(ta,{asChild:!0,children:e.jsx(L,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:e.jsx(vt,{className:"h-3 w-3"})})}),e.jsxs(os,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(cs,{children:[e.jsx(ls,{children:"Detalles de la Transacci√≥n"}),e.jsx(ds,{children:"Informaci√≥n completa y asientos contables en balanza"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Informaci√≥n General"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",t.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",t.tipo_ingreso]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"M√©todo de Pago:"})," ",t.metodo_pago||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo de Pago:"})," ",t.tipo_pago]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(t.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Montos"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total:"})," $",_(t.monto_total)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descuento:"})," $",_(t.monto_descuento)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Neto:"})," $",_(t.monto_neto)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pagado:"})," $",_(t.monto_pagado||0)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pendiente:"})," $",_(t.monto_pendiente||0)]})]})]})]}),(t.cliente_nombre||t.cliente_telefono||t.cliente_email)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n del Cliente"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.cliente_nombre&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",t.cliente_nombre]}),t.cliente_telefono&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tel√©fono:"})," ",t.cliente_telefono]}),t.cliente_email&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",t.cliente_email]}),t.cliente_rfc&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"RFC:"})," ",t.cliente_rfc]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n Contable"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Cuenta Principal:"})," ",t.cuenta_principal_codigo," - ",t.cuenta_principal_codigo==="4001"?"Ventas":t.cuenta_principal_codigo==="4004"?"Otros Ingresos":""]}),t.subcuenta_id?e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," ",((u=t.subcuentas)==null?void 0:u.nombre)||(()=>{const p=ce.find(g=>g.id===t.subcuenta_id);return(p==null?void 0:p.nombre)||"Subcuenta no encontrada"})()]}):e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," Sin subcuenta asignada"]})]})]}),t.comentarios&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Comentarios"}),e.jsx("div",{className:"p-3 bg-muted rounded-md",children:e.jsx("p",{className:"text-sm",children:t.comentarios})})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3",children:"Asientos en Balanza de Comprobaci√≥n"}),Ma?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando asientos contables..."}):Le?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"N√∫mero de Asiento:"})," ",Le.numero_asiento]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(Le.fecha).toLocaleDateString("es-ES")]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",Le.descripcion]})]})}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Cuenta"}),e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Descripci√≥n"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Debe"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Haber"})]})}),e.jsxs("tbody",{children:[(n=Le.detalles)==null?void 0:n.map((p,g)=>e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"p-3 text-sm",children:[e.jsx("div",{className:"font-medium",children:p.cuenta_codigo}),e.jsx("div",{className:"text-xs text-muted-foreground",children:p.cuenta_nombre})]}),e.jsx("td",{className:"p-3 text-sm",children:p.descripcion}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:p.debe>0?`$${_(p.debe)}`:"-"}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:p.haber>0?`$${_(p.haber)}`:"-"})]},g)),e.jsxs("tr",{className:"border-t-2 bg-muted/50 font-bold",children:[e.jsx("td",{colSpan:2,className:"p-3 text-sm",children:"TOTALES"}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",_((i=Le.detalles)==null?void 0:i.reduce((p,g)=>p+Number(g.debe),0))]}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",_((x=Le.detalles)==null?void 0:x.reduce((p,g)=>p+Number(g.haber),0))]})]})]})]})}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/30 rounded-md text-sm",children:[e.jsx("p",{className:"font-medium text-blue-700 dark:text-blue-300 mb-1",children:"üí° Informaci√≥n"}),e.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:"Este asiento contable refleja c√≥mo esta transacci√≥n afecta a las diferentes cuentas en la balanza de comprobaci√≥n y posteriormente en los estados financieros."})]})]}):e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg text-sm text-muted-foreground text-center",children:"No se encontraron asientos contables para esta transacci√≥n"})]})]})]})]})]}),t.comentarios&&e.jsxs("div",{className:"mt-1 p-2 bg-blue-50 dark:bg-blue-950/30 rounded text-xs",children:[e.jsx("span",{className:"font-medium text-blue-700 dark:text-blue-300",children:"üí¨ "}),e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:t.comentarios.length>50?`${t.comentarios.substring(0,50)}...`:t.comentarios})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[e.jsx("span",{className:"capitalize",children:t.tipo_ingreso}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{className:"capitalize",children:t.metodo_pago}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{className:"capitalize",children:t.tipo_pago})]}),e.jsxs("div",{className:"mt-2 p-2 bg-muted/30 rounded-md",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Informaci√≥n Contable:"}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Cuenta Principal:"})," ",t.cuenta_principal_codigo,t.cuenta_principal_codigo==="4001"?" - Ventas":t.cuenta_principal_codigo==="4004"?" - Otros Ingresos":""]}),t.subcuenta_id?e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," ",((j=t.subcuentas)==null?void 0:j.nombre)||(()=>{const p=ce.find(g=>g.id===t.subcuenta_id);return(p==null?void 0:p.nombre)||"Subcuenta no encontrada"})()]}):e.jsxs("div",{className:"text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," Sin subcuenta asignada"]})]})]})]}),e.jsxs("div",{className:"text-right ml-4 flex flex-col gap-2 items-end",children:[e.jsxs("p",{className:"font-bold text-primary",children:["$",_(t.monto_total)]}),t.monto_descuento>0&&e.jsxs("p",{className:"text-sm text-red-600",children:["-$",_(t.monto_descuento)," desc."]}),!d&&!l&&e.jsx(L,{variant:"outline",size:"sm",className:"mt-2 text-xs border-red-300 text-red-600 hover:bg-red-50 dark:border-red-800 dark:text-red-400 dark:hover:bg-red-950/30",onClick:()=>{ct(t),Es(!0)},children:"‚ùå Cancelar"})]})]})]}),d&&t.motivo_cancelacion&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"p-3 bg-red-100 dark:bg-red-950/40 rounded-md border border-red-300 dark:border-red-800",children:[e.jsx("p",{className:"text-xs font-medium text-red-700 dark:text-red-300 mb-1",children:"üìã Motivo de cancelaci√≥n:"}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:t.motivo_cancelacion}),e.jsxs("p",{className:"text-xs text-red-500 dark:text-red-500 mt-1",children:["Cancelada el: ",new Date(t.fecha_cancelacion).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),r.transaccionReversion&&e.jsxs("div",{className:"p-3 bg-orange-100 dark:bg-orange-950/40 rounded-md border border-orange-300 dark:border-orange-800",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-orange-700 dark:text-orange-300",children:"‚Ü©Ô∏è Asiento de Reversi√≥n Generado"})}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",r.transaccionReversion.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Monto reversado:"})," $",_(Math.abs(r.transaccionReversion.monto_total))]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(r.transaccionReversion.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-muted-foreground",children:[e.jsx("span",{children:new Date(t.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsxs("span",{className:"font-medium text-green-600",children:["Neto: $",t.monto_neto.toFixed(2)]})]})]},t.id)})})]})})()]})]})}),e.jsx(zs,{value:"analitica",className:"mt-6",children:(()=>{const a=(()=>{const t=new Date;t.getMonth();const d=t.getFullYear();let l=b.filter(u=>u.estado!=="cancelado"&&!u.descripcion.includes("CANCELACI√ìN:"));if(Q==="diario"){const u=le.toISOString().split("T")[0];l=l.filter(n=>n.asiento_fecha===u)}else if(Q==="mensual"){const u=A.getMonth(),n=A.getFullYear();l=l.filter(i=>{const x=i.asiento_fecha;if(!x)return!1;const j=yt(x);return j.getMonth()===u&&j.getFullYear()===n})}else l=l.filter(u=>{const n=u.asiento_fecha;return n?yt(n).getFullYear()===d:!1});return O==="ventas"?l.filter(u=>u.cuenta_principal_codigo==="4001"):l.filter(u=>{var n;return((n=u.cuenta_principal_codigo)==null?void 0:n.startsWith("4"))&&u.cuenta_principal_codigo!=="4001"&&u.cuenta_principal_codigo!=="4003"})})(),o=(()=>{const t=a.filter(u=>u.tipo_pago==="contado"||u.tipo_pago==="parcial");if(t.length===0)return[];const d={};t.forEach(u=>{const n=u.metodo_pago==="efectivo"?"Efectivo":"Tarjeta";d[n]=(d[n]||0)+Se(u,f)});const l=Object.values(d).reduce((u,n)=>u+n,0);return Object.entries(d).map(([u,n])=>({name:u,value:n,porcentaje:l>0?(n/l*100).toFixed(1):"0.0"}))})(),r=()=>O==="ventas"?a.length>0||V.ventasBrutas>0||V.descuentos>0:a.length>0||V.otrosIngresos>0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground mb-4",children:"Highlights de Ingresos"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Resumen del D√≠a"})}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",S(ts.ventasBrutas,y)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",S(ts.descuentos,y)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",S(ts.ventasNetas,y)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",S(ts.otrosIngresos,y)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",S(ts.totalIngresos,y)]})]})]})]}),e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Resumen del Mes"})}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",S(as.ventasBrutas,y)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",S(as.descuentos,y)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",S(as.ventasNetas,y)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",S(as.otrosIngresos,y)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",S(as.totalIngresos,y)]})]})]})]}),e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Resumen del A√±o"})}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",S(ns.ventasBrutas,y)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",S(ns.descuentos,y)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",S(ns.ventasNetas,y)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",S(ns.otrosIngresos,y)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",S(ns.totalIngresos,y)]})]})]})]})]})]}),e.jsx("div",{className:"my-8 border-t-2 border-primary/20"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-foreground mb-6",children:["Anal√≠tica de ",O==="ventas"?"Ventas":"Otros Ingresos"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Tipo de Ingreso"}),e.jsx(ae,{children:"Selecciona qu√© analizar"})]}),e.jsx(Y,{children:e.jsxs(fe,{value:O,onValueChange:t=>Da(t),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"ventas",id:"tipo-ventas"}),e.jsx(h,{htmlFor:"tipo-ventas",className:"cursor-pointer",children:"Ventas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"otros",id:"tipo-otros"}),e.jsx(h,{htmlFor:"tipo-otros",className:"cursor-pointer",children:"Otros Ingresos"})]})]})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Per√≠odo de An√°lisis"}),e.jsx(ae,{children:"Selecciona el per√≠odo"})]}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs(fe,{value:Q,onValueChange:t=>_a(t),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"diario",id:"period-daily"}),e.jsx(h,{htmlFor:"period-daily",className:"cursor-pointer",children:"Diario"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"mensual",id:"period-monthly"}),e.jsx(h,{htmlFor:"period-monthly",className:"cursor-pointer",children:"Mensual"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"anual",id:"period-annual"}),e.jsx(h,{htmlFor:"period-annual",className:"cursor-pointer",children:"Anual"})]})]}),Q==="diario"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(h,{className:"text-xs text-muted-foreground mb-2 block",children:"Fecha espec√≠fica"}),e.jsxs(aa,{children:[e.jsx(na,{asChild:!0,children:e.jsxs(L,{variant:"outline",className:ra("w-full justify-start text-left font-normal",!le&&"text-muted-foreground"),size:"sm",children:[e.jsx(ia,{className:"mr-2 h-4 w-4"}),oa(le,"PPP",{locale:pa})]})}),e.jsx(ca,{className:"w-auto p-0",align:"start",children:e.jsx(la,{mode:"single",selected:le,onSelect:t=>t&&Ia(t),initialFocus:!0,className:"pointer-events-auto"})})]})]}),Q==="mensual"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(h,{className:"text-xs text-muted-foreground mb-2 block",children:"Mes espec√≠fico"}),e.jsxs(aa,{children:[e.jsx(na,{asChild:!0,children:e.jsxs(L,{variant:"outline",className:ra("w-full justify-start text-left font-normal",!A&&"text-muted-foreground"),size:"sm",children:[e.jsx(ia,{className:"mr-2 h-4 w-4"}),oa(A,"MMMM yyyy",{locale:pa})]})}),e.jsx(ca,{className:"w-auto p-0",align:"start",children:e.jsx(la,{mode:"single",selected:A,onSelect:t=>t&&Ta(t),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Formato de Cifras"}),e.jsx(ae,{children:"Visualizaci√≥n de montos"})]}),e.jsx(Y,{children:e.jsxs(fe,{value:y,onValueChange:t=>Pa(t),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"general",id:"scale-general"}),e.jsx(h,{htmlFor:"scale-general",className:"cursor-pointer",children:"General"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"miles",id:"scale-thousands"}),e.jsx(h,{htmlFor:"scale-thousands",className:"cursor-pointer",children:"Miles (K)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"millones",id:"scale-millions"}),e.jsx(h,{htmlFor:"scale-millions",className:"cursor-pointer",children:"Millones (M)"})]})]})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Tipo de M√©trica"}),e.jsx(ae,{children:"Datos a visualizar"})]}),e.jsx(Y,{children:e.jsxs(fe,{value:f,onValueChange:t=>Fa(t),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"brutas",id:"metric-brutas"}),e.jsx(h,{htmlFor:"metric-brutas",className:"cursor-pointer",children:"Ventas Brutas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"descuentos",id:"metric-descuentos"}),e.jsx(h,{htmlFor:"metric-descuentos",className:"cursor-pointer",children:"Descuentos"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{value:"netas",id:"metric-netas"}),e.jsx(h,{htmlFor:"metric-netas",className:"cursor-pointer",children:"Ventas Netas"})]})]})})]})]}),e.jsxs(W,{className:"mb-6",children:[e.jsxs(q,{children:[e.jsxs(G,{children:["Evoluci√≥n de ",f==="descuentos"?"Descuentos":O==="otros"?"Otros Ingresos":f==="brutas"?"Ventas Brutas":"Ventas Netas"]}),e.jsxs(ae,{children:[f==="descuentos"?"Descuentos aplicados":O==="otros"?"Otros ingresos":f==="brutas"?"Ventas brutas":"Ventas netas"," - ",Q==="diario"?"del d√≠a":Q==="mensual"?"por d√≠a del mes":"por mes del a√±o"]})]}),e.jsx(Y,{children:R?e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"Cargando datos..."}):V.detallesPorPeriodo.length===0?e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"}):e.jsx("div",{className:"h-80",children:e.jsx(us,{width:"100%",height:"100%",children:e.jsxs(Cn,{data:V.detallesPorPeriodo.map(t=>({periodo:t.periodo,ventas:t.ventasBrutas,descuentos:t.descuentos,neto:t.ventasNetas,otrosIngresos:t.otrosIngresos})),children:[e.jsx(da,{strokeDasharray:"3 3"}),e.jsx(ma,{dataKey:"periodo",tick:{fill:"#000000"}}),e.jsx(ua,{tickFormatter:t=>S(t,y),tick:{fill:"#000000"}}),e.jsx(xs,{formatter:t=>[`$${S(Number(t),y)}`,""],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}}),e.jsx(Sn,{}),f==="descuentos"&&e.jsx(Ls,{type:"monotone",dataKey:"descuentos",stroke:"hsl(180 60% 70%)",name:"Descuentos",strokeWidth:2,children:e.jsx(hs,{dataKey:"descuentos",position:"top",formatter:t=>`$${S(t,y)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),f==="brutas"&&O==="ventas"&&e.jsx(Ls,{type:"monotone",dataKey:"ventas",stroke:"hsl(180 50% 55%)",name:"Ventas Brutas",strokeWidth:2,children:e.jsx(hs,{dataKey:"ventas",position:"top",formatter:t=>`$${S(t,y)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),f==="netas"&&O==="ventas"&&e.jsx(Ls,{type:"monotone",dataKey:"neto",stroke:"hsl(180 45% 45%)",name:"Ventas Netas",strokeWidth:2,children:e.jsx(hs,{dataKey:"neto",position:"top",formatter:t=>`$${S(t,y)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),O==="otros"&&f!=="descuentos"&&e.jsx(Ls,{type:"monotone",dataKey:"otrosIngresos",stroke:"hsl(140 50% 50%)",name:"Otros Ingresos",strokeWidth:2,children:e.jsx(hs,{dataKey:"otrosIngresos",position:"top",formatter:t=>`$${S(t,y)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})})]})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:[f==="brutas"?"Ventas Brutas":f==="descuentos"?"Descuentos":"Ventas Netas"," por Tipo"]}),e.jsxs(ae,{children:["Distribuci√≥n de ",f==="brutas"?"ventas brutas":f==="descuentos"?"descuentos":"ventas netas"," por categor√≠a"]})]}),e.jsx(Y,{children:R?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):r()?O==="otros"&&f==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(us,{width:"100%",height:"100%",children:e.jsxs(xa,{children:[e.jsx(ha,{data:(()=>{const t=O==="ventas"?f==="brutas"?V.ventasBrutas:f==="descuentos"?V.descuentos:V.ventasNetas:V.otrosIngresos;if(a.length===0&&t>0)return[{tipo:"Otros Ingresos",monto:t,porcentaje:"100.0"}];const d=a.reduce((u,n)=>(u[n.tipo_ingreso]=(u[n.tipo_ingreso]||0)+Se(n,f),u),{}),l=Object.values(d).reduce((u,n)=>u+n,0);return Object.entries(d).map(([u,n])=>({tipo:u.charAt(0).toUpperCase()+u.slice(1),monto:n,porcentaje:l>0?(n/l*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({tipo:t,porcentaje:d,monto:l})=>`${t}
${d}%
$${S(l,y)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:Object.keys(a.reduce((t,d)=>(t[d.tipo_ingreso]=!0,t),{})).map((t,d)=>{const l=["hsl(180 50% 55%)","hsl(180 45% 45%)","hsl(180 55% 65%)","hsl(180 40% 40%)"];return e.jsx(Bs,{fill:l[d%4]},`cell-${d}`)})}),e.jsx(xs,{formatter:t=>[`$${S(Number(t),y)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:["Estado de Pagos - ",f==="brutas"?"Ventas Brutas":f==="descuentos"?"Descuentos":"Ventas Netas"]}),e.jsx(ae,{children:"Distribuci√≥n por estado de pago"})]}),e.jsx(Y,{children:R?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):r()?O==="otros"&&f==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(us,{width:"100%",height:"100%",children:e.jsxs(xa,{children:[e.jsxs(ha,{data:(()=>{const t=O==="ventas"?f==="brutas"?V.ventasBrutas:f==="descuentos"?V.descuentos:V.ventasNetas:V.otrosIngresos;if(a.length===0&&t>0)return[{estado:"Pagado Total",monto:t,porcentaje:"100.0"}];const d=a.reduce((u,n)=>{let i="Por Cobrar";return n.tipo_pago==="contado"||n.monto_pagado&&n.monto_pendiente===0?i="Pagado Total":(n.tipo_pago==="parcial"||n.monto_pagado>0&&n.monto_pendiente>0)&&(i="Pago Parcial"),u[i]=(u[i]||0)+Se(n,f),u},{}),l=Object.values(d).reduce((u,n)=>u+n,0);return Object.entries(d).map(([u,n])=>({estado:u,monto:n,porcentaje:l>0?(n/l*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({estado:t,porcentaje:d,monto:l})=>`${t}
${d}%
$${S(l,y)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:[e.jsx(Bs,{fill:"hsl(180 50% 55%)"}),e.jsx(Bs,{fill:"hsl(180 55% 65%)"}),e.jsx(Bs,{fill:"hsl(180 45% 45%)"})]}),e.jsx(xs,{formatter:t=>[`$${S(Number(t),y)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(W,{children:[e.jsxs(q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(G,{children:[f==="brutas"?"Ventas Brutas":f==="descuentos"?"Descuentos":"Ventas Netas"," por ",Xe==="subcuenta"?"Subcuenta":"Cuenta"]}),e.jsxs(ae,{children:["Distribuci√≥n por ",Xe==="subcuenta"?"subcuentas":"cuentas"," contables"]})]}),e.jsxs(xe,{value:Xe,onValueChange:t=>Va(t),children:[e.jsx(he,{className:"w-[150px]",children:e.jsx(pe,{})}),e.jsxs(je,{children:[e.jsx(F,{value:"subcuenta",children:"Por Subcuenta"}),e.jsx(F,{value:"cuenta",children:"Por Cuenta"})]})]})]}),e.jsx(Y,{children:R?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):r()?O==="otros"&&f==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(us,{width:"100%",height:"100%",children:e.jsxs(_n,{data:(()=>{const t=O==="ventas"?f==="brutas"?V.ventasBrutas:f==="descuentos"?V.descuentos:V.ventasNetas:V.otrosIngresos;if(a.length===0&&t>0)return[{subcuenta:"Sin detalle",monto:t}];const d=a.reduce((n,i)=>{var j;let x;if(Xe==="subcuenta")x=i.subcuenta_id?((j=ce.find(p=>p.id===i.subcuenta_id))==null?void 0:j.nombre)||"Subcuenta desconocida":"Sin subcuenta asignada";else{const p=ie.find(g=>g.codigo===i.cuenta_principal_codigo);x=p?`${i.cuenta_principal_codigo} - ${p.nombre}`:i.cuenta_principal_codigo||"Sin cuenta"}return n[x]=(n[x]||0)+Se(i,f),n},{}),l=Object.values(d).reduce((n,i)=>n+i,0);if(t-l>.01){const n={};Ae.forEach(i=>{const x=i.detalle_asientos.find(C=>C.cuenta_codigo.startsWith("4")&&Number(C.haber)>0);if(!x)return;const j=Number(x.haber)||0,p=x.cuenta_codigo,g=ie.find(C=>C.codigo===p),N=(g==null?void 0:g.nombre)||"Otros ingresos";let w;if(Xe==="cuenta")w=`${p} - ${N}`;else if(Xe==="subcuenta"){const C=x.subcuenta_id,z=ce.find(B=>B.id===C);w=(z==null?void 0:z.nombre)||"Sin subcuenta asignada"}else w=N;n[w]=(n[w]||0)+j}),Object.entries(n).forEach(([i,x])=>{d[i]=(d[i]||0)+x})}return Object.entries(d).map(([n,i])=>({subcuenta:n,monto:i}))})(),layout:"vertical",children:[e.jsx(da,{strokeDasharray:"3 3"}),e.jsx(ma,{type:"number",tickFormatter:t=>S(t,y),tick:{fill:"#000000"},domain:[0,t=>t*1.2]}),e.jsx(ua,{type:"category",dataKey:"subcuenta",width:150,tick:{fill:"#000000"}}),e.jsx(xs,{formatter:t=>[`$${S(Number(t),y)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}}),e.jsx(Pn,{dataKey:"monto",fill:"hsl(180 50% 55%)",children:e.jsx(hs,{dataKey:"monto",position:"right",formatter:t=>`$${S(t,y)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"M√©todos de Pago Recibidos"}),e.jsxs(ae,{children:["Distribuci√≥n de ",f==="brutas"?"ventas brutas":f==="descuentos"?"descuentos":"ventas netas"," por m√©todo de pago"]})]}),e.jsx(Y,{children:R?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):r()?O==="otros"&&f==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):o.length===0?e.jsxs("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:["No hay transacciones con m√©todo de pago en este per√≠odo",e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-2 block",children:"Las ventas a cr√©dito no tienen m√©todo de pago asignado"})]}):e.jsx("div",{className:"h-64",children:e.jsx(us,{width:"100%",height:"100%",children:e.jsx(Fn,{data:o,dataKey:"value",aspectRatio:4/3,stroke:"#fff",fill:"#8884d8",content:e.jsx(kn,{}),children:e.jsx(xs,{content:e.jsx(An,{scaleFormat:y})})})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:[f==="brutas"?"Ventas Brutas":f==="descuentos"?"Descuentos":"Ventas Netas"," por Producto"]}),e.jsxs(ae,{children:["Ranking de productos ",f==="descuentos"?"con m√°s descuentos":"m√°s vendidos"]})]}),e.jsx(Y,{children:R?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):r()?e.jsx("div",{className:"space-y-3",children:(()=>{if(O==="otros"&&f==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const t=O==="ventas"?f==="brutas"?V.ventasBrutas:f==="descuentos"?V.descuentos:V.ventasNetas:V.otrosIngresos;if(a.length===0&&t>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ve,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin detalle de producto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",S(t,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(ve,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",S(t,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const d={};a.forEach(n=>{if(n.tipo_ingreso==="inventariados"&&n.descripcion.startsWith("Venta de ")){const i=n.descripcion.replace("Venta de ","").trim(),x=Ce.find(j=>j.nombre.toLowerCase()===i.toLowerCase());d[i]||(d[i]={nombre:i,transacciones:0,monto:0,imagen:x==null?void 0:x.imagen_url,tieneAsignacion:!0}),d[i].transacciones+=1,d[i].monto+=Se(n,f)}}),a.forEach(n=>{if(n.tipo_ingreso==="precargados"){let i=[];n.descripcion.startsWith("Venta: ")?i=n.descripcion.replace("Venta: ","").split(", ").map(N=>{const w=N.match(/^(.+?) \(x(\d+)\)$/);return w?{nombre:w[1].trim(),cantidad:parseInt(w[2])}:{nombre:N.trim(),cantidad:1}}):n.descripcion.startsWith("Venta de ")?i=[{nombre:n.descripcion.replace("Venta de ","").trim(),cantidad:1}]:i=[{nombre:n.descripcion,cantidad:1}];const x=Se(n,f),j=[];let p=0;i.forEach(({nombre:g,cantidad:N})=>{const w=oe.find(z=>z.nombre.toLowerCase()===g.toLowerCase()),C=(w==null?void 0:w.precio)||0;j.push({nombre:g,cantidad:N,precioBase:C}),p+=C*N}),j.forEach(({nombre:g,cantidad:N,precioBase:w})=>{const C=oe.find(re=>re.nombre.toLowerCase()===g.toLowerCase()),z=w*N,B=p>0?z/p:1/j.length,U=x*B;d[g]||(d[g]={nombre:g,transacciones:0,monto:0,imagen:C==null?void 0:C.imagen_url,tieneAsignacion:!!C}),d[g].transacciones+=1,d[g].monto+=U})}if(n.tipo_ingreso==="general"||n.tipo_ingreso==="inventariados"&&!n.descripcion.startsWith("Venta de")){const i="Ingresos sin producto asignado";d[i]||(d[i]={nombre:i,transacciones:0,monto:0,tieneAsignacion:!1}),d[i].transacciones+=1,d[i].monto+=Se(n,f)}if(n.tipo_ingreso==="otros"){const i=n.descripcion||"Otros ingresos";d[i]||(d[i]={nombre:i,transacciones:0,monto:0,tieneAsignacion:!1}),d[i].transacciones+=1,d[i].monto+=Se(n,f)}});const l=Object.values(d).sort((n,i)=>i.monto-n.monto);if(l.reduce((n,i)=>n+i.monto,0),O==="otros"){const n=a.filter(x=>x.tipo_ingreso==="otros").reduce((x,j)=>x+Se(j,f),0);if(t-n>.01){const x={};Ae.forEach(j=>{var z;const p=j.detalle_asientos.find(B=>B.cuenta_codigo.startsWith("4")&&Number(B.haber)>0);if(!p)return;const g=Number(p.haber)||0,N=p.cuenta_codigo,w=ie.find(B=>B.codigo===N);let C;(z=j.numero_asiento)!=null&&z.startsWith("BAJA-")?C=(w==null?void 0:w.nombre)||"Ganancia en Venta de Activos":C=j.descripcion||(w==null?void 0:w.nombre)||"Otros ingresos",x[C]||(x[C]={monto:0,count:0}),x[C].monto+=g,x[C].count+=1}),Object.entries(x).forEach(([j,p])=>{p.monto>.01&&l.push({nombre:j,transacciones:p.count,monto:p.monto,tieneAsignacion:!1})})}}const u=l.slice(0,10);return e.jsxs(e.Fragment,{children:[u.map(n=>{const i=l.reduce((j,p)=>j+p.monto,0),x=i>0?(n.monto/i*100).toFixed(1):"0.0";return e.jsxs("div",{className:`flex items-center gap-3 p-3 border rounded-lg ${n.tieneAsignacion?"":"border-amber-500/50 bg-amber-50/50 dark:bg-amber-950/20"}`,children:[n.imagen?e.jsx("img",{src:n.imagen,alt:n.nombre,className:"w-12 h-12 rounded-md object-cover flex-shrink-0"}):e.jsx("div",{className:`w-12 h-12 rounded-md flex items-center justify-center flex-shrink-0 ${n.tieneAsignacion?"bg-muted":"bg-amber-100 dark:bg-amber-900/30"}`,children:e.jsx(ve,{className:`w-5 h-5 ${n.tieneAsignacion?"text-muted-foreground":"text-amber-600 dark:text-amber-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium truncate",children:n.nombre}),!n.tieneAsignacion&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-200 flex-shrink-0",children:"Sin asignar"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[n.transacciones," ",n.transacciones===1?"transacci√≥n":"transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",S(n.monto,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[x,"%"]})})]},n.nombre)}),(()=>{const n=l.reduce((i,x)=>i+x.monto,0);return n>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(ve,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[l.reduce((i,x)=>i+x.transacciones,0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",S(n,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:[f==="brutas"?"Ventas Brutas":f==="descuentos"?"Descuentos":"Ventas Netas"," por Cliente"]}),e.jsxs(ae,{children:["Ranking de ",f==="descuentos"?"clientes con m√°s descuentos":"mejores clientes"]})]}),e.jsx(Y,{children:R?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):r()?e.jsx("div",{className:"space-y-3",children:(()=>{if(O==="otros"&&f==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const t=O==="ventas"?f==="brutas"?V.ventasBrutas:f==="descuentos"?V.descuentos:V.ventasNetas:V.otrosIngresos;if(a.length===0&&t>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ms,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin cliente asignado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",S(t,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(ms,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",S(t,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const d=a.reduce((i,x)=>{const j=x.cliente_nombre||"Sin cliente asignado";return i[j]||(i[j]={nombre:j,transacciones:0,monto:0,email:x.cliente_email,telefono:x.cliente_telefono}),i[j].transacciones+=1,i[j].monto+=Se(x,f),i},{}),l=Object.values(d).sort((i,x)=>x.monto-i.monto),u=l.reduce((i,x)=>i+x.monto,0);if(O==="otros"){const i=t-u;if(i>.01){const x=l.find(j=>j.nombre==="Sin cliente asignado");x?(x.monto+=i,x.transacciones+=Ae.length):l.push({nombre:"Sin cliente asignado",transacciones:Ae.length,monto:i}),l.sort((j,p)=>p.monto-j.monto)}}const n=l.slice(0,10);return e.jsxs(e.Fragment,{children:[n.map(i=>{const x=l.reduce((p,g)=>p+g.monto,0),j=x>0?(i.monto/x*100).toFixed(1):"0.0";return e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ms,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:i.nombre}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-0.5",children:[e.jsxs("p",{children:[i.transacciones," ",i.transacciones===1?"compra":"compras"]}),i.telefono&&e.jsx("p",{className:"text-xs",children:i.telefono}),i.email&&e.jsx("p",{className:"text-xs truncate",children:i.email})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",S(i.monto,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[j,"%"]})})]},i.nombre)}),(()=>{const i=l.reduce((x,j)=>x+j.monto,0);return i>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(ms,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[l.reduce((x,j)=>x+j.transacciones,0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",S(i,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]})]})]})]})})()}),e.jsx(zs,{value:"catalogo",className:"mt-6",children:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{className:"flex items-center justify-between",children:["Cat√°logo de Productos",e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>{ja(),ee({title:"Actualizado",description:"La lista de productos se ha actualizado correctamente"})},children:[e.jsx(Dn,{className:"mr-2 h-4 w-4"}),"Actualizar"]}),e.jsxs(is,{open:Oa,onOpenChange:rt,children:[e.jsx(ta,{asChild:!0,children:e.jsxs(L,{children:[e.jsx(Nt,{className:"mr-2 h-4 w-4"}),"Nuevo Producto"]})}),e.jsxs(os,{className:"sm:max-w-[425px]",children:[e.jsxs(cs,{children:[e.jsx(ls,{children:"Agregar Nuevo Producto"}),e.jsx(ds,{children:"Completa la informaci√≥n del producto para agregarlo al cat√°logo."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"product-name",className:"text-right",children:"Nombre"}),e.jsx(E,{id:"product-name",value:it,onChange:s=>Ot(s.target.value),className:"col-span-3",placeholder:"Nombre del producto"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"product-image",className:"text-right",children:"Imagen"}),e.jsx(E,{id:"product-image",type:"file",accept:"image/*",onChange:s=>{var a;return qt(((a=s.target.files)==null?void 0:a[0])||null)},className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"product-price",className:"text-right",children:"Precio"}),e.jsx(E,{id:"product-price",type:"number",value:ot,onChange:s=>zt(s.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"product-account",className:"text-right",children:"Cuenta"}),e.jsxs("div",{className:"col-span-3 flex items-center p-2 border rounded-md bg-muted/50",children:[e.jsx("span",{className:"text-sm font-medium",children:"4001 - Ventas"}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"(cuenta fija)"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(xe,{value:Ut,onValueChange:s=>Wt(s==="none"?"":s),children:[e.jsx(he,{className:"col-span-3",children:e.jsx(pe,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(je,{children:[e.jsx(F,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),ce.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>e.jsx(F,{value:s.id,children:s.nombre},s.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(Ze,{id:"product-description",value:Lt,onChange:s=>Bt(s.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]})]}),e.jsxs(Rs,{children:[e.jsx(L,{type:"button",variant:"outline",onClick:()=>rt(!1),children:"Cancelar"}),e.jsx(L,{onClick:nn,disabled:ks,children:ks?"Guardando...":"Guardar Producto"})]})]})]}),e.jsx(is,{open:Ua,onOpenChange:Ms,children:e.jsxs(os,{className:"sm:max-w-[425px]",children:[e.jsxs(cs,{children:[e.jsx(ls,{children:"Editar Producto"}),e.jsx(ds,{children:"Modifica la informaci√≥n del producto."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"edit-product-name",className:"text-right",children:"Nombre *"}),e.jsx(E,{id:"edit-product-name",value:mt,onChange:s=>ut(s.target.value),className:"col-span-3",placeholder:"Ej: Consultor√≠a, Producto X"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"edit-product-price",className:"text-right",children:"Precio *"}),e.jsx(E,{id:"edit-product-price",type:"number",value:xt,onChange:s=>ht(s.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"edit-product-image",className:"text-right",children:"Imagen"}),e.jsxs("div",{className:"col-span-3 space-y-2",children:[e.jsx(E,{id:"edit-product-image",type:"file",accept:"image/*",onChange:rn}),Ht&&e.jsx("div",{className:"aspect-square w-24 mx-auto",children:e.jsx("img",{src:Ht,alt:"Preview",className:"w-full h-full object-cover rounded-md"})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"edit-product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(Ze,{id:"edit-product-description",value:Kt,onChange:s=>pt(s.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"edit-product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(xe,{value:Jt||"none",onValueChange:s=>Qt(s==="none"?"":s),children:[e.jsx(he,{className:"col-span-3",children:e.jsx(pe,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(je,{children:[e.jsx(F,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),ce.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>e.jsx(F,{value:s.id,children:s.nombre},s.id))]})]})]})]}),e.jsxs(Rs,{children:[e.jsx(L,{type:"button",variant:"outline",onClick:()=>Ms(!1),children:"Cancelar"}),e.jsx(L,{onClick:on,disabled:ks,children:ks?"Actualizando...":"Actualizar Producto"})]})]})})]})]}),e.jsx(ae,{children:"Gestiona el cat√°logo de productos y servicios con cuentas contables asignadas"})]}),e.jsxs(Y,{children:[e.jsxs(Me,{className:"mb-6",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsxs(Re,{children:[e.jsx("strong",{children:"Recomendaci√≥n:"}),' Asignar subcuentas a cada producto ayuda a llevar un mejor control contable. La cuenta predeterminada es "4001 - Ventas".']})]}),e.jsx("div",{className:"space-y-6",children:Us?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):oe.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay productos de servicios registrados a√∫n"}):e.jsxs("div",{className:"space-y-6",children:[ce.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>{const a=oe.filter(c=>c.subcuenta_id===s.id);return a.length===0?null:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{className:"text-lg flex items-center",children:[e.jsx(ve,{className:"mr-2 h-5 w-5"}),"Subcuenta: ",s.nombre]}),e.jsxs(ae,{children:[a.length," producto",a.length!==1?"s":""]})]}),e.jsx(Y,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(c=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[c.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:c.imagen_url,alt:c.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:c.nombre}),c.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:c.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",c.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>Zt(c),className:"flex-1",children:"Editar"}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>wt.mutate(c.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},c.id))})})]},s.id)}),(()=>{const s=oe.filter(a=>!a.subcuenta_id);return s.length===0?null:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{className:"text-lg flex items-center",children:[e.jsx(sa,{className:"mr-2 h-5 w-5"}),"Cuenta General: 4001 - Ventas"]}),e.jsxs(ae,{children:[s.length," producto",s.length!==1?"s":""," sin subcuenta espec√≠fica"]})]}),e.jsx(Y,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(a=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[a.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:a.nombre}),a.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:a.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",a.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>Zt(a),className:"flex-1",children:"Editar"}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>wt.mutate(a.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},a.id))})})]})})()]})})]})]})})]}),e.jsx(is,{open:Ba,onOpenChange:Es,children:e.jsxs(os,{children:[e.jsxs(cs,{children:[e.jsx(ls,{children:"‚ùå Cancelar Transacci√≥n"}),e.jsx(ds,{children:"Esta acci√≥n crear√° un asiento contable de reversi√≥n. La transacci√≥n original quedar√° marcada como cancelada pero mantendr√° toda su trazabilidad."})]}),e.jsxs("div",{className:"space-y-4",children:[Ge&&e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Transacci√≥n a cancelar:"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",Ge.descripcion]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Monto:"})," $",_(Ge.monto_total)]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(Ge.created_at).toLocaleDateString("es-ES")]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"motivo-cancelacion",children:"Motivo de la Cancelaci√≥n *"}),e.jsx(Ze,{id:"motivo-cancelacion",placeholder:"Ej: Error en registro, cliente cancel√≥ pedido, etc.",value:Vs,onChange:s=>lt(s.target.value),rows:3})]}),e.jsxs(Me,{children:[e.jsx(M,{className:"h-4 w-4"}),e.jsxs(Re,{className:"text-xs",children:[e.jsx("strong",{children:"¬øQu√© suceder√°?"}),e.jsxs("ul",{className:"list-disc ml-4 mt-1 space-y-1",children:[e.jsx("li",{children:"Se crear√° un asiento de reversi√≥n autom√°ticamente"}),e.jsx("li",{children:'La transacci√≥n original se marcar√° como "cancelada"'}),e.jsx("li",{children:"Si es venta de inventario, el stock se restaurar√°"}),e.jsx("li",{children:"Ambas transacciones quedar√°n visibles para auditor√≠a"})]})]})]})]}),e.jsxs(Rs,{children:[e.jsx(L,{variant:"outline",onClick:()=>{Es(!1),lt(""),ct(null)},disabled:dt,children:"Cancelar"}),e.jsx(L,{variant:"destructive",onClick:tn,disabled:dt||!Vs.trim(),children:dt?"Cancelando...":"Confirmar Cancelaci√≥n"})]})]})})]})]})};export{Rn as default};
