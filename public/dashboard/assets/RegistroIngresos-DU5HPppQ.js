import{c as on,r as m,s as K,u as cn,a as ln,b as dn,d as mn,e as un,f as xn,g as hn,h as pn,i as jn,j as gn,k as e,D as cs,l as ls,m as ds,n as ms,C as A,o as us,S as Ee,p as Zt,R as ve,q as D,L as h,I as T,t as Os,B as M,v as X,T as fn,w as vn,x as zs,y as Ls,z as O,A as z,E as L,F as ne,G as B,H as ea,P as Ne,J as Nt,U as xs,K as Ae,M as Ve,N as xe,O as he,Q as pe,V as je,W as S,X as Ze,Y as Nn,Z as bn,_ as sa,$ as ta,a0 as aa,a1 as na,a2 as ra,a3 as oa,a4 as ia,a5 as ca,a6 as hs,a7 as yn,a8 as la,a9 as da,aa as ma,ab as ps,ac as _n,ad as Bs,ae as js,af as ua,ag as xa,ah as qs,ai as wn,aj as Cn,ak as Sn,al as Pn,am as bt,an as ha}from"./index-BIb6IlZl.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fn=on("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),Dn=(q=10)=>{const[G,ee]=m.useState([]),[$,J]=m.useState(!0),[Me,ie]=m.useState(null),Pe=async()=>{try{J(!0),ie(null);const{data:ue,error:Re}=await K.from("transacciones_ingresos").select(`
          *,
          asiento:asientos_contables!transaccion_ingreso_id(fecha)
        `).order("created_at",{ascending:!1}).limit(q);if(Re)throw Re;const Ye=(ue||[]).map(es=>({...es,asiento_fecha:Array.isArray(es.asiento)&&es.asiento.length>0?es.asiento[0].fecha:null}));ee(Ye)}catch(ue){console.error("Error fetching transacciones:",ue),ie(ue instanceof Error?ue.message:"Error desconocido")}finally{J(!1)}};return m.useEffect(()=>{Pe();const ue=K.channel("transacciones-recientes-changes").on("postgres_changes",{event:"*",schema:"public",table:"transacciones_ingresos"},()=>{Pe()}).subscribe();return()=>{K.removeChannel(ue)}},[q]),{transacciones:G,loading:$,error:Me,refetch:Pe}},C=q=>(typeof q=="string"?parseFloat(q):q).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),w=(q,G)=>{let ee=q,$="";return G==="miles"?(ee=q/1e3,$=" K"):G==="millones"&&(ee=q/1e6,$=" M"),ee.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})+$},Se=(q,G)=>G==="brutas"?q.monto_total||0:G==="descuentos"?q.monto_descuento||0:G==="netas"&&(q.monto_neto||q.monto_total)||0,yt=q=>{const[G,ee,$]=q.split("-").map(Number);return new Date(G,ee-1,$)},In=q=>{const{x:G,y:ee,width:$,height:J,name:Me,value:ie,porcentaje:Pe}=q,Re=Me==="Efectivo"?"hsl(180 50% 55%)":"hsl(180 45% 45%)",Ye=$>100&&J>70;return e.jsxs("g",{children:[e.jsx("rect",{x:G,y:ee,width:$,height:J,fill:Re,stroke:"#fff",strokeWidth:2}),Ye&&e.jsxs(e.Fragment,{children:[e.jsx("text",{x:G+$/2,y:ee+J/2-20,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontWeight:"bold",fontSize:"16px",style:{userSelect:"none"},children:Me}),e.jsxs("text",{x:G+$/2,y:ee+J/2+5,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:["$",w(ie,"general")]}),e.jsxs("text",{x:G+$/2,y:ee+J/2+25,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:[Pe,"%"]})]})]})},Tn=({active:q,payload:G,scaleFormat:ee})=>{if(q&&G&&G.length){const $=G[0].payload,J=$.name==="Efectivo";return e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-lg p-3",children:[e.jsx("p",{className:"font-bold text-foreground mb-1",children:$.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Monto: ",e.jsxs("span",{className:"font-semibold text-foreground",children:["$",w($.value,ee)]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Porcentaje: ",e.jsxs("span",{className:"font-semibold text-foreground",children:[$.porcentaje,"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2 italic",children:J?"Se registra en Efectivo (Caja)":"Se registra en Bancos"})]})}return null},An=()=>{const{ventasResumen:q,loading:G,refetch:ee}=cn(),{transacciones:$,loading:J,refetch:Me}=Dn(1e3),{data:ie=[]}=ln(),{data:Pe}=dn(),ue=(Pe==null?void 0:Pe.cuentasFlat)||[],{data:Re=[],isLoading:Ye,refetch:es}=mn(),{data:ge=[],isLoading:Us,refetch:pa}=un(),{data:Oe=[],isLoading:ja}=xn(),ga=hn(),fa=pn(),_t=jn(),va=gn(),[F,wt]=m.useState(""),[Na,ba]=m.useState(!1),[ya,_a]=m.useState(""),[gs,Ct]=m.useState(""),[P,St]=m.useState(""),[fe,ze]=m.useState(""),[fs,Ke]=m.useState(""),[Pt,vs]=m.useState(!1),[H,Ft]=m.useState(""),[be,Ws]=m.useState(""),[He,Ns]=m.useState(""),[ye,bs]=m.useState(""),[_e,ys]=m.useState(""),[Fe,_s]=m.useState(""),[ws,Dt]=m.useState(""),[we,It]=m.useState(""),[Cs,Gs]=m.useState(""),[Te,Ss]=m.useState([]),[wa,ss]=m.useState(!1),[v,Ps]=m.useState(null),[Je,Ys]=m.useState("historico"),[re,ts]=m.useState(""),[Q,Ca]=m.useState("diario"),[y,Sa]=m.useState("general"),[f,Pa]=m.useState("brutas"),[V,Fa]=m.useState("ventas"),[ce,Da]=m.useState(new Date),[I,Ia]=m.useState(new Date),[as,Ta]=m.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[ns,$a]=m.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[rs,ka]=m.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[k,Tt]=m.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]}),[$n,Qe]=m.useState([]),[$e,Ea]=m.useState([]),[De,$t]=m.useState(""),[Ie,kt]=m.useState(""),[le,Et]=m.useState("todos"),[de,At]=m.useState("todas"),[se,Vt]=m.useState(""),[Xe,Aa]=m.useState("subcuenta"),[Le,Ks]=m.useState(null),[Va,os]=m.useState(!1),[te,Hs]=m.useState(""),[Be,is]=m.useState(""),[ke,Js]=m.useState("1"),[Fs,Qs]=m.useState(0),[Xs,Ds]=m.useState(!0),[Zs,et]=m.useState("0"),[qe,st]=m.useState("monto"),[U,Is]=m.useState([]),[Ue,tt]=m.useState(""),[Ts,at]=m.useState(""),[$s,nt]=m.useState("1"),[rt,Mt]=m.useState("0"),[We,Ma]=m.useState("monto"),[Z,ks]=m.useState([]),[Ra,ot]=m.useState(!1),[it,Rt]=m.useState(""),[ct,Ot]=m.useState(""),[zt,Lt]=m.useState(""),[kn,Oa]=m.useState("4001"),[Bt,qt]=m.useState(""),[za,Ut]=m.useState(null);m.useState(null);const[Es,As]=m.useState(!1),[La,Vs]=m.useState(!1),[Ge,lt]=m.useState(null),[Ms,dt]=m.useState(""),[mt,Wt]=m.useState(!1),[Ba,Rs]=m.useState(!1),[qa,Gt]=m.useState(null),[ut,xt]=m.useState(""),[ht,pt]=m.useState(""),[Yt,jt]=m.useState(""),[Ua,gt]=m.useState(null),[Kt,ft]=m.useState(null),[Ht,Jt]=m.useState(""),Ce=Re||[],Wa=s=>{var l;Hs(s);const t=Ce.find(o=>o.id===s);if(t){const o=t.precio_venta,r=o&&o>0?o.toString():((l=t.costo_unitario)==null?void 0:l.toString())||"0",a=o&&o>0;Ds(a),is(r),Qs(t.cantidad_stock||0),Ke(`Venta de ${t.nombre}`);const d=((o&&o>0?o:t.costo_unitario||0)*parseFloat(ke)).toFixed(2);ze(d)}},Ga=s=>{if(is(s),te&&s){const t=(parseFloat(s)*parseFloat(ke||"1")).toFixed(2);ze(t)}},Ya=()=>{if(!Ue)return;const s=ge.find(d=>d.id===Ue);if(!s)return;const t=parseFloat($s)||1,l=parseFloat(rt)||0,o=s.precio*t,r=We==="porcentaje"?o*(l/100):l,a=Math.max(0,o-r),c=Z.findIndex(d=>d.id===Ue);if(c!==-1){const d=[...Z];d[c].cantidad+=t,d[c].descuento+=r;const u=d[c].precio*d[c].cantidad;d[c].subtotal=Math.max(0,u-d[c].descuento),ks(d)}else ks([...Z,{id:s.id,nombre:s.nombre,precio:s.precio,cantidad:t,descuento:r,subtotal:a,imagen_url:s.imagen_url}]);tt(""),nt("1"),at(""),Mt("0")},Ka=s=>{ks(Z.filter(t=>t.id!==s))},Ha=()=>{if(!te)return;const s=Ce.find(u=>u.id===te);if(!s)return;const t=parseFloat(ke)||1,l=parseFloat(Be)||0,o=parseFloat(Zs)||0,r=l*t,a=qe==="porcentaje"?r*(o/100):o,c=Math.max(0,r-a),d=U.findIndex(u=>u.id===te);if(d!==-1){const u=[...U];u[d].cantidad+=t,u[d].descuento+=a;const n=u[d].precioUnitario*u[d].cantidad;u[d].subtotal=Math.max(0,n-u[d].descuento),Is(u)}else Is([...U,{id:te,nombre:s.nombre,precioUnitario:l,cantidad:t,descuento:a,subtotal:c,stockDisponible:s.cantidad_stock||0,costoUnitario:s.costo_unitario||0,imagen_url:s.imagen_url}]);Hs(""),Js("1"),is(""),et("0"),st("monto"),Qs(0),Ds(!0),X({title:"‚úÖ Producto agregado",description:`${s.nombre} agregado a la venta`})},Ja=s=>{Is(U.filter(t=>t.id!==s)),X({title:"Producto eliminado",description:"El producto ha sido removido de la venta"})};m.useEffect(()=>{if(F==="precargados"&&Z.length>0){const s=Z.reduce((t,l)=>t+l.subtotal,0).toFixed(2);ze(s),Ke(`Venta de ${Z.length} producto(s)`)}},[Z,F]),m.useEffect(()=>{if(F==="inventariados"&&U.length>0){const s=U.reduce((t,l)=>t+l.subtotal,0).toFixed(2);ze(s),Ke(`Venta de ${U.length} producto(s) de inventario`)}},[U,F]);const Qa=s=>{tt(s);const t=ge.find(l=>l.id===s);t&&at(t.precio.toString())},Qt=()=>{const s=[];return F||s.push("Tipo de Ingreso"),F==="precargados"?Z.length===0&&s.push("Debe agregar al menos un producto"):F==="inventariados"?U.length===0&&s.push("Debe agregar al menos un producto del inventario"):(F==="general"||F==="otros")&&(fs.trim()||s.push("Descripci√≥n")),F!=="precargados"&&F!=="inventariados"&&(!fe||parseFloat(fe)<=0)&&s.push("Monto Total"),(P==="credito"||P==="parcial")&&(H||s.push("Tipo de Cliente"),H==="recurrente"&&!be&&s.push("Cliente Seleccionado"),H==="nuevo"&&(He.trim()||s.push("Nombre del Cliente"),ye.trim()||s.push("Tel√©fono del Cliente"),_e.trim()||s.push("Email del Cliente")),ws||s.push("Fecha de Vencimiento"),P==="parcial"&&((!we||parseFloat(we)<=0)&&s.push("Monto Abonado"),fe&&we&&parseFloat(we)>=parseFloat(fe)&&s.push("Monto Abonado debe ser menor al total"))),(P==="contado"||P==="parcial")&&!gs&&s.push("M√©todo de Pago"),P||s.push("Tipo de Pago"),s},Y=s=>Qt().includes(s),Xa=(s,t,l)=>{const o=[];return!Oe||Oe.length===0||Oe.forEach(r=>{r.telefono&&s&&r.telefono.trim()===s.trim()&&o.push(`El tel√©fono ${s} ya est√° registrado para el cliente "${r.nombre}"`),r.email&&t&&r.email.trim().toLowerCase()===t.trim().toLowerCase()&&o.push(`El correo ${t} ya est√° registrado para el cliente "${r.nombre}"`),r.rfc&&l&&r.rfc.trim().toUpperCase()===l.trim().toUpperCase()&&o.push(`El RFC ${l} ya est√° registrado para el cliente "${r.nombre}"`)}),o};m.useEffect(()=>{if(H==="nuevo"&&(ye||_e||Fe)){const s=Xa(ye,_e,Fe);Ss(s)}else Ss([])},[ye,_e,Fe,H,Oe]),m.useEffect(()=>{(async()=>{var l;const{data:t}=await K.auth.getUser();if((l=t==null?void 0:t.user)!=null&&l.id)try{const{data:o,error:r}=await K.from("asientos_contables").select(`
            id,
            fecha,
            descripcion,
            numero_asiento,
            detalle_asientos!inner(
              cuenta_codigo,
              haber,
              debe,
              subcuenta_id
            )
          `).eq("user_id",t.user.id).is("transaccion_ingreso_id",null);if(r)throw r;if(!o)return;const a=o.filter(c=>c.detalle_asientos.some(d=>d.cuenta_codigo.startsWith("4")&&d.cuenta_codigo!=="4003"&&Number(d.haber)>0));Ea(a)}catch(o){console.error("Error al cargar asientos directos:",o)}})()},[]),m.useEffect(()=>{(async()=>{var l;const{data:t}=await K.auth.getUser();if((l=t==null?void 0:t.user)!=null&&l.id)try{let o,r;Q==="diario"?(o=new Date(ce),o.setHours(0,0,0,0),r=new Date(ce),r.setHours(23,59,59,999)):Q==="mensual"?(o=new Date(I.getFullYear(),I.getMonth(),1),r=new Date(I.getFullYear(),I.getMonth()+1,0,23,59,59,999)):(o=new Date(new Date().getFullYear(),0,1),r=new Date(new Date().getFullYear(),11,31,23,59,59,999));const{data:a,error:c}=await K.from("asientos_contables").select("id, fecha, descripcion").eq("user_id",t.user.id).gte("fecha",o.toISOString().split("T")[0]).lte("fecha",r.toISOString().split("T")[0]);if(c)throw c;if(!a||a.length===0){Tt({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]});return}const d=a.map(N=>N.id),{data:u,error:n}=await K.from("detalle_asientos").select("asiento_id, cuenta_codigo, debe, haber").in("asiento_id",d);if(n)throw n;if(!u)return;let i=0,x=0,j=0;const p={};a.forEach(N=>{const _=u.filter(W=>W.asiento_id===N.id),b=yt(N.fecha);let E;Q==="diario"?E="Hoy":Q==="mensual"?E=`D√≠a ${b.getDate()}`:E=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][b.getMonth()],p[E]||(p[E]={ventasBrutas:0,descuentos:0,otrosIngresos:0}),_.forEach(W=>{const R=W.debe||0,oe=W.haber||0,me=W.cuenta_codigo;if(V==="ventas"){if(me==="4001"){const ae=oe-R;i+=ae,p[E].ventasBrutas+=ae}if(me==="4003"){const ae=R-oe;x+=ae,p[E].descuentos+=ae}}else if(me.startsWith("4")&&me!=="4001"&&me!=="4003"){const ae=oe-R;j+=ae,p[E].otrosIngresos+=ae}})});let g=[];if(Q==="diario"){const N=p.Hoy||{ventasBrutas:0,descuentos:0,otrosIngresos:0};g=[{periodo:"Hoy",ventasBrutas:N.ventasBrutas,descuentos:N.descuentos,ventasNetas:N.ventasBrutas-N.descuentos,otrosIngresos:N.otrosIngresos}]}else if(Q==="mensual"){const N=new Date(I.getFullYear(),I.getMonth()+1,0).getDate();g=Array.from({length:N},(_,b)=>{const W=`D√≠a ${b+1}`,R=p[W]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:W,ventasBrutas:R.ventasBrutas,descuentos:R.descuentos,ventasNetas:R.ventasBrutas-R.descuentos,otrosIngresos:R.otrosIngresos}})}else g=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"].map(_=>{const b=p[_]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:_,ventasBrutas:b.ventasBrutas,descuentos:b.descuentos,ventasNetas:b.ventasBrutas-b.descuentos,otrosIngresos:b.otrosIngresos}});Tt({ventasBrutas:i,descuentos:x,ventasNetas:i-x,otrosIngresos:j,detallesPorPeriodo:g})}catch(o){console.error("Error calculando anal√≠ticas desde asientos:",o)}})()},[Q,ce,I,V]),m.useEffect(()=>{(async()=>{var l;try{const{data:o}=await K.auth.getUser();if(!((l=o==null?void 0:o.user)!=null&&l.id))return;const r=async n=>{const i=new Date;let x,j;if(n==="dia")x=ce.toISOString().split("T")[0],j=x;else if(n==="mes"){const R=I.getMonth(),oe=I.getFullYear(),me=new Date(oe,R,1),ae=new Date(oe,R+1,0);x=me.toISOString().split("T")[0],j=ae.toISOString().split("T")[0]}else{const R=i.getFullYear();x=`${R}-01-01`,j=`${R}-12-31`}const{data:p,error:g}=await K.from("detalle_asientos").select(`
              id,
              cuenta_codigo,
              debe,
              haber,
              asiento_id,
              asientos_contables!inner(
                fecha,
                user_id
              )
            `).eq("asientos_contables.user_id",o.user.id).gte("asientos_contables.fecha",x).lte("asientos_contables.fecha",j).like("cuenta_codigo","4%");if(g)throw g;let N=0,_=0,b=0;(p||[]).forEach(R=>{const oe=Number(R.debe)||0,me=Number(R.haber)||0,ae=R.cuenta_codigo;ae==="4001"?N+=me-oe:ae==="4003"?_+=oe-me:ae!=null&&ae.startsWith("4")&&(b+=me-oe)});const E=N-_,W=E+b;return{ventasBrutas:N,descuentos:_,ventasNetas:E,otrosIngresos:b,totalIngresos:W}},a=async()=>{try{const{data:{user:n}}=await K.auth.getUser();if(!n)return;let i,x=new Date;Q==="diario"?(i=new Date(ce),i.setHours(0,0,0,0),x=new Date(ce),x.setHours(23,59,59,999)):Q==="mensual"?(i=new Date(I.getFullYear(),I.getMonth(),1),x=new Date(I.getFullYear(),I.getMonth()+1,0,23,59,59,999)):(i=new Date(I.getFullYear(),0,1),x=new Date(I.getFullYear(),11,31,23,59,59,999));const{data:j,error:p}=await K.from("movimientos_inventario").select(`
                *,
                productos (
                  id,
                  nombre,
                  precio_venta,
                  imagen_url
                )
              `).eq("user_id",n.id).eq("tipo_movimiento","venta").gte("created_at",i.toISOString()).lte("created_at",x.toISOString()).order("created_at",{ascending:!1});if(p){console.error("Error cargando movimientos:",p),Qe([]);return}Qe(j||[])}catch(n){console.error("Error en cargarMovimientosInventario:",n),Qe([])}},[c,d,u]=await Promise.all([r("dia"),r("mes"),r("ano")]);Ta(c),$a(d),ka(u)}catch(o){console.error("Error calculando totales:",o)}})(),(async()=>{try{const{data:{user:l}}=await K.auth.getUser();if(!l)return;let o,r=new Date;Q==="diario"?(o=new Date(ce),o.setHours(0,0,0,0),r=new Date(ce),r.setHours(23,59,59,999)):Q==="mensual"?(o=new Date(I.getFullYear(),I.getMonth(),1),r=new Date(I.getFullYear(),I.getMonth()+1,0,23,59,59,999)):(o=new Date(I.getFullYear(),0,1),r=new Date(I.getFullYear(),11,31,23,59,59,999));const{data:a,error:c}=await K.from("movimientos_inventario").select(`
            *,
            productos (
              id,
              nombre,
              precio_venta,
              imagen_url
            )
          `).eq("user_id",l.id).eq("tipo_movimiento","venta").gte("created_at",o.toISOString()).lte("created_at",r.toISOString()).order("created_at",{ascending:!1});if(c){console.error("Error cargando movimientos:",c),Qe([]);return}Qe(a||[])}catch(l){console.error("Error en loadMovimientos:",l),Qe([])}})()},[ce,I,Q,$]);const Za=async s=>{os(!0),Ks(null);try{console.log("Cargando asientos para transacci√≥n:",s);const{data:t,error:l}=await K.from("asientos_contables").select("*").eq("transaccion_ingreso_id",s).maybeSingle();if(console.log("Resultado de asientos:",{asientos:t,asientosError:l}),l){console.error("Error loading asiento:",l),X({title:"Error",description:"Error al cargar asientos contables",variant:"destructive"}),os(!1);return}if(!t){console.warn("No se encontr√≥ asiento para la transacci√≥n:",s),os(!1);return}const{data:o,error:r}=await K.from("detalle_asientos").select("*").eq("asiento_id",t.id);if(console.log("Resultado de detalles:",{detalles:o,detallesError:r}),r){console.error("Error loading detalles:",r),X({title:"Error",description:"Error al cargar detalles de asientos",variant:"destructive"}),os(!1);return}const{data:a}=await K.from("cuentas").select("codigo, nombre"),c=new Map((a==null?void 0:a.map(n=>[n.codigo,n.nombre]))||[]),d=(o==null?void 0:o.map(n=>({...n,cuenta_nombre:c.get(n.cuenta_codigo)||n.cuenta_codigo})))||[],u={...t,detalles:d};console.log("Asiento completo cargado:",u),Ks(u)}catch(t){console.error("Error en loadAsientosContables:",t),X({title:"Error",description:"Error inesperado al cargar asientos",variant:"destructive"})}finally{os(!1)}},en=async()=>{const s=Qt();if(s.length>0){X({title:"‚ö†Ô∏è Campos requeridos faltantes",description:`Debes completar: ${s.join(", ")}`,variant:"destructive"});return}if(F==="inventariados"){if(U.length===0){X({title:"‚ö†Ô∏è No hay productos",description:"Debes agregar al menos un producto del inventario a la venta",variant:"destructive"});return}for(const t of U)if(t.cantidad>t.stockDisponible){const l=Ce.find(o=>o.id===t.id);Ps({productName:t.nombre,requested:t.cantidad,available:t.stockDisponible,costoPorUnidad:(l==null?void 0:l.costo_unitario)||0,costoTotal:((l==null?void 0:l.costo_unitario)||0)*t.cantidad}),ss(!0);return}await vt();return}if(F==="inventariados"&&te){const t=parseFloat(ke||"1");if(t>Fs){const l=Ce.find(c=>c.id===te);let o=(l==null?void 0:l.costo_unitario)||0;if(o===0){const{data:c}=await K.from("movimientos_inventario").select("costo_unitario, cantidad, tipo_movimiento").eq("producto_id",te).eq("tipo_movimiento","compra").order("created_at",{ascending:!1});if(c&&c.length>0){let d=0,u=0;for(const n of c)n.costo_unitario>0&&n.cantidad>0&&(d+=n.costo_unitario*n.cantidad,u+=n.cantidad);u>0&&(o=d/u)}}const r=t-Fs,a=o*r;Ps({productName:(l==null?void 0:l.nombre)||"Producto",requested:t,available:Fs,costoPorUnidad:o,costoTotal:a}),ss(!0);return}}H==="nuevo"&&Te.length>0&&!confirm(`Se detectaron posibles duplicados:

${Te.join(`
`)}

¬øDeseas continuar registrando este cliente de todas formas?`)||await vt()},vt=async()=>{vs(!0);try{let s=null;if(H==="nuevo"&&He.trim())try{s=(await va.mutateAsync({nombre:He.trim(),email:_e.trim()||void 0,telefono:ye.trim()||void 0,rfc:Fe.trim()||void 0,activo:!0})).id}catch(n){console.error("Error creating client:",n),X({title:"Error al crear cliente",description:"No se pudo crear el cliente nuevo",variant:"destructive"}),vs(!1);return}else H==="recurrente"&&be&&(s=be);const t=Ce.find(n=>n.id===te);let l=fs,o=Number(fe||"0"),r=null,a=0;if(F==="precargados"&&Z.length>0){const n=ge.find(j=>j.id===Z[0].id);r=(n==null?void 0:n.subcuenta_id)||null;const i=Z.reduce((j,p)=>j+p.precio*p.cantidad,0),x=Z.reduce((j,p)=>j+p.descuento,0);o=i,a=x,l=`Venta: ${Z.map(j=>`${j.nombre} (x${j.cantidad})`).join(", ")}`}else F==="inventariados"&&(l="Venta de productos inventariados",o=0,r=null);F!=="precargados"&&(a=Na?Number(ya||"0"):0);const c=Math.max(0,Number((o-a).toFixed(2)));let d=0,u=0;if(P==="contado"?(d=c,u=0):P==="parcial"?(d=Number(we||"0"),u=Math.max(0,c-d)):P==="credito"&&(d=0,u=c),F==="inventariados"&&U.length>0){const n=U.reduce((g,N)=>g+N.precioUnitario*N.cantidad,0),i=U.reduce((g,N)=>g+N.descuento,0),x=n-i;let j=0,p=0;P==="contado"?(j=x,p=0):P==="parcial"?(j=Number(we||"0"),p=Math.max(0,x-j)):P==="credito"&&(j=0,p=x);for(const g of U){const N=Ce.find(me=>me.id===g.id);if(!N)continue;const _=U.length===1?`Venta de ${g.nombre}`:`Venta m√∫ltiple (${U.length} productos): ${g.nombre}`,b=g.subtotal/x,E=j*b,W=p*b,{data:R,error:oe}=await K.functions.invoke("registrar-ingreso",{body:{tipoIngreso:"inventariados",descripcion:_,montoTotal:g.precioUnitario*g.cantidad,montoDescuento:g.descuento,cuentaPrincipalCodigo:"4001",subcuentaId:N.subcuenta_id||null,metodoPago:gs,tipoPago:P,montoPagado:E,montoPendiente:W,clienteNombre:He.trim()||null,clienteTelefono:ye.trim()||null,clienteEmail:_e.trim()||null,clienteRFC:Fe.trim()||null,clienteId:s,fechaVencimiento:ws||null,comentarios:Cs.trim()||null,productoId:g.id,cantidadVendida:g.cantidad,precioVenta:g.precioUnitario,costoPersonalizado:Je==="personalizado"&&re?parseFloat(re):void 0}});if(oe)throw oe}X({title:"‚úÖ Venta registrada exitosamente",description:`Se registraron ${U.length} productos del inventario`,duration:5e3})}else{if(!l||o<=0){X({title:"‚ö†Ô∏è Datos incompletos",description:"Selecciona un producto v√°lido o ingresa una descripci√≥n y monto.",variant:"destructive"}),vs(!1);return}const{data:n,error:i}=await K.functions.invoke("registrar-ingreso",{body:{tipoIngreso:F,descripcion:l,montoTotal:o,montoDescuento:a,cuentaPrincipalCodigo:F==="otros"?"4102":"4001",subcuentaId:r||void 0,metodoPago:gs,tipoPago:P,montoPagado:d,montoPendiente:u,clienteNombre:He.trim()||null,clienteTelefono:ye.trim()||null,clienteEmail:_e.trim()||null,clienteRFC:Fe.trim()||null,clienteId:s,fechaVencimiento:ws||null,comentarios:Cs.trim()||null,...F==="inventariados"&&t&&{productoId:t.id,cantidadVendida:Number(ke||"1"),precioVenta:Number(Be||"0"),costoPersonalizado:Je==="personalizado"&&re?Number(re):void 0}}});if(i)throw i;X({title:"Ingreso registrado",description:`Asiento ${n.numeroAsiento} creado correctamente`})}await Promise.all([ee(),Me()]),F==="inventariados"&&window.location.reload(),wt(""),Ke(""),ze(""),_a(""),ba(!1),Ct(""),St(""),Ft(""),Ws(""),Ns(""),bs(""),ys(""),_s(""),Dt(""),It(""),Gs(""),Ss([]),tt(""),at(""),nt("1"),ks([]),Hs(""),is(""),Js("1"),Qs(0),Ds(!0),Is([]),et("0"),st("monto")}catch(s){X({title:"Error",description:s.message||"Error al registrar el ingreso",variant:"destructive"})}finally{vs(!1)}},sn=async()=>{if(!Ge||!Ms.trim()){X({title:"‚ö†Ô∏è Motivo requerido",description:"Debes ingresar el motivo de la cancelaci√≥n",variant:"destructive"});return}Wt(!0);try{console.log("Cancelando transacci√≥n:",Ge.id);const{data:s,error:t}=await K.functions.invoke("cancelar-ingreso",{body:{transaccionId:Ge.id,motivoCancelacion:Ms.trim()}});if(console.log("Respuesta de edge function:",{data:s,error:t}),t)throw console.error("Error de edge function:",t),new Error(t.message||JSON.stringify(t));if(s!=null&&s.error)throw console.error("Error en data:",s),new Error(s.error);X({title:"‚úì Transacci√≥n cancelada",description:`Asiento de reversi√≥n ${(s==null?void 0:s.numeroAsientoReversion)||"creado"} correctamente`}),await Promise.all([ee(),Me()]),dt(""),lt(null),Vs(!1)}catch(s){console.error("Error completo al cancelar:",s),X({title:"‚ùå Error al cancelar",description:(s==null?void 0:s.message)||(s==null?void 0:s.toString())||"No se pudo cancelar la transacci√≥n",variant:"destructive"})}finally{Wt(!1)}},tn=s=>{switch(s){case"precargados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ae,{children:[e.jsx(A,{className:"h-4 w-4"}),e.jsxs(Ve,{children:[e.jsx("strong",{children:"Recordatorio:"}),' Para registrar ventas de productos precargados, primero debes agregar los productos al cat√°logo desde la pesta√±a "Cat√°logo de Productos".']})]}),e.jsxs(O,{className:"bg-muted/50",children:[e.jsx(z,{className:"pb-3",children:e.jsx(L,{className:"text-base",children:"Agregar Productos a la Venta"})}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"producto-precargado",children:"Seleccionar Producto"}),e.jsxs(xe,{value:Ue,onValueChange:Qa,children:[e.jsx(he,{children:e.jsx(pe,{placeholder:Us?"Cargando productos...":"Seleccionar producto del cat√°logo"})}),e.jsx(je,{className:"max-h-80 z-50 bg-background border border-border w-full",children:Us?e.jsx(S,{value:"loading",disabled:!0,children:"Cargando productos..."}):ge.length===0?e.jsx(S,{value:"empty",disabled:!0,children:"No hay productos de servicios registrados"}):ge.map(t=>e.jsx(S,{value:t.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate mb-1",children:t.nombre}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",C(t.precio)]})]})]})},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cantidad",children:"Cantidad"}),e.jsx(T,{id:"cantidad",type:"number",placeholder:"1",min:"1",value:$s,onChange:t=>nt(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"precio-unitario",children:"Precio Unitario"}),e.jsx(T,{id:"precio-unitario",type:"number",placeholder:"0.00",value:Ts,readOnly:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"descuento-producto",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(ve,{value:We,onValueChange:t=>Ma(t),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"monto",id:"descuento-monto"}),e.jsx(h,{htmlFor:"descuento-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"porcentaje",id:"descuento-porcentaje"}),e.jsx(h,{htmlFor:"descuento-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(T,{id:"descuento-producto",type:"number",placeholder:We==="porcentaje"?"0":"0.00",min:"0",max:We==="porcentaje"?"100":void 0,step:We==="porcentaje"?"1":"0.01",value:rt,onChange:t=>Mt(t.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:We==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Subtotal con Descuento"}),e.jsx(T,{type:"text",value:Ue&&Ts?(()=>{const t=parseFloat(Ts)*parseFloat($s||"1"),l=parseFloat(rt||"0"),o=We==="porcentaje"?Math.max(0,t-t*l/100):Math.max(0,t-l);return`$${C(o)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(M,{type:"button",onClick:Ya,disabled:!Ue,className:"w-full",variant:"secondary",children:[e.jsx(bt,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),Z.length>0&&e.jsxs(O,{children:[e.jsx(z,{className:"pb-3",children:e.jsxs(L,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",Z.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",C(Z.reduce((t,l)=>t+l.subtotal,0))]})]})}),e.jsx(B,{children:e.jsx("div",{className:"space-y-2",children:Z.map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[t.cantidad," x $",C(t.precio)," = $",C(t.cantidad*t.precio)]}),t.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",C(t.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",C(t.subtotal)]})]})]})]}),e.jsx(M,{type:"button",variant:"ghost",size:"sm",onClick:()=>Ka(t.id),className:"text-destructive hover:text-destructive",children:e.jsx(A,{className:"h-4 w-4"})})]},`${t.id}-${l}`))})})]}),Y("Debe agregar al menos un producto")&&e.jsxs(Ae,{variant:"destructive",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(Ve,{children:"Debes agregar al menos un producto a la venta"})]})]});case"inventariados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ae,{children:[e.jsx(A,{className:"h-4 w-4"}),e.jsxs(Ve,{children:[e.jsx("strong",{children:"Ventas desde Inventario:"})," Selecciona productos, aplica descuentos opcionales y agr√©galos a la venta. Si vendes m√°s de lo disponible, se te pedir√° confirmar la sobreventa."]})]}),e.jsxs(O,{className:"bg-muted/50",children:[e.jsx(z,{className:"pb-3",children:e.jsx(L,{className:"text-base",children:"Agregar Productos del Inventario"})}),e.jsxs(B,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"producto-inventario",children:"Seleccionar Producto"}),e.jsxs(xe,{value:te,onValueChange:Wa,children:[e.jsx(he,{children:e.jsx(pe,{placeholder:Ye?"Cargando inventario...":"Seleccionar producto del inventario"})}),e.jsx(je,{className:"max-h-80 z-50 bg-background border border-border w-full",children:Ye?e.jsx(S,{value:"loading",disabled:!0,children:"Cargando inventario..."}):Ce.length===0?e.jsx(S,{value:"empty",disabled:!0,children:"No hay productos con stock disponible"}):Ce.map(t=>e.jsx(S,{value:t.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.nombre}),e.jsxs("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full flex-shrink-0 ml-2",children:["Stock: ",t.cantidad_stock||0]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Costo: $",t.costo_unitario||0]}),t.precio_venta&&t.precio_venta>0?e.jsxs("span",{className:"text-xs text-green-600 font-medium",children:["Venta: $",t.precio_venta]}):e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"‚ö†Ô∏è Sin precio"})]})]})]})},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cantidad-inv",children:"Cantidad a Vender"}),e.jsx(T,{id:"cantidad-inv",type:"number",min:"1",value:ke,onChange:t=>Js(t.target.value)}),te&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Stock disponible: ",Fs," unidades"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"precio-inv",children:"Precio Unitario"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ve,{value:Xs?"registrado":"personalizado",onValueChange:t=>{const l=t==="registrado";if(Ds(l),l&&te){const o=Ce.find(r=>r.id===te);if(o){const r=o.precio_venta||o.costo_unitario||0;is(r.toString())}}},className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"registrado",id:"precio-registrado"}),e.jsx(h,{htmlFor:"precio-registrado",className:"text-sm cursor-pointer",children:"Precio registrado"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"personalizado",id:"precio-personalizado"}),e.jsx(h,{htmlFor:"precio-personalizado",className:"text-sm cursor-pointer",children:"Personalizado"})]})]}),e.jsx(T,{id:"precio-inv",type:"number",step:"0.01",min:"0",value:Be,onChange:t=>Ga(t.target.value),readOnly:Xs,className:Xs?"bg-muted":""})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"descuento-inv",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(ve,{value:qe,onValueChange:t=>st(t),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"monto",id:"descuento-inv-monto"}),e.jsx(h,{htmlFor:"descuento-inv-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"porcentaje",id:"descuento-inv-porcentaje"}),e.jsx(h,{htmlFor:"descuento-inv-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(T,{id:"descuento-inv",type:"number",placeholder:qe==="porcentaje"?"0":"0.00",min:"0",max:qe==="porcentaje"?"100":void 0,step:qe==="porcentaje"?"1":"0.01",value:Zs,onChange:t=>et(t.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:qe==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{children:"Subtotal con Descuento"}),e.jsx(T,{type:"text",value:te&&Be?(()=>{const t=parseFloat(Be)*parseFloat(ke||"1"),l=parseFloat(Zs||"0"),o=qe==="porcentaje"?Math.max(0,t-t*l/100):Math.max(0,t-l);return`$${C(o)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(M,{type:"button",onClick:Ha,disabled:!te||!Be,className:"w-full",variant:"secondary",children:[e.jsx(bt,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),U.length>0&&e.jsxs(O,{children:[e.jsx(z,{className:"pb-3",children:e.jsxs(L,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",U.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",C(U.reduce((t,l)=>t+l.subtotal,0))]})]})}),e.jsx(B,{children:e.jsx("div",{className:"space-y-2",children:U.map((t,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[t.cantidad," x $",C(t.precioUnitario)," = $",C(t.cantidad*t.precioUnitario)]}),t.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",C(t.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",C(t.subtotal)]}),e.jsxs("span",{className:"text-xs",children:["Stock disponible: ",t.stockDisponible]})]})]})]}),e.jsx(M,{type:"button",variant:"ghost",size:"sm",onClick:()=>Ja(t.id),className:"text-destructive hover:text-destructive",children:e.jsx(A,{className:"h-4 w-4"})})]},`${t.id}-${l}`))})})]})]});case"general":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"descripcion-general",children:"Descripci√≥n del Ingreso"}),Y("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(T,{id:"descripcion-general",placeholder:"Ej: Servicio de consultor√≠a",value:fs,onChange:t=>Ke(t.target.value),className:Y("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cuenta-contable",children:"Cuenta Contable"}),e.jsxs(xe,{defaultValue:"4001",children:[e.jsx(he,{children:e.jsx(pe,{placeholder:"4001 - Ventas"})}),e.jsx(je,{children:e.jsx(S,{value:"4001",children:"4001 - Ventas"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"subcuenta",children:"Subcuenta (Opcional)"}),e.jsxs(xe,{children:[e.jsx(he,{children:e.jsx(pe,{placeholder:"Seleccionar subcuenta"})}),e.jsx(je,{children:e.jsx(S,{value:"sub1",children:"Subcuenta ejemplo"})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"monto-general",children:"Monto"}),Y("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(T,{id:"monto-general",type:"number",placeholder:"0.00",value:fe,onChange:t=>ze(t.target.value),className:Y("Monto Total")?"border-destructive":""})]})]});case"otros":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ae,{children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(Ve,{children:"Este ingreso se ligar√° a la cuenta 4102 - Otros Productos."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"descripcion-otros",children:"Descripci√≥n del Ingreso Extraordinario"}),Y("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(Ze,{id:"descripcion-otros",placeholder:"Ej: Venta extraordinaria de equipo usado, donaci√≥n recibida, etc.",value:fs,onChange:t=>Ke(t.target.value),className:Y("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"monto-otros",children:"Monto"}),Y("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(T,{id:"monto-otros",type:"number",placeholder:"0.00",value:fe,onChange:t=>ze(t.target.value),className:Y("Monto Total")?"border-destructive":""})]})]});default:return null}},an=async()=>{if(!it.trim()||!ct.trim()){X({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}As(!0);try{await ga.mutateAsync({nombre:it.trim(),precio:parseFloat(ct),descripcion:zt.trim()||void 0,subcuentaId:Bt||void 0,imagen:za||void 0}),Rt(""),Ot(""),Lt(""),Oa("4001"),qt(""),Ut(null),ot(!1)}catch{}finally{As(!1)}},Xt=s=>{var t;Gt(s),xt(s.nombre),pt(((t=s.precio)==null?void 0:t.toString())||""),jt(s.descripcion||""),ft(s.imagen_url||null),gt(null),Jt(s.subcuenta_id||""),Rs(!0)},nn=s=>{var l;const t=(l=s.target.files)==null?void 0:l[0];if(t){gt(t);const o=new FileReader;o.onloadend=()=>{ft(o.result)},o.readAsDataURL(t)}},rn=async()=>{if(!ut.trim()||!ht.trim()){X({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}As(!0);try{await fa.mutateAsync({id:qa.id,nombre:ut.trim(),precio:parseFloat(ht),descripcion:Yt.trim()||void 0,imagen:Ua||void 0,subcuentaId:Ht||null}),Rs(!1),Gt(null),xt(""),pt(""),jt(""),gt(null),ft(null)}catch{}finally{As(!1)}};return e.jsxs("div",{className:"h-full overflow-hidden flex flex-col",children:[e.jsx(cs,{open:wa,onOpenChange:ss,children:e.jsxs(ls,{children:[e.jsxs(ds,{children:[e.jsxs(ms,{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(A,{className:"h-5 w-5"}),"Advertencia: Inventario Insuficiente"]}),e.jsxs(us,{className:"space-y-3 pt-4",children:[e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-950/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx("p",{className:"font-medium mb-2",children:"Est√°s a punto de vender un producto sin suficiente inventario:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Producto:"}),e.jsx("span",{className:"font-medium",children:v==null?void 0:v.productName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cantidad solicitada:"}),e.jsx("span",{className:"font-medium",children:v==null?void 0:v.requested})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Stock disponible:"}),e.jsx("span",{className:"font-medium",children:v==null?void 0:v.available})]}),e.jsx(Ee,{}),e.jsxs("div",{className:"flex justify-between text-orange-600",children:[e.jsx("span",{className:"font-medium",children:"Faltante:"}),e.jsx("span",{className:"font-bold",children:((v==null?void 0:v.requested)||0)-((v==null?void 0:v.available)||0)})]})]})]}),(v==null?void 0:v.costoPorUnidad)&&v.costoPorUnidad>0&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border-2 border-blue-300 dark:border-blue-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Zt,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),e.jsx("p",{className:"font-bold text-blue-700 dark:text-blue-300",children:"üìä Costo Promedio Hist√≥rico"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Costo promedio calculado:"}),e.jsxs("span",{className:"text-lg font-bold text-blue-700 dark:text-blue-300",children:["$",C(v.costoPorUnidad)," por unidad"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Este costo se calcul√≥ autom√°ticamente del promedio ponderado de todas tus compras anteriores de este producto. Puedes usar este costo sugerido o ingresar uno personalizado si conoces el costo real de esta venta."})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"font-medium mb-3 text-blue-700 dark:text-blue-400",children:"Impacto en el inventario:"}),v!=null&&v.costoPorUnidad&&v.costoPorUnidad>0?e.jsxs(e.Fragment,{children:[e.jsxs(ve,{value:Je,onValueChange:s=>{Ys(s),s==="historico"&&ts("")},className:"space-y-3 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"historico",id:"costo-historico"}),e.jsxs(h,{htmlFor:"costo-historico",className:"text-sm cursor-pointer",children:["Usar costo hist√≥rico: ",e.jsxs("strong",{className:"text-blue-700 dark:text-blue-400",children:["$",C(v.costoPorUnidad)]})," por unidad"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"personalizado",id:"costo-personalizado"}),e.jsx(h,{htmlFor:"costo-personalizado",className:"text-sm cursor-pointer",children:"Ingresar costo personalizado"})]})]}),Je==="personalizado"&&e.jsxs("div",{className:"mb-3",children:[e.jsx(h,{htmlFor:"costo-custom",className:"text-xs",children:"Costo unitario personalizado"}),e.jsx(T,{id:"costo-custom",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:re,onChange:s=>ts(s.target.value),className:"mt-1"})]}),e.jsx(Ee,{className:"my-3"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Costo por unidad aplicado:"}),e.jsxs("span",{className:"font-medium",children:["$",C(Je==="personalizado"&&re?re:v.costoPorUnidad)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",C((Je==="personalizado"&&re?Number(re):v.costoPorUnidad)*(((v==null?void 0:v.requested)||0)-((v==null?void 0:v.available)||0)))]})]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"‚ö†Ô∏è Este producto no tiene costo hist√≥rico registrado."}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"costo-requerido",className:"text-xs",children:"Ingresa el costo unitario para esta transacci√≥n"}),e.jsx(T,{id:"costo-requerido",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:re,onChange:s=>ts(s.target.value),className:"mt-1"})]}),re&&Number(re)>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ee,{}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",C(Number(re)*(((v==null?void 0:v.requested)||0)-((v==null?void 0:v.available)||0)))]})]})]})]})]}),e.jsxs("p",{className:"text-sm",children:["Si contin√∫as, el inventario quedar√° en ",e.jsxs("strong",{className:"text-destructive",children:["negativo (",((v==null?void 0:v.available)||0)-((v==null?void 0:v.requested)||0)," unidades)"]}),". Esto se reflejar√° en tu control de inventario con el valor mostrado arriba."]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"¬øDeseas continuar con la venta de todas formas?"})]})]}),e.jsxs(Os,{className:"gap-2 sm:gap-0",children:[e.jsx(M,{variant:"outline",onClick:()=>{ss(!1),Ps(null),Ys("historico"),ts("")},children:"Cancelar"}),e.jsxs(M,{variant:"destructive",onClick:async()=>{if((!(v!=null&&v.costoPorUnidad)||v.costoPorUnidad===0)&&(!re||Number(re)<=0)){X({title:"Costo requerido",description:"Debes ingresar un costo unitario para continuar",variant:"destructive"});return}ss(!1),Ps(null),await vt(),Ys("historico"),ts("")},children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Continuar con la Venta"]})]})]})}),e.jsxs("div",{className:"p-6 border-b bg-background",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Registro de Ingresos"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Registra ventas, gestiona cat√°logos y analiza ingresos de la empresa"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[e.jsxs(fn,{defaultValue:"registro",className:"w-full",children:[e.jsxs(vn,{className:"grid w-full grid-cols-4",children:[e.jsx(zs,{value:"registro",children:"Registro de Ingresos"}),e.jsx(zs,{value:"resumen",children:"Resumen de Ventas"}),e.jsx(zs,{value:"analitica",children:"Anal√≠tica de Ventas"}),e.jsx(zs,{value:"catalogo",children:"Cat√°logo de Productos"})]}),e.jsx(Ls,{value:"registro",className:"mt-6 space-y-6",children:e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsx(L,{children:"Nuevo Registro de Ingreso"}),e.jsx(ne,{children:"Selecciona el tipo de ingreso y completa la informaci√≥n requerida"})]}),e.jsxs(B,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(h,{className:"text-base font-semibold",children:"Tipo de Ingreso"}),e.jsx(ve,{value:F,onValueChange:wt,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50",children:[e.jsx(D,{value:"precargados",id:"precargados"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ea,{className:"h-5 w-5 text-primary"}),e.jsx(h,{htmlFor:"precargados",className:"cursor-pointer flex-1",children:e.jsx("div",{className:"font-medium",children:"Productos Precargados"})})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50",children:[e.jsx(D,{value:"inventariados",id:"inventariados"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-primary"}),e.jsxs(h,{htmlFor:"inventariados",className:"cursor-pointer flex-1",children:[e.jsx("div",{className:"font-medium",children:"Productos Inventariados"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Del inventario registrado"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50",children:[e.jsx(D,{value:"general",id:"general"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Nt,{className:"h-5 w-5 text-primary"}),e.jsxs(h,{htmlFor:"general",className:"cursor-pointer flex-1",children:[e.jsx("div",{className:"font-medium",children:"Ingreso General"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Operaci√≥n no inventariada"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50",children:[e.jsx(D,{value:"otros",id:"otros"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fn,{className:"h-5 w-5 text-primary"}),e.jsxs(h,{htmlFor:"otros",className:"cursor-pointer flex-1",children:[e.jsx("div",{className:"font-medium",children:"Otros Ingresos"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Extraordinarios, donaciones"})]})]})]})]})})]}),F&&e.jsxs("div",{className:"space-y-6 p-4 border rounded-lg bg-muted/20",children:[tn(F),e.jsx(Ee,{}),e.jsx("div",{className:"space-y-4",children:(F==="precargados"&&Ue||F==="inventariados"&&te)&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"C√°lculo Autom√°tico"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cantidad:"}),e.jsx("span",{children:F==="precargados"?$s:ke})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Precio Unitario:"}),e.jsxs("span",{children:["$",F==="precargados"?Ts:Be]})]}),e.jsx(Ee,{}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",fe]})]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"font-medium",children:"Estado del Pago"}),Y("Tipo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(ve,{value:P,onValueChange:St,className:Y("Tipo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(D,{value:"contado",id:"contado"}),e.jsx(h,{htmlFor:"contado",className:"cursor-pointer",children:"Pago Total"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(D,{value:"parcial",id:"parcial"}),e.jsx(h,{htmlFor:"parcial",className:"cursor-pointer",children:"Pago parcial"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(D,{value:"credito",id:"credito"}),e.jsx(h,{htmlFor:"credito",className:"cursor-pointer",children:"Adeudo Total"})]})]}),P==="parcial"&&e.jsxs("div",{className:"ml-6 p-4 border rounded-lg bg-blue-50 dark:bg-blue-950/20 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"monto-abonado",children:"Monto que se va a pagar"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),Y("Monto Abonado")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(T,{id:"monto-abonado",type:"number",step:"0.01",placeholder:"0.00",value:we,onChange:s=>It(s.target.value),className:Y("Monto Abonado")?"border-destructive":""})]}),fe&&we&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-3 bg-white dark:bg-gray-900 rounded border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de la venta"}),e.jsxs("p",{className:"text-lg font-semibold text-primary",children:["$",C(fe)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Se pagar√° ahora"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:["$",C(we)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Queda pendiente"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["$",C(parseFloat(fe)-parseFloat(we))]})]})]})]})]}),e.jsx(Ee,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xs,{className:"h-5 w-5"}),e.jsx(h,{className:"font-medium",children:"Datos del Cliente"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:P==="contado"?"Opcional - Para anal√≠ticas y comentarios":"Obligatorio para cuentas por cobrar"})]}),P==="contado"&&e.jsxs(Ae,{children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(Ve,{children:"Asignar cliente es opcional para pagos totales. √ötil para anal√≠ticas de ventas y seguimiento de clientes."})]}),(P==="parcial"||P==="credito")&&e.jsxs(Ae,{children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx(Ve,{children:"Se registrar√° en Cuentas por Cobrar para an√°lisis de vencimientos"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"font-medium",children:"Tipo de Cliente"}),e.jsxs(xe,{value:H,onValueChange:s=>{Ft(s),Ws(""),Ns(""),bs(""),ys(""),_s(""),Ss([])},children:[e.jsx(he,{children:e.jsx(pe,{placeholder:P==="contado"?"Opcional - Selecciona para anal√≠ticas":"Selecciona el tipo de cliente"})}),e.jsxs(je,{children:[e.jsx(S,{value:"nuevo",children:"Cliente Nuevo"}),e.jsx(S,{value:"recurrente",children:"Cliente Recurrente"})]})]})]}),H==="recurrente"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cliente-existente",children:"Seleccionar Cliente"}),e.jsxs(xe,{value:be,onValueChange:s=>{Ws(s);const t=Oe.find(l=>l.id===s);t&&(Ns(t.nombre),bs(t.telefono||""),ys(t.email||""),_s(t.rfc||""))},children:[e.jsx(he,{children:e.jsx(pe,{placeholder:"Buscar cliente existente"})}),e.jsx(je,{children:ja?e.jsx("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:"Cargando clientes..."}):Oe.length===0?e.jsx("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:"No hay clientes registrados"}):Oe.map(s=>e.jsx(S,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.nombre}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.telefono&&`Tel: ${s.telefono}`,s.email&&` ‚Ä¢ Email: ${s.email}`,s.source==="transaction"&&" ‚Ä¢ (De transacci√≥n)"]})]})},s.id))})]}),be&&e.jsx("p",{className:"text-xs text-muted-foreground text-green-600",children:"‚úì Datos del cliente cargados autom√°ticamente"})]}),(H==="nuevo"||H==="recurrente"&&be)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cliente-nombre",children:"Nombre del Cliente"}),e.jsx(T,{id:"cliente-nombre",type:"text",placeholder:"Nombre completo",value:He,onChange:s=>Ns(s.target.value),disabled:H==="recurrente"&&be!==""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"cliente-telefono",children:"N√∫mero de Tel√©fono"}),(P==="parcial"||P==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),Y("Tel√©fono del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(T,{id:"cliente-telefono",type:"tel",placeholder:"Ej: +52 55 1234 5678",value:ye,onChange:s=>bs(s.target.value),className:Y("Tel√©fono del Cliente")?"border-destructive":"",disabled:H==="recurrente"&&be!==""}),H==="nuevo"&&Te.some(s=>s.includes(ye)&&s.includes("tel√©fono"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Te.find(s=>s.includes(ye)&&s.includes("tel√©fono"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"cliente-email",children:"Correo Electr√≥nico"}),(P==="parcial"||P==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),Y("Email del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(T,{id:"cliente-email",type:"email",placeholder:"cliente@ejemplo.com",value:_e,onChange:s=>ys(s.target.value),className:Y("Email del Cliente")?"border-destructive":"",disabled:H==="recurrente"&&be!==""}),H==="nuevo"&&Te.some(s=>s.includes(_e)&&s.includes("correo"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Te.find(s=>s.includes(_e)&&s.includes("correo"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"cliente-rfc",children:"RFC (ID Fiscal) - Opcional"}),e.jsx(T,{id:"cliente-rfc",type:"text",placeholder:"RFC123456ABC1",value:Fe,onChange:s=>_s(s.target.value.toUpperCase()),maxLength:13,disabled:H==="recurrente"&&be!==""}),H==="nuevo"&&Te.some(s=>s.includes(Fe)&&s.includes("RFC"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Te.find(s=>s.includes(Fe)&&s.includes("RFC"))})]})]}),(P==="parcial"||P==="credito")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{htmlFor:"fecha-vencimiento",children:"Fecha de Vencimiento"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),Y("Fecha de Vencimiento")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(T,{id:"fecha-vencimiento",type:"date",value:ws,onChange:s=>Dt(s.target.value),className:Y("Fecha de Vencimiento")?"border-destructive":"",min:new Date().toISOString().split("T")[0]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Fecha l√≠mite para el pago ",P==="parcial"?"del monto pendiente":"completo"]})]}),P==="contado"&&H&&e.jsxs("div",{className:"col-span-full space-y-2",children:[e.jsx(h,{htmlFor:"comentario-venta",children:"Comentarios de la venta (Opcional)"}),e.jsx(Ze,{id:"comentario-venta",placeholder:"Detalles adicionales sobre esta venta, preferencias del cliente, etc.",value:Cs,onChange:s=>Gs(s.target.value),rows:2}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Informaci√≥n √∫til para futuras ventas y an√°lisis del cliente"})]})]})]}),e.jsx(Ee,{}),(P==="contado"||P==="parcial")&&e.jsxs(e.Fragment,{children:[e.jsx(Ee,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{className:"font-medium",children:"M√©todo de Pago"}),Y("M√©todo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(ve,{value:gs,onValueChange:Ct,className:Y("M√©todo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(D,{value:"efectivo",id:"efectivo"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Nn,{className:"h-4 w-4 text-green-600"}),e.jsxs(h,{htmlFor:"efectivo",className:"cursor-pointer",children:["Efectivo ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Caja)"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(D,{value:"tarjeta",id:"tarjeta"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(bn,{className:"h-4 w-4 text-blue-800"}),e.jsxs(h,{htmlFor:"tarjeta",className:"cursor-pointer",children:["Tarjeta ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Bancos)"})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"comentarios",children:"Comentarios de la venta (Opcional)"}),e.jsx(Ze,{id:"comentarios",placeholder:"Agrega cualquier comentario o nota sobre esta venta...",value:Cs,onChange:s=>Gs(s.target.value),rows:3,className:"resize-none"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(M,{size:"lg",className:"px-8",onClick:en,disabled:Pt,children:[e.jsx(Zt,{className:"mr-2 h-4 w-4"}),Pt?"Registrando...":"Registrar Ingreso"]})})]})]})]})}),e.jsx(Ls,{value:"resumen",className:"mt-6",children:e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsx(L,{children:"Registro Detallado de Ventas"}),e.jsx(ne,{children:"Historial completo de transacciones de ingresos"})]}),e.jsxs(B,{children:[e.jsxs("div",{className:"mb-6 p-4 border rounded-lg bg-muted/30 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"filtro-fecha-inicio",children:"Fecha Inicio"}),e.jsx(T,{id:"filtro-fecha-inicio",type:"date",value:De,onChange:s=>$t(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"filtro-fecha-fin",children:"Fecha Fin"}),e.jsx(T,{id:"filtro-fecha-fin",type:"date",value:Ie,onChange:s=>kt(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"filtro-tipo",children:"Tipo de Ingreso"}),e.jsxs(xe,{value:le,onValueChange:Et,children:[e.jsx(he,{id:"filtro-tipo",children:e.jsx(pe,{placeholder:"Todos"})}),e.jsxs(je,{children:[e.jsx(S,{value:"todos",children:"Todos"}),e.jsx(S,{value:"precargados",children:"Precargados"}),e.jsx(S,{value:"inventariados",children:"Inventariados"}),e.jsx(S,{value:"general",children:"General"}),e.jsx(S,{value:"otros",children:"Otros"}),e.jsx(S,{value:"asiento_directo",children:"Asientos Directos"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"filtro-cuenta",children:"Cuenta"}),e.jsxs(xe,{value:de,onValueChange:At,children:[e.jsx(he,{id:"filtro-cuenta",children:e.jsx(pe,{placeholder:"Todas"})}),e.jsxs(je,{children:[e.jsx(S,{value:"todas",children:"Todas"}),e.jsx(S,{value:"4001",children:"4001 - Ventas"}),e.jsx(S,{value:"4004",children:"4004 - Ventas Inventarios"}),e.jsx(S,{value:"4101",children:"4101 - Productos Financieros"}),e.jsx(S,{value:"4102",children:"4102 - Otros Productos"}),e.jsx(S,{value:"4103",children:"4103 - Ganancia en Venta de Activos"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"filtro-subcuenta",children:"Subcuenta"}),e.jsxs(xe,{value:se,onValueChange:Vt,children:[e.jsx(he,{id:"filtro-subcuenta",children:e.jsx(pe,{placeholder:"Todas"})}),e.jsxs(je,{children:[e.jsx(S,{value:"todas",children:"Todas"}),e.jsx(S,{value:"sin-subcuenta",children:"Sin subcuenta"}),ie.map(s=>e.jsx(S,{value:s.id,children:s.nombre},s.id))]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:()=>{$t(""),kt(""),Et("todos"),At("todas"),Vt("")},children:"Limpiar Filtros"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Resultados: ",(()=>{const s=$e.map(o=>{const r=o.detalle_asientos.find(a=>a.cuenta_codigo.startsWith("4")&&Number(a.haber)>0);return{created_at:o.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(r==null?void 0:r.cuenta_codigo)||"",subcuenta_id:r==null?void 0:r.subcuenta_id}});return[...$,...s].filter(o=>{const r=(!De||new Date(o.created_at)>=new Date(De))&&(!Ie||new Date(o.created_at)<=new Date(Ie+"T23:59:59")),a=!le||le==="todos"||o.tipo_ingreso===le,c=!de||de==="todas"||o.cuenta_principal_codigo===de,d=!se||se==="todas"||se==="sin-subcuenta"&&!o.subcuenta_id||o.subcuenta_id===se;return r&&a&&c&&d}).length})()]}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["Total: $",(()=>{const s=$e.map(o=>{const r=o.detalle_asientos.find(a=>a.cuenta_codigo.startsWith("4")&&Number(a.haber)>0);return{created_at:o.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(r==null?void 0:r.cuenta_codigo)||"",subcuenta_id:r==null?void 0:r.subcuenta_id,monto_total:Number(r==null?void 0:r.haber)||0}}),l=[...$,...s].filter(o=>{const r=(!De||new Date(o.created_at)>=new Date(De))&&(!Ie||new Date(o.created_at)<=new Date(Ie+"T23:59:59")),a=!le||le==="todos"||o.tipo_ingreso===le,c=!de||de==="todas"||o.cuenta_principal_codigo===de,d=!se||se==="todas"||se==="sin-subcuenta"&&!o.subcuenta_id||o.subcuenta_id===se;return r&&a&&c&&d});return C(l.reduce((o,r)=>o+r.monto_total,0))})()]}),e.jsxs("p",{className:"text-sm font-medium text-green-600",children:["Neto: $",(()=>{const s=$e.map(o=>{const r=o.detalle_asientos.find(a=>a.cuenta_codigo.startsWith("4")&&Number(a.haber)>0);return{created_at:o.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(r==null?void 0:r.cuenta_codigo)||"",subcuenta_id:r==null?void 0:r.subcuenta_id,monto_neto:Number(r==null?void 0:r.haber)||0}}),l=[...$,...s].filter(o=>{const r=(!De||new Date(o.created_at)>=new Date(De))&&(!Ie||new Date(o.created_at)<=new Date(Ie+"T23:59:59")),a=!le||le==="todos"||o.tipo_ingreso===le,c=!de||de==="todas"||o.cuenta_principal_codigo===de,d=!se||se==="todas"||se==="sin-subcuenta"&&!o.subcuenta_id||o.subcuenta_id===se;return r&&a&&c&&d});return C(l.reduce((o,r)=>o+r.monto_neto,0))})()]})]})]})]}),J?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando transacciones..."}):(()=>{const s=$e.map(r=>{const a=r.detalle_asientos.find(c=>c.cuenta_codigo.startsWith("4")&&Number(c.haber)>0);return{id:r.id,descripcion:r.descripcion,monto_total:Number(a==null?void 0:a.haber)||0,monto_neto:Number(a==null?void 0:a.haber)||0,monto_descuento:0,monto_pagado:Number(a==null?void 0:a.haber)||0,monto_pendiente:0,tipo_ingreso:"asiento_directo",metodo_pago:"N/A",tipo_pago:"contado",cuenta_principal_codigo:(a==null?void 0:a.cuenta_codigo)||"",subcuenta_id:a==null?void 0:a.subcuenta_id,created_at:r.fecha,asiento_fecha:r.fecha,es_asiento_directo:!0,estado:"activo"}}),o=[...$,...s].filter(r=>{const a=(!De||new Date(r.created_at)>=new Date(De))&&(!Ie||new Date(r.created_at)<=new Date(Ie+"T23:59:59")),c=!le||le==="todos"||r.tipo_ingreso===le,d=!de||de==="todas"||r.cuenta_principal_codigo===de,u=!se||se==="todas"||se==="sin-subcuenta"&&!r.subcuenta_id||r.subcuenta_id===se;return a&&c&&d&&u}).filter(r=>!r.descripcion.includes("CANCELACI√ìN:")).map(r=>{const a=r.estado==="cancelado";let c=null;return a&&r.transaccion_cancelacion_id&&(c=$.find(d=>d.id===r.transaccion_cancelacion_id)),{...r,esCancelada:a,transaccionReversion:c}});return o.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay transacciones que coincidan con los filtros"}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm font-medium text-muted-foreground mb-4",children:["Mostrando ",o.length," transacci√≥n(es)"]}),e.jsx("div",{className:"space-y-3",children:o.map(r=>{var u,n,i,x,j;const a=r,c=r.esCancelada,d=!1;return e.jsxs("div",{className:`border rounded-lg p-4 ${c?"bg-red-50 dark:bg-red-950/20 border-red-300 dark:border-red-800":"hover:bg-muted/50"}`,children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[a.es_asiento_directo&&e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-purple-100 dark:bg-purple-900/30 flex-shrink-0 flex items-center justify-center",children:e.jsx(Nt,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),!a.es_asiento_directo&&(a.tipo_ingreso==="precargados"||a.tipo_ingreso==="inventariados")&&(()=>{const p=a.descripcion.replace("Venta de ","").replace("Venta: ",""),N=[...ge,...Re].find(_=>_.nombre===a.descripcion||_.nombre===p||a.descripcion.includes(_.nombre));return N!=null&&N.imagen_url?e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:e.jsx("img",{src:N.imagen_url,alt:N.nombre,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0 flex items-center justify-center",children:e.jsx(Ne,{className:"w-5 h-5 text-muted-foreground"})})})(),e.jsxs("div",{className:"flex justify-between items-start flex-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("p",{className:"font-medium",children:a.descripcion}),a.es_asiento_directo&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200",children:"üìã Asiento Directo"}),c&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200",children:"‚ùå Cancelada"}),d,e.jsxs(cs,{onOpenChange:p=>{p?Za(a.id):Ks(null)},children:[e.jsx(sa,{asChild:!0,children:e.jsx(M,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:e.jsx(Nt,{className:"h-3 w-3"})})}),e.jsxs(ls,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ds,{children:[e.jsx(ms,{children:"Detalles de la Transacci√≥n"}),e.jsx(us,{children:"Informaci√≥n completa y asientos contables en balanza"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Informaci√≥n General"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",a.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",a.tipo_ingreso]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"M√©todo de Pago:"})," ",a.metodo_pago||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo de Pago:"})," ",a.tipo_pago]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(a.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Montos"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total:"})," $",C(a.monto_total)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descuento:"})," $",C(a.monto_descuento)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Neto:"})," $",C(a.monto_neto)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pagado:"})," $",C(a.monto_pagado||0)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pendiente:"})," $",C(a.monto_pendiente||0)]})]})]})]}),(a.cliente_nombre||a.cliente_telefono||a.cliente_email)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n del Cliente"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.cliente_nombre&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",a.cliente_nombre]}),a.cliente_telefono&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tel√©fono:"})," ",a.cliente_telefono]}),a.cliente_email&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",a.cliente_email]}),a.cliente_rfc&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"RFC:"})," ",a.cliente_rfc]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n Contable"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Cuenta Principal:"})," ",a.cuenta_principal_codigo," - ",a.cuenta_principal_codigo==="4001"?"Ventas":a.cuenta_principal_codigo==="4004"?"Otros Ingresos":""]}),a.subcuenta_id?e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," ",((u=a.subcuentas)==null?void 0:u.nombre)||(()=>{const p=ie.find(g=>g.id===a.subcuenta_id);return(p==null?void 0:p.nombre)||"Subcuenta no encontrada"})()]}):e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," Sin subcuenta asignada"]})]})]}),a.comentarios&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Comentarios"}),e.jsx("div",{className:"p-3 bg-muted rounded-md",children:e.jsx("p",{className:"text-sm",children:a.comentarios})})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3",children:"Asientos en Balanza de Comprobaci√≥n"}),Va?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando asientos contables..."}):Le?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"N√∫mero de Asiento:"})," ",Le.numero_asiento]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(Le.fecha).toLocaleDateString("es-ES")]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",Le.descripcion]})]})}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Cuenta"}),e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Descripci√≥n"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Debe"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Haber"})]})}),e.jsxs("tbody",{children:[(n=Le.detalles)==null?void 0:n.map((p,g)=>e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"p-3 text-sm",children:[e.jsx("div",{className:"font-medium",children:p.cuenta_codigo}),e.jsx("div",{className:"text-xs text-muted-foreground",children:p.cuenta_nombre})]}),e.jsx("td",{className:"p-3 text-sm",children:p.descripcion}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:p.debe>0?`$${C(p.debe)}`:"-"}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:p.haber>0?`$${C(p.haber)}`:"-"})]},g)),e.jsxs("tr",{className:"border-t-2 bg-muted/50 font-bold",children:[e.jsx("td",{colSpan:2,className:"p-3 text-sm",children:"TOTALES"}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",C((i=Le.detalles)==null?void 0:i.reduce((p,g)=>p+Number(g.debe),0))]}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",C((x=Le.detalles)==null?void 0:x.reduce((p,g)=>p+Number(g.haber),0))]})]})]})]})}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/30 rounded-md text-sm",children:[e.jsx("p",{className:"font-medium text-blue-700 dark:text-blue-300 mb-1",children:"üí° Informaci√≥n"}),e.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:"Este asiento contable refleja c√≥mo esta transacci√≥n afecta a las diferentes cuentas en la balanza de comprobaci√≥n y posteriormente en los estados financieros."})]})]}):e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg text-sm text-muted-foreground text-center",children:"No se encontraron asientos contables para esta transacci√≥n"})]})]})]})]})]}),a.comentarios&&e.jsxs("div",{className:"mt-1 p-2 bg-blue-50 dark:bg-blue-950/30 rounded text-xs",children:[e.jsx("span",{className:"font-medium text-blue-700 dark:text-blue-300",children:"üí¨ "}),e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:a.comentarios.length>50?`${a.comentarios.substring(0,50)}...`:a.comentarios})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[e.jsx("span",{className:"capitalize",children:a.tipo_ingreso}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{className:"capitalize",children:a.metodo_pago}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{className:"capitalize",children:a.tipo_pago})]}),e.jsxs("div",{className:"mt-2 p-2 bg-muted/30 rounded-md",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Informaci√≥n Contable:"}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Cuenta Principal:"})," ",a.cuenta_principal_codigo,a.cuenta_principal_codigo==="4001"?" - Ventas":a.cuenta_principal_codigo==="4004"?" - Otros Ingresos":""]}),a.subcuenta_id?e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," ",((j=a.subcuentas)==null?void 0:j.nombre)||(()=>{const p=ie.find(g=>g.id===a.subcuenta_id);return(p==null?void 0:p.nombre)||"Subcuenta no encontrada"})()]}):e.jsxs("div",{className:"text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," Sin subcuenta asignada"]})]})]})]}),e.jsxs("div",{className:"text-right ml-4 flex flex-col gap-2 items-end",children:[e.jsxs("p",{className:"font-bold text-primary",children:["$",C(a.monto_total)]}),a.monto_descuento>0&&e.jsxs("p",{className:"text-sm text-red-600",children:["-$",C(a.monto_descuento)," desc."]}),!c&&!d&&e.jsx(M,{variant:"outline",size:"sm",className:"mt-2 text-xs border-red-300 text-red-600 hover:bg-red-50 dark:border-red-800 dark:text-red-400 dark:hover:bg-red-950/30",onClick:()=>{lt(a),Vs(!0)},children:"‚ùå Cancelar"})]})]})]}),c&&a.motivo_cancelacion&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"p-3 bg-red-100 dark:bg-red-950/40 rounded-md border border-red-300 dark:border-red-800",children:[e.jsx("p",{className:"text-xs font-medium text-red-700 dark:text-red-300 mb-1",children:"üìã Motivo de cancelaci√≥n:"}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:a.motivo_cancelacion}),e.jsxs("p",{className:"text-xs text-red-500 dark:text-red-500 mt-1",children:["Cancelada el: ",new Date(a.fecha_cancelacion).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),r.transaccionReversion&&e.jsxs("div",{className:"p-3 bg-orange-100 dark:bg-orange-950/40 rounded-md border border-orange-300 dark:border-orange-800",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-orange-700 dark:text-orange-300",children:"‚Ü©Ô∏è Asiento de Reversi√≥n Generado"})}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",r.transaccionReversion.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Monto reversado:"})," $",C(Math.abs(r.transaccionReversion.monto_total))]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(r.transaccionReversion.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-muted-foreground",children:[e.jsx("span",{children:new Date(a.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsxs("span",{className:"font-medium text-green-600",children:["Neto: $",a.monto_neto.toFixed(2)]})]})]},a.id)})})]})})()]})]})}),e.jsx(Ls,{value:"analitica",className:"mt-6",children:(()=>{const t=(()=>{const a=new Date;a.getMonth();const c=a.getFullYear();let d=$.filter(u=>u.estado!=="cancelado"&&!u.descripcion.includes("CANCELACI√ìN:"));if(Q==="diario"){const u=ce.toISOString().split("T")[0];d=d.filter(n=>n.asiento_fecha===u)}else if(Q==="mensual"){const u=I.getMonth(),n=I.getFullYear();d=d.filter(i=>{const x=i.asiento_fecha;if(!x)return!1;const j=yt(x);return j.getMonth()===u&&j.getFullYear()===n})}else d=d.filter(u=>{const n=u.asiento_fecha;return n?yt(n).getFullYear()===c:!1});return V==="ventas"?d.filter(u=>u.cuenta_principal_codigo==="4001"):d.filter(u=>{var n;return((n=u.cuenta_principal_codigo)==null?void 0:n.startsWith("4"))&&u.cuenta_principal_codigo!=="4001"&&u.cuenta_principal_codigo!=="4003"})})(),o=(()=>{const a=t.filter(u=>u.tipo_pago==="contado"||u.tipo_pago==="parcial");if(a.length===0)return[];const c={};a.forEach(u=>{const n=u.metodo_pago==="efectivo"?"Efectivo":"Tarjeta";c[n]=(c[n]||0)+Se(u,f)});const d=Object.values(c).reduce((u,n)=>u+n,0);return Object.entries(c).map(([u,n])=>({name:u,value:n,porcentaje:d>0?(n/d*100).toFixed(1):"0.0"}))})(),r=()=>V==="ventas"?t.length>0||k.ventasBrutas>0||k.descuentos>0:t.length>0||k.otrosIngresos>0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground mb-4",children:"Highlights de Ingresos"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(O,{children:[e.jsx(z,{className:"pb-3",children:e.jsx(L,{className:"text-lg font-semibold text-primary",children:"Resumen del D√≠a"})}),e.jsxs(B,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",w(as.ventasBrutas,y)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",w(as.descuentos,y)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",w(as.ventasNetas,y)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",w(as.otrosIngresos,y)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",w(as.totalIngresos,y)]})]})]})]}),e.jsxs(O,{children:[e.jsx(z,{className:"pb-3",children:e.jsx(L,{className:"text-lg font-semibold text-primary",children:"Resumen del Mes"})}),e.jsxs(B,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",w(ns.ventasBrutas,y)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",w(ns.descuentos,y)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",w(ns.ventasNetas,y)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",w(ns.otrosIngresos,y)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",w(ns.totalIngresos,y)]})]})]})]}),e.jsxs(O,{children:[e.jsx(z,{className:"pb-3",children:e.jsx(L,{className:"text-lg font-semibold text-primary",children:"Resumen del A√±o"})}),e.jsxs(B,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",w(rs.ventasBrutas,y)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",w(rs.descuentos,y)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",w(rs.ventasNetas,y)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",w(rs.otrosIngresos,y)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",w(rs.totalIngresos,y)]})]})]})]})]})]}),e.jsx("div",{className:"my-8 border-t-2 border-primary/20"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-foreground mb-6",children:["Anal√≠tica de ",V==="ventas"?"Ventas":"Otros Ingresos"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsx(L,{children:"Tipo de Ingreso"}),e.jsx(ne,{children:"Selecciona qu√© analizar"})]}),e.jsx(B,{children:e.jsxs(ve,{value:V,onValueChange:a=>Fa(a),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"ventas",id:"tipo-ventas"}),e.jsx(h,{htmlFor:"tipo-ventas",className:"cursor-pointer",children:"Ventas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"otros",id:"tipo-otros"}),e.jsx(h,{htmlFor:"tipo-otros",className:"cursor-pointer",children:"Otros Ingresos"})]})]})})]}),e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsx(L,{children:"Per√≠odo de An√°lisis"}),e.jsx(ne,{children:"Selecciona el per√≠odo"})]}),e.jsxs(B,{className:"space-y-3",children:[e.jsxs(ve,{value:Q,onValueChange:a=>Ca(a),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"diario",id:"period-daily"}),e.jsx(h,{htmlFor:"period-daily",className:"cursor-pointer",children:"Diario"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"mensual",id:"period-monthly"}),e.jsx(h,{htmlFor:"period-monthly",className:"cursor-pointer",children:"Mensual"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"anual",id:"period-annual"}),e.jsx(h,{htmlFor:"period-annual",className:"cursor-pointer",children:"Anual"})]})]}),Q==="diario"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(h,{className:"text-xs text-muted-foreground mb-2 block",children:"Fecha espec√≠fica"}),e.jsxs(ta,{children:[e.jsx(aa,{asChild:!0,children:e.jsxs(M,{variant:"outline",className:na("w-full justify-start text-left font-normal",!ce&&"text-muted-foreground"),size:"sm",children:[e.jsx(ra,{className:"mr-2 h-4 w-4"}),oa(ce,"PPP",{locale:ha})]})}),e.jsx(ia,{className:"w-auto p-0",align:"start",children:e.jsx(ca,{mode:"single",selected:ce,onSelect:a=>a&&Da(a),initialFocus:!0,className:"pointer-events-auto"})})]})]}),Q==="mensual"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(h,{className:"text-xs text-muted-foreground mb-2 block",children:"Mes espec√≠fico"}),e.jsxs(ta,{children:[e.jsx(aa,{asChild:!0,children:e.jsxs(M,{variant:"outline",className:na("w-full justify-start text-left font-normal",!I&&"text-muted-foreground"),size:"sm",children:[e.jsx(ra,{className:"mr-2 h-4 w-4"}),oa(I,"MMMM yyyy",{locale:ha})]})}),e.jsx(ia,{className:"w-auto p-0",align:"start",children:e.jsx(ca,{mode:"single",selected:I,onSelect:a=>a&&Ia(a),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsx(L,{children:"Formato de Cifras"}),e.jsx(ne,{children:"Visualizaci√≥n de montos"})]}),e.jsx(B,{children:e.jsxs(ve,{value:y,onValueChange:a=>Sa(a),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"general",id:"scale-general"}),e.jsx(h,{htmlFor:"scale-general",className:"cursor-pointer",children:"General"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"miles",id:"scale-thousands"}),e.jsx(h,{htmlFor:"scale-thousands",className:"cursor-pointer",children:"Miles (K)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"millones",id:"scale-millions"}),e.jsx(h,{htmlFor:"scale-millions",className:"cursor-pointer",children:"Millones (M)"})]})]})})]}),e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsx(L,{children:"Tipo de M√©trica"}),e.jsx(ne,{children:"Datos a visualizar"})]}),e.jsx(B,{children:e.jsxs(ve,{value:f,onValueChange:a=>Pa(a),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"brutas",id:"metric-brutas"}),e.jsx(h,{htmlFor:"metric-brutas",className:"cursor-pointer",children:"Ventas Brutas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"descuentos",id:"metric-descuentos"}),e.jsx(h,{htmlFor:"metric-descuentos",className:"cursor-pointer",children:"Descuentos"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{value:"netas",id:"metric-netas"}),e.jsx(h,{htmlFor:"metric-netas",className:"cursor-pointer",children:"Ventas Netas"})]})]})})]})]}),e.jsxs(O,{className:"mb-6",children:[e.jsxs(z,{children:[e.jsxs(L,{children:["Evoluci√≥n de ",f==="descuentos"?"Descuentos":V==="otros"?"Otros Ingresos":f==="brutas"?"Ventas Brutas":"Ventas Netas"]}),e.jsxs(ne,{children:[f==="descuentos"?"Descuentos aplicados":V==="otros"?"Otros ingresos":f==="brutas"?"Ventas brutas":"Ventas netas"," - ",Q==="diario"?"del d√≠a":Q==="mensual"?"por d√≠a del mes":"por mes del a√±o"]})]}),e.jsx(B,{children:J?e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"Cargando datos..."}):k.detallesPorPeriodo.length===0?e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"}):e.jsx("div",{className:"h-80",children:e.jsx(hs,{width:"100%",height:"100%",children:e.jsxs(yn,{data:k.detallesPorPeriodo.map(a=>({periodo:a.periodo,ventas:a.ventasBrutas,descuentos:a.descuentos,neto:a.ventasNetas,otrosIngresos:a.otrosIngresos})),children:[e.jsx(la,{strokeDasharray:"3 3"}),e.jsx(da,{dataKey:"periodo",tick:{fill:"#000000"}}),e.jsx(ma,{tickFormatter:a=>w(a,y),tick:{fill:"#000000"}}),e.jsx(ps,{formatter:a=>[`$${w(Number(a),y)}`,""],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}}),e.jsx(_n,{}),f==="descuentos"&&e.jsx(Bs,{type:"monotone",dataKey:"descuentos",stroke:"hsl(180 60% 70%)",name:"Descuentos",strokeWidth:2,children:e.jsx(js,{dataKey:"descuentos",position:"top",formatter:a=>`$${w(a,y)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),f==="brutas"&&V==="ventas"&&e.jsx(Bs,{type:"monotone",dataKey:"ventas",stroke:"hsl(180 50% 55%)",name:"Ventas Brutas",strokeWidth:2,children:e.jsx(js,{dataKey:"ventas",position:"top",formatter:a=>`$${w(a,y)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),f==="netas"&&V==="ventas"&&e.jsx(Bs,{type:"monotone",dataKey:"neto",stroke:"hsl(180 45% 45%)",name:"Ventas Netas",strokeWidth:2,children:e.jsx(js,{dataKey:"neto",position:"top",formatter:a=>`$${w(a,y)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),V==="otros"&&f!=="descuentos"&&e.jsx(Bs,{type:"monotone",dataKey:"otrosIngresos",stroke:"hsl(140 50% 50%)",name:"Otros Ingresos",strokeWidth:2,children:e.jsx(js,{dataKey:"otrosIngresos",position:"top",formatter:a=>`$${w(a,y)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})})]})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsxs(L,{children:[f==="brutas"?"Ventas Brutas":f==="descuentos"?"Descuentos":"Ventas Netas"," por Tipo"]}),e.jsxs(ne,{children:["Distribuci√≥n de ",f==="brutas"?"ventas brutas":f==="descuentos"?"descuentos":"ventas netas"," por categor√≠a"]})]}),e.jsx(B,{children:J?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):r()?V==="otros"&&f==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(hs,{width:"100%",height:"100%",children:e.jsxs(ua,{children:[e.jsx(xa,{data:(()=>{const a=V==="ventas"?f==="brutas"?k.ventasBrutas:f==="descuentos"?k.descuentos:k.ventasNetas:k.otrosIngresos;if(t.length===0&&a>0)return[{tipo:"Otros Ingresos",monto:a,porcentaje:"100.0"}];const c=t.reduce((u,n)=>(u[n.tipo_ingreso]=(u[n.tipo_ingreso]||0)+Se(n,f),u),{}),d=Object.values(c).reduce((u,n)=>u+n,0);return Object.entries(c).map(([u,n])=>({tipo:u.charAt(0).toUpperCase()+u.slice(1),monto:n,porcentaje:d>0?(n/d*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({tipo:a,porcentaje:c,monto:d})=>`${a}
${c}%
$${w(d,y)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:Object.keys(t.reduce((a,c)=>(a[c.tipo_ingreso]=!0,a),{})).map((a,c)=>{const d=["hsl(180 50% 55%)","hsl(180 45% 45%)","hsl(180 55% 65%)","hsl(180 40% 40%)"];return e.jsx(qs,{fill:d[c%4]},`cell-${c}`)})}),e.jsx(ps,{formatter:a=>[`$${w(Number(a),y)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsxs(L,{children:["Estado de Pagos - ",f==="brutas"?"Ventas Brutas":f==="descuentos"?"Descuentos":"Ventas Netas"]}),e.jsx(ne,{children:"Distribuci√≥n por estado de pago"})]}),e.jsx(B,{children:J?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):r()?V==="otros"&&f==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(hs,{width:"100%",height:"100%",children:e.jsxs(ua,{children:[e.jsxs(xa,{data:(()=>{const a=V==="ventas"?f==="brutas"?k.ventasBrutas:f==="descuentos"?k.descuentos:k.ventasNetas:k.otrosIngresos;if(t.length===0&&a>0)return[{estado:"Pagado Total",monto:a,porcentaje:"100.0"}];const c=t.reduce((u,n)=>{let i="Por Cobrar";return n.tipo_pago==="contado"||n.monto_pagado&&n.monto_pendiente===0?i="Pagado Total":(n.tipo_pago==="parcial"||n.monto_pagado>0&&n.monto_pendiente>0)&&(i="Pago Parcial"),u[i]=(u[i]||0)+Se(n,f),u},{}),d=Object.values(c).reduce((u,n)=>u+n,0);return Object.entries(c).map(([u,n])=>({estado:u,monto:n,porcentaje:d>0?(n/d*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({estado:a,porcentaje:c,monto:d})=>`${a}
${c}%
$${w(d,y)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:[e.jsx(qs,{fill:"hsl(180 50% 55%)"}),e.jsx(qs,{fill:"hsl(180 55% 65%)"}),e.jsx(qs,{fill:"hsl(180 45% 45%)"})]}),e.jsx(ps,{formatter:a=>[`$${w(Number(a),y)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(O,{children:[e.jsxs(z,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(L,{children:[f==="brutas"?"Ventas Brutas":f==="descuentos"?"Descuentos":"Ventas Netas"," por ",Xe==="subcuenta"?"Subcuenta":"Cuenta"]}),e.jsxs(ne,{children:["Distribuci√≥n por ",Xe==="subcuenta"?"subcuentas":"cuentas"," contables"]})]}),e.jsxs(xe,{value:Xe,onValueChange:a=>Aa(a),children:[e.jsx(he,{className:"w-[150px]",children:e.jsx(pe,{})}),e.jsxs(je,{children:[e.jsx(S,{value:"subcuenta",children:"Por Subcuenta"}),e.jsx(S,{value:"cuenta",children:"Por Cuenta"})]})]})]}),e.jsx(B,{children:J?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):r()?V==="otros"&&f==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(hs,{width:"100%",height:"100%",children:e.jsxs(wn,{data:(()=>{const a=V==="ventas"?f==="brutas"?k.ventasBrutas:f==="descuentos"?k.descuentos:k.ventasNetas:k.otrosIngresos;if(t.length===0&&a>0)return[{subcuenta:"Sin detalle",monto:a}];const c=t.reduce((n,i)=>{var j;let x;if(Xe==="subcuenta")x=i.subcuenta_id?((j=ie.find(p=>p.id===i.subcuenta_id))==null?void 0:j.nombre)||"Subcuenta desconocida":"Sin subcuenta asignada";else{const p=ue.find(g=>g.codigo===i.cuenta_principal_codigo);x=p?`${i.cuenta_principal_codigo} - ${p.nombre}`:i.cuenta_principal_codigo||"Sin cuenta"}return n[x]=(n[x]||0)+Se(i,f),n},{}),d=Object.values(c).reduce((n,i)=>n+i,0);if(a-d>.01){const n={};$e.forEach(i=>{const x=i.detalle_asientos.find(b=>b.cuenta_codigo.startsWith("4")&&Number(b.haber)>0);if(!x)return;const j=Number(x.haber)||0,p=x.cuenta_codigo,g=ue.find(b=>b.codigo===p),N=(g==null?void 0:g.nombre)||"Otros ingresos";let _;if(Xe==="cuenta")_=`${p} - ${N}`;else if(Xe==="subcuenta"){const b=x.subcuenta_id,E=ie.find(W=>W.id===b);_=(E==null?void 0:E.nombre)||"Sin subcuenta asignada"}else _=N;n[_]=(n[_]||0)+j}),Object.entries(n).forEach(([i,x])=>{c[i]=(c[i]||0)+x})}return Object.entries(c).map(([n,i])=>({subcuenta:n,monto:i}))})(),layout:"vertical",children:[e.jsx(la,{strokeDasharray:"3 3"}),e.jsx(da,{type:"number",tickFormatter:a=>w(a,y),tick:{fill:"#000000"},domain:[0,a=>a*1.2]}),e.jsx(ma,{type:"category",dataKey:"subcuenta",width:150,tick:{fill:"#000000"}}),e.jsx(ps,{formatter:a=>[`$${w(Number(a),y)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}}),e.jsx(Cn,{dataKey:"monto",fill:"hsl(180 50% 55%)",children:e.jsx(js,{dataKey:"monto",position:"right",formatter:a=>`$${w(a,y)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsx(L,{children:"M√©todos de Pago Recibidos"}),e.jsxs(ne,{children:["Distribuci√≥n de ",f==="brutas"?"ventas brutas":f==="descuentos"?"descuentos":"ventas netas"," por m√©todo de pago"]})]}),e.jsx(B,{children:J?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):r()?V==="otros"&&f==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):o.length===0?e.jsxs("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:["No hay transacciones con m√©todo de pago en este per√≠odo",e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-2 block",children:"Las ventas a cr√©dito no tienen m√©todo de pago asignado"})]}):e.jsx("div",{className:"h-64",children:e.jsx(hs,{width:"100%",height:"100%",children:e.jsx(Sn,{data:o,dataKey:"value",aspectRatio:4/3,stroke:"#fff",fill:"#8884d8",content:e.jsx(In,{}),children:e.jsx(ps,{content:e.jsx(Tn,{scaleFormat:y})})})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsxs(L,{children:[f==="brutas"?"Ventas Brutas":f==="descuentos"?"Descuentos":"Ventas Netas"," por Producto"]}),e.jsxs(ne,{children:["Ranking de productos ",f==="descuentos"?"con m√°s descuentos":"m√°s vendidos"]})]}),e.jsx(B,{children:J?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):r()?e.jsx("div",{className:"space-y-3",children:(()=>{if(V==="otros"&&f==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const a=V==="ventas"?f==="brutas"?k.ventasBrutas:f==="descuentos"?k.descuentos:k.ventasNetas:k.otrosIngresos;if(t.length===0&&a>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(Ne,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin detalle de producto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",w(a,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Ne,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",w(a,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const c={};t.forEach(n=>{if(n.tipo_ingreso==="inventariados"&&n.descripcion.startsWith("Venta de ")){const i=n.descripcion.replace("Venta de ","").trim(),x=Ce.find(j=>j.nombre.toLowerCase()===i.toLowerCase());c[i]||(c[i]={nombre:i,transacciones:0,monto:0,imagen:x==null?void 0:x.imagen_url,tieneAsignacion:!0}),c[i].transacciones+=1,c[i].monto+=Se(n,f)}}),t.forEach(n=>{if(n.tipo_ingreso==="precargados"){let i=[];n.descripcion.startsWith("Venta: ")?i=n.descripcion.replace("Venta: ","").split(", ").map(N=>{const _=N.match(/^(.+?) \(x(\d+)\)$/);return _?{nombre:_[1].trim(),cantidad:parseInt(_[2])}:{nombre:N.trim(),cantidad:1}}):n.descripcion.startsWith("Venta de ")?i=[{nombre:n.descripcion.replace("Venta de ","").trim(),cantidad:1}]:i=[{nombre:n.descripcion,cantidad:1}];const x=Se(n,f),j=[];let p=0;i.forEach(({nombre:g,cantidad:N})=>{const _=ge.find(E=>E.nombre.toLowerCase()===g.toLowerCase()),b=(_==null?void 0:_.precio)||0;j.push({nombre:g,cantidad:N,precioBase:b}),p+=b*N}),j.forEach(({nombre:g,cantidad:N,precioBase:_})=>{const b=ge.find(oe=>oe.nombre.toLowerCase()===g.toLowerCase()),E=_*N,W=p>0?E/p:1/j.length,R=x*W;c[g]||(c[g]={nombre:g,transacciones:0,monto:0,imagen:b==null?void 0:b.imagen_url,tieneAsignacion:!!b}),c[g].transacciones+=1,c[g].monto+=R})}if(n.tipo_ingreso==="general"||n.tipo_ingreso==="inventariados"&&!n.descripcion.startsWith("Venta de")){const i="Ingresos sin producto asignado";c[i]||(c[i]={nombre:i,transacciones:0,monto:0,tieneAsignacion:!1}),c[i].transacciones+=1,c[i].monto+=Se(n,f)}if(n.tipo_ingreso==="otros"){const i=n.descripcion||"Otros ingresos";c[i]||(c[i]={nombre:i,transacciones:0,monto:0,tieneAsignacion:!1}),c[i].transacciones+=1,c[i].monto+=Se(n,f)}});const d=Object.values(c).sort((n,i)=>i.monto-n.monto);if(d.reduce((n,i)=>n+i.monto,0),V==="otros"){const n=t.filter(x=>x.tipo_ingreso==="otros").reduce((x,j)=>x+Se(j,f),0);if(a-n>.01){const x={};$e.forEach(j=>{var E;const p=j.detalle_asientos.find(W=>W.cuenta_codigo.startsWith("4")&&Number(W.haber)>0);if(!p)return;const g=Number(p.haber)||0,N=p.cuenta_codigo,_=ue.find(W=>W.codigo===N);let b;(E=j.numero_asiento)!=null&&E.startsWith("BAJA-")?b=(_==null?void 0:_.nombre)||"Ganancia en Venta de Activos":b=j.descripcion||(_==null?void 0:_.nombre)||"Otros ingresos",x[b]||(x[b]={monto:0,count:0}),x[b].monto+=g,x[b].count+=1}),Object.entries(x).forEach(([j,p])=>{p.monto>.01&&d.push({nombre:j,transacciones:p.count,monto:p.monto,tieneAsignacion:!1})})}}const u=d.slice(0,10);return e.jsxs(e.Fragment,{children:[u.map(n=>{const i=d.reduce((j,p)=>j+p.monto,0),x=i>0?(n.monto/i*100).toFixed(1):"0.0";return e.jsxs("div",{className:`flex items-center gap-3 p-3 border rounded-lg ${n.tieneAsignacion?"":"border-amber-500/50 bg-amber-50/50 dark:bg-amber-950/20"}`,children:[n.imagen?e.jsx("img",{src:n.imagen,alt:n.nombre,className:"w-12 h-12 rounded-md object-cover flex-shrink-0"}):e.jsx("div",{className:`w-12 h-12 rounded-md flex items-center justify-center flex-shrink-0 ${n.tieneAsignacion?"bg-muted":"bg-amber-100 dark:bg-amber-900/30"}`,children:e.jsx(Ne,{className:`w-5 h-5 ${n.tieneAsignacion?"text-muted-foreground":"text-amber-600 dark:text-amber-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium truncate",children:n.nombre}),!n.tieneAsignacion&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-200 flex-shrink-0",children:"Sin asignar"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[n.transacciones," ",n.transacciones===1?"transacci√≥n":"transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",w(n.monto,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[x,"%"]})})]},n.nombre)}),(()=>{const n=d.reduce((i,x)=>i+x.monto,0);return n>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Ne,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[d.reduce((i,x)=>i+x.transacciones,0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",w(n,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsxs(L,{children:[f==="brutas"?"Ventas Brutas":f==="descuentos"?"Descuentos":"Ventas Netas"," por Cliente"]}),e.jsxs(ne,{children:["Ranking de ",f==="descuentos"?"clientes con m√°s descuentos":"mejores clientes"]})]}),e.jsx(B,{children:J?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):r()?e.jsx("div",{className:"space-y-3",children:(()=>{if(V==="otros"&&f==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const a=V==="ventas"?f==="brutas"?k.ventasBrutas:f==="descuentos"?k.descuentos:k.ventasNetas:k.otrosIngresos;if(t.length===0&&a>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(xs,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin cliente asignado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",w(a,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(xs,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",w(a,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const c=t.reduce((i,x)=>{const j=x.cliente_nombre||"Sin cliente asignado";return i[j]||(i[j]={nombre:j,transacciones:0,monto:0,email:x.cliente_email,telefono:x.cliente_telefono}),i[j].transacciones+=1,i[j].monto+=Se(x,f),i},{}),d=Object.values(c).sort((i,x)=>x.monto-i.monto),u=d.reduce((i,x)=>i+x.monto,0);if(V==="otros"){const i=a-u;if(i>.01){const x=d.find(j=>j.nombre==="Sin cliente asignado");x?(x.monto+=i,x.transacciones+=$e.length):d.push({nombre:"Sin cliente asignado",transacciones:$e.length,monto:i}),d.sort((j,p)=>p.monto-j.monto)}}const n=d.slice(0,10);return e.jsxs(e.Fragment,{children:[n.map(i=>{const x=d.reduce((p,g)=>p+g.monto,0),j=x>0?(i.monto/x*100).toFixed(1):"0.0";return e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(xs,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:i.nombre}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-0.5",children:[e.jsxs("p",{children:[i.transacciones," ",i.transacciones===1?"compra":"compras"]}),i.telefono&&e.jsx("p",{className:"text-xs",children:i.telefono}),i.email&&e.jsx("p",{className:"text-xs truncate",children:i.email})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",w(i.monto,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[j,"%"]})})]},i.nombre)}),(()=>{const i=d.reduce((x,j)=>x+j.monto,0);return i>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(xs,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[d.reduce((x,j)=>x+j.transacciones,0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",w(i,y)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]})]})]})]})})()}),e.jsx(Ls,{value:"catalogo",className:"mt-6",children:e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsxs(L,{className:"flex items-center justify-between",children:["Cat√°logo de Productos",e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>{pa(),X({title:"Actualizado",description:"La lista de productos se ha actualizado correctamente"})},children:[e.jsx(Pn,{className:"mr-2 h-4 w-4"}),"Actualizar"]}),e.jsxs(cs,{open:Ra,onOpenChange:ot,children:[e.jsx(sa,{asChild:!0,children:e.jsxs(M,{children:[e.jsx(bt,{className:"mr-2 h-4 w-4"}),"Nuevo Producto"]})}),e.jsxs(ls,{className:"sm:max-w-[425px]",children:[e.jsxs(ds,{children:[e.jsx(ms,{children:"Agregar Nuevo Producto"}),e.jsx(us,{children:"Completa la informaci√≥n del producto para agregarlo al cat√°logo."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"product-name",className:"text-right",children:"Nombre"}),e.jsx(T,{id:"product-name",value:it,onChange:s=>Rt(s.target.value),className:"col-span-3",placeholder:"Nombre del producto"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"product-image",className:"text-right",children:"Imagen"}),e.jsx(T,{id:"product-image",type:"file",accept:"image/*",onChange:s=>{var t;return Ut(((t=s.target.files)==null?void 0:t[0])||null)},className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"product-price",className:"text-right",children:"Precio"}),e.jsx(T,{id:"product-price",type:"number",value:ct,onChange:s=>Ot(s.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"product-account",className:"text-right",children:"Cuenta"}),e.jsxs("div",{className:"col-span-3 flex items-center p-2 border rounded-md bg-muted/50",children:[e.jsx("span",{className:"text-sm font-medium",children:"4001 - Ventas"}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"(cuenta fija)"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(xe,{value:Bt,onValueChange:s=>qt(s==="none"?"":s),children:[e.jsx(he,{className:"col-span-3",children:e.jsx(pe,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(je,{children:[e.jsx(S,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),ie.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>e.jsx(S,{value:s.id,children:s.nombre},s.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(Ze,{id:"product-description",value:zt,onChange:s=>Lt(s.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]})]}),e.jsxs(Os,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:()=>ot(!1),children:"Cancelar"}),e.jsx(M,{onClick:an,disabled:Es,children:Es?"Guardando...":"Guardar Producto"})]})]})]}),e.jsx(cs,{open:Ba,onOpenChange:Rs,children:e.jsxs(ls,{className:"sm:max-w-[425px]",children:[e.jsxs(ds,{children:[e.jsx(ms,{children:"Editar Producto"}),e.jsx(us,{children:"Modifica la informaci√≥n del producto."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"edit-product-name",className:"text-right",children:"Nombre *"}),e.jsx(T,{id:"edit-product-name",value:ut,onChange:s=>xt(s.target.value),className:"col-span-3",placeholder:"Ej: Consultor√≠a, Producto X"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"edit-product-price",className:"text-right",children:"Precio *"}),e.jsx(T,{id:"edit-product-price",type:"number",value:ht,onChange:s=>pt(s.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"edit-product-image",className:"text-right",children:"Imagen"}),e.jsxs("div",{className:"col-span-3 space-y-2",children:[e.jsx(T,{id:"edit-product-image",type:"file",accept:"image/*",onChange:nn}),Kt&&e.jsx("div",{className:"aspect-square w-24 mx-auto",children:e.jsx("img",{src:Kt,alt:"Preview",className:"w-full h-full object-cover rounded-md"})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"edit-product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(Ze,{id:"edit-product-description",value:Yt,onChange:s=>jt(s.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(h,{htmlFor:"edit-product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(xe,{value:Ht||"none",onValueChange:s=>Jt(s==="none"?"":s),children:[e.jsx(he,{className:"col-span-3",children:e.jsx(pe,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(je,{children:[e.jsx(S,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),ie.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>e.jsx(S,{value:s.id,children:s.nombre},s.id))]})]})]})]}),e.jsxs(Os,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:()=>Rs(!1),children:"Cancelar"}),e.jsx(M,{onClick:rn,disabled:Es,children:Es?"Actualizando...":"Actualizar Producto"})]})]})})]})]}),e.jsx(ne,{children:"Gestiona el cat√°logo de productos y servicios con cuentas contables asignadas"})]}),e.jsxs(B,{children:[e.jsxs(Ae,{className:"mb-6",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsxs(Ve,{children:[e.jsx("strong",{children:"Recomendaci√≥n:"}),' Asignar subcuentas a cada producto ayuda a llevar un mejor control contable. La cuenta predeterminada es "4001 - Ventas".']})]}),e.jsx("div",{className:"space-y-6",children:Us?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):ge.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay productos de servicios registrados a√∫n"}):e.jsxs("div",{className:"space-y-6",children:[ie.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>{const t=ge.filter(l=>l.subcuenta_id===s.id);return t.length===0?null:e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsxs(L,{className:"text-lg flex items-center",children:[e.jsx(Ne,{className:"mr-2 h-5 w-5"}),"Subcuenta: ",s.nombre]}),e.jsxs(ne,{children:[t.length," producto",t.length!==1?"s":""]})]}),e.jsx(B,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(l=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[l.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:l.imagen_url,alt:l.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:l.nombre}),l.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:l.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",l.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:()=>Xt(l),className:"flex-1",children:"Editar"}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>_t.mutate(l.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},l.id))})})]},s.id)}),(()=>{const s=ge.filter(t=>!t.subcuenta_id);return s.length===0?null:e.jsxs(O,{children:[e.jsxs(z,{children:[e.jsxs(L,{className:"text-lg flex items-center",children:[e.jsx(ea,{className:"mr-2 h-5 w-5"}),"Cuenta General: 4001 - Ventas"]}),e.jsxs(ne,{children:[s.length," producto",s.length!==1?"s":""," sin subcuenta espec√≠fica"]})]}),e.jsx(B,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(t=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[t.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:t.nombre}),t.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",t.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:()=>Xt(t),className:"flex-1",children:"Editar"}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>_t.mutate(t.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},t.id))})})]})})()]})})]})]})})]}),e.jsx(cs,{open:La,onOpenChange:Vs,children:e.jsxs(ls,{children:[e.jsxs(ds,{children:[e.jsx(ms,{children:"‚ùå Cancelar Transacci√≥n"}),e.jsx(us,{children:"Esta acci√≥n crear√° un asiento contable de reversi√≥n. La transacci√≥n original quedar√° marcada como cancelada pero mantendr√° toda su trazabilidad."})]}),e.jsxs("div",{className:"space-y-4",children:[Ge&&e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Transacci√≥n a cancelar:"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",Ge.descripcion]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Monto:"})," $",C(Ge.monto_total)]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(Ge.created_at).toLocaleDateString("es-ES")]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{htmlFor:"motivo-cancelacion",children:"Motivo de la Cancelaci√≥n *"}),e.jsx(Ze,{id:"motivo-cancelacion",placeholder:"Ej: Error en registro, cliente cancel√≥ pedido, etc.",value:Ms,onChange:s=>dt(s.target.value),rows:3})]}),e.jsxs(Ae,{children:[e.jsx(A,{className:"h-4 w-4"}),e.jsxs(Ve,{className:"text-xs",children:[e.jsx("strong",{children:"¬øQu√© suceder√°?"}),e.jsxs("ul",{className:"list-disc ml-4 mt-1 space-y-1",children:[e.jsx("li",{children:"Se crear√° un asiento de reversi√≥n autom√°ticamente"}),e.jsx("li",{children:'La transacci√≥n original se marcar√° como "cancelada"'}),e.jsx("li",{children:"Si es venta de inventario, el stock se restaurar√°"}),e.jsx("li",{children:"Ambas transacciones quedar√°n visibles para auditor√≠a"})]})]})]})]}),e.jsxs(Os,{children:[e.jsx(M,{variant:"outline",onClick:()=>{Vs(!1),dt(""),lt(null)},disabled:mt,children:"Cancelar"}),e.jsx(M,{variant:"destructive",onClick:sn,disabled:mt||!Ms.trim(),children:mt?"Cancelando...":"Confirmar Cancelaci√≥n"})]})]})})]})]})};export{An as default};
