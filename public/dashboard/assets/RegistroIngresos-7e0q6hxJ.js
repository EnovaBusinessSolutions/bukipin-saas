import{c as Sn,r as h,a as Cn,f as ws,e as rs,j as e,b as Xs,P as At,d as kt,B as O,C as Et,g as Mt,h as Vt,u as _n,i as Pn,k as Fn,l as Dn,m as In,n as $n,o as Tn,p as An,q as kn,s as En,D as xs,t as hs,v as ps,w as gs,x as U,y as js,S as Re,z as ja,R as Ie,A as q,L as j,I as W,E as Hs,F as re,T as fa,G as Na,H as ss,J as ts,K as Y,M as G,N as K,O as ie,Q as H,U as ba,V as $e,W as va,X as fs,Y as Oe,Z as Be,_ as pe,$ as ge,a0 as ye,a1 as je,a2 as k,a3 as as,a4 as Mn,a5 as Vn,a6 as ya,a7 as Ns,a8 as Rn,a9 as wa,aa as Sa,ab as Ca,ac as bs,ad as On,ae as Js,af as vs,ag as _a,ah as Pa,ai as Qs,aj as Bn,ak as Ln,al as zn,am as Un,an as $t}from"./index-DLrLwJLV.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wn=Sn("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),qn=u=>{const P=(u==null?void 0:u.data)??u??[];return Array.isArray(P)?P:[]},Yn=(u=10)=>{const[P,F]=h.useState([]),[C,T]=h.useState(!0),[ce,ue]=h.useState(null),Z=async()=>{try{T(!0),ue(null);const se=await Cn(`/api/transacciones/ingresos/recientes?limit=${encodeURIComponent(String(u))}`,{method:"GET"}),we=qn(se).map(Ne=>{var He;return{...Ne,asiento_fecha:Ne.asiento_fecha??(Array.isArray(Ne.asiento)&&Ne.asiento.length>0?((He=Ne.asiento[0])==null?void 0:He.fecha)??null:null)}});F(we)}catch(se){console.error("Error fetching transacciones recientes:",se),ue((se==null?void 0:se.message)||"Error desconocido")}finally{T(!1)}};return h.useEffect(()=>{let se=!0;Z();const we=window.setInterval(()=>{se&&Z()},3e4);return()=>{se=!1,window.clearInterval(we)}},[u]),{transacciones:P,loading:C,error:ce,refetch:Z}};function Gn({value:u,onChange:P,className:F,placeholder:C="Selecciona un rango",disabled:T}){const ce=h.useMemo(()=>u!=null&&u.from?u.to?`${ws(u.from,"dd/MM/yyyy",{locale:rs})} ‚Äì ${ws(u.to,"dd/MM/yyyy",{locale:rs})}`:ws(u.from,"dd/MM/yyyy",{locale:rs}):C,[u,C]);return e.jsx("div",{className:Xs("grid gap-2",F),children:e.jsxs(At,{children:[e.jsx(kt,{asChild:!0,children:e.jsxs(O,{type:"button",variant:"outline",disabled:T,className:Xs("w-full justify-start text-left font-normal",!(u!=null&&u.from)&&"text-muted-foreground"),children:[e.jsx(Et,{className:"mr-2 h-4 w-4"}),ce]})}),e.jsxs(Mt,{className:"w-auto p-0",align:"start",children:[e.jsx(Vt,{initialFocus:!0,mode:"range",numberOfMonths:2,selected:u,onSelect:P,locale:rs,defaultMonth:(u==null?void 0:u.from)??new Date}),e.jsxs("div",{className:"flex items-center justify-between gap-2 border-t p-2",children:[e.jsx(O,{type:"button",variant:"ghost",size:"sm",onClick:()=>P(void 0),children:"Limpiar"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:u!=null&&u.from&&!(u!=null&&u.to)?"Elige la fecha fin":" "})]})]})]})})}async function Te(u,P={}){const F=await fetch(u,{credentials:"include",headers:{"Content-Type":"application/json",...P.headers||{}},...P}),C=await F.json().catch(()=>({}));if(!F.ok){const T=(C==null?void 0:C.error)||(C==null?void 0:C.message)||`HTTP ${F.status}`;throw new Error(T)}return(C==null?void 0:C.data)??C}async function Tt(u,P={}){const F=(P==null?void 0:P.body)??{};try{if(u==="registrar-ingreso")return{data:await Te("/api/ingresos",{method:"POST",body:JSON.stringify(F)}),error:null};if(u==="cancelar-ingreso"){const T=F==null?void 0:F.transaccionId;return{data:await Te(`/api/ingresos/${encodeURIComponent(T)}/cancelar`,{method:"POST",body:JSON.stringify({motivoCancelacion:F==null?void 0:F.motivoCancelacion})}),error:null}}return{data:await Te(`/api/functions/${encodeURIComponent(u)}`,{method:"POST",body:JSON.stringify(F)}),error:null}}catch(C){return{data:null,error:{message:(C==null?void 0:C.message)||String(C)}}}}const Ke=u=>{if(u==null)return 0;const P=typeof u=="string"?Number(u):u;return Number.isFinite(P)?P:0},D=u=>Ke(u).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),$=(u,P)=>{const F=Ke(u);let C=F,T="";return P==="miles"?(C=F/1e3,T=" K"):P==="millones"&&(C=F/1e6,T=" M"),C.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})+T},ys=u=>{if(!u)return u;const P=u.id??u._id,F=u.fecha??u.createdAt??u.created_at??u.updatedAt??u.updated_at,C=F?String(F):void 0,T=C?C.slice(0,10):u.created_at,ce=Ke(u.monto_total??u.montoTotal??u.total??u.monto_total),ue=Ke(u.monto_descuento??u.montoDescuento??u.descuento),Z=Ke(u.monto_neto??u.montoNeto??u.neto??ce-ue),se=Ke(u.monto_pagado??u.montoPagado??u.pagado??Z),fe=Ke(u.saldo_pendiente??u.saldoPendiente??u.pendiente??Math.max(0,Z-se)),we=u.tipo_ingreso??u.tipoIngreso??u.tipo,Ne=u.metodo_pago??u.metodoPago,He=u.tipo_pago??u.tipoPago;return{...u,id:P,_id:u._id??P,created_at:u.created_at??T,fecha:u.fecha??C,tipo_ingreso:we,tipoIngreso:u.tipoIngreso??we,metodo_pago:Ne,metodoPago:u.metodoPago??Ne,tipo_pago:He,tipoPago:u.tipoPago??He,monto_total:ce,montoTotal:u.montoTotal??ce,total:u.total??ce,monto_descuento:ue,montoDescuento:u.montoDescuento??ue,monto_neto:Z,montoNeto:u.montoNeto??Z,neto:u.neto??Z,monto_pagado:se,montoPagado:u.montoPagado??se,pagado:u.pagado??se,saldo_pendiente:fe,saldoPendiente:u.saldoPendiente??fe,pendiente:u.pendiente??fe}},de=(u,P)=>{const F=ys(u);return P==="brutas"?F.monto_total||0:P==="descuentos"?F.monto_descuento||0:P==="netas"&&(F.monto_neto||F.monto_total)||0},ns=u=>{const P=(u??"").toString().slice(0,10),[F,C,T]=P.split("-").map(Number);return new Date(F,(C||1)-1,T||1)},Kn=u=>{const{x:P,y:F,width:C,height:T,name:ce,value:ue,porcentaje:Z}=u,fe=ce==="Efectivo"?"hsl(180 50% 55%)":"hsl(180 45% 45%)",we=C>100&&T>70;return e.jsxs("g",{children:[e.jsx("rect",{x:P,y:F,width:C,height:T,fill:fe,stroke:"#fff",strokeWidth:2}),we&&e.jsxs(e.Fragment,{children:[e.jsx("text",{x:P+C/2,y:F+T/2-20,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontWeight:"bold",fontSize:"16px",style:{userSelect:"none"},children:ce}),e.jsxs("text",{x:P+C/2,y:F+T/2+5,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:["$",$(ue,"general")]}),e.jsxs("text",{x:P+C/2,y:F+T/2+25,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:[Z,"%"]})]})]})},Hn=({active:u,payload:P,scaleFormat:F})=>{if(u&&P&&P.length){const C=P[0].payload,T=C.name==="Efectivo";return e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-lg p-3",children:[e.jsx("p",{className:"font-bold text-foreground mb-1",children:C.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Monto: ",e.jsxs("span",{className:"font-semibold text-foreground",children:["$",$(C.value,F)]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Porcentaje: ",e.jsxs("span",{className:"font-semibold text-foreground",children:[C.porcentaje,"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2 italic",children:T?"Se registra en Efectivo (Caja)":"Se registra en Bancos"})]})}return null},Zn=()=>{const{ventasResumen:u,loading:P,refetch:F}=_n(),{transacciones:C,loading:T,refetch:ce}=Yn(1e3),ue=(C??[]).map(ys),{data:Z=[]}=Pn(),{data:se}=Fn(),fe=(se==null?void 0:se.cuentasFlat)||[],{data:we=[],isLoading:Ne,refetch:He}=Dn(),{data:Se=[],isLoading:Zs,refetch:Fa}=In(),{data:ke=[],isLoading:Da}=$n(),Ia=Tn(),$a=An(),Rt=kn(),Ta=En(),[R,Je]=h.useState(""),[Aa,ka]=h.useState(!1),[Ea,Ma]=h.useState(""),[Ss,Ot]=h.useState(""),[E,Bt]=h.useState(""),[be,Le]=h.useState(""),[Cs,Qe]=h.useState(""),[Lt,_s]=h.useState(!1),[ee,zt]=h.useState(""),[ve,et]=h.useState(""),[Xe,Ps]=h.useState(""),[Ce,Fs]=h.useState(""),[_e,Ds]=h.useState(""),[Ae,Is]=h.useState(""),[$s,Ut]=h.useState(""),[Pe,Wt]=h.useState(""),[Ts,st]=h.useState(""),[Ee,As]=h.useState([]),[Va,os]=h.useState(!1),[w,ks]=h.useState(null),[Ze,tt]=h.useState("historico"),[le,is]=h.useState(""),[Q,Ra]=h.useState("diario"),[I,Oa]=h.useState("general"),[N,Ba]=h.useState("brutas"),[B,La]=h.useState("ventas"),[me,za]=h.useState(new Date),[M,Ua]=h.useState(new Date),[cs,Wa]=h.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[ls,qa]=h.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[ds,Ya]=h.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[V,qt]=h.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]}),[Jn,Es]=h.useState([]),[es,Ga]=h.useState([]),[Yt,Gt]=h.useState(""),[Kt,Ht]=h.useState(""),[Ka,Jt]=h.useState(void 0);function Qt(s){const t=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),i=String(s.getDate()).padStart(2,"0");return`${t}-${r}-${i}`}function Ha(s){const[t,r,i]=String(s).split("-").map(Number);return!t||!r||!i?null:new Date(t,r-1,i,0,0,0,0)}function Ja(s){const[t,r,i]=String(s).split("-").map(Number);return!t||!r||!i?null:new Date(t,r-1,i,23,59,59,999)}const Ms=s=>{const t=ns(s),r=Yt?Ha(Yt):null,i=Kt?Ja(Kt):null;return!(r&&t<r||i&&t>i)},Qa=s=>{Jt(s);const t=s==null?void 0:s.from,r=s==null?void 0:s.to;Gt(t?Qt(t):""),Ht(r?Qt(r):"")},[xe,Xt]=h.useState("todos"),[he,Zt]=h.useState("todas"),[ne,ea]=h.useState(""),[ms,Xa]=h.useState("subcuenta"),[ze,Vs]=h.useState(null),[Za,at]=h.useState(!1),[oe,nt]=h.useState(""),[Ue,us]=h.useState(""),[Me,rt]=h.useState("1"),[Rs,ot]=h.useState(0),[it,Os]=h.useState(!0),[ct,lt]=h.useState("0"),[We,dt]=h.useState("monto"),[J,Bs]=h.useState([]),[qe,mt]=h.useState(""),[Ls,ut]=h.useState(""),[zs,xt]=h.useState("1"),[ht,sa]=h.useState("0"),[Ye,en]=h.useState("monto"),[te,Us]=h.useState([]),[sn,pt]=h.useState(!1),[gt,ta]=h.useState(""),[jt,aa]=h.useState(""),[na,ra]=h.useState(""),[Qn,tn]=h.useState("4001"),[oa,ia]=h.useState(""),[an,ca]=h.useState(null);h.useState(null);const[Ws,qs]=h.useState(!1),[nn,Ys]=h.useState(!1),[Ge,ft]=h.useState(null),[Gs,Nt]=h.useState(""),[bt,la]=h.useState(!1),[rn,Ks]=h.useState(!1),[on,da]=h.useState(null),[vt,yt]=h.useState(""),[wt,St]=h.useState(""),[ma,Ct]=h.useState(""),[cn,_t]=h.useState(null),[ua,Pt]=h.useState(null),[xa,ha]=h.useState(""),Fe=we||[],ln=s=>{var r;nt(s);const t=Fe.find(i=>i.id===s);if(t){const i=t.precio_venta,n=i&&i>0?i.toString():((r=t.costo_unitario)==null?void 0:r.toString())||"0",a=i&&i>0;Os(a),us(n),ot(t.cantidad_stock||0),Qe(`Venta de ${t.nombre}`);const m=((i&&i>0?i:t.costo_unitario||0)*parseFloat(Me)).toFixed(2);Le(m)}},dn=s=>{if(us(s),oe&&s){const t=(parseFloat(s)*parseFloat(Me||"1")).toFixed(2);Le(t)}},mn=()=>{if(!qe)return;const s=Se.find(m=>m.id===qe);if(!s)return;const t=parseFloat(zs)||1,r=parseFloat(ht)||0,i=s.precio*t,n=Ye==="porcentaje"?i*(r/100):r,a=Math.max(0,i-n),l=te.findIndex(m=>m.id===qe);if(l!==-1){const m=[...te];m[l].cantidad+=t,m[l].descuento+=n;const x=m[l].precio*m[l].cantidad;m[l].subtotal=Math.max(0,x-m[l].descuento),Us(m)}else Us([...te,{id:s.id,nombre:s.nombre,precio:s.precio,cantidad:t,descuento:n,subtotal:a,imagen_url:s.imagen_url}]);mt(""),xt("1"),ut(""),sa("0")},un=s=>{Us(te.filter(t=>t.id!==s))},xn=()=>{if(!oe)return;const s=Fe.find(x=>x.id===oe);if(!s)return;const t=parseFloat(Me)||1,r=parseFloat(Ue)||0,i=parseFloat(ct)||0,n=r*t,a=We==="porcentaje"?n*(i/100):i,l=Math.max(0,n-a),m=J.findIndex(x=>x.id===oe);if(m!==-1){const x=[...J];x[m].cantidad+=t,x[m].descuento+=a;const p=x[m].precioUnitario*x[m].cantidad;x[m].subtotal=Math.max(0,p-x[m].descuento),Bs(x)}else Bs([...J,{id:oe,nombre:s.nombre,precioUnitario:r,cantidad:t,descuento:a,subtotal:l,stockDisponible:s.cantidad_stock||0,costoUnitario:s.costo_unitario||0,imagen_url:s.imagen_url}]);nt(""),rt("1"),us(""),lt("0"),dt("monto"),ot(0),Os(!0),re({title:"‚úÖ Producto agregado",description:`${s.nombre} agregado a la venta`})},hn=s=>{Bs(J.filter(t=>t.id!==s)),re({title:"Producto eliminado",description:"El producto ha sido removido de la venta"})};h.useEffect(()=>{if(R==="precargados"&&te.length>0){const s=te.reduce((t,r)=>t+r.subtotal,0).toFixed(2);Le(s),Qe(`Venta de ${te.length} producto(s)`)}},[te,R]),h.useEffect(()=>{if(R==="inventariados"&&J.length>0){const s=J.reduce((t,r)=>t+r.subtotal,0).toFixed(2);Le(s),Qe(`Venta de ${J.length} producto(s) de inventario`)}},[J,R]);const pn=s=>{mt(s);const t=Se.find(r=>r.id===s);t&&ut(t.precio.toString())},pa=()=>{const s=[];return R||s.push("Tipo de Ingreso"),R==="precargados"?te.length===0&&s.push("Debe agregar al menos un producto"):R==="inventariados"?J.length===0&&s.push("Debe agregar al menos un producto del inventario"):(R==="general"||R==="otros")&&(Cs.trim()||s.push("Descripci√≥n")),R!=="precargados"&&R!=="inventariados"&&(!be||parseFloat(be)<=0)&&s.push("Monto Total"),(E==="credito"||E==="parcial")&&(ee||s.push("Tipo de Cliente"),ee==="recurrente"&&!ve&&s.push("Cliente Seleccionado"),ee==="nuevo"&&(Xe.trim()||s.push("Nombre del Cliente"),Ce.trim()||s.push("Tel√©fono del Cliente"),_e.trim()||s.push("Email del Cliente")),$s||s.push("Fecha de Vencimiento"),E==="parcial"&&((!Pe||parseFloat(Pe)<=0)&&s.push("Monto Abonado"),be&&Pe&&parseFloat(Pe)>=parseFloat(be)&&s.push("Monto Abonado debe ser menor al total"))),(E==="contado"||E==="parcial")&&!Ss&&s.push("M√©todo de Pago"),E||s.push("Tipo de Pago"),s},X=s=>pa().includes(s),gn=(s,t,r)=>{const i=[];return!ke||ke.length===0||ke.forEach(n=>{n.telefono&&s&&n.telefono.trim()===s.trim()&&i.push(`El tel√©fono ${s} ya est√° registrado para el cliente "${n.nombre}"`),n.email&&t&&n.email.trim().toLowerCase()===t.trim().toLowerCase()&&i.push(`El correo ${t} ya est√° registrado para el cliente "${n.nombre}"`),n.rfc&&r&&n.rfc.trim().toUpperCase()===r.trim().toUpperCase()&&i.push(`El RFC ${r} ya est√° registrado para el cliente "${n.nombre}"`)}),i};h.useEffect(()=>{if(ee==="nuevo"&&(Ce||_e||Ae)){const s=gn(Ce,_e,Ae);As(s)}else As([])},[Ce,_e,Ae,ee,ke]),h.useEffect(()=>{(async()=>{var t;try{const r=await Te("/api/ingresos/asientos-directos"),i=(r==null?void 0:r.asientos)??((t=r==null?void 0:r.data)==null?void 0:t.asientos)??r??[],n=null;if(!i)return;const a=i.filter(l=>l.detalle_asientos.some(m=>m.cuenta_codigo.startsWith("4")&&m.cuenta_codigo!=="4003"&&Number(m.haber)>0));Ga(a)}catch(r){console.error("Error al cargar asientos directos:",r)}})()},[]),h.useEffect(()=>{(async()=>{var t,r;try{let i,n;Q==="diario"?(i=new Date(me),i.setHours(0,0,0,0),n=new Date(me),n.setHours(23,59,59,999)):Q==="mensual"?(i=new Date(M.getFullYear(),M.getMonth(),1),n=new Date(M.getFullYear(),M.getMonth()+1,0,23,59,59,999)):(i=new Date(new Date().getFullYear(),0,1),n=new Date(new Date().getFullYear(),11,31,23,59,59,999));const a=await Te(`/api/ingresos/asientos?start=${encodeURIComponent(i.toISOString().split("T")[0])}&end=${encodeURIComponent(n.toISOString().split("T")[0])}`),l=(a==null?void 0:a.asientos)??((t=a==null?void 0:a.data)==null?void 0:t.asientos)??[],m=(a==null?void 0:a.detalles)??((r=a==null?void 0:a.data)==null?void 0:r.detalles)??[],x=null;if(!l||l.length===0){qt({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]});return}const p=l.map(b=>b.id);let o=0,c=0,d=0;const g={};l.forEach(b=>{const v=m.filter(y=>y.asiento_id===b.id),_=ns(b.fecha);let A;Q==="diario"?A="Hoy":Q==="mensual"?A=`D√≠a ${_.getDate()}`:A=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][_.getMonth()],g[A]||(g[A]={ventasBrutas:0,descuentos:0,otrosIngresos:0}),v.forEach(y=>{const f=y.debe||0,L=y.haber||0,z=y.cuenta_codigo;if(B==="ventas"){if(z==="4001"){const ae=L-f;o+=ae,g[A].ventasBrutas+=ae}if(z==="4003"){const ae=f-L;c+=ae,g[A].descuentos+=ae}}else if(z.startsWith("4")&&z!=="4001"&&z!=="4003"){const ae=L-f;d+=ae,g[A].otrosIngresos+=ae}})});let S=[];if(Q==="diario"){const b=g.Hoy||{ventasBrutas:0,descuentos:0,otrosIngresos:0};S=[{periodo:"Hoy",ventasBrutas:b.ventasBrutas,descuentos:b.descuentos,ventasNetas:b.ventasBrutas-b.descuentos,otrosIngresos:b.otrosIngresos}]}else if(Q==="mensual"){const b=new Date(M.getFullYear(),M.getMonth()+1,0).getDate();S=Array.from({length:b},(v,_)=>{const y=`D√≠a ${_+1}`,f=g[y]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:y,ventasBrutas:f.ventasBrutas,descuentos:f.descuentos,ventasNetas:f.ventasBrutas-f.descuentos,otrosIngresos:f.otrosIngresos}})}else S=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"].map(v=>{const _=g[v]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:v,ventasBrutas:_.ventasBrutas,descuentos:_.descuentos,ventasNetas:_.ventasBrutas-_.descuentos,otrosIngresos:_.otrosIngresos}});qt({ventasBrutas:o,descuentos:c,ventasNetas:o-c,otrosIngresos:d,detallesPorPeriodo:S})}catch(i){console.error("Error calculando anal√≠ticas desde asientos:",i)}})()},[Q,me,M,B]),h.useEffect(()=>{(async()=>{try{const r=async m=>{var y;const x=new Date;let p,o;if(m==="dia")p=me.toISOString().split("T")[0],o=p;else if(m==="mes"){const f=M.getMonth(),L=M.getFullYear(),z=new Date(L,f,1),ae=new Date(L,f+1,0);p=z.toISOString().split("T")[0],o=ae.toISOString().split("T")[0]}else{const f=x.getFullYear();p=`${f}-01-01`,o=`${f}-12-31`}const c=await Te(`/api/ingresos/detalles?start=${encodeURIComponent(p)}&end=${encodeURIComponent(o)}`),d=(c==null?void 0:c.detalles)??((y=c==null?void 0:c.data)==null?void 0:y.detalles)??c??[],g=null;let S=0,b=0,v=0;(d||[]).forEach(f=>{const L=Number(f.debe)||0,z=Number(f.haber)||0,ae=f.cuenta_codigo;ae==="4001"?S+=z-L:ae==="4003"?b+=L-z:ae!=null&&ae.startsWith("4")&&(v+=z-L)});const _=S-b,A=_+v;return{ventasBrutas:S,descuentos:b,ventasNetas:_,otrosIngresos:v,totalIngresos:A}},i=async()=>{var m;try{let x,p=new Date;Q==="diario"?(x=new Date(me),x.setHours(0,0,0,0),p=new Date(me),p.setHours(23,59,59,999)):Q==="mensual"?(x=new Date(M.getFullYear(),M.getMonth(),1),p=new Date(M.getFullYear(),M.getMonth()+1,0,23,59,59,999)):(x=new Date(M.getFullYear(),0,1),p=new Date(M.getFullYear(),11,31,23,59,59,999));const o=await Te(`/api/inventario/movimientos?tipo=venta&start=${encodeURIComponent(x.toISOString())}&end=${encodeURIComponent(p.toISOString())}`),c=(o==null?void 0:o.movimientos)??((m=o==null?void 0:o.data)==null?void 0:m.movimientos)??o??[],d=null;Es(c||[])}catch(x){console.error("Error en cargarMovimientosInventario:",x),Es([])}},[n,a,l]=await Promise.all([r("dia"),r("mes"),r("ano")]);Wa(n),qa(a),Ya(l)}catch(r){console.error("Error calculando totales:",r)}})(),(async()=>{var r;try{let i,n=new Date;Q==="diario"?(i=new Date(me),i.setHours(0,0,0,0),n=new Date(me),n.setHours(23,59,59,999)):Q==="mensual"?(i=new Date(M.getFullYear(),M.getMonth(),1),n=new Date(M.getFullYear(),M.getMonth()+1,0,23,59,59,999)):(i=new Date(M.getFullYear(),0,1),n=new Date(M.getFullYear(),11,31,23,59,59,999));const a=await Te(`/api/inventario/movimientos?tipo=venta&start=${encodeURIComponent(i.toISOString())}&end=${encodeURIComponent(n.toISOString())}`),l=(a==null?void 0:a.movimientos)??((r=a==null?void 0:a.data)==null?void 0:r.movimientos)??a??[],m=null;Es(l||[])}catch(i){console.error("Error en loadMovimientos:",i),Es([])}})()},[me,M,Q,C]);const jn=async s=>{var r,i;const t=String(s??"").trim();if(at(!0),Vs(null),!t||t==="undefined"||t==="null"){at(!1);return}try{const n=await Te(`/api/asientos/by-transaccion?source=ingreso&id=${encodeURIComponent(t)}`),a=(n==null?void 0:n.asiento)??((r=n==null?void 0:n.data)==null?void 0:r.asiento)??n??null;Vs(a)}catch(n){const a=String((n==null?void 0:n.message)??"");(n==null?void 0:n.status)===404||((i=n==null?void 0:n.response)==null?void 0:i.status)===404||a.includes("404")||(console.error("Error en loadAsientosContables:",n),re({title:"Error",description:"Error inesperado al cargar asientos",variant:"destructive"})),Vs(null)}finally{at(!1)}},fn=async()=>{var t;const s=pa();if(s.length>0){re({title:"‚ö†Ô∏è Campos requeridos faltantes",description:`Debes completar: ${s.join(", ")}`,variant:"destructive"});return}if(R==="inventariados"){if(J.length===0){re({title:"‚ö†Ô∏è No hay productos",description:"Debes agregar al menos un producto del inventario a la venta",variant:"destructive"});return}for(const r of J)if(r.cantidad>r.stockDisponible){const i=Fe.find(n=>n.id===r.id);ks({productName:r.nombre,requested:r.cantidad,available:r.stockDisponible,costoPorUnidad:(i==null?void 0:i.costo_unitario)||0,costoTotal:((i==null?void 0:i.costo_unitario)||0)*r.cantidad}),os(!0);return}await Ft();return}if(R==="inventariados"&&oe){const r=parseFloat(Me||"1");if(r>Rs){const i=Fe.find(m=>m.id===oe);let n=(i==null?void 0:i.costo_unitario)||0;if(n===0){const m=await Te(`/api/inventario/productos/${encodeURIComponent(oe)}/movimientos?tipo=compra`),x=(m==null?void 0:m.movimientos)??((t=m==null?void 0:m.data)==null?void 0:t.movimientos)??m??[];if(x&&x.length>0){let p=0,o=0;for(const c of x)c.costo_unitario>0&&c.cantidad>0&&(p+=c.costo_unitario*c.cantidad,o+=c.cantidad);o>0&&(n=p/o)}}const a=r-Rs,l=n*a;ks({productName:(i==null?void 0:i.nombre)||"Producto",requested:r,available:Rs,costoPorUnidad:n,costoTotal:l}),os(!0);return}}ee==="nuevo"&&Ee.length>0&&!confirm(`Se detectaron posibles duplicados:

${Ee.join(`
`)}

¬øDeseas continuar registrando este cliente de todas formas?`)||await Ft()},Ft=async()=>{_s(!0);try{let s=null;if(ee==="nuevo"&&Xe.trim())try{s=(await Ta.mutateAsync({nombre:Xe.trim(),email:_e.trim()||void 0,telefono:Ce.trim()||void 0,rfc:Ae.trim()||void 0})).id}catch(p){console.error("Error creating client:",p),re({title:"Error al crear cliente",description:"No se pudo crear el cliente nuevo",variant:"destructive"}),_s(!1);return}else ee==="recurrente"&&ve&&(s=ve);const t=Fe.find(p=>p.id===oe);let r=Cs,i=Number(be||"0"),n=null,a=0;if(R==="precargados"&&te.length>0){const p=Se.find(d=>d.id===te[0].id);n=(p==null?void 0:p.subcuenta_id)||null;const o=te.reduce((d,g)=>d+g.precio*g.cantidad,0),c=te.reduce((d,g)=>d+g.descuento,0);i=o,a=c,r=`Venta: ${te.map(d=>`${d.nombre} (x${d.cantidad})`).join(", ")}`}else R==="inventariados"&&(r="Venta de productos inventariados",i=0,n=null);R!=="precargados"&&(a=Aa?Number(Ea||"0"):0);const l=Math.max(0,Number((i-a).toFixed(2)));let m=0,x=0;if(E==="contado"?(m=l,x=0):E==="parcial"?(m=Number(Pe||"0"),x=Math.max(0,l-m)):E==="credito"&&(m=0,x=l),R==="inventariados"&&J.length>0){const p=J.reduce((S,b)=>S+b.precioUnitario*b.cantidad,0),o=J.reduce((S,b)=>S+b.descuento,0),c=p-o;let d=0,g=0;E==="contado"?(d=c,g=0):E==="parcial"?(d=Number(Pe||"0"),g=Math.max(0,c-d)):E==="credito"&&(d=0,g=c);for(const S of J){const b=Fe.find(z=>z.id===S.id);if(!b)continue;const v=J.length===1?`Venta de ${S.nombre}`:`Venta m√∫ltiple (${J.length} productos): ${S.nombre}`,_=S.subtotal/c,A=d*_,y=g*_,{data:f,error:L}=await Tt("registrar-ingreso",{body:{tipoIngreso:"inventariados",descripcion:v,montoTotal:S.precioUnitario*S.cantidad,montoDescuento:S.descuento,cuentaPrincipalCodigo:"4001",subcuentaId:b.subcuenta_id||null,metodoPago:Ss,tipoPago:E,montoPagado:A,montoPendiente:y,clienteNombre:Xe.trim()||null,clienteTelefono:Ce.trim()||null,clienteEmail:_e.trim()||null,clienteRFC:Ae.trim()||null,clienteId:s,fechaVencimiento:$s||null,comentarios:Ts.trim()||null,productoId:S.id,cantidadVendida:S.cantidad,precioVenta:S.precioUnitario,costoPersonalizado:Ze==="personalizado"&&le?parseFloat(le):void 0}});if(L)throw L}re({title:"‚úÖ Venta registrada exitosamente",description:`Se registraron ${J.length} productos del inventario`,duration:5e3})}else{if(!r||i<=0){re({title:"‚ö†Ô∏è Datos incompletos",description:"Selecciona un producto v√°lido o ingresa una descripci√≥n y monto.",variant:"destructive"}),_s(!1);return}const{data:p,error:o}=await Tt("registrar-ingreso",{body:{tipoIngreso:R,descripcion:r,montoTotal:i,montoDescuento:a,cuentaPrincipalCodigo:R==="otros"?"4102":"4001",subcuentaId:n||void 0,metodoPago:Ss,tipoPago:E,montoPagado:m,montoPendiente:x,clienteNombre:Xe.trim()||null,clienteTelefono:Ce.trim()||null,clienteEmail:_e.trim()||null,clienteRFC:Ae.trim()||null,clienteId:s,fechaVencimiento:$s||null,comentarios:Ts.trim()||null,...R==="inventariados"&&t?{productoId:t.id,cantidadVendida:Number(Me||"1"),precioVenta:Number(Ue||"0"),costoPersonalizado:Ze==="personalizado"&&le?Number(le):void 0}:{}}});if(o)throw o;re({title:"Ingreso registrado",description:`Asiento ${p.numeroAsiento} creado correctamente`})}await Promise.all([F(),ce()]),R==="inventariados"&&window.location.reload(),Je(""),Qe(""),Le(""),Ma(""),ka(!1),Ot(""),Bt(""),zt(""),et(""),Ps(""),Fs(""),Ds(""),Is(""),Ut(""),Wt(""),st(""),As([]),mt(""),ut(""),xt("1"),Us([]),nt(""),us(""),rt("1"),ot(0),Os(!0),Bs([]),lt("0"),dt("monto")}catch(s){re({title:"Error",description:s.message||"Error al registrar el ingreso",variant:"destructive"})}finally{_s(!1)}},Nn=async()=>{if(!Ge||!Gs.trim()){re({title:"‚ö†Ô∏è Motivo requerido",description:"Debes ingresar el motivo de la cancelaci√≥n",variant:"destructive"});return}la(!0);try{console.log("Cancelando transacci√≥n:",Ge.id);const{data:s,error:t}=await Tt("cancelar-ingreso",{body:{transaccionId:Ge.id,motivoCancelacion:Gs.trim()}});if(console.log("Respuesta de edge function:",{data:s,error:t}),t)throw console.error("Error de edge function:",t),new Error(t.message||JSON.stringify(t));if(s!=null&&s.error)throw console.error("Error en data:",s),new Error(s.error);re({title:"‚úì Transacci√≥n cancelada",description:`Asiento de reversi√≥n ${(s==null?void 0:s.numeroAsientoReversion)||"creado"} correctamente`}),await Promise.all([F(),ce()]),Nt(""),ft(null),Ys(!1)}catch(s){console.error("Error completo al cancelar:",s),re({title:"‚ùå Error al cancelar",description:(s==null?void 0:s.message)||(s==null?void 0:s.toString())||"No se pudo cancelar la transacci√≥n",variant:"destructive"})}finally{la(!1)}},bn=s=>{switch(s){case"precargados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Oe,{children:[e.jsx(U,{className:"h-4 w-4"}),e.jsxs(Be,{children:[e.jsx("strong",{children:"Recordatorio:"}),' Para registrar ventas de productos precargados, primero debes agregar los productos al cat√°logo desde la pesta√±a "Cat√°logo de Productos".']})]}),e.jsxs(Y,{className:"bg-muted/50",children:[e.jsx(G,{className:"pb-3",children:e.jsx(K,{className:"text-base",children:"Agregar Productos a la Venta"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"producto-precargado",children:"Seleccionar Producto"}),e.jsxs(pe,{value:qe,onValueChange:pn,children:[e.jsx(ge,{children:e.jsx(ye,{placeholder:Zs?"Cargando productos...":"Seleccionar producto del cat√°logo"})}),e.jsx(je,{className:"max-h-80 z-50 bg-background border border-border w-full",children:Zs?e.jsx(k,{value:"loading",disabled:!0,children:"Cargando productos..."}):Se.length===0?e.jsx(k,{value:"empty",disabled:!0,children:"No hay productos de servicios registrados"}):Se.map(t=>e.jsx(k,{value:t.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx($e,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate mb-1",children:t.nombre}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",D(t.precio)]})]})]})},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cantidad",children:"Cantidad"}),e.jsx(W,{id:"cantidad",type:"number",placeholder:"1",min:"1",value:zs,onChange:t=>xt(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"precio-unitario",children:"Precio Unitario"}),e.jsx(W,{id:"precio-unitario",type:"number",placeholder:"0.00",value:Ls,readOnly:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"descuento-producto",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(Ie,{value:Ye,onValueChange:t=>en(t),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"monto",id:"descuento-monto"}),e.jsx(j,{htmlFor:"descuento-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"porcentaje",id:"descuento-porcentaje"}),e.jsx(j,{htmlFor:"descuento-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(W,{id:"descuento-producto",type:"number",placeholder:Ye==="porcentaje"?"0":"0.00",min:"0",max:Ye==="porcentaje"?"100":void 0,step:Ye==="porcentaje"?"1":"0.01",value:ht,onChange:t=>sa(t.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Ye==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Subtotal con Descuento"}),e.jsx(W,{type:"text",value:qe&&Ls?(()=>{const t=parseFloat(Ls)*parseFloat(zs||"1"),r=parseFloat(ht||"0"),i=Ye==="porcentaje"?Math.max(0,t-t*r/100):Math.max(0,t-r);return`$${D(i)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(O,{type:"button",onClick:mn,disabled:!qe,className:"w-full",variant:"secondary",children:[e.jsx($t,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),te.length>0&&e.jsxs(Y,{children:[e.jsx(G,{className:"pb-3",children:e.jsxs(K,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",te.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",D(te.reduce((t,r)=>t+r.subtotal,0))]})]})}),e.jsx(H,{children:e.jsx("div",{className:"space-y-2",children:te.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx($e,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[t.cantidad," x $",D(t.precio)," = $",D(t.cantidad*t.precio)]}),t.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",D(t.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",D(t.subtotal)]})]})]})]}),e.jsx(O,{type:"button",variant:"ghost",size:"sm",onClick:()=>un(t.id),className:"text-destructive hover:text-destructive",children:e.jsx(U,{className:"h-4 w-4"})})]},`${t.id}-${r}`))})})]}),X("Debe agregar al menos un producto")&&e.jsxs(Oe,{variant:"destructive",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(Be,{children:"Debes agregar al menos un producto a la venta"})]})]});case"inventariados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Oe,{children:[e.jsx(U,{className:"h-4 w-4"}),e.jsxs(Be,{children:[e.jsx("strong",{children:"Ventas desde Inventario:"})," Selecciona productos, aplica descuentos opcionales y agr√©galos a la venta. Si vendes m√°s de lo disponible, se te pedir√° confirmar la sobreventa."]})]}),e.jsxs(Y,{className:"bg-muted/50",children:[e.jsx(G,{className:"pb-3",children:e.jsx(K,{className:"text-base",children:"Agregar Productos del Inventario"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"producto-inventario",children:"Seleccionar Producto"}),e.jsxs(pe,{value:oe,onValueChange:ln,children:[e.jsx(ge,{children:e.jsx(ye,{placeholder:Ne?"Cargando inventario...":"Seleccionar producto del inventario"})}),e.jsx(je,{className:"max-h-80 z-50 bg-background border border-border w-full",children:Ne?e.jsx(k,{value:"loading",disabled:!0,children:"Cargando inventario..."}):Fe.length===0?e.jsx(k,{value:"empty",disabled:!0,children:"No hay productos con stock disponible"}):Fe.map(t=>e.jsx(k,{value:t.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx($e,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.nombre}),e.jsxs("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full flex-shrink-0 ml-2",children:["Stock: ",t.cantidad_stock||0]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Costo: $",t.costo_unitario||0]}),t.precio_venta&&t.precio_venta>0?e.jsxs("span",{className:"text-xs text-green-600 font-medium",children:["Venta: $",t.precio_venta]}):e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"‚ö†Ô∏è Sin precio"})]})]})]})},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cantidad-inv",children:"Cantidad a Vender"}),e.jsx(W,{id:"cantidad-inv",type:"number",min:"1",value:Me,onChange:t=>rt(t.target.value)}),oe&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Stock disponible: ",Rs," unidades"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"precio-inv",children:"Precio Unitario"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Ie,{value:it?"registrado":"personalizado",onValueChange:t=>{const r=t==="registrado";if(Os(r),r&&oe){const i=Fe.find(n=>n.id===oe);if(i){const n=i.precio_venta||i.costo_unitario||0;us(n.toString())}}},className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"registrado",id:"precio-registrado"}),e.jsx(j,{htmlFor:"precio-registrado",className:"text-sm cursor-pointer",children:"Precio registrado"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"personalizado",id:"precio-personalizado"}),e.jsx(j,{htmlFor:"precio-personalizado",className:"text-sm cursor-pointer",children:"Personalizado"})]})]}),e.jsx(W,{id:"precio-inv",type:"number",step:"0.01",min:"0",value:Ue,onChange:t=>dn(t.target.value),readOnly:it,className:it?"bg-muted":""})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"descuento-inv",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(Ie,{value:We,onValueChange:t=>dt(t),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"monto",id:"descuento-inv-monto"}),e.jsx(j,{htmlFor:"descuento-inv-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"porcentaje",id:"descuento-inv-porcentaje"}),e.jsx(j,{htmlFor:"descuento-inv-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(W,{id:"descuento-inv",type:"number",placeholder:We==="porcentaje"?"0":"0.00",min:"0",max:We==="porcentaje"?"100":void 0,step:We==="porcentaje"?"1":"0.01",value:ct,onChange:t=>lt(t.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:We==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Subtotal con Descuento"}),e.jsx(W,{type:"text",value:oe&&Ue?(()=>{const t=parseFloat(Ue)*parseFloat(Me||"1"),r=parseFloat(ct||"0"),i=We==="porcentaje"?Math.max(0,t-t*r/100):Math.max(0,t-r);return`$${D(i)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(O,{type:"button",onClick:xn,disabled:!oe||!Ue,className:"w-full",variant:"secondary",children:[e.jsx($t,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),J.length>0&&e.jsxs(Y,{children:[e.jsx(G,{className:"pb-3",children:e.jsxs(K,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",J.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",D(J.reduce((t,r)=>t+r.subtotal,0))]})]})}),e.jsx(H,{children:e.jsx("div",{className:"space-y-2",children:J.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx($e,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[t.cantidad," x $",D(t.precioUnitario)," = $",D(t.cantidad*t.precioUnitario)]}),t.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",D(t.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",D(t.subtotal)]}),e.jsxs("span",{className:"text-xs",children:["Stock disponible: ",t.stockDisponible]})]})]})]}),e.jsx(O,{type:"button",variant:"ghost",size:"sm",onClick:()=>hn(t.id),className:"text-destructive hover:text-destructive",children:e.jsx(U,{className:"h-4 w-4"})})]},`${t.id}-${r}`))})})]})]});case"general":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"descripcion-general",children:"Descripci√≥n del Ingreso"}),X("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(W,{id:"descripcion-general",placeholder:"Ej: Servicio de consultor√≠a",value:Cs,onChange:t=>Qe(t.target.value),className:X("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cuenta-contable",children:"Cuenta Contable"}),e.jsxs(pe,{defaultValue:"4001",children:[e.jsx(ge,{children:e.jsx(ye,{placeholder:"4001 - Ventas"})}),e.jsx(je,{children:e.jsx(k,{value:"4001",children:"4001 - Ventas"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"subcuenta",children:"Subcuenta (Opcional)"}),e.jsxs(pe,{children:[e.jsx(ge,{children:e.jsx(ye,{placeholder:"Seleccionar subcuenta"})}),e.jsx(je,{children:e.jsx(k,{value:"sub1",children:"Subcuenta ejemplo"})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"monto-general",children:"Monto"}),X("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(W,{id:"monto-general",type:"number",placeholder:"0.00",value:be,onChange:t=>Le(t.target.value),className:X("Monto Total")?"border-destructive":""})]})]});case"otros":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Oe,{children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(Be,{children:"Este ingreso se ligar√° a la cuenta 4102 - Otros Productos."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"descripcion-otros",children:"Descripci√≥n del Ingreso Extraordinario"}),X("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(as,{id:"descripcion-otros",placeholder:"Ej: Venta extraordinaria de equipo usado, donaci√≥n recibida, etc.",value:Cs,onChange:t=>Qe(t.target.value),className:X("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"monto-otros",children:"Monto"}),X("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(W,{id:"monto-otros",type:"number",placeholder:"0.00",value:be,onChange:t=>Le(t.target.value),className:X("Monto Total")?"border-destructive":""})]})]});default:return null}},vn=async()=>{if(!gt.trim()||!jt.trim()){re({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}qs(!0);try{await Ia.mutateAsync({nombre:gt.trim(),precio:parseFloat(jt),descripcion:na.trim()||void 0,subcuentaId:oa||void 0,imagen:an||void 0}),ta(""),aa(""),ra(""),tn("4001"),ia(""),ca(null),pt(!1)}catch{}finally{qs(!1)}},ga=s=>{var t;da(s),yt(s.nombre),St(((t=s.precio)==null?void 0:t.toString())||""),Ct(s.descripcion||""),Pt(s.imagen_url||null),_t(null),ha(s.subcuenta_id||""),Ks(!0)},yn=s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];if(t){_t(t);const i=new FileReader;i.onloadend=()=>{Pt(i.result)},i.readAsDataURL(t)}},wn=async()=>{if(!vt.trim()||!wt.trim()){re({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}qs(!0);try{await $a.mutateAsync({id:on.id,nombre:vt.trim(),precio:parseFloat(wt),descripcion:ma.trim()||void 0,imagen:cn||void 0,subcuentaId:xa||null}),Ks(!1),da(null),yt(""),St(""),Ct(""),_t(null),Pt(null)}catch{}finally{qs(!1)}};return e.jsxs("div",{className:"h-full overflow-hidden flex flex-col",children:[e.jsx(xs,{open:Va,onOpenChange:os,children:e.jsxs(hs,{children:[e.jsxs(ps,{children:[e.jsxs(gs,{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(U,{className:"h-5 w-5"}),"Advertencia: Inventario Insuficiente"]}),e.jsxs(js,{className:"space-y-3 pt-4",children:[e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-950/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx("p",{className:"font-medium mb-2",children:"Est√°s a punto de vender un producto sin suficiente inventario:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Producto:"}),e.jsx("span",{className:"font-medium",children:w==null?void 0:w.productName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cantidad solicitada:"}),e.jsx("span",{className:"font-medium",children:w==null?void 0:w.requested})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Stock disponible:"}),e.jsx("span",{className:"font-medium",children:w==null?void 0:w.available})]}),e.jsx(Re,{}),e.jsxs("div",{className:"flex justify-between text-orange-600",children:[e.jsx("span",{className:"font-medium",children:"Faltante:"}),e.jsx("span",{className:"font-bold",children:((w==null?void 0:w.requested)||0)-((w==null?void 0:w.available)||0)})]})]})]}),(w==null?void 0:w.costoPorUnidad)&&w.costoPorUnidad>0&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border-2 border-blue-300 dark:border-blue-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ja,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),e.jsx("p",{className:"font-bold text-blue-700 dark:text-blue-300",children:"üìä Costo Promedio Hist√≥rico"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Costo promedio calculado:"}),e.jsxs("span",{className:"text-lg font-bold text-blue-700 dark:text-blue-300",children:["$",D(w.costoPorUnidad)," por unidad"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Este costo se calcul√≥ autom√°ticamente del promedio ponderado de todas tus compras anteriores de este producto. Puedes usar este costo sugerido o ingresar uno personalizado si conoces el costo real de esta venta."})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"font-medium mb-3 text-blue-700 dark:text-blue-400",children:"Impacto en el inventario:"}),w!=null&&w.costoPorUnidad&&w.costoPorUnidad>0?e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{value:Ze,onValueChange:s=>{tt(s),s==="historico"&&is("")},className:"space-y-3 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"historico",id:"costo-historico"}),e.jsxs(j,{htmlFor:"costo-historico",className:"text-sm cursor-pointer",children:["Usar costo hist√≥rico: ",e.jsxs("strong",{className:"text-blue-700 dark:text-blue-400",children:["$",D(w.costoPorUnidad)]})," por unidad"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"personalizado",id:"costo-personalizado"}),e.jsx(j,{htmlFor:"costo-personalizado",className:"text-sm cursor-pointer",children:"Ingresar costo personalizado"})]})]}),Ze==="personalizado"&&e.jsxs("div",{className:"mb-3",children:[e.jsx(j,{htmlFor:"costo-custom",className:"text-xs",children:"Costo unitario personalizado"}),e.jsx(W,{id:"costo-custom",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:le,onChange:s=>is(s.target.value),className:"mt-1"})]}),e.jsx(Re,{className:"my-3"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Costo por unidad aplicado:"}),e.jsxs("span",{className:"font-medium",children:["$",D(Ze==="personalizado"&&le?le:w.costoPorUnidad)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",D((Ze==="personalizado"&&le?Number(le):w.costoPorUnidad)*(((w==null?void 0:w.requested)||0)-((w==null?void 0:w.available)||0)))]})]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"‚ö†Ô∏è Este producto no tiene costo hist√≥rico registrado."}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"costo-requerido",className:"text-xs",children:"Ingresa el costo unitario para esta transacci√≥n"}),e.jsx(W,{id:"costo-requerido",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:le,onChange:s=>is(s.target.value),className:"mt-1"})]}),le&&Number(le)>0&&e.jsxs(e.Fragment,{children:[e.jsx(Re,{}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",D(Number(le)*(((w==null?void 0:w.requested)||0)-((w==null?void 0:w.available)||0)))]})]})]})]})]}),e.jsxs("p",{className:"text-sm",children:["Si contin√∫as, el inventario quedar√° en ",e.jsxs("strong",{className:"text-destructive",children:["negativo (",((w==null?void 0:w.available)||0)-((w==null?void 0:w.requested)||0)," unidades)"]}),". Esto se reflejar√° en tu control de inventario con el valor mostrado arriba."]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"¬øDeseas continuar con la venta de todas formas?"})]})]}),e.jsxs(Hs,{className:"gap-2 sm:gap-0",children:[e.jsx(O,{variant:"outline",onClick:()=>{os(!1),ks(null),tt("historico"),is("")},children:"Cancelar"}),e.jsxs(O,{variant:"destructive",onClick:async()=>{if((!(w!=null&&w.costoPorUnidad)||w.costoPorUnidad===0)&&(!le||Number(le)<=0)){re({title:"Costo requerido",description:"Debes ingresar un costo unitario para continuar",variant:"destructive"});return}os(!1),ks(null),await Ft(),tt("historico"),is("")},children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Continuar con la Venta"]})]})]})}),e.jsxs("div",{className:"p-6 border-b bg-background",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Registro de Ingresos"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Registra ventas, gestiona cat√°logos y analiza ingresos de la empresa"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[e.jsxs(fa,{defaultValue:"registro",className:"w-full",children:[e.jsxs(Na,{className:"grid w-full grid-cols-4",children:[e.jsx(ss,{value:"registro",children:"Registro de Ingresos"}),e.jsx(ss,{value:"resumen",children:"Resumen de Ventas"}),e.jsx(ss,{value:"analitica",children:"Anal√≠tica de Ventas"}),e.jsx(ss,{value:"catalogo",children:"Cat√°logo de Productos"})]}),e.jsx(ts,{value:"registro",className:"mt-6 space-y-6",children:e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsx(K,{children:"Nuevo Registro de Ingreso"}),e.jsx(ie,{children:"Selecciona el tipo de ingreso y completa la informaci√≥n requerida"})]}),e.jsxs(H,{className:"space-y-6",children:[!R&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(j,{className:"text-base font-semibold",children:"Selecciona el tipo de ingreso que deseas registrar"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6",children:[e.jsxs("button",{type:"button",onClick:()=>Je("precargados"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(ba,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Productos Precargados"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Del cat√°logo de servicios/productos"})]}),e.jsxs("button",{type:"button",onClick:()=>Je("inventariados"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx($e,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Productos Inventariados"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Del inventario registrado"})]}),e.jsxs("button",{type:"button",onClick:()=>Je("general"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(va,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Ingreso General"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Operaci√≥n no inventariada"})]}),e.jsxs("button",{type:"button",onClick:()=>Je("otros"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Wn,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Otros Ingresos"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Extraordinarios, donaciones"})]})]})]}),R&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(O,{type:"button",variant:"ghost",size:"sm",className:"px-0",onClick:()=>Je(""),children:"‚Üê Volver al men√∫ de selecci√≥n"}),e.jsxs("div",{className:"space-y-6 p-4 border rounded-lg bg-muted/20",children:[bn(R),e.jsx(Re,{}),e.jsx("div",{className:"space-y-4",children:R==="precargados"&&qe||R==="inventariados"&&oe?e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"C√°lculo Autom√°tico"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cantidad:"}),e.jsx("span",{children:R==="precargados"?zs:Me})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Precio Unitario:"}),e.jsxs("span",{children:["$",R==="precargados"?Ls:Ue]})]}),e.jsx(Re,{}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",be]})]})]})]}):null}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"font-medium",children:"Estado del Pago"}),X("Tipo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(Ie,{value:E,onValueChange:Bt,className:X("Tipo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{value:"contado",id:"contado"}),e.jsx(j,{htmlFor:"contado",className:"cursor-pointer",children:"Pago Total"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{value:"parcial",id:"parcial"}),e.jsx(j,{htmlFor:"parcial",className:"cursor-pointer",children:"Pago parcial"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{value:"credito",id:"credito"}),e.jsx(j,{htmlFor:"credito",className:"cursor-pointer",children:"Adeudo Total"})]})]}),E==="parcial"&&e.jsxs("div",{className:"ml-6 p-4 border rounded-lg bg-blue-50 dark:bg-blue-950/20 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"monto-abonado",children:"Monto que se va a pagar"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),X("Monto Abonado")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(W,{id:"monto-abonado",type:"number",step:"0.01",placeholder:"0.00",value:Pe,onChange:s=>Wt(s.target.value),className:X("Monto Abonado")?"border-destructive":""})]}),be&&Pe&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-3 bg-white dark:bg-gray-900 rounded border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de la venta"}),e.jsxs("p",{className:"text-lg font-semibold text-primary",children:["$",D(be)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Se pagar√° ahora"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:["$",D(Pe)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Queda pendiente"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["$",D(parseFloat(be)-parseFloat(Pe))]})]})]})]})]}),e.jsx(Re,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(fs,{className:"h-5 w-5"}),e.jsx(j,{className:"font-medium",children:"Datos del Cliente"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:E==="contado"?"Opcional - Para anal√≠ticas y comentarios":"Obligatorio para cuentas por cobrar"})]}),E==="contado"&&e.jsxs(Oe,{children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(Be,{children:"Asignar cliente es opcional para pagos totales. √ötil para anal√≠ticas de ventas y seguimiento de clientes."})]}),(E==="parcial"||E==="credito")&&e.jsxs(Oe,{children:[e.jsx(U,{className:"h-4 w-4"}),e.jsx(Be,{children:"Se registrar√° en Cuentas por Cobrar para an√°lisis de vencimientos"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"font-medium",children:"Tipo de Cliente"}),e.jsxs(pe,{value:ee,onValueChange:s=>{zt(s),et(""),Ps(""),Fs(""),Ds(""),Is(""),As([])},children:[e.jsx(ge,{children:e.jsx(ye,{placeholder:E==="contado"?"Opcional - Selecciona para anal√≠ticas":"Selecciona el tipo de cliente"})}),e.jsxs(je,{children:[e.jsx(k,{value:"nuevo",children:"Cliente Nuevo"}),e.jsx(k,{value:"recurrente",children:"Cliente Recurrente"})]})]})]}),ee==="recurrente"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cliente-existente",children:"Seleccionar Cliente"}),(()=>{const s=ke.find(t=>t.id===ve);return e.jsxs(pe,{value:ve??"",onValueChange:t=>{et(t);const r=ke.find(i=>i.id===t);r&&(Ps(r.nombre),Fs(r.telefono||""),Ds(r.email||""),Is(r.rfc||""))},children:[e.jsx(ge,{className:"h-auto py-2",children:s?e.jsxs("div",{className:"flex flex-col text-left leading-tight",children:[e.jsx("span",{className:"font-medium",children:s.nombre}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.telefono?`Tel: ${s.telefono}`:"",s.telefono&&s.email?" ‚Ä¢ ":"",s.email?`Email: ${s.email}`:"",s.source==="transaction"?" ‚Ä¢ (De transacci√≥n)":""]})]}):e.jsx("span",{className:"text-muted-foreground",children:"Buscar cliente existente..."})}),e.jsx(je,{className:"p-1",children:Da?e.jsx("div",{className:"px-2 py-2 text-sm text-muted-foreground",children:"Cargando clientes..."}):ke.length===0?e.jsx("div",{className:"px-2 py-2 text-sm text-muted-foreground",children:"No hay clientes registrados"}):ke.map(t=>e.jsx(k,{value:t.id,className:"py-2",children:e.jsxs("div",{className:"flex flex-col text-left leading-tight",children:[e.jsx("span",{className:"font-medium",children:t.nombre}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.telefono?`Tel: ${t.telefono}`:"",t.telefono&&t.email?" ‚Ä¢ ":"",t.email?`Email: ${t.email}`:"",t.source==="transaction"?" ‚Ä¢ (De transacci√≥n)":""]})]})},t.id))})]})})(),!!ve&&e.jsx("p",{className:"text-xs text-green-600",children:"‚úì Datos del cliente cargados autom√°ticamente"})]}),(ee==="nuevo"||ee==="recurrente"&&ve)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cliente-nombre",children:"Nombre del Cliente"}),e.jsx(W,{id:"cliente-nombre",type:"text",placeholder:"Nombre completo",value:Xe,onChange:s=>Ps(s.target.value),disabled:ee==="recurrente"&&ve!==""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"cliente-telefono",children:"N√∫mero de Tel√©fono"}),(E==="parcial"||E==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),X("Tel√©fono del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(W,{id:"cliente-telefono",type:"tel",placeholder:"Ej: +52 55 1234 5678",value:Ce,onChange:s=>Fs(s.target.value),className:X("Tel√©fono del Cliente")?"border-destructive":"",disabled:ee==="recurrente"&&ve!==""}),ee==="nuevo"&&Ee.some(s=>s.includes(Ce)&&s.includes("tel√©fono"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Ee.find(s=>s.includes(Ce)&&s.includes("tel√©fono"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"cliente-email",children:"Correo Electr√≥nico"}),(E==="parcial"||E==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),X("Email del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(W,{id:"cliente-email",type:"email",placeholder:"cliente@ejemplo.com",value:_e,onChange:s=>Ds(s.target.value),className:X("Email del Cliente")?"border-destructive":"",disabled:ee==="recurrente"&&ve!==""}),ee==="nuevo"&&Ee.some(s=>s.includes(_e)&&s.includes("correo"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Ee.find(s=>s.includes(_e)&&s.includes("correo"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cliente-rfc",children:"RFC (ID Fiscal) - Opcional"}),e.jsx(W,{id:"cliente-rfc",type:"text",placeholder:"RFC123456ABC1",value:Ae,onChange:s=>Is(s.target.value.toUpperCase()),maxLength:13,disabled:ee==="recurrente"&&ve!==""}),ee==="nuevo"&&Ee.some(s=>s.includes(Ae)&&s.includes("RFC"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Ee.find(s=>s.includes(Ae)&&s.includes("RFC"))})]})]}),(E==="parcial"||E==="credito")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"fecha-vencimiento",children:"Fecha de Vencimiento"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),X("Fecha de Vencimiento")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(W,{id:"fecha-vencimiento",type:"date",value:$s,onChange:s=>Ut(s.target.value),className:X("Fecha de Vencimiento")?"border-destructive":"",min:new Date().toISOString().split("T")[0]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Fecha l√≠mite para el pago"," ",E==="parcial"?"del monto pendiente":"completo"]})]}),E==="contado"&&ee&&e.jsxs("div",{className:"col-span-full space-y-2",children:[e.jsx(j,{htmlFor:"comentario-venta",children:"Comentarios de la venta (Opcional)"}),e.jsx(as,{id:"comentario-venta",placeholder:"Detalles adicionales sobre esta venta, preferencias del cliente, etc.",value:Ts,onChange:s=>st(s.target.value),rows:2}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Informaci√≥n √∫til para futuras ventas y an√°lisis del cliente"})]})]})]}),e.jsx(Re,{}),(E==="contado"||E==="parcial")&&e.jsxs(e.Fragment,{children:[e.jsx(Re,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"font-medium",children:"M√©todo de Pago"}),X("M√©todo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(U,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(Ie,{value:Ss,onValueChange:Ot,className:X("M√©todo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{value:"efectivo",id:"efectivo"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Mn,{className:"h-4 w-4 text-green-600"}),e.jsxs(j,{htmlFor:"efectivo",className:"cursor-pointer",children:["Efectivo"," ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Caja)"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{value:"tarjeta",id:"tarjeta"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Vn,{className:"h-4 w-4 text-blue-800"}),e.jsxs(j,{htmlFor:"tarjeta",className:"cursor-pointer",children:["Tarjeta"," ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Bancos)"})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"comentarios",children:"Comentarios de la venta (Opcional)"}),e.jsx(as,{id:"comentarios",placeholder:"Agrega cualquier comentario o nota sobre esta venta...",value:Ts,onChange:s=>st(s.target.value),rows:3,className:"resize-none"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(O,{size:"lg",className:"px-8",onClick:fn,disabled:Lt,children:[e.jsx(ja,{className:"mr-2 h-4 w-4"}),Lt?"Registrando...":"Registrar Ingreso"]})})]})]})]})]})}),e.jsx(ts,{value:"resumen",className:"mt-6",children:e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsx(K,{children:"Registro Detallado de Ventas"}),e.jsx(ie,{children:"Historial completo de transacciones de ingresos"})]}),e.jsxs(H,{children:[e.jsxs("div",{className:"mb-6 p-4 border rounded-lg bg-muted/30 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2 lg:col-span-2",children:[e.jsx(j,{children:"Rango de fechas"}),e.jsx(Gn,{value:Ka,onChange:Qa})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"filtro-tipo",children:"Tipo de Ingreso"}),e.jsxs(pe,{value:xe,onValueChange:Xt,children:[e.jsx(ge,{id:"filtro-tipo",children:e.jsx(ye,{placeholder:"Todos"})}),e.jsxs(je,{children:[e.jsx(k,{value:"todos",children:"Todos"}),e.jsx(k,{value:"precargados",children:"Precargados"}),e.jsx(k,{value:"inventariados",children:"Inventariados"}),e.jsx(k,{value:"general",children:"General"}),e.jsx(k,{value:"otros",children:"Otros"}),e.jsx(k,{value:"asiento_directo",children:"Venta de activo fijo"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"filtro-cuenta",children:"Cuenta"}),e.jsxs(pe,{value:he,onValueChange:Zt,children:[e.jsx(ge,{id:"filtro-cuenta",children:e.jsx(ye,{placeholder:"Todas"})}),e.jsxs(je,{children:[e.jsx(k,{value:"todas",children:"Todas"}),e.jsx(k,{value:"4001",children:"4001 - Ventas"}),e.jsx(k,{value:"4004",children:"4004 - Ventas Inventarios"}),e.jsx(k,{value:"4101",children:"4101 - Productos Financieros"}),e.jsx(k,{value:"4102",children:"4102 - Otros Productos"}),e.jsx(k,{value:"4103",children:"4103 - Ganancia en Venta de Activos"}),e.jsx(k,{value:"4103",children:"4002 - Devoluciones sobre ventas"}),e.jsx(k,{value:"4103",children:"4002 - Descuentos sobre ventas"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"filtro-subcuenta",children:"Subcuenta"}),e.jsxs(pe,{value:ne,onValueChange:ea,children:[e.jsx(ge,{id:"filtro-subcuenta",children:e.jsx(ye,{placeholder:"Todas"})}),e.jsxs(je,{children:[e.jsx(k,{value:"todas",children:"Todas"}),e.jsx(k,{value:"sin-subcuenta",children:"Sin subcuenta"}),Z.map(s=>e.jsx(k,{value:s.id,children:s.nombre},s.id))]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsx(O,{variant:"outline",size:"sm",onClick:()=>{Jt(void 0),Gt(""),Ht(""),Xt("todos"),Zt("todas"),ea("")},children:"Limpiar Filtros"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Resultados:"," ",(()=>{const s=es.map(n=>{const a=n.detalle_asientos.find(l=>l.cuenta_codigo.startsWith("4")&&Number(l.haber)>0);return{created_at:n.fecha,fecha:n.fecha,fecha_fixed:n.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(a==null?void 0:a.cuenta_codigo)||"",subcuenta_id:a==null?void 0:a.subcuenta_id}});return[...C??[],...s??[]].map(ys).filter(n=>{const a=n.fecha_fixed??n.fecha??n.created_at,l=Ms(a),m=!xe||xe==="todos"||n.tipo_ingreso===xe,x=!he||he==="todas"||n.cuenta_principal_codigo===he,p=!ne||ne==="todas"||ne==="sin-subcuenta"&&!n.subcuenta_id||n.subcuenta_id===ne;return l&&m&&x&&p}).length})()]}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["Total: $",(()=>{const s=es.map(i=>{const n=i.detalle_asientos.find(a=>a.cuenta_codigo.startsWith("4")&&Number(a.haber)>0);return{created_at:i.fecha,fecha:i.fecha,fecha_fixed:i.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(n==null?void 0:n.cuenta_codigo)||"",subcuenta_id:n==null?void 0:n.subcuenta_id,monto_total:Number(n==null?void 0:n.haber)||0}}),r=[...ue,...s].filter(i=>{const n=i.fecha_fixed??i.fecha??i.created_at,a=Ms(n),l=!xe||xe==="todos"||i.tipo_ingreso===xe,m=!he||he==="todas"||i.cuenta_principal_codigo===he,x=!ne||ne==="todas"||ne==="sin-subcuenta"&&!i.subcuenta_id||i.subcuenta_id===ne;return a&&l&&m&&x});return D(r.reduce((i,n)=>i+Number(n.monto_total||0),0))})()]}),e.jsxs("p",{className:"text-sm font-medium text-green-600",children:["Neto: $",(()=>{const s=es.map(i=>{const n=i.detalle_asientos.find(a=>a.cuenta_codigo.startsWith("4")&&Number(a.haber)>0);return{created_at:i.fecha,fecha:i.fecha,fecha_fixed:i.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(n==null?void 0:n.cuenta_codigo)||"",subcuenta_id:n==null?void 0:n.subcuenta_id,monto_neto:Number(n==null?void 0:n.haber)||0}}),r=[...ue,...s].filter(i=>{const n=i.fecha_fixed??i.fecha??i.created_at,a=Ms(n),l=!xe||xe==="todos"||i.tipo_ingreso===xe,m=!he||he==="todas"||i.cuenta_principal_codigo===he,x=!ne||ne==="todas"||ne==="sin-subcuenta"&&!i.subcuenta_id||i.subcuenta_id===ne;return a&&l&&m&&x});return D(r.reduce((i,n)=>i+Number(n.monto_neto||0),0))})()]})]})]})]}),T?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando transacciones..."}):(()=>{const s=es.map(n=>{const a=n.detalle_asientos.find(l=>l.cuenta_codigo.startsWith("4")&&Number(l.haber)>0);return{id:n.id??n._id,descripcion:n.descripcion,monto_total:Number(a==null?void 0:a.haber)||0,monto_neto:Number(a==null?void 0:a.haber)||0,monto_descuento:0,monto_pagado:Number(a==null?void 0:a.haber)||0,monto_pendiente:0,tipo_ingreso:"asiento_directo",metodo_pago:"N/A",tipo_pago:"contado",cuenta_principal_codigo:(a==null?void 0:a.cuenta_codigo)||"",subcuenta_id:a==null?void 0:a.subcuenta_id,created_at:n.fecha,fecha:n.fecha,fecha_fixed:n.fecha,asiento_fecha:n.fecha,es_asiento_directo:!0,estado:"activo"}}),i=[...ue,...s.map(ys)].filter(n=>{const a=n.fecha_fixed??n.fecha??n.created_at,l=Ms(a),m=!xe||xe==="todos"||n.tipo_ingreso===xe,x=!he||he==="todas"||n.cuenta_principal_codigo===he,p=!ne||ne==="todas"||ne==="sin-subcuenta"&&!n.subcuenta_id||n.subcuenta_id===ne;return l&&m&&x&&p}).filter(n=>!String(n.descripcion||"").includes("CANCELACI√ìN:")).map(n=>{const a=n.estado==="cancelado";let l=null;return a&&n.transaccion_cancelacion_id&&(l=ue.find(m=>m.id===n.transaccion_cancelacion_id)),{...n,esCancelada:a,transaccionReversion:l}});return i.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay transacciones que coincidan con los filtros"}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"text-sm font-medium text-muted-foreground",children:["Mostrando ",i.length," transacci√≥n(es)"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Tip: da clic en el √≠cono üìÑ para ver ‚ÄúInformaci√≥n general‚Äù y ‚ÄúRegistro contable‚Äù"})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-background",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/60",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap",children:"Fecha"}),e.jsx("th",{className:"text-left p-3 font-medium min-w-[320px]",children:"Descripci√≥n"}),e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap hidden md:table-cell",children:"Tipo"}),e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap hidden lg:table-cell",children:"Cuenta"}),e.jsx("th",{className:"text-right p-3 font-medium whitespace-nowrap",children:"Total"}),e.jsx("th",{className:"text-right p-3 font-medium whitespace-nowrap hidden md:table-cell",children:"Neto"}),e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap hidden md:table-cell",children:"Estado"}),e.jsx("th",{className:"text-right p-3 font-medium whitespace-nowrap",children:"Acciones"})]})}),e.jsx("tbody",{children:i.map(n=>{var c,d,g,S,b;const a=n,l=n.esCancelada,m=!1,x=a.fecha_fixed??a.fecha??a.created_at,p=(()=>{try{return new Date(x).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return String(x||"")}})(),o=Number(de(a,"netas")||0);return e.jsxs("tr",{className:`border-t hover:bg-muted/30 ${l?"bg-red-50/60 dark:bg-red-950/20":""}`,children:[e.jsx("td",{className:"p-3 whitespace-nowrap text-muted-foreground",children:p}),e.jsxs("td",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium",children:a.descripcion}),a.es_asiento_directo&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200",children:"üìã Asiento Directo"}),l&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200",children:"‚ùå Cancelada"}),m]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("span",{className:"capitalize",children:a.metodo_pago||"N/A"})," ","‚Ä¢"," ",e.jsx("span",{className:"capitalize",children:a.tipo_pago||"N/A"}),a.subcuenta_id?e.jsxs(e.Fragment,{children:[" ","‚Ä¢"," ",e.jsxs("span",{className:"text-muted-foreground",children:["Subcuenta:"," ",((c=a.subcuentas)==null?void 0:c.nombre)||(()=>{const v=Z.find(_=>_.id===a.subcuenta_id);return(v==null?void 0:v.nombre)||"Subcuenta no encontrada"})()]})]}):null]}),a.comentarios&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 dark:bg-blue-950/30 rounded text-xs",children:[e.jsxs("span",{className:"font-medium text-blue-700 dark:text-blue-300",children:["üí¨"," "]}),e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:String(a.comentarios).length>80?`${String(a.comentarios).substring(0,80)}...`:String(a.comentarios)})]}),l&&a.motivo_cancelacion&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"p-3 bg-red-100 dark:bg-red-950/40 rounded-md border border-red-300 dark:border-red-800",children:[e.jsx("p",{className:"text-xs font-medium text-red-700 dark:text-red-300 mb-1",children:"üìã Motivo de cancelaci√≥n:"}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:a.motivo_cancelacion}),e.jsxs("p",{className:"text-xs text-red-500 dark:text-red-500 mt-1",children:["Cancelada el:"," ",new Date(a.fecha_cancelacion).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.transaccionReversion&&e.jsxs("div",{className:"p-3 bg-orange-100 dark:bg-orange-950/40 rounded-md border border-orange-300 dark:border-orange-800",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-orange-700 dark:text-orange-300",children:"‚Ü©Ô∏è Asiento de Reversi√≥n Generado"})}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",n.transaccionReversion.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Monto reversado:"})," $",D(Math.abs(n.transaccionReversion.monto_total))]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",(()=>{const v=n.transaccionReversion.fecha_fixed??n.transaccionReversion.fecha??n.transaccionReversion.created_at;return new Date(v).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})()]})]})]})]})]}),e.jsx("td",{className:"p-3 hidden md:table-cell",children:e.jsx("span",{className:"capitalize",children:a.tipo_ingreso})}),e.jsx("td",{className:"p-3 hidden lg:table-cell",children:a.cuenta_principal_codigo||"-"}),e.jsxs("td",{className:"p-3 text-right font-bold text-primary whitespace-nowrap",children:["$",D(a.monto_total),a.monto_descuento>0&&e.jsxs("div",{className:"text-xs text-red-600 font-medium",children:["-$",D(a.monto_descuento)," desc."]})]}),e.jsx("td",{className:"p-3 text-right hidden md:table-cell whitespace-nowrap",children:e.jsxs("span",{className:"font-medium text-green-600",children:["$",D(o)]})}),e.jsx("td",{className:"p-3 hidden md:table-cell",children:l?e.jsx("span",{className:"text-red-600 font-medium",children:"Cancelada"}):e.jsx("span",{className:"text-muted-foreground",children:"Activa"})}),e.jsx("td",{className:"p-3 text-right whitespace-nowrap",children:e.jsxs("div",{className:"inline-flex items-center gap-2 justify-end",children:[e.jsxs(xs,{onOpenChange:v=>{if(v){const _=String(a._id??a.id??"");jn(_)}else Vs(null)},children:[e.jsx(ya,{asChild:!0,children:e.jsx(O,{variant:"outline",size:"sm",className:"h-8 px-2",children:e.jsx(va,{className:"h-4 w-4"})})}),e.jsxs(hs,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ps,{children:[e.jsx(gs,{children:"Detalles de la Transacci√≥n"}),e.jsx(js,{children:"Informaci√≥n completa y asientos contables en balanza"})]}),e.jsxs(fa,{defaultValue:"general",className:"w-full",children:[e.jsxs(Na,{className:"grid w-full grid-cols-2",children:[e.jsx(ss,{value:"general",children:"Informaci√≥n General"}),e.jsx(ss,{value:"contable",children:"Registros Contables"})]}),e.jsxs(ts,{value:"general",className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Informaci√≥n General"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",a.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",a.tipo_ingreso]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"M√©todo de Pago:"})," ",a.metodo_pago||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo de Pago:"})," ",a.tipo_pago]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",(()=>{const v=a.fecha_fixed??a.fecha??a.created_at;try{return new Date(v).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return String(v||"")}})()]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Montos"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total:"})," $",D(a.monto_total)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descuento:"})," $",D(a.monto_descuento)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Neto:"})," $",D(a.monto_neto)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pagado:"})," $",D(a.monto_pagado||0)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pendiente:"})," $",D(a.monto_pendiente||0)]})]})]})]}),(a.cliente_nombre||a.cliente_telefono||a.cliente_email)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n del Cliente"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.cliente_nombre&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",a.cliente_nombre]}),a.cliente_telefono&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tel√©fono:"})," ",a.cliente_telefono]}),a.cliente_email&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",a.cliente_email]}),a.cliente_rfc&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"RFC:"})," ",a.cliente_rfc]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n Contable"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Cuenta Principal:"})," ",a.cuenta_principal??`${a.cuenta_principal_codigo}`]}),a.subcuenta_id?e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," ",((d=a.subcuentas)==null?void 0:d.nombre)||(()=>{const v=Z.find(_=>_.id===a.subcuenta_id);return(v==null?void 0:v.nombre)||"Subcuenta no encontrada"})()]}):e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," Sin subcuenta asignada"]})]})]}),a.comentarios&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Comentarios"}),e.jsx("div",{className:"p-3 bg-muted rounded-md",children:e.jsx("p",{className:"text-sm",children:a.comentarios})})]})]}),e.jsxs(ts,{value:"contable",className:"mt-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3",children:"Asientos en Balanza de Comprobaci√≥n"}),Za?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando asientos contables..."}):ze?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"N√∫mero de Asiento:"})," ",ze.numero_asiento]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(ze.fecha).toLocaleDateString("es-ES")]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",ze.descripcion]})]})}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Cuenta"}),e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Descripci√≥n"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Debe"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Haber"})]})}),e.jsxs("tbody",{children:[(g=ze.detalles)==null?void 0:g.map((v,_)=>e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"p-3 text-sm",children:[e.jsx("div",{className:"font-medium",children:v.cuenta_codigo}),e.jsx("div",{className:"text-xs text-muted-foreground",children:v.cuenta_nombre})]}),e.jsx("td",{className:"p-3 text-sm",children:v.descripcion}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:v.debe>0?`$${D(v.debe)}`:"-"}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:v.haber>0?`$${D(v.haber)}`:"-"})]},_)),e.jsxs("tr",{className:"border-t-2 bg-muted/50 font-bold",children:[e.jsx("td",{colSpan:2,className:"p-3 text-sm",children:"TOTALES"}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",D((S=ze.detalles)==null?void 0:S.reduce((v,_)=>v+Number(_.debe),0))]}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",D((b=ze.detalles)==null?void 0:b.reduce((v,_)=>v+Number(_.haber),0))]})]})]})]})}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/30 rounded-md text-sm",children:[e.jsx("p",{className:"font-medium text-blue-700 dark:text-blue-300 mb-1",children:"üí° Informaci√≥n"}),e.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:"Este asiento contable refleja c√≥mo esta transacci√≥n afecta a las diferentes cuentas en la balanza de comprobaci√≥n y posteriormente en los estados financieros."})]})]}):e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg text-sm text-muted-foreground text-center",children:"No se encontraron asientos contables para esta transacci√≥n"})]})]})]})]}),!l&&!m&&e.jsx(O,{variant:"outline",size:"sm",className:"h-8 px-2 border-red-300 text-red-600 hover:bg-red-50 dark:border-red-800 dark:text-red-400 dark:hover:bg-red-950/30",onClick:()=>{ft(ys(a)),Ys(!0)},children:"‚ùå"})]})})]},a.id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t bg-muted/40",children:[e.jsx("td",{className:"p-3 text-sm font-medium",colSpan:4,children:"TOTALES"}),e.jsxs("td",{className:"p-3 text-right font-bold text-primary whitespace-nowrap",children:["$",D(i.reduce((n,a)=>n+Number(a.monto_total||0),0))]}),e.jsx("td",{className:"p-3 text-right hidden md:table-cell whitespace-nowrap",children:e.jsxs("span",{className:"font-bold text-green-600",children:["$",D(i.reduce((n,a)=>n+Number(de(a,"netas")||0),0))]})}),e.jsx("td",{className:"p-3 hidden md:table-cell"}),e.jsx("td",{className:"p-3"})]})})]})})})]})})()]})]})}),e.jsx(ts,{value:"analitica",className:"mt-6",children:(()=>{const s=Array.isArray(es)?es:[],r=(()=>{const m=new Date().getFullYear();let x=C.filter(p=>{var o;return p.estado!=="cancelado"&&!((o=p.descripcion)!=null&&o.includes("CANCELACI√ìN:"))});if(Q==="diario"){const p=me.toISOString().split("T")[0];x=x.filter(o=>o.asiento_fecha===p)}else if(Q==="mensual"){const p=M.getMonth(),o=M.getFullYear();x=x.filter(c=>{const d=c.asiento_fecha;if(!d)return!1;const g=ns(d);return g.getMonth()===p&&g.getFullYear()===o})}else x=x.filter(p=>{const o=p.asiento_fecha;return o?ns(o).getFullYear()===m:!1});return B==="ventas"?x.filter(p=>p.cuenta_principal_codigo==="4001"):x.filter(p=>{var o;return((o=p.cuenta_principal_codigo)==null?void 0:o.startsWith("4"))&&p.cuenta_principal_codigo!=="4001"&&p.cuenta_principal_codigo!=="4003"})})(),n=(()=>{const l=r.filter(p=>p.tipo_pago==="contado"||p.tipo_pago==="parcial");if(l.length===0)return[];const m={};l.forEach(p=>{const o=p.metodo_pago==="efectivo"?"Efectivo":"Tarjeta";m[o]=(m[o]||0)+(Number(de(p,N))||0)});const x=Object.values(m).reduce((p,o)=>p+(Number(o)||0),0);return Object.entries(m).map(([p,o])=>({name:p,value:o,porcentaje:x>0?(o/x*100).toFixed(1):"0.0"}))})(),a=()=>B==="ventas"?r.length>0||(Number(V.ventasBrutas)||0)>0||(Number(V.descuentos)||0)>0:r.length>0||(Number(V.otrosIngresos)||0)>0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground mb-4",children:"Highlights de Ingresos"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(Y,{children:[e.jsx(G,{className:"pb-3",children:e.jsx(K,{className:"text-lg font-semibold text-primary",children:"Resumen del D√≠a"})}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",$(cs.ventasBrutas,I)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",$(cs.descuentos,I)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",$(cs.ventasNetas,I)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",$(cs.otrosIngresos,I)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",$(cs.totalIngresos,I)]})]})]})]}),e.jsxs(Y,{children:[e.jsx(G,{className:"pb-3",children:e.jsx(K,{className:"text-lg font-semibold text-primary",children:"Resumen del Mes"})}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",$(ls.ventasBrutas,I)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",$(ls.descuentos,I)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",$(ls.ventasNetas,I)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",$(ls.otrosIngresos,I)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",$(ls.totalIngresos,I)]})]})]})]}),e.jsxs(Y,{children:[e.jsx(G,{className:"pb-3",children:e.jsx(K,{className:"text-lg font-semibold text-primary",children:"Resumen del A√±o"})}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",$(ds.ventasBrutas,I)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",$(ds.descuentos,I)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",$(ds.ventasNetas,I)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",$(ds.otrosIngresos,I)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",$(ds.totalIngresos,I)]})]})]})]})]})]}),e.jsx("div",{className:"my-8 border-t-2 border-primary/20"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-foreground mb-6",children:["Anal√≠tica de ",B==="ventas"?"Ventas":"Otros Ingresos"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsx(K,{children:"Tipo de Ingreso"}),e.jsx(ie,{children:"Selecciona qu√© analizar"})]}),e.jsx(H,{children:e.jsxs(Ie,{value:B,onValueChange:l=>La(l),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"ventas",id:"tipo-ventas"}),e.jsx(j,{htmlFor:"tipo-ventas",className:"cursor-pointer",children:"Ventas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"otros",id:"tipo-otros"}),e.jsx(j,{htmlFor:"tipo-otros",className:"cursor-pointer",children:"Otros Ingresos"})]})]})})]}),e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsx(K,{children:"Per√≠odo de An√°lisis"}),e.jsx(ie,{children:"Selecciona el per√≠odo"})]}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs(Ie,{value:Q,onValueChange:l=>Ra(l),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"diario",id:"period-daily"}),e.jsx(j,{htmlFor:"period-daily",className:"cursor-pointer",children:"Diario"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"mensual",id:"period-monthly"}),e.jsx(j,{htmlFor:"period-monthly",className:"cursor-pointer",children:"Mensual"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"anual",id:"period-annual"}),e.jsx(j,{htmlFor:"period-annual",className:"cursor-pointer",children:"Anual"})]})]}),Q==="diario"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(j,{className:"text-xs text-muted-foreground mb-2 block",children:"Fecha espec√≠fica"}),e.jsxs(At,{children:[e.jsx(kt,{asChild:!0,children:e.jsxs(O,{variant:"outline",className:Xs("w-full justify-start text-left font-normal",!me&&"text-muted-foreground"),size:"sm",children:[e.jsx(Et,{className:"mr-2 h-4 w-4"}),ws(me,"PPP",{locale:rs})]})}),e.jsx(Mt,{className:"w-auto p-0",align:"start",children:e.jsx(Vt,{mode:"single",selected:me,onSelect:l=>l&&za(l),initialFocus:!0,className:"pointer-events-auto"})})]})]}),Q==="mensual"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(j,{className:"text-xs text-muted-foreground mb-2 block",children:"Mes espec√≠fico"}),e.jsxs(At,{children:[e.jsx(kt,{asChild:!0,children:e.jsxs(O,{variant:"outline",className:Xs("w-full justify-start text-left font-normal",!M&&"text-muted-foreground"),size:"sm",children:[e.jsx(Et,{className:"mr-2 h-4 w-4"}),ws(M,"MMMM yyyy",{locale:rs})]})}),e.jsx(Mt,{className:"w-auto p-0",align:"start",children:e.jsx(Vt,{mode:"single",selected:M,onSelect:l=>l&&Ua(l),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsx(K,{children:"Formato de Cifras"}),e.jsx(ie,{children:"Visualizaci√≥n de montos"})]}),e.jsx(H,{children:e.jsxs(Ie,{value:I,onValueChange:l=>Oa(l),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"general",id:"scale-general"}),e.jsx(j,{htmlFor:"scale-general",className:"cursor-pointer",children:"General"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"miles",id:"scale-thousands"}),e.jsx(j,{htmlFor:"scale-thousands",className:"cursor-pointer",children:"Miles (K)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"millones",id:"scale-millions"}),e.jsx(j,{htmlFor:"scale-millions",className:"cursor-pointer",children:"Millones (M)"})]})]})})]}),e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsx(K,{children:"Tipo de M√©trica"}),e.jsx(ie,{children:"Datos a visualizar"})]}),e.jsx(H,{children:e.jsxs(Ie,{value:N,onValueChange:l=>Ba(l),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"brutas",id:"metric-brutas"}),e.jsx(j,{htmlFor:"metric-brutas",className:"cursor-pointer",children:"Ventas Brutas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"descuentos",id:"metric-descuentos"}),e.jsx(j,{htmlFor:"metric-descuentos",className:"cursor-pointer",children:"Descuentos"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"netas",id:"metric-netas"}),e.jsx(j,{htmlFor:"metric-netas",className:"cursor-pointer",children:"Ventas Netas"})]})]})})]})]}),e.jsxs(Y,{className:"mb-6",children:[e.jsxs(G,{children:[e.jsxs(K,{children:["Evoluci√≥n de"," ",N==="descuentos"?"Descuentos":B==="otros"?"Otros Ingresos":N==="brutas"?"Ventas Brutas":"Ventas Netas"]}),e.jsx(ie,{children:(N==="descuentos"?"Descuentos aplicados":B==="otros"?"Otros ingresos":N==="brutas"?"Ventas brutas":"Ventas netas")+" - "+(Q==="diario"?"del d√≠a":Q==="mensual"?"por d√≠a del mes":"por mes del a√±o")})]}),e.jsx(H,{children:(()=>{const l=Number(B==="ventas"?N==="brutas"?V.ventasBrutas||0:N==="descuentos"?V.descuentos||0:V.ventasNetas||0:V.otrosIngresos||0),m=()=>{const d=r||[],g=(y,f)=>{if(B==="otros"){y.otrosIngresos+=f;return}N==="brutas"?y.ventasBrutas+=f:N==="descuentos"?y.descuentos+=f:y.ventasNetas+=f};if(Q==="diario"){const y=me.toISOString().split("T")[0],f={periodo:y,ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0};return d.forEach(L=>{const z=L.asiento_fecha;!z||String(z).slice(0,10)!==y||g(f,Number(de(L,N)||0))}),d.length===0&&l>0&&f.ventasBrutas+f.descuentos+f.ventasNetas+f.otrosIngresos===0&&g(f,l),[f]}if(Q==="mensual"){const y=M.getMonth(),f=M.getFullYear(),L=new Date(f,y+1,0).getDate(),z=Array.from({length:L},(Ve,De)=>({periodo:`D√≠a ${De+1}`,ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,__day:De+1}));if(d.forEach(Ve=>{const De=Ve.asiento_fecha;if(!De)return;const Dt=ns(De);if(Dt.getFullYear()!==f||Dt.getMonth()!==y)return;const It=Dt.getDate()-1;It<0||It>=z.length||g(z[It],Number(de(Ve,N)||0))}),z.reduce((Ve,De)=>Ve+De.ventasBrutas+De.descuentos+De.ventasNetas+De.otrosIngresos,0)===0&&l>0){const Ve={periodo:`Mes ${y+1}/${f}`,ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0};return g(Ve,l),[Ve]}return z}const b=new Date().getFullYear(),v=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],_=Array.from({length:12},(y,f)=>({periodo:v[f],ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,__month:f}));if(d.forEach(y=>{const f=y.asiento_fecha;if(!f)return;const L=ns(f);if(L.getFullYear()!==b)return;const z=L.getMonth();g(_[z],Number(de(y,N)||0))}),_.reduce((y,f)=>y+f.ventasBrutas+f.descuentos+f.ventasNetas+f.otrosIngresos,0)===0&&l>0){const y={periodo:`${b}`,ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0};return g(y,l),[y]}return _},x=Array.isArray(V.detallesPorPeriodo)?V.detallesPorPeriodo:[],o=((x.length>0?x:m())||[]).map(d=>({periodo:d.periodo,ventas:Number(d.ventasBrutas||0),descuentos:Number(d.descuentos||0),neto:Number(d.ventasNetas||0),otrosIngresos:Number(d.otrosIngresos||0),__day:d.__day,__month:d.__month})),c=o.some(d=>(d.ventas||0)+(d.descuentos||0)+(d.neto||0)+(d.otrosIngresos||0)>0);return T?e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"Cargando datos..."}):!c&&l<=0?e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"}):e.jsx("div",{className:"h-80",children:e.jsx(Ns,{width:"100%",height:"100%",children:e.jsxs(Rn,{data:o,children:[e.jsx(wa,{strokeDasharray:"3 3"}),e.jsx(Sa,{dataKey:"periodo"}),e.jsx(Ca,{tickFormatter:d=>$(d,I)}),e.jsx(bs,{formatter:d=>[`$${$(Number(d),I)}`,""],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"10px"},wrapperStyle:{zIndex:1e3}}),e.jsx(On,{}),N==="descuentos"&&e.jsx(Js,{type:"monotone",dataKey:"descuentos",stroke:"hsl(180 60% 70%)",name:"Descuentos",strokeWidth:2,dot:!1,children:e.jsx(vs,{dataKey:"descuentos",position:"top",formatter:d=>Number(d)>0?`$${$(d,I)}`:"",style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),N==="brutas"&&B==="ventas"&&e.jsx(Js,{type:"monotone",dataKey:"ventas",stroke:"hsl(180 50% 55%)",name:"Ventas Brutas",strokeWidth:2,dot:!1,children:e.jsx(vs,{dataKey:"ventas",position:"top",formatter:d=>Number(d)>0?`$${$(d,I)}`:"",style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),N==="netas"&&B==="ventas"&&e.jsx(Js,{type:"monotone",dataKey:"neto",stroke:"hsl(180 45% 45%)",name:"Ventas Netas",strokeWidth:2,dot:!1,children:e.jsx(vs,{dataKey:"neto",position:"top",formatter:d=>Number(d)>0?`$${$(d,I)}`:"",style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),B==="otros"&&N!=="descuentos"&&e.jsx(Js,{type:"monotone",dataKey:"otrosIngresos",stroke:"hsl(140 50% 50%)",name:"Otros Ingresos",strokeWidth:2,dot:!1,children:e.jsx(vs,{dataKey:"otrosIngresos",position:"top",formatter:d=>Number(d)>0?`$${$(d,I)}`:"",style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})})]})})})})()})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsxs(K,{children:[N==="brutas"?"Ventas Brutas":N==="descuentos"?"Descuentos":"Ventas Netas"," por Tipo"]}),e.jsxs(ie,{children:["Distribuci√≥n de"," ",N==="brutas"?"ventas brutas":N==="descuentos"?"descuentos":"ventas netas"," por categor√≠a"]})]}),e.jsx(H,{children:T?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):a()?B==="otros"&&N==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(Ns,{width:"100%",height:"100%",children:e.jsxs(_a,{children:[e.jsx(Pa,{data:(()=>{const l=B==="ventas"?N==="brutas"?V.ventasBrutas:N==="descuentos"?V.descuentos:V.ventasNetas:V.otrosIngresos;if(r.length===0&&(Number(l)||0)>0)return[{tipo:"Otros Ingresos",monto:Number(l)||0,porcentaje:"100.0"}];const m=r.reduce((p,o)=>{const c=(o==null?void 0:o.tipo_ingreso)||"sin_tipo";return p[c]=(p[c]||0)+(Number(de(o,N))||0),p},{}),x=Object.values(m).reduce((p,o)=>p+(Number(o)||0),0);return Object.entries(m).map(([p,o])=>({tipo:String(p).charAt(0).toUpperCase()+String(p).slice(1),monto:Number(o)||0,porcentaje:x>0?((Number(o)||0)/x*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({tipo:l,porcentaje:m,monto:x})=>`${l}
${m}%
$${$(Number(x)||0,I)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:Object.keys(r.reduce((l,m)=>(l[(m==null?void 0:m.tipo_ingreso)||"sin_tipo"]=!0,l),{})).map((l,m)=>{const x=["hsl(180 50% 55%)","hsl(180 45% 45%)","hsl(180 55% 65%)","hsl(180 40% 40%)"];return e.jsx(Qs,{fill:x[m%4]},`cell-${m}`)})}),e.jsx(bs,{formatter:l=>[`$${$(Number(l),I)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsxs(K,{children:["Estado de Pagos - ",N==="brutas"?"Ventas Brutas":N==="descuentos"?"Descuentos":"Ventas Netas"]}),e.jsx(ie,{children:"Distribuci√≥n por estado de pago"})]}),e.jsx(H,{children:T?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):a()?B==="otros"&&N==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(Ns,{width:"100%",height:"100%",children:e.jsxs(_a,{children:[e.jsxs(Pa,{data:(()=>{const l=B==="ventas"?N==="brutas"?V.ventasBrutas:N==="descuentos"?V.descuentos:V.ventasNetas:V.otrosIngresos;if(r.length===0&&(Number(l)||0)>0)return[{estado:"Pagado Total",monto:Number(l)||0,porcentaje:"100.0"}];const m=r.reduce((p,o)=>{let c="Por Cobrar";return o.tipo_pago==="contado"||o.monto_pagado&&o.monto_pendiente===0?c="Pagado Total":(o.tipo_pago==="parcial"||o.monto_pagado>0&&o.monto_pendiente>0)&&(c="Pago Parcial"),p[c]=(p[c]||0)+(Number(de(o,N))||0),p},{}),x=Object.values(m).reduce((p,o)=>p+(Number(o)||0),0);return Object.entries(m).map(([p,o])=>({estado:p,monto:Number(o)||0,porcentaje:x>0?((Number(o)||0)/x*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({estado:l,porcentaje:m,monto:x})=>`${l}
${m}%
$${$(Number(x)||0,I)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:[e.jsx(Qs,{fill:"hsl(180 50% 55%)"}),e.jsx(Qs,{fill:"hsl(180 55% 65%)"}),e.jsx(Qs,{fill:"hsl(180 45% 45%)"})]}),e.jsx(bs,{formatter:l=>[`$${$(Number(l),I)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(Y,{children:[e.jsxs(G,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(K,{children:[N==="brutas"?"Ventas Brutas":N==="descuentos"?"Descuentos":"Ventas Netas"," por"," ",ms==="subcuenta"?"Subcuenta":"Cuenta"]}),e.jsxs(ie,{children:["Distribuci√≥n por ",ms==="subcuenta"?"subcuentas":"cuentas"," contables"]})]}),e.jsxs(pe,{value:ms,onValueChange:l=>Xa(l),children:[e.jsx(ge,{className:"w-[150px]",children:e.jsx(ye,{})}),e.jsxs(je,{children:[e.jsx(k,{value:"subcuenta",children:"Por Subcuenta"}),e.jsx(k,{value:"cuenta",children:"Por Cuenta"})]})]})]}),e.jsx(H,{children:T?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):a()?B==="otros"&&N==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(Ns,{width:"100%",height:"100%",children:e.jsxs(Bn,{data:(()=>{const l=B==="ventas"?N==="brutas"?V.ventasBrutas:N==="descuentos"?V.descuentos:V.ventasNetas:V.otrosIngresos;if(r.length===0&&(Number(l)||0)>0)return[{subcuenta:"Sin detalle",monto:Number(l)||0}];const m=r.reduce((o,c)=>{var g;let d;if(ms==="subcuenta")d=c.subcuenta_id?((g=Z.find(S=>S.id===c.subcuenta_id))==null?void 0:g.nombre)||"Subcuenta desconocida":"Sin subcuenta asignada";else{const S=fe.find(b=>b.codigo===c.cuenta_principal_codigo);d=S?`${c.cuenta_principal_codigo} - ${S.nombre}`:c.cuenta_principal_codigo||"Sin cuenta"}return o[d]=(o[d]||0)+(Number(de(c,N))||0),o},{}),x=Object.values(m).reduce((o,c)=>o+(Number(c)||0),0);if((Number(l)||0)-x>.01){const o={};s.forEach(c=>{const g=(Array.isArray(c.detalle_asientos)?c.detalle_asientos:[]).find(y=>String(y.cuenta_codigo||"").startsWith("4")&&Number(y.haber)>0);if(!g)return;const S=Number(g.haber)||0,b=String(g.cuenta_codigo||""),v=fe.find(y=>y.codigo===b),_=(v==null?void 0:v.nombre)||"Otros ingresos";let A;if(ms==="cuenta")A=`${b} - ${_}`;else{const y=g.subcuenta_id,f=Z.find(L=>L.id===y);A=(f==null?void 0:f.nombre)||"Sin subcuenta asignada"}o[A]=(o[A]||0)+S}),Object.entries(o).forEach(([c,d])=>{m[c]=(m[c]||0)+(Number(d)||0)})}return Object.entries(m).map(([o,c])=>({subcuenta:o,monto:Number(c)||0}))})(),layout:"vertical",children:[e.jsx(wa,{strokeDasharray:"3 3"}),e.jsx(Sa,{type:"number",tickFormatter:l=>$(l,I),tick:{fill:"#000000"},domain:[0,l=>l*1.2]}),e.jsx(Ca,{type:"category",dataKey:"subcuenta",width:150,tick:{fill:"#000000"}}),e.jsx(bs,{formatter:l=>[`$${$(Number(l),I)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}}),e.jsx(Ln,{dataKey:"monto",fill:"hsl(180 50% 55%)",children:e.jsx(vs,{dataKey:"monto",position:"right",formatter:l=>`$${$(l,I)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsx(K,{children:"M√©todos de Pago Recibidos"}),e.jsxs(ie,{children:["Distribuci√≥n de"," ",N==="brutas"?"ventas brutas":N==="descuentos"?"descuentos":"ventas netas"," por m√©todo de pago"]})]}),e.jsx(H,{children:T?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):a()?B==="otros"&&N==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):n.length===0?e.jsxs("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:["No hay transacciones con m√©todo de pago en este per√≠odo",e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-2 block",children:"Las ventas a cr√©dito no tienen m√©todo de pago asignado"})]}):e.jsx("div",{className:"h-64",children:e.jsx(Ns,{width:"100%",height:"100%",children:e.jsx(zn,{data:n,dataKey:"value",aspectRatio:4/3,stroke:"#fff",fill:"#8884d8",content:e.jsx(Kn,{}),children:e.jsx(bs,{content:e.jsx(Hn,{scaleFormat:I})})})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsxs(K,{children:[N==="brutas"?"Ventas Brutas":N==="descuentos"?"Descuentos":"Ventas Netas"," por Producto"]}),e.jsxs(ie,{children:["Ranking de productos ",N==="descuentos"?"con m√°s descuentos":"m√°s vendidos"]})]}),e.jsx(H,{children:T?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):a()?e.jsx("div",{className:"space-y-3",children:(()=>{if(B==="otros"&&N==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const l=B==="ventas"?N==="brutas"?V.ventasBrutas:N==="descuentos"?V.descuentos:V.ventasNetas:V.otrosIngresos;if(r.length===0&&(Number(l)||0)>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx($e,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin detalle de producto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",$(Number(l)||0,I)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx($e,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",$(Number(l)||0,I)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const m={};r.forEach(o=>{if(o.tipo_ingreso==="inventariados"&&String(o.descripcion||"").startsWith("Venta de ")){const c=String(o.descripcion).replace("Venta de ","").trim(),d=Fe.find(g=>g.nombre.toLowerCase()===c.toLowerCase());m[c]||(m[c]={nombre:c,transacciones:0,monto:0,imagen:d==null?void 0:d.imagen_url,tieneAsignacion:!0}),m[c].transacciones+=1,m[c].monto+=Number(de(o,N))||0}}),r.forEach(o=>{if(o.tipo_ingreso==="precargados"){let c=[];String(o.descripcion||"").startsWith("Venta: ")?c=String(o.descripcion).replace("Venta: ","").split(", ").map(v=>{const _=v.match(/^(.+?) \(x(\d+)\)$/);return _?{nombre:_[1].trim(),cantidad:parseInt(_[2])}:{nombre:v.trim(),cantidad:1}}):String(o.descripcion||"").startsWith("Venta de ")?c=[{nombre:String(o.descripcion).replace("Venta de ","").trim(),cantidad:1}]:c=[{nombre:String(o.descripcion||"Sin descripci√≥n"),cantidad:1}];const d=Number(de(o,N))||0,g=[];let S=0;c.forEach(({nombre:b,cantidad:v})=>{const _=Se.find(y=>y.nombre.toLowerCase()===b.toLowerCase()),A=Number(_==null?void 0:_.precio)||0;g.push({nombre:b,cantidad:v,precioBase:A}),S+=A*v}),g.forEach(({nombre:b,cantidad:v,precioBase:_})=>{const A=Se.find(z=>z.nombre.toLowerCase()===b.toLowerCase()),y=_*v,f=S>0?y/S:1/Math.max(g.length,1),L=d*f;m[b]||(m[b]={nombre:b,transacciones:0,monto:0,imagen:A==null?void 0:A.imagen_url,tieneAsignacion:!!A}),m[b].transacciones+=1,m[b].monto+=Number(L)||0})}if(o.tipo_ingreso==="general"||o.tipo_ingreso==="inventariados"&&!String(o.descripcion||"").startsWith("Venta de ")){const c="Ingresos sin producto asignado";m[c]||(m[c]={nombre:c,transacciones:0,monto:0,tieneAsignacion:!1}),m[c].transacciones+=1,m[c].monto+=Number(de(o,N))||0}if(o.tipo_ingreso==="otros"){const c=String(o.descripcion||"Otros ingresos");m[c]||(m[c]={nombre:c,transacciones:0,monto:0,tieneAsignacion:!1}),m[c].transacciones+=1,m[c].monto+=Number(de(o,N))||0}});const x=Object.values(m).sort((o,c)=>(Number(c.monto)||0)-(Number(o.monto)||0));if(B==="otros"){const o=r.filter(d=>d.tipo_ingreso==="otros").reduce((d,g)=>d+(Number(de(g,N))||0),0);if((Number(l)||0)-o>.01){const d={};s.forEach(g=>{const b=(Array.isArray(g.detalle_asientos)?g.detalle_asientos:[]).find(f=>String(f.cuenta_codigo||"").startsWith("4")&&Number(f.haber)>0);if(!b)return;const v=Number(b.haber)||0,_=String(b.cuenta_codigo||""),A=fe.find(f=>f.codigo===_);let y;String(g.numero_asiento||"").startsWith("BAJA-")?y=(A==null?void 0:A.nombre)||"Ganancia en Venta de Activos":y=String(g.descripcion||(A==null?void 0:A.nombre)||"Otros ingresos"),d[y]||(d[y]={monto:0,count:0}),d[y].monto+=v,d[y].count+=1}),Object.entries(d).forEach(([g,S])=>{(Number(S.monto)||0)>.01&&x.push({nombre:g,transacciones:S.count,monto:S.monto,tieneAsignacion:!1})})}}const p=x.slice(0,10);return e.jsxs(e.Fragment,{children:[p.map(o=>{const c=x.reduce((g,S)=>g+(Number(S.monto)||0),0),d=c>0?((Number(o.monto)||0)/c*100).toFixed(1):"0.0";return e.jsxs("div",{className:`flex items-center gap-3 p-3 border rounded-lg ${o.tieneAsignacion?"":"border-amber-500/50 bg-amber-50/50 dark:bg-amber-950/20"}`,children:[o.imagen?e.jsx("img",{src:o.imagen,alt:o.nombre,className:"w-12 h-12 rounded-md object-cover flex-shrink-0"}):e.jsx("div",{className:`w-12 h-12 rounded-md flex items-center justify-center flex-shrink-0 ${o.tieneAsignacion?"bg-muted":"bg-amber-100 dark:bg-amber-900/30"}`,children:e.jsx($e,{className:`w-5 h-5 ${o.tieneAsignacion?"text-muted-foreground":"text-amber-600 dark:text-amber-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium truncate",children:o.nombre}),!o.tieneAsignacion&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-200 flex-shrink-0",children:"Sin asignar"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[o.transacciones," ",o.transacciones===1?"transacci√≥n":"transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",$(Number(o.monto)||0,I)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[d,"%"]})})]},o.nombre)}),(()=>{const o=x.reduce((c,d)=>c+(Number(d.monto)||0),0);return o>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx($e,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x.reduce((c,d)=>c+(Number(d.transacciones)||0),0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",$(o,I)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsxs(K,{children:[N==="brutas"?"Ventas Brutas":N==="descuentos"?"Descuentos":"Ventas Netas"," por Cliente"]}),e.jsxs(ie,{children:["Ranking de ",N==="descuentos"?"clientes con m√°s descuentos":"mejores clientes"]})]}),e.jsx(H,{children:T?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):a()?e.jsx("div",{className:"space-y-3",children:(()=>{if(B==="otros"&&N==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const l=B==="ventas"?N==="brutas"?V.ventasBrutas:N==="descuentos"?V.descuentos:V.ventasNetas:V.otrosIngresos;if(r.length===0&&(Number(l)||0)>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(fs,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin cliente asignado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",$(Number(l)||0,I)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(fs,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",$(Number(l)||0,I)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const m=r.reduce((c,d)=>{const g=String((d==null?void 0:d.cliente_nombre)||"Sin cliente asignado");return c[g]||(c[g]={nombre:g,transacciones:0,monto:0,email:d==null?void 0:d.cliente_email,telefono:d==null?void 0:d.cliente_telefono}),c[g].transacciones+=1,c[g].monto+=Number(de(d,N))||0,c},{}),x=Object.values(m).sort((c,d)=>(Number(d.monto)||0)-(Number(c.monto)||0)),p=x.reduce((c,d)=>c+(Number(d.monto)||0),0);if(B==="otros"){const c=(Number(l)||0)-p;if(c>.01){const d=x.find(g=>g.nombre==="Sin cliente asignado");d?(d.monto+=c,d.transacciones+=s.length):x.push({nombre:"Sin cliente asignado",transacciones:s.length,monto:c}),x.sort((g,S)=>(Number(S.monto)||0)-(Number(g.monto)||0))}}const o=x.slice(0,10);return e.jsxs(e.Fragment,{children:[o.map(c=>{const d=x.reduce((S,b)=>S+(Number(b.monto)||0),0),g=d>0?((Number(c.monto)||0)/d*100).toFixed(1):"0.0";return e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(fs,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:c.nombre}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-0.5",children:[e.jsxs("p",{children:[c.transacciones," ",c.transacciones===1?"compra":"compras"]}),c.telefono&&e.jsx("p",{className:"text-xs",children:c.telefono}),c.email&&e.jsx("p",{className:"text-xs truncate",children:c.email})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",$(Number(c.monto)||0,I)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[g,"%"]})})]},c.nombre)}),(()=>{const c=x.reduce((d,g)=>d+(Number(g.monto)||0),0);return c>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(fs,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x.reduce((d,g)=>d+(Number(g.transacciones)||0),0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",$(c,I)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]})]})]})]})})()}),e.jsx(ts,{value:"catalogo",className:"mt-6",children:e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsxs(K,{className:"flex items-center justify-between",children:["Cat√°logo de Productos",e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{variant:"outline",size:"sm",onClick:()=>{Fa(),re({title:"Actualizado",description:"La lista de productos se ha actualizado correctamente"})},children:[e.jsx(Un,{className:"mr-2 h-4 w-4"}),"Actualizar"]}),e.jsxs(xs,{open:sn,onOpenChange:pt,children:[e.jsx(ya,{asChild:!0,children:e.jsxs(O,{children:[e.jsx($t,{className:"mr-2 h-4 w-4"}),"Nuevo Producto"]})}),e.jsxs(hs,{className:"sm:max-w-[425px]",children:[e.jsxs(ps,{children:[e.jsx(gs,{children:"Agregar Nuevo Producto"}),e.jsx(js,{children:"Completa la informaci√≥n del producto para agregarlo al cat√°logo."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-name",className:"text-right",children:"Nombre"}),e.jsx(W,{id:"product-name",value:gt,onChange:s=>ta(s.target.value),className:"col-span-3",placeholder:"Nombre del producto"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-image",className:"text-right",children:"Imagen"}),e.jsx(W,{id:"product-image",type:"file",accept:"image/*",onChange:s=>{var t;return ca(((t=s.target.files)==null?void 0:t[0])||null)},className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-price",className:"text-right",children:"Precio"}),e.jsx(W,{id:"product-price",type:"number",value:jt,onChange:s=>aa(s.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-account",className:"text-right",children:"Cuenta"}),e.jsxs("div",{className:"col-span-3 flex items-center p-2 border rounded-md bg-muted/50",children:[e.jsx("span",{className:"text-sm font-medium",children:"4001 - Ventas"}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"(cuenta fija)"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(pe,{value:oa,onValueChange:s=>ia(s==="none"?"":s),children:[e.jsx(ge,{className:"col-span-3",children:e.jsx(ye,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(je,{children:[e.jsx(k,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),Z.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>e.jsx(k,{value:s.id,children:s.nombre},s.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(as,{id:"product-description",value:na,onChange:s=>ra(s.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]})]}),e.jsxs(Hs,{children:[e.jsx(O,{type:"button",variant:"outline",onClick:()=>pt(!1),children:"Cancelar"}),e.jsx(O,{onClick:vn,disabled:Ws,children:Ws?"Guardando...":"Guardar Producto"})]})]})]}),e.jsx(xs,{open:rn,onOpenChange:Ks,children:e.jsxs(hs,{className:"sm:max-w-[425px]",children:[e.jsxs(ps,{children:[e.jsx(gs,{children:"Editar Producto"}),e.jsx(js,{children:"Modifica la informaci√≥n del producto."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-name",className:"text-right",children:"Nombre *"}),e.jsx(W,{id:"edit-product-name",value:vt,onChange:s=>yt(s.target.value),className:"col-span-3",placeholder:"Ej: Consultor√≠a, Producto X"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-price",className:"text-right",children:"Precio *"}),e.jsx(W,{id:"edit-product-price",type:"number",value:wt,onChange:s=>St(s.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-image",className:"text-right",children:"Imagen"}),e.jsxs("div",{className:"col-span-3 space-y-2",children:[e.jsx(W,{id:"edit-product-image",type:"file",accept:"image/*",onChange:yn}),ua&&e.jsx("div",{className:"aspect-square w-24 mx-auto",children:e.jsx("img",{src:ua,alt:"Preview",className:"w-full h-full object-cover rounded-md"})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(as,{id:"edit-product-description",value:ma,onChange:s=>Ct(s.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(pe,{value:xa||"none",onValueChange:s=>ha(s==="none"?"":s),children:[e.jsx(ge,{className:"col-span-3",children:e.jsx(ye,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(je,{children:[e.jsx(k,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),Z.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>e.jsx(k,{value:s.id,children:s.nombre},s.id))]})]})]})]}),e.jsxs(Hs,{children:[e.jsx(O,{type:"button",variant:"outline",onClick:()=>Ks(!1),children:"Cancelar"}),e.jsx(O,{onClick:wn,disabled:Ws,children:Ws?"Actualizando...":"Actualizar Producto"})]})]})})]})]}),e.jsx(ie,{children:"Gestiona el cat√°logo de productos y servicios con cuentas contables asignadas"})]}),e.jsxs(H,{children:[e.jsxs(Oe,{className:"mb-6",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsxs(Be,{children:[e.jsx("strong",{children:"Recomendaci√≥n:"}),' Asignar subcuentas a cada producto ayuda a llevar un mejor control contable. La cuenta predeterminada es "4001 - Ventas".']})]}),e.jsx("div",{className:"space-y-6",children:Zs?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):Se.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay productos de servicios registrados a√∫n"}):e.jsxs("div",{className:"space-y-6",children:[Z.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>{const t=Se.filter(r=>r.subcuenta_id===s.id);return t.length===0?null:e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsxs(K,{className:"text-lg flex items-center",children:[e.jsx($e,{className:"mr-2 h-5 w-5"}),"Subcuenta: ",s.nombre]}),e.jsxs(ie,{children:[t.length," producto",t.length!==1?"s":""]})]}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(r=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[r.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:r.imagen_url,alt:r.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:r.nombre}),r.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:r.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",r.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{variant:"outline",size:"sm",onClick:()=>ga(r),className:"flex-1",children:"Editar"}),e.jsx(O,{variant:"outline",size:"sm",onClick:()=>Rt.mutate(r.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},r.id))})})]},s.id)}),(()=>{const s=Se.filter(t=>!t.subcuenta_id);return s.length===0?null:e.jsxs(Y,{children:[e.jsxs(G,{children:[e.jsxs(K,{className:"text-lg flex items-center",children:[e.jsx(ba,{className:"mr-2 h-5 w-5"}),"Cuenta General: 4001 - Ventas"]}),e.jsxs(ie,{children:[s.length," producto",s.length!==1?"s":""," sin subcuenta espec√≠fica"]})]}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(t=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[t.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:t.nombre}),t.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",t.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(O,{variant:"outline",size:"sm",onClick:()=>ga(t),className:"flex-1",children:"Editar"}),e.jsx(O,{variant:"outline",size:"sm",onClick:()=>Rt.mutate(t.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},t.id))})})]})})()]})})]})]})})]}),e.jsx(xs,{open:nn,onOpenChange:Ys,children:e.jsxs(hs,{children:[e.jsxs(ps,{children:[e.jsx(gs,{children:"‚ùå Cancelar Transacci√≥n"}),e.jsx(js,{children:"Esta acci√≥n crear√° un asiento contable de reversi√≥n. La transacci√≥n original quedar√° marcada como cancelada pero mantendr√° toda su trazabilidad."})]}),e.jsxs("div",{className:"space-y-4",children:[Ge&&e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Transacci√≥n a cancelar:"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",Ge.descripcion]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Monto:"})," $",D(Ge.monto_total)]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(Ge.created_at).toLocaleDateString("es-ES")]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"motivo-cancelacion",children:"Motivo de la Cancelaci√≥n *"}),e.jsx(as,{id:"motivo-cancelacion",placeholder:"Ej: Error en registro, cliente cancel√≥ pedido, etc.",value:Gs,onChange:s=>Nt(s.target.value),rows:3})]}),e.jsxs(Oe,{children:[e.jsx(U,{className:"h-4 w-4"}),e.jsxs(Be,{className:"text-xs",children:[e.jsx("strong",{children:"¬øQu√© suceder√°?"}),e.jsxs("ul",{className:"list-disc ml-4 mt-1 space-y-1",children:[e.jsx("li",{children:"Se crear√° un asiento de reversi√≥n autom√°ticamente"}),e.jsx("li",{children:'La transacci√≥n original se marcar√° como "cancelada"'}),e.jsx("li",{children:"Si es venta de inventario, el stock se restaurar√°"}),e.jsx("li",{children:"Ambas transacciones quedar√°n visibles para auditor√≠a"})]})]})]})]}),e.jsxs(Hs,{children:[e.jsx(O,{variant:"outline",onClick:()=>{Ys(!1),Nt(""),ft(null)},disabled:bt,children:"Cancelar"}),e.jsx(O,{variant:"destructive",onClick:Nn,disabled:bt||!Gs.trim(),children:bt?"Cancelando...":"Confirmar Cancelaci√≥n"})]})]})})]})]})};export{Zn as default};
