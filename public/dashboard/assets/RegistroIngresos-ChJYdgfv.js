import{c as bn,r as u,a as vn,f as bs,e as ts,j as e,b as Js,P as Dt,d as It,B as R,C as Tt,g as $t,h as kt,u as yn,i as wn,k as Sn,l as Cn,m as _n,n as Pn,o as Fn,p as Dn,q as In,s as Tn,D as ds,t as ms,v as us,w as xs,x as L,y as hs,S as Me,z as xa,R as De,A as U,L as j,I as z,E as Gs,F as ae,T as ha,G as pa,H as Ze,J as es,K as W,M as q,N as G,O as oe,Q as Y,U as ja,V as Ie,W as ga,X as ps,Y as Ve,Z as Re,_ as he,$ as pe,a0 as ye,a1 as je,a2 as T,a3 as ss,a4 as $n,a5 as kn,a6 as fa,a7 as js,a8 as An,a9 as Na,aa as ba,ab as va,ac as gs,ad as En,ae as Ys,af as fs,ag as ya,ah as wa,ai as Ks,aj as Mn,ak as Vn,al as Rn,am as On,an as Pt}from"./index-Bybxfnmq.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ln=bn("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),zn=m=>{const C=(m==null?void 0:m.data)??m??[];return Array.isArray(C)?C:[]},Bn=(m=10)=>{const[C,_]=u.useState([]),[w,I]=u.useState(!0),[ie,de]=u.useState(null),J=async()=>{try{I(!0),de(null);const X=await vn(`/api/transacciones/ingresos/recientes?limit=${encodeURIComponent(String(m))}`,{method:"GET"}),we=zn(X).map(Ne=>{var Ye;return{...Ne,asiento_fecha:Ne.asiento_fecha??(Array.isArray(Ne.asiento)&&Ne.asiento.length>0?((Ye=Ne.asiento[0])==null?void 0:Ye.fecha)??null:null)}});_(we)}catch(X){console.error("Error fetching transacciones recientes:",X),de((X==null?void 0:X.message)||"Error desconocido")}finally{I(!1)}};return u.useEffect(()=>{let X=!0;J();const we=window.setInterval(()=>{X&&J()},3e4);return()=>{X=!1,window.clearInterval(we)}},[m]),{transacciones:C,loading:w,error:ie,refetch:J}};function Un({value:m,onChange:C,className:_,placeholder:w="Selecciona un rango",disabled:I}){const ie=u.useMemo(()=>m!=null&&m.from?m.to?`${bs(m.from,"dd/MM/yyyy",{locale:ts})} ‚Äì ${bs(m.to,"dd/MM/yyyy",{locale:ts})}`:bs(m.from,"dd/MM/yyyy",{locale:ts}):w,[m,w]);return e.jsx("div",{className:Js("grid gap-2",_),children:e.jsxs(Dt,{children:[e.jsx(It,{asChild:!0,children:e.jsxs(R,{type:"button",variant:"outline",disabled:I,className:Js("w-full justify-start text-left font-normal",!(m!=null&&m.from)&&"text-muted-foreground"),children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"}),ie]})}),e.jsxs($t,{className:"w-auto p-0",align:"start",children:[e.jsx(kt,{initialFocus:!0,mode:"range",numberOfMonths:2,selected:m,onSelect:C,locale:ts,defaultMonth:(m==null?void 0:m.from)??new Date}),e.jsxs("div",{className:"flex items-center justify-between gap-2 border-t p-2",children:[e.jsx(R,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(void 0),children:"Limpiar"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:m!=null&&m.from&&!(m!=null&&m.to)?"Elige la fecha fin":" "})]})]})]})})}async function Te(m,C={}){const _=await fetch(m,{credentials:"include",headers:{"Content-Type":"application/json",...C.headers||{}},...C}),w=await _.json().catch(()=>({}));if(!_.ok){const I=(w==null?void 0:w.error)||(w==null?void 0:w.message)||`HTTP ${_.status}`;throw new Error(I)}return(w==null?void 0:w.data)??w}async function Ft(m,C={}){const _=(C==null?void 0:C.body)??{};try{if(m==="registrar-ingreso")return{data:await Te("/api/ingresos",{method:"POST",body:JSON.stringify(_)}),error:null};if(m==="cancelar-ingreso"){const I=_==null?void 0:_.transaccionId;return{data:await Te(`/api/ingresos/${encodeURIComponent(I)}/cancelar`,{method:"POST",body:JSON.stringify({motivoCancelacion:_==null?void 0:_.motivoCancelacion})}),error:null}}return{data:await Te(`/api/functions/${encodeURIComponent(m)}`,{method:"POST",body:JSON.stringify(_)}),error:null}}catch(w){return{data:null,error:{message:(w==null?void 0:w.message)||String(w)}}}}const Ge=m=>{if(m==null)return 0;const C=typeof m=="string"?Number(m):m;return Number.isFinite(C)?C:0},P=m=>Ge(m).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),D=(m,C)=>{const _=Ge(m);let w=_,I="";return C==="miles"?(w=_/1e3,I=" K"):C==="millones"&&(w=_/1e6,I=" M"),w.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})+I},Ns=m=>{if(!m)return m;const C=m.id??m._id,_=m.fecha??m.createdAt??m.created_at??m.updatedAt??m.updated_at,w=_?String(_):void 0,I=w?w.slice(0,10):m.created_at,ie=Ge(m.monto_total??m.montoTotal??m.total??m.monto_total),de=Ge(m.monto_descuento??m.montoDescuento??m.descuento),J=Ge(m.monto_neto??m.montoNeto??m.neto??ie-de),X=Ge(m.monto_pagado??m.montoPagado??m.pagado??J),fe=Ge(m.saldo_pendiente??m.saldoPendiente??m.pendiente??Math.max(0,J-X)),we=m.tipo_ingreso??m.tipoIngreso??m.tipo,Ne=m.metodo_pago??m.metodoPago,Ye=m.tipo_pago??m.tipoPago;return{...m,id:C,_id:m._id??C,created_at:m.created_at??I,fecha:m.fecha??w,tipo_ingreso:we,tipoIngreso:m.tipoIngreso??we,metodo_pago:Ne,metodoPago:m.metodoPago??Ne,tipo_pago:Ye,tipoPago:m.tipoPago??Ye,monto_total:ie,montoTotal:m.montoTotal??ie,total:m.total??ie,monto_descuento:de,montoDescuento:m.montoDescuento??de,monto_neto:J,montoNeto:m.montoNeto??J,neto:m.neto??J,monto_pagado:X,montoPagado:m.montoPagado??X,pagado:m.pagado??X,saldo_pendiente:fe,saldoPendiente:m.saldoPendiente??fe,pendiente:m.pendiente??fe}},ge=(m,C)=>{const _=Ns(m);return C==="brutas"?_.monto_total||0:C==="descuentos"?_.monto_descuento||0:C==="netas"&&(_.monto_neto||_.monto_total)||0},Hs=m=>{const C=(m??"").toString().slice(0,10),[_,w,I]=C.split("-").map(Number);return new Date(_,(w||1)-1,I||1)},Wn=m=>{const{x:C,y:_,width:w,height:I,name:ie,value:de,porcentaje:J}=m,fe=ie==="Efectivo"?"hsl(180 50% 55%)":"hsl(180 45% 45%)",we=w>100&&I>70;return e.jsxs("g",{children:[e.jsx("rect",{x:C,y:_,width:w,height:I,fill:fe,stroke:"#fff",strokeWidth:2}),we&&e.jsxs(e.Fragment,{children:[e.jsx("text",{x:C+w/2,y:_+I/2-20,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontWeight:"bold",fontSize:"16px",style:{userSelect:"none"},children:ie}),e.jsxs("text",{x:C+w/2,y:_+I/2+5,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:["$",D(de,"general")]}),e.jsxs("text",{x:C+w/2,y:_+I/2+25,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:[J,"%"]})]})]})},qn=({active:m,payload:C,scaleFormat:_})=>{if(m&&C&&C.length){const w=C[0].payload,I=w.name==="Efectivo";return e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-lg p-3",children:[e.jsx("p",{className:"font-bold text-foreground mb-1",children:w.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Monto: ",e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(w.value,_)]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Porcentaje: ",e.jsxs("span",{className:"font-semibold text-foreground",children:[w.porcentaje,"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2 italic",children:I?"Se registra en Efectivo (Caja)":"Se registra en Bancos"})]})}return null},Hn=()=>{const{ventasResumen:m,loading:C,refetch:_}=yn(),{transacciones:w,loading:I,refetch:ie}=Bn(1e3),de=(w??[]).map(Ns),{data:J=[]}=wn(),{data:X}=Sn(),fe=(X==null?void 0:X.cuentasFlat)||[],{data:we=[],isLoading:Ne,refetch:Ye}=Cn(),{data:Se=[],isLoading:Qs,refetch:Sa}=_n(),{data:ke=[],isLoading:Ca}=Pn(),_a=Fn(),Pa=Dn(),At=In(),Fa=Tn(),[M,Ke]=u.useState(""),[Da,Ia]=u.useState(!1),[Ta,$a]=u.useState(""),[vs,Et]=u.useState(""),[E,Mt]=u.useState(""),[be,Oe]=u.useState(""),[ys,He]=u.useState(""),[Vt,ws]=u.useState(!1),[Q,Rt]=u.useState(""),[ve,Xs]=u.useState(""),[Je,Ss]=u.useState(""),[Ce,Cs]=u.useState(""),[_e,_s]=u.useState(""),[$e,Ps]=u.useState(""),[Fs,Ot]=u.useState(""),[Pe,Lt]=u.useState(""),[Ds,Zs]=u.useState(""),[Ae,Is]=u.useState([]),[ka,as]=u.useState(!1),[v,Ts]=u.useState(null),[Qe,et]=u.useState("historico"),[ce,ns]=u.useState(""),[Z,Aa]=u.useState("diario"),[F,Ea]=u.useState("general"),[N,Ma]=u.useState("brutas"),[B,Va]=u.useState("ventas"),[me,Ra]=u.useState(new Date),[V,Oa]=u.useState(new Date),[rs,La]=u.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[os,za]=u.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[is,Ba]=u.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[O,zt]=u.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]}),[Gn,$s]=u.useState([]),[Xe,Ua]=u.useState([]),[Bt,Ut]=u.useState(""),[Wt,qt]=u.useState(""),[Wa,Gt]=u.useState(void 0);function Yt(s){const t=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),i=String(s.getDate()).padStart(2,"0");return`${t}-${r}-${i}`}function qa(s){const[t,r,i]=String(s).split("-").map(Number);return!t||!r||!i?null:new Date(t,r-1,i,0,0,0,0)}function Ga(s){const[t,r,i]=String(s).split("-").map(Number);return!t||!r||!i?null:new Date(t,r-1,i,23,59,59,999)}const ks=s=>{const t=Hs(s),r=Bt?qa(Bt):null,i=Wt?Ga(Wt):null;return!(r&&t<r||i&&t>i)},Ya=s=>{Gt(s);const t=s==null?void 0:s.from,r=s==null?void 0:s.to;Ut(t?Yt(t):""),qt(r?Yt(r):"")},[ue,Kt]=u.useState("todos"),[xe,Ht]=u.useState("todas"),[se,Jt]=u.useState(""),[cs,Ka]=u.useState("subcuenta"),[Le,As]=u.useState(null),[Ha,st]=u.useState(!1),[ne,tt]=u.useState(""),[ze,ls]=u.useState(""),[Ee,at]=u.useState("1"),[Es,nt]=u.useState(0),[rt,Ms]=u.useState(!0),[ot,it]=u.useState("0"),[Be,ct]=u.useState("monto"),[K,Vs]=u.useState([]),[Ue,lt]=u.useState(""),[Rs,dt]=u.useState(""),[Os,mt]=u.useState("1"),[ut,Qt]=u.useState("0"),[We,Ja]=u.useState("monto"),[ee,Ls]=u.useState([]),[Qa,xt]=u.useState(!1),[ht,Xt]=u.useState(""),[pt,Zt]=u.useState(""),[ea,sa]=u.useState(""),[Yn,Xa]=u.useState("4001"),[ta,aa]=u.useState(""),[Za,na]=u.useState(null);u.useState(null);const[zs,Bs]=u.useState(!1),[en,Us]=u.useState(!1),[qe,jt]=u.useState(null),[Ws,gt]=u.useState(""),[ft,ra]=u.useState(!1),[sn,qs]=u.useState(!1),[tn,oa]=u.useState(null),[Nt,bt]=u.useState(""),[vt,yt]=u.useState(""),[ia,wt]=u.useState(""),[an,St]=u.useState(null),[ca,Ct]=u.useState(null),[la,da]=u.useState(""),Fe=we||[],nn=s=>{var r;tt(s);const t=Fe.find(i=>i.id===s);if(t){const i=t.precio_venta,n=i&&i>0?i.toString():((r=t.costo_unitario)==null?void 0:r.toString())||"0",a=i&&i>0;Ms(a),ls(n),nt(t.cantidad_stock||0),He(`Venta de ${t.nombre}`);const d=((i&&i>0?i:t.costo_unitario||0)*parseFloat(Ee)).toFixed(2);Oe(d)}},rn=s=>{if(ls(s),ne&&s){const t=(parseFloat(s)*parseFloat(Ee||"1")).toFixed(2);Oe(t)}},on=()=>{if(!Ue)return;const s=Se.find(d=>d.id===Ue);if(!s)return;const t=parseFloat(Os)||1,r=parseFloat(ut)||0,i=s.precio*t,n=We==="porcentaje"?i*(r/100):r,a=Math.max(0,i-n),o=ee.findIndex(d=>d.id===Ue);if(o!==-1){const d=[...ee];d[o].cantidad+=t,d[o].descuento+=n;const x=d[o].precio*d[o].cantidad;d[o].subtotal=Math.max(0,x-d[o].descuento),Ls(d)}else Ls([...ee,{id:s.id,nombre:s.nombre,precio:s.precio,cantidad:t,descuento:n,subtotal:a,imagen_url:s.imagen_url}]);lt(""),mt("1"),dt(""),Qt("0")},cn=s=>{Ls(ee.filter(t=>t.id!==s))},ln=()=>{if(!ne)return;const s=Fe.find(x=>x.id===ne);if(!s)return;const t=parseFloat(Ee)||1,r=parseFloat(ze)||0,i=parseFloat(ot)||0,n=r*t,a=Be==="porcentaje"?n*(i/100):i,o=Math.max(0,n-a),d=K.findIndex(x=>x.id===ne);if(d!==-1){const x=[...K];x[d].cantidad+=t,x[d].descuento+=a;const h=x[d].precioUnitario*x[d].cantidad;x[d].subtotal=Math.max(0,h-x[d].descuento),Vs(x)}else Vs([...K,{id:ne,nombre:s.nombre,precioUnitario:r,cantidad:t,descuento:a,subtotal:o,stockDisponible:s.cantidad_stock||0,costoUnitario:s.costo_unitario||0,imagen_url:s.imagen_url}]);tt(""),at("1"),ls(""),it("0"),ct("monto"),nt(0),Ms(!0),ae({title:"‚úÖ Producto agregado",description:`${s.nombre} agregado a la venta`})},dn=s=>{Vs(K.filter(t=>t.id!==s)),ae({title:"Producto eliminado",description:"El producto ha sido removido de la venta"})};u.useEffect(()=>{if(M==="precargados"&&ee.length>0){const s=ee.reduce((t,r)=>t+r.subtotal,0).toFixed(2);Oe(s),He(`Venta de ${ee.length} producto(s)`)}},[ee,M]),u.useEffect(()=>{if(M==="inventariados"&&K.length>0){const s=K.reduce((t,r)=>t+r.subtotal,0).toFixed(2);Oe(s),He(`Venta de ${K.length} producto(s) de inventario`)}},[K,M]);const mn=s=>{lt(s);const t=Se.find(r=>r.id===s);t&&dt(t.precio.toString())},ma=()=>{const s=[];return M||s.push("Tipo de Ingreso"),M==="precargados"?ee.length===0&&s.push("Debe agregar al menos un producto"):M==="inventariados"?K.length===0&&s.push("Debe agregar al menos un producto del inventario"):(M==="general"||M==="otros")&&(ys.trim()||s.push("Descripci√≥n")),M!=="precargados"&&M!=="inventariados"&&(!be||parseFloat(be)<=0)&&s.push("Monto Total"),(E==="credito"||E==="parcial")&&(Q||s.push("Tipo de Cliente"),Q==="recurrente"&&!ve&&s.push("Cliente Seleccionado"),Q==="nuevo"&&(Je.trim()||s.push("Nombre del Cliente"),Ce.trim()||s.push("Tel√©fono del Cliente"),_e.trim()||s.push("Email del Cliente")),Fs||s.push("Fecha de Vencimiento"),E==="parcial"&&((!Pe||parseFloat(Pe)<=0)&&s.push("Monto Abonado"),be&&Pe&&parseFloat(Pe)>=parseFloat(be)&&s.push("Monto Abonado debe ser menor al total"))),(E==="contado"||E==="parcial")&&!vs&&s.push("M√©todo de Pago"),E||s.push("Tipo de Pago"),s},H=s=>ma().includes(s),un=(s,t,r)=>{const i=[];return!ke||ke.length===0||ke.forEach(n=>{n.telefono&&s&&n.telefono.trim()===s.trim()&&i.push(`El tel√©fono ${s} ya est√° registrado para el cliente "${n.nombre}"`),n.email&&t&&n.email.trim().toLowerCase()===t.trim().toLowerCase()&&i.push(`El correo ${t} ya est√° registrado para el cliente "${n.nombre}"`),n.rfc&&r&&n.rfc.trim().toUpperCase()===r.trim().toUpperCase()&&i.push(`El RFC ${r} ya est√° registrado para el cliente "${n.nombre}"`)}),i};u.useEffect(()=>{if(Q==="nuevo"&&(Ce||_e||$e)){const s=un(Ce,_e,$e);Is(s)}else Is([])},[Ce,_e,$e,Q,ke]),u.useEffect(()=>{(async()=>{var t;try{const r=await Te("/api/ingresos/asientos-directos"),i=(r==null?void 0:r.asientos)??((t=r==null?void 0:r.data)==null?void 0:t.asientos)??r??[],n=null;if(!i)return;const a=i.filter(o=>o.detalle_asientos.some(d=>d.cuenta_codigo.startsWith("4")&&d.cuenta_codigo!=="4003"&&Number(d.haber)>0));Ua(a)}catch(r){console.error("Error al cargar asientos directos:",r)}})()},[]),u.useEffect(()=>{(async()=>{var t,r;try{let i,n;Z==="diario"?(i=new Date(me),i.setHours(0,0,0,0),n=new Date(me),n.setHours(23,59,59,999)):Z==="mensual"?(i=new Date(V.getFullYear(),V.getMonth(),1),n=new Date(V.getFullYear(),V.getMonth()+1,0,23,59,59,999)):(i=new Date(new Date().getFullYear(),0,1),n=new Date(new Date().getFullYear(),11,31,23,59,59,999));const a=await Te(`/api/ingresos/asientos?start=${encodeURIComponent(i.toISOString().split("T")[0])}&end=${encodeURIComponent(n.toISOString().split("T")[0])}`),o=(a==null?void 0:a.asientos)??((t=a==null?void 0:a.data)==null?void 0:t.asientos)??[],d=(a==null?void 0:a.detalles)??((r=a==null?void 0:a.data)==null?void 0:r.detalles)??[],x=null;if(!o||o.length===0){zt({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]});return}const h=o.map(b=>b.id);let c=0,l=0,p=0;const g={};o.forEach(b=>{const f=d.filter(k=>k.asiento_id===b.id),S=Hs(b.fecha);let $;Z==="diario"?$="Hoy":Z==="mensual"?$=`D√≠a ${S.getDate()}`:$=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][S.getMonth()],g[$]||(g[$]={ventasBrutas:0,descuentos:0,otrosIngresos:0}),f.forEach(k=>{const A=k.debe||0,te=k.haber||0,le=k.cuenta_codigo;if(B==="ventas"){if(le==="4001"){const re=te-A;c+=re,g[$].ventasBrutas+=re}if(le==="4003"){const re=A-te;l+=re,g[$].descuentos+=re}}else if(le.startsWith("4")&&le!=="4001"&&le!=="4003"){const re=te-A;p+=re,g[$].otrosIngresos+=re}})});let y=[];if(Z==="diario"){const b=g.Hoy||{ventasBrutas:0,descuentos:0,otrosIngresos:0};y=[{periodo:"Hoy",ventasBrutas:b.ventasBrutas,descuentos:b.descuentos,ventasNetas:b.ventasBrutas-b.descuentos,otrosIngresos:b.otrosIngresos}]}else if(Z==="mensual"){const b=new Date(V.getFullYear(),V.getMonth()+1,0).getDate();y=Array.from({length:b},(f,S)=>{const k=`D√≠a ${S+1}`,A=g[k]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:k,ventasBrutas:A.ventasBrutas,descuentos:A.descuentos,ventasNetas:A.ventasBrutas-A.descuentos,otrosIngresos:A.otrosIngresos}})}else y=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"].map(f=>{const S=g[f]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:f,ventasBrutas:S.ventasBrutas,descuentos:S.descuentos,ventasNetas:S.ventasBrutas-S.descuentos,otrosIngresos:S.otrosIngresos}});zt({ventasBrutas:c,descuentos:l,ventasNetas:c-l,otrosIngresos:p,detallesPorPeriodo:y})}catch(i){console.error("Error calculando anal√≠ticas desde asientos:",i)}})()},[Z,me,V,B]),u.useEffect(()=>{(async()=>{try{const r=async d=>{var k;const x=new Date;let h,c;if(d==="dia")h=me.toISOString().split("T")[0],c=h;else if(d==="mes"){const A=V.getMonth(),te=V.getFullYear(),le=new Date(te,A,1),re=new Date(te,A+1,0);h=le.toISOString().split("T")[0],c=re.toISOString().split("T")[0]}else{const A=x.getFullYear();h=`${A}-01-01`,c=`${A}-12-31`}const l=await Te(`/api/ingresos/detalles?start=${encodeURIComponent(h)}&end=${encodeURIComponent(c)}`),p=(l==null?void 0:l.detalles)??((k=l==null?void 0:l.data)==null?void 0:k.detalles)??l??[],g=null;let y=0,b=0,f=0;(p||[]).forEach(A=>{const te=Number(A.debe)||0,le=Number(A.haber)||0,re=A.cuenta_codigo;re==="4001"?y+=le-te:re==="4003"?b+=te-le:re!=null&&re.startsWith("4")&&(f+=le-te)});const S=y-b,$=S+f;return{ventasBrutas:y,descuentos:b,ventasNetas:S,otrosIngresos:f,totalIngresos:$}},i=async()=>{var d;try{let x,h=new Date;Z==="diario"?(x=new Date(me),x.setHours(0,0,0,0),h=new Date(me),h.setHours(23,59,59,999)):Z==="mensual"?(x=new Date(V.getFullYear(),V.getMonth(),1),h=new Date(V.getFullYear(),V.getMonth()+1,0,23,59,59,999)):(x=new Date(V.getFullYear(),0,1),h=new Date(V.getFullYear(),11,31,23,59,59,999));const c=await Te(`/api/inventario/movimientos?tipo=venta&start=${encodeURIComponent(x.toISOString())}&end=${encodeURIComponent(h.toISOString())}`),l=(c==null?void 0:c.movimientos)??((d=c==null?void 0:c.data)==null?void 0:d.movimientos)??c??[],p=null;$s(l||[])}catch(x){console.error("Error en cargarMovimientosInventario:",x),$s([])}},[n,a,o]=await Promise.all([r("dia"),r("mes"),r("ano")]);La(n),za(a),Ba(o)}catch(r){console.error("Error calculando totales:",r)}})(),(async()=>{var r;try{let i,n=new Date;Z==="diario"?(i=new Date(me),i.setHours(0,0,0,0),n=new Date(me),n.setHours(23,59,59,999)):Z==="mensual"?(i=new Date(V.getFullYear(),V.getMonth(),1),n=new Date(V.getFullYear(),V.getMonth()+1,0,23,59,59,999)):(i=new Date(V.getFullYear(),0,1),n=new Date(V.getFullYear(),11,31,23,59,59,999));const a=await Te(`/api/inventario/movimientos?tipo=venta&start=${encodeURIComponent(i.toISOString())}&end=${encodeURIComponent(n.toISOString())}`),o=(a==null?void 0:a.movimientos)??((r=a==null?void 0:a.data)==null?void 0:r.movimientos)??a??[],d=null;$s(o||[])}catch(i){console.error("Error en loadMovimientos:",i),$s([])}})()},[me,V,Z,w]);const xn=async s=>{var r,i;const t=String(s??"").trim();if(st(!0),As(null),!t||t==="undefined"||t==="null"){st(!1);return}try{const n=await Te(`/api/asientos/by-transaccion?source=ingreso&id=${encodeURIComponent(t)}`),a=(n==null?void 0:n.asiento)??((r=n==null?void 0:n.data)==null?void 0:r.asiento)??n??null;As(a)}catch(n){const a=String((n==null?void 0:n.message)??"");(n==null?void 0:n.status)===404||((i=n==null?void 0:n.response)==null?void 0:i.status)===404||a.includes("404")||(console.error("Error en loadAsientosContables:",n),ae({title:"Error",description:"Error inesperado al cargar asientos",variant:"destructive"})),As(null)}finally{st(!1)}},hn=async()=>{var t;const s=ma();if(s.length>0){ae({title:"‚ö†Ô∏è Campos requeridos faltantes",description:`Debes completar: ${s.join(", ")}`,variant:"destructive"});return}if(M==="inventariados"){if(K.length===0){ae({title:"‚ö†Ô∏è No hay productos",description:"Debes agregar al menos un producto del inventario a la venta",variant:"destructive"});return}for(const r of K)if(r.cantidad>r.stockDisponible){const i=Fe.find(n=>n.id===r.id);Ts({productName:r.nombre,requested:r.cantidad,available:r.stockDisponible,costoPorUnidad:(i==null?void 0:i.costo_unitario)||0,costoTotal:((i==null?void 0:i.costo_unitario)||0)*r.cantidad}),as(!0);return}await _t();return}if(M==="inventariados"&&ne){const r=parseFloat(Ee||"1");if(r>Es){const i=Fe.find(d=>d.id===ne);let n=(i==null?void 0:i.costo_unitario)||0;if(n===0){const d=await Te(`/api/inventario/productos/${encodeURIComponent(ne)}/movimientos?tipo=compra`),x=(d==null?void 0:d.movimientos)??((t=d==null?void 0:d.data)==null?void 0:t.movimientos)??d??[];if(x&&x.length>0){let h=0,c=0;for(const l of x)l.costo_unitario>0&&l.cantidad>0&&(h+=l.costo_unitario*l.cantidad,c+=l.cantidad);c>0&&(n=h/c)}}const a=r-Es,o=n*a;Ts({productName:(i==null?void 0:i.nombre)||"Producto",requested:r,available:Es,costoPorUnidad:n,costoTotal:o}),as(!0);return}}Q==="nuevo"&&Ae.length>0&&!confirm(`Se detectaron posibles duplicados:

${Ae.join(`
`)}

¬øDeseas continuar registrando este cliente de todas formas?`)||await _t()},_t=async()=>{ws(!0);try{let s=null;if(Q==="nuevo"&&Je.trim())try{s=(await Fa.mutateAsync({nombre:Je.trim(),email:_e.trim()||void 0,telefono:Ce.trim()||void 0,rfc:$e.trim()||void 0})).id}catch(h){console.error("Error creating client:",h),ae({title:"Error al crear cliente",description:"No se pudo crear el cliente nuevo",variant:"destructive"}),ws(!1);return}else Q==="recurrente"&&ve&&(s=ve);const t=Fe.find(h=>h.id===ne);let r=ys,i=Number(be||"0"),n=null,a=0;if(M==="precargados"&&ee.length>0){const h=Se.find(p=>p.id===ee[0].id);n=(h==null?void 0:h.subcuenta_id)||null;const c=ee.reduce((p,g)=>p+g.precio*g.cantidad,0),l=ee.reduce((p,g)=>p+g.descuento,0);i=c,a=l,r=`Venta: ${ee.map(p=>`${p.nombre} (x${p.cantidad})`).join(", ")}`}else M==="inventariados"&&(r="Venta de productos inventariados",i=0,n=null);M!=="precargados"&&(a=Da?Number(Ta||"0"):0);const o=Math.max(0,Number((i-a).toFixed(2)));let d=0,x=0;if(E==="contado"?(d=o,x=0):E==="parcial"?(d=Number(Pe||"0"),x=Math.max(0,o-d)):E==="credito"&&(d=0,x=o),M==="inventariados"&&K.length>0){const h=K.reduce((y,b)=>y+b.precioUnitario*b.cantidad,0),c=K.reduce((y,b)=>y+b.descuento,0),l=h-c;let p=0,g=0;E==="contado"?(p=l,g=0):E==="parcial"?(p=Number(Pe||"0"),g=Math.max(0,l-p)):E==="credito"&&(p=0,g=l);for(const y of K){const b=Fe.find(le=>le.id===y.id);if(!b)continue;const f=K.length===1?`Venta de ${y.nombre}`:`Venta m√∫ltiple (${K.length} productos): ${y.nombre}`,S=y.subtotal/l,$=p*S,k=g*S,{data:A,error:te}=await Ft("registrar-ingreso",{body:{tipoIngreso:"inventariados",descripcion:f,montoTotal:y.precioUnitario*y.cantidad,montoDescuento:y.descuento,cuentaPrincipalCodigo:"4001",subcuentaId:b.subcuenta_id||null,metodoPago:vs,tipoPago:E,montoPagado:$,montoPendiente:k,clienteNombre:Je.trim()||null,clienteTelefono:Ce.trim()||null,clienteEmail:_e.trim()||null,clienteRFC:$e.trim()||null,clienteId:s,fechaVencimiento:Fs||null,comentarios:Ds.trim()||null,productoId:y.id,cantidadVendida:y.cantidad,precioVenta:y.precioUnitario,costoPersonalizado:Qe==="personalizado"&&ce?parseFloat(ce):void 0}});if(te)throw te}ae({title:"‚úÖ Venta registrada exitosamente",description:`Se registraron ${K.length} productos del inventario`,duration:5e3})}else{if(!r||i<=0){ae({title:"‚ö†Ô∏è Datos incompletos",description:"Selecciona un producto v√°lido o ingresa una descripci√≥n y monto.",variant:"destructive"}),ws(!1);return}const{data:h,error:c}=await Ft("registrar-ingreso",{body:{tipoIngreso:M,descripcion:r,montoTotal:i,montoDescuento:a,cuentaPrincipalCodigo:M==="otros"?"4102":"4001",subcuentaId:n||void 0,metodoPago:vs,tipoPago:E,montoPagado:d,montoPendiente:x,clienteNombre:Je.trim()||null,clienteTelefono:Ce.trim()||null,clienteEmail:_e.trim()||null,clienteRFC:$e.trim()||null,clienteId:s,fechaVencimiento:Fs||null,comentarios:Ds.trim()||null,...M==="inventariados"&&t?{productoId:t.id,cantidadVendida:Number(Ee||"1"),precioVenta:Number(ze||"0"),costoPersonalizado:Qe==="personalizado"&&ce?Number(ce):void 0}:{}}});if(c)throw c;ae({title:"Ingreso registrado",description:`Asiento ${h.numeroAsiento} creado correctamente`})}await Promise.all([_(),ie()]),M==="inventariados"&&window.location.reload(),Ke(""),He(""),Oe(""),$a(""),Ia(!1),Et(""),Mt(""),Rt(""),Xs(""),Ss(""),Cs(""),_s(""),Ps(""),Ot(""),Lt(""),Zs(""),Is([]),lt(""),dt(""),mt("1"),Ls([]),tt(""),ls(""),at("1"),nt(0),Ms(!0),Vs([]),it("0"),ct("monto")}catch(s){ae({title:"Error",description:s.message||"Error al registrar el ingreso",variant:"destructive"})}finally{ws(!1)}},pn=async()=>{if(!qe||!Ws.trim()){ae({title:"‚ö†Ô∏è Motivo requerido",description:"Debes ingresar el motivo de la cancelaci√≥n",variant:"destructive"});return}ra(!0);try{console.log("Cancelando transacci√≥n:",qe.id);const{data:s,error:t}=await Ft("cancelar-ingreso",{body:{transaccionId:qe.id,motivoCancelacion:Ws.trim()}});if(console.log("Respuesta de edge function:",{data:s,error:t}),t)throw console.error("Error de edge function:",t),new Error(t.message||JSON.stringify(t));if(s!=null&&s.error)throw console.error("Error en data:",s),new Error(s.error);ae({title:"‚úì Transacci√≥n cancelada",description:`Asiento de reversi√≥n ${(s==null?void 0:s.numeroAsientoReversion)||"creado"} correctamente`}),await Promise.all([_(),ie()]),gt(""),jt(null),Us(!1)}catch(s){console.error("Error completo al cancelar:",s),ae({title:"‚ùå Error al cancelar",description:(s==null?void 0:s.message)||(s==null?void 0:s.toString())||"No se pudo cancelar la transacci√≥n",variant:"destructive"})}finally{ra(!1)}},jn=s=>{switch(s){case"precargados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ve,{children:[e.jsx(L,{className:"h-4 w-4"}),e.jsxs(Re,{children:[e.jsx("strong",{children:"Recordatorio:"}),' Para registrar ventas de productos precargados, primero debes agregar los productos al cat√°logo desde la pesta√±a "Cat√°logo de Productos".']})]}),e.jsxs(W,{className:"bg-muted/50",children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-base",children:"Agregar Productos a la Venta"})}),e.jsxs(Y,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"producto-precargado",children:"Seleccionar Producto"}),e.jsxs(he,{value:Ue,onValueChange:mn,children:[e.jsx(pe,{children:e.jsx(ye,{placeholder:Qs?"Cargando productos...":"Seleccionar producto del cat√°logo"})}),e.jsx(je,{className:"max-h-80 z-50 bg-background border border-border w-full",children:Qs?e.jsx(T,{value:"loading",disabled:!0,children:"Cargando productos..."}):Se.length===0?e.jsx(T,{value:"empty",disabled:!0,children:"No hay productos de servicios registrados"}):Se.map(t=>e.jsx(T,{value:t.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate mb-1",children:t.nombre}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",P(t.precio)]})]})]})},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cantidad",children:"Cantidad"}),e.jsx(z,{id:"cantidad",type:"number",placeholder:"1",min:"1",value:Os,onChange:t=>mt(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"precio-unitario",children:"Precio Unitario"}),e.jsx(z,{id:"precio-unitario",type:"number",placeholder:"0.00",value:Rs,readOnly:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"descuento-producto",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(De,{value:We,onValueChange:t=>Ja(t),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"monto",id:"descuento-monto"}),e.jsx(j,{htmlFor:"descuento-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"porcentaje",id:"descuento-porcentaje"}),e.jsx(j,{htmlFor:"descuento-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(z,{id:"descuento-producto",type:"number",placeholder:We==="porcentaje"?"0":"0.00",min:"0",max:We==="porcentaje"?"100":void 0,step:We==="porcentaje"?"1":"0.01",value:ut,onChange:t=>Qt(t.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:We==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Subtotal con Descuento"}),e.jsx(z,{type:"text",value:Ue&&Rs?(()=>{const t=parseFloat(Rs)*parseFloat(Os||"1"),r=parseFloat(ut||"0"),i=We==="porcentaje"?Math.max(0,t-t*r/100):Math.max(0,t-r);return`$${P(i)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(R,{type:"button",onClick:on,disabled:!Ue,className:"w-full",variant:"secondary",children:[e.jsx(Pt,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),ee.length>0&&e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsxs(G,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",ee.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",P(ee.reduce((t,r)=>t+r.subtotal,0))]})]})}),e.jsx(Y,{children:e.jsx("div",{className:"space-y-2",children:ee.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[t.cantidad," x $",P(t.precio)," = $",P(t.cantidad*t.precio)]}),t.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",P(t.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",P(t.subtotal)]})]})]})]}),e.jsx(R,{type:"button",variant:"ghost",size:"sm",onClick:()=>cn(t.id),className:"text-destructive hover:text-destructive",children:e.jsx(L,{className:"h-4 w-4"})})]},`${t.id}-${r}`))})})]}),H("Debe agregar al menos un producto")&&e.jsxs(Ve,{variant:"destructive",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(Re,{children:"Debes agregar al menos un producto a la venta"})]})]});case"inventariados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ve,{children:[e.jsx(L,{className:"h-4 w-4"}),e.jsxs(Re,{children:[e.jsx("strong",{children:"Ventas desde Inventario:"})," Selecciona productos, aplica descuentos opcionales y agr√©galos a la venta. Si vendes m√°s de lo disponible, se te pedir√° confirmar la sobreventa."]})]}),e.jsxs(W,{className:"bg-muted/50",children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-base",children:"Agregar Productos del Inventario"})}),e.jsxs(Y,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"producto-inventario",children:"Seleccionar Producto"}),e.jsxs(he,{value:ne,onValueChange:nn,children:[e.jsx(pe,{children:e.jsx(ye,{placeholder:Ne?"Cargando inventario...":"Seleccionar producto del inventario"})}),e.jsx(je,{className:"max-h-80 z-50 bg-background border border-border w-full",children:Ne?e.jsx(T,{value:"loading",disabled:!0,children:"Cargando inventario..."}):Fe.length===0?e.jsx(T,{value:"empty",disabled:!0,children:"No hay productos con stock disponible"}):Fe.map(t=>e.jsx(T,{value:t.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.nombre}),e.jsxs("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full flex-shrink-0 ml-2",children:["Stock: ",t.cantidad_stock||0]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Costo: $",t.costo_unitario||0]}),t.precio_venta&&t.precio_venta>0?e.jsxs("span",{className:"text-xs text-green-600 font-medium",children:["Venta: $",t.precio_venta]}):e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"‚ö†Ô∏è Sin precio"})]})]})]})},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cantidad-inv",children:"Cantidad a Vender"}),e.jsx(z,{id:"cantidad-inv",type:"number",min:"1",value:Ee,onChange:t=>at(t.target.value)}),ne&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Stock disponible: ",Es," unidades"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"precio-inv",children:"Precio Unitario"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(De,{value:rt?"registrado":"personalizado",onValueChange:t=>{const r=t==="registrado";if(Ms(r),r&&ne){const i=Fe.find(n=>n.id===ne);if(i){const n=i.precio_venta||i.costo_unitario||0;ls(n.toString())}}},className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"registrado",id:"precio-registrado"}),e.jsx(j,{htmlFor:"precio-registrado",className:"text-sm cursor-pointer",children:"Precio registrado"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"personalizado",id:"precio-personalizado"}),e.jsx(j,{htmlFor:"precio-personalizado",className:"text-sm cursor-pointer",children:"Personalizado"})]})]}),e.jsx(z,{id:"precio-inv",type:"number",step:"0.01",min:"0",value:ze,onChange:t=>rn(t.target.value),readOnly:rt,className:rt?"bg-muted":""})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"descuento-inv",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(De,{value:Be,onValueChange:t=>ct(t),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"monto",id:"descuento-inv-monto"}),e.jsx(j,{htmlFor:"descuento-inv-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"porcentaje",id:"descuento-inv-porcentaje"}),e.jsx(j,{htmlFor:"descuento-inv-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(z,{id:"descuento-inv",type:"number",placeholder:Be==="porcentaje"?"0":"0.00",min:"0",max:Be==="porcentaje"?"100":void 0,step:Be==="porcentaje"?"1":"0.01",value:ot,onChange:t=>it(t.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Be==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Subtotal con Descuento"}),e.jsx(z,{type:"text",value:ne&&ze?(()=>{const t=parseFloat(ze)*parseFloat(Ee||"1"),r=parseFloat(ot||"0"),i=Be==="porcentaje"?Math.max(0,t-t*r/100):Math.max(0,t-r);return`$${P(i)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(R,{type:"button",onClick:ln,disabled:!ne||!ze,className:"w-full",variant:"secondary",children:[e.jsx(Pt,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),K.length>0&&e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsxs(G,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",K.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",P(K.reduce((t,r)=>t+r.subtotal,0))]})]})}),e.jsx(Y,{children:e.jsx("div",{className:"space-y-2",children:K.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[t.cantidad," x $",P(t.precioUnitario)," = $",P(t.cantidad*t.precioUnitario)]}),t.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",P(t.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",P(t.subtotal)]}),e.jsxs("span",{className:"text-xs",children:["Stock disponible: ",t.stockDisponible]})]})]})]}),e.jsx(R,{type:"button",variant:"ghost",size:"sm",onClick:()=>dn(t.id),className:"text-destructive hover:text-destructive",children:e.jsx(L,{className:"h-4 w-4"})})]},`${t.id}-${r}`))})})]})]});case"general":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"descripcion-general",children:"Descripci√≥n del Ingreso"}),H("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(z,{id:"descripcion-general",placeholder:"Ej: Servicio de consultor√≠a",value:ys,onChange:t=>He(t.target.value),className:H("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cuenta-contable",children:"Cuenta Contable"}),e.jsxs(he,{defaultValue:"4001",children:[e.jsx(pe,{children:e.jsx(ye,{placeholder:"4001 - Ventas"})}),e.jsx(je,{children:e.jsx(T,{value:"4001",children:"4001 - Ventas"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"subcuenta",children:"Subcuenta (Opcional)"}),e.jsxs(he,{children:[e.jsx(pe,{children:e.jsx(ye,{placeholder:"Seleccionar subcuenta"})}),e.jsx(je,{children:e.jsx(T,{value:"sub1",children:"Subcuenta ejemplo"})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"monto-general",children:"Monto"}),H("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(z,{id:"monto-general",type:"number",placeholder:"0.00",value:be,onChange:t=>Oe(t.target.value),className:H("Monto Total")?"border-destructive":""})]})]});case"otros":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ve,{children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(Re,{children:"Este ingreso se ligar√° a la cuenta 4102 - Otros Productos."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"descripcion-otros",children:"Descripci√≥n del Ingreso Extraordinario"}),H("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(ss,{id:"descripcion-otros",placeholder:"Ej: Venta extraordinaria de equipo usado, donaci√≥n recibida, etc.",value:ys,onChange:t=>He(t.target.value),className:H("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"monto-otros",children:"Monto"}),H("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(z,{id:"monto-otros",type:"number",placeholder:"0.00",value:be,onChange:t=>Oe(t.target.value),className:H("Monto Total")?"border-destructive":""})]})]});default:return null}},gn=async()=>{if(!ht.trim()||!pt.trim()){ae({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}Bs(!0);try{await _a.mutateAsync({nombre:ht.trim(),precio:parseFloat(pt),descripcion:ea.trim()||void 0,subcuentaId:ta||void 0,imagen:Za||void 0}),Xt(""),Zt(""),sa(""),Xa("4001"),aa(""),na(null),xt(!1)}catch{}finally{Bs(!1)}},ua=s=>{var t;oa(s),bt(s.nombre),yt(((t=s.precio)==null?void 0:t.toString())||""),wt(s.descripcion||""),Ct(s.imagen_url||null),St(null),da(s.subcuenta_id||""),qs(!0)},fn=s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];if(t){St(t);const i=new FileReader;i.onloadend=()=>{Ct(i.result)},i.readAsDataURL(t)}},Nn=async()=>{if(!Nt.trim()||!vt.trim()){ae({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}Bs(!0);try{await Pa.mutateAsync({id:tn.id,nombre:Nt.trim(),precio:parseFloat(vt),descripcion:ia.trim()||void 0,imagen:an||void 0,subcuentaId:la||null}),qs(!1),oa(null),bt(""),yt(""),wt(""),St(null),Ct(null)}catch{}finally{Bs(!1)}};return e.jsxs("div",{className:"h-full overflow-hidden flex flex-col",children:[e.jsx(ds,{open:ka,onOpenChange:as,children:e.jsxs(ms,{children:[e.jsxs(us,{children:[e.jsxs(xs,{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(L,{className:"h-5 w-5"}),"Advertencia: Inventario Insuficiente"]}),e.jsxs(hs,{className:"space-y-3 pt-4",children:[e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-950/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx("p",{className:"font-medium mb-2",children:"Est√°s a punto de vender un producto sin suficiente inventario:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Producto:"}),e.jsx("span",{className:"font-medium",children:v==null?void 0:v.productName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cantidad solicitada:"}),e.jsx("span",{className:"font-medium",children:v==null?void 0:v.requested})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Stock disponible:"}),e.jsx("span",{className:"font-medium",children:v==null?void 0:v.available})]}),e.jsx(Me,{}),e.jsxs("div",{className:"flex justify-between text-orange-600",children:[e.jsx("span",{className:"font-medium",children:"Faltante:"}),e.jsx("span",{className:"font-bold",children:((v==null?void 0:v.requested)||0)-((v==null?void 0:v.available)||0)})]})]})]}),(v==null?void 0:v.costoPorUnidad)&&v.costoPorUnidad>0&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border-2 border-blue-300 dark:border-blue-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(xa,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),e.jsx("p",{className:"font-bold text-blue-700 dark:text-blue-300",children:"üìä Costo Promedio Hist√≥rico"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Costo promedio calculado:"}),e.jsxs("span",{className:"text-lg font-bold text-blue-700 dark:text-blue-300",children:["$",P(v.costoPorUnidad)," por unidad"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Este costo se calcul√≥ autom√°ticamente del promedio ponderado de todas tus compras anteriores de este producto. Puedes usar este costo sugerido o ingresar uno personalizado si conoces el costo real de esta venta."})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"font-medium mb-3 text-blue-700 dark:text-blue-400",children:"Impacto en el inventario:"}),v!=null&&v.costoPorUnidad&&v.costoPorUnidad>0?e.jsxs(e.Fragment,{children:[e.jsxs(De,{value:Qe,onValueChange:s=>{et(s),s==="historico"&&ns("")},className:"space-y-3 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"historico",id:"costo-historico"}),e.jsxs(j,{htmlFor:"costo-historico",className:"text-sm cursor-pointer",children:["Usar costo hist√≥rico: ",e.jsxs("strong",{className:"text-blue-700 dark:text-blue-400",children:["$",P(v.costoPorUnidad)]})," por unidad"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"personalizado",id:"costo-personalizado"}),e.jsx(j,{htmlFor:"costo-personalizado",className:"text-sm cursor-pointer",children:"Ingresar costo personalizado"})]})]}),Qe==="personalizado"&&e.jsxs("div",{className:"mb-3",children:[e.jsx(j,{htmlFor:"costo-custom",className:"text-xs",children:"Costo unitario personalizado"}),e.jsx(z,{id:"costo-custom",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:ce,onChange:s=>ns(s.target.value),className:"mt-1"})]}),e.jsx(Me,{className:"my-3"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Costo por unidad aplicado:"}),e.jsxs("span",{className:"font-medium",children:["$",P(Qe==="personalizado"&&ce?ce:v.costoPorUnidad)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",P((Qe==="personalizado"&&ce?Number(ce):v.costoPorUnidad)*(((v==null?void 0:v.requested)||0)-((v==null?void 0:v.available)||0)))]})]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"‚ö†Ô∏è Este producto no tiene costo hist√≥rico registrado."}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"costo-requerido",className:"text-xs",children:"Ingresa el costo unitario para esta transacci√≥n"}),e.jsx(z,{id:"costo-requerido",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:ce,onChange:s=>ns(s.target.value),className:"mt-1"})]}),ce&&Number(ce)>0&&e.jsxs(e.Fragment,{children:[e.jsx(Me,{}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",P(Number(ce)*(((v==null?void 0:v.requested)||0)-((v==null?void 0:v.available)||0)))]})]})]})]})]}),e.jsxs("p",{className:"text-sm",children:["Si contin√∫as, el inventario quedar√° en ",e.jsxs("strong",{className:"text-destructive",children:["negativo (",((v==null?void 0:v.available)||0)-((v==null?void 0:v.requested)||0)," unidades)"]}),". Esto se reflejar√° en tu control de inventario con el valor mostrado arriba."]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"¬øDeseas continuar con la venta de todas formas?"})]})]}),e.jsxs(Gs,{className:"gap-2 sm:gap-0",children:[e.jsx(R,{variant:"outline",onClick:()=>{as(!1),Ts(null),et("historico"),ns("")},children:"Cancelar"}),e.jsxs(R,{variant:"destructive",onClick:async()=>{if((!(v!=null&&v.costoPorUnidad)||v.costoPorUnidad===0)&&(!ce||Number(ce)<=0)){ae({title:"Costo requerido",description:"Debes ingresar un costo unitario para continuar",variant:"destructive"});return}as(!1),Ts(null),await _t(),et("historico"),ns("")},children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Continuar con la Venta"]})]})]})}),e.jsxs("div",{className:"p-6 border-b bg-background",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Registro de Ingresos"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Registra ventas, gestiona cat√°logos y analiza ingresos de la empresa"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[e.jsxs(ha,{defaultValue:"registro",className:"w-full",children:[e.jsxs(pa,{className:"grid w-full grid-cols-4",children:[e.jsx(Ze,{value:"registro",children:"Registro de Ingresos"}),e.jsx(Ze,{value:"resumen",children:"Resumen de Ventas"}),e.jsx(Ze,{value:"analitica",children:"Anal√≠tica de Ventas"}),e.jsx(Ze,{value:"catalogo",children:"Cat√°logo de Productos"})]}),e.jsx(es,{value:"registro",className:"mt-6 space-y-6",children:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Nuevo Registro de Ingreso"}),e.jsx(oe,{children:"Selecciona el tipo de ingreso y completa la informaci√≥n requerida"})]}),e.jsxs(Y,{className:"space-y-6",children:[!M&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(j,{className:"text-base font-semibold",children:"Selecciona el tipo de ingreso que deseas registrar"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6",children:[e.jsxs("button",{type:"button",onClick:()=>Ke("precargados"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(ja,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Productos Precargados"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Del cat√°logo de servicios/productos"})]}),e.jsxs("button",{type:"button",onClick:()=>Ke("inventariados"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Ie,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Productos Inventariados"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Del inventario registrado"})]}),e.jsxs("button",{type:"button",onClick:()=>Ke("general"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(ga,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Ingreso General"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Operaci√≥n no inventariada"})]}),e.jsxs("button",{type:"button",onClick:()=>Ke("otros"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Ln,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Otros Ingresos"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Extraordinarios, donaciones"})]})]})]}),M&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(R,{type:"button",variant:"ghost",size:"sm",className:"px-0",onClick:()=>Ke(""),children:"‚Üê Volver al men√∫ de selecci√≥n"}),e.jsxs("div",{className:"space-y-6 p-4 border rounded-lg bg-muted/20",children:[jn(M),e.jsx(Me,{}),e.jsx("div",{className:"space-y-4",children:M==="precargados"&&Ue||M==="inventariados"&&ne?e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"C√°lculo Autom√°tico"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cantidad:"}),e.jsx("span",{children:M==="precargados"?Os:Ee})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Precio Unitario:"}),e.jsxs("span",{children:["$",M==="precargados"?Rs:ze]})]}),e.jsx(Me,{}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",be]})]})]})]}):null}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"font-medium",children:"Estado del Pago"}),H("Tipo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(De,{value:E,onValueChange:Mt,className:H("Tipo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(U,{value:"contado",id:"contado"}),e.jsx(j,{htmlFor:"contado",className:"cursor-pointer",children:"Pago Total"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(U,{value:"parcial",id:"parcial"}),e.jsx(j,{htmlFor:"parcial",className:"cursor-pointer",children:"Pago parcial"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(U,{value:"credito",id:"credito"}),e.jsx(j,{htmlFor:"credito",className:"cursor-pointer",children:"Adeudo Total"})]})]}),E==="parcial"&&e.jsxs("div",{className:"ml-6 p-4 border rounded-lg bg-blue-50 dark:bg-blue-950/20 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"monto-abonado",children:"Monto que se va a pagar"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Monto Abonado")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(z,{id:"monto-abonado",type:"number",step:"0.01",placeholder:"0.00",value:Pe,onChange:s=>Lt(s.target.value),className:H("Monto Abonado")?"border-destructive":""})]}),be&&Pe&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-3 bg-white dark:bg-gray-900 rounded border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de la venta"}),e.jsxs("p",{className:"text-lg font-semibold text-primary",children:["$",P(be)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Se pagar√° ahora"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:["$",P(Pe)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Queda pendiente"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["$",P(parseFloat(be)-parseFloat(Pe))]})]})]})]})]}),e.jsx(Me,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ps,{className:"h-5 w-5"}),e.jsx(j,{className:"font-medium",children:"Datos del Cliente"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:E==="contado"?"Opcional - Para anal√≠ticas y comentarios":"Obligatorio para cuentas por cobrar"})]}),E==="contado"&&e.jsxs(Ve,{children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(Re,{children:"Asignar cliente es opcional para pagos totales. √ötil para anal√≠ticas de ventas y seguimiento de clientes."})]}),(E==="parcial"||E==="credito")&&e.jsxs(Ve,{children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx(Re,{children:"Se registrar√° en Cuentas por Cobrar para an√°lisis de vencimientos"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"font-medium",children:"Tipo de Cliente"}),e.jsxs(he,{value:Q,onValueChange:s=>{Rt(s),Xs(""),Ss(""),Cs(""),_s(""),Ps(""),Is([])},children:[e.jsx(pe,{children:e.jsx(ye,{placeholder:E==="contado"?"Opcional - Selecciona para anal√≠ticas":"Selecciona el tipo de cliente"})}),e.jsxs(je,{children:[e.jsx(T,{value:"nuevo",children:"Cliente Nuevo"}),e.jsx(T,{value:"recurrente",children:"Cliente Recurrente"})]})]})]}),Q==="recurrente"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cliente-existente",children:"Seleccionar Cliente"}),(()=>{const s=ke.find(t=>t.id===ve);return e.jsxs(he,{value:ve??"",onValueChange:t=>{Xs(t);const r=ke.find(i=>i.id===t);r&&(Ss(r.nombre),Cs(r.telefono||""),_s(r.email||""),Ps(r.rfc||""))},children:[e.jsx(pe,{className:"h-auto py-2",children:s?e.jsxs("div",{className:"flex flex-col text-left leading-tight",children:[e.jsx("span",{className:"font-medium",children:s.nombre}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.telefono?`Tel: ${s.telefono}`:"",s.telefono&&s.email?" ‚Ä¢ ":"",s.email?`Email: ${s.email}`:"",s.source==="transaction"?" ‚Ä¢ (De transacci√≥n)":""]})]}):e.jsx("span",{className:"text-muted-foreground",children:"Buscar cliente existente..."})}),e.jsx(je,{className:"p-1",children:Ca?e.jsx("div",{className:"px-2 py-2 text-sm text-muted-foreground",children:"Cargando clientes..."}):ke.length===0?e.jsx("div",{className:"px-2 py-2 text-sm text-muted-foreground",children:"No hay clientes registrados"}):ke.map(t=>e.jsx(T,{value:t.id,className:"py-2",children:e.jsxs("div",{className:"flex flex-col text-left leading-tight",children:[e.jsx("span",{className:"font-medium",children:t.nombre}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.telefono?`Tel: ${t.telefono}`:"",t.telefono&&t.email?" ‚Ä¢ ":"",t.email?`Email: ${t.email}`:"",t.source==="transaction"?" ‚Ä¢ (De transacci√≥n)":""]})]})},t.id))})]})})(),!!ve&&e.jsx("p",{className:"text-xs text-green-600",children:"‚úì Datos del cliente cargados autom√°ticamente"})]}),(Q==="nuevo"||Q==="recurrente"&&ve)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cliente-nombre",children:"Nombre del Cliente"}),e.jsx(z,{id:"cliente-nombre",type:"text",placeholder:"Nombre completo",value:Je,onChange:s=>Ss(s.target.value),disabled:Q==="recurrente"&&ve!==""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"cliente-telefono",children:"N√∫mero de Tel√©fono"}),(E==="parcial"||E==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Tel√©fono del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(z,{id:"cliente-telefono",type:"tel",placeholder:"Ej: +52 55 1234 5678",value:Ce,onChange:s=>Cs(s.target.value),className:H("Tel√©fono del Cliente")?"border-destructive":"",disabled:Q==="recurrente"&&ve!==""}),Q==="nuevo"&&Ae.some(s=>s.includes(Ce)&&s.includes("tel√©fono"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Ae.find(s=>s.includes(Ce)&&s.includes("tel√©fono"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"cliente-email",children:"Correo Electr√≥nico"}),(E==="parcial"||E==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Email del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(z,{id:"cliente-email",type:"email",placeholder:"cliente@ejemplo.com",value:_e,onChange:s=>_s(s.target.value),className:H("Email del Cliente")?"border-destructive":"",disabled:Q==="recurrente"&&ve!==""}),Q==="nuevo"&&Ae.some(s=>s.includes(_e)&&s.includes("correo"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Ae.find(s=>s.includes(_e)&&s.includes("correo"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cliente-rfc",children:"RFC (ID Fiscal) - Opcional"}),e.jsx(z,{id:"cliente-rfc",type:"text",placeholder:"RFC123456ABC1",value:$e,onChange:s=>Ps(s.target.value.toUpperCase()),maxLength:13,disabled:Q==="recurrente"&&ve!==""}),Q==="nuevo"&&Ae.some(s=>s.includes($e)&&s.includes("RFC"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Ae.find(s=>s.includes($e)&&s.includes("RFC"))})]})]}),(E==="parcial"||E==="credito")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"fecha-vencimiento",children:"Fecha de Vencimiento"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Fecha de Vencimiento")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(z,{id:"fecha-vencimiento",type:"date",value:Fs,onChange:s=>Ot(s.target.value),className:H("Fecha de Vencimiento")?"border-destructive":"",min:new Date().toISOString().split("T")[0]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Fecha l√≠mite para el pago"," ",E==="parcial"?"del monto pendiente":"completo"]})]}),E==="contado"&&Q&&e.jsxs("div",{className:"col-span-full space-y-2",children:[e.jsx(j,{htmlFor:"comentario-venta",children:"Comentarios de la venta (Opcional)"}),e.jsx(ss,{id:"comentario-venta",placeholder:"Detalles adicionales sobre esta venta, preferencias del cliente, etc.",value:Ds,onChange:s=>Zs(s.target.value),rows:2}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Informaci√≥n √∫til para futuras ventas y an√°lisis del cliente"})]})]})]}),e.jsx(Me,{}),(E==="contado"||E==="parcial")&&e.jsxs(e.Fragment,{children:[e.jsx(Me,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"font-medium",children:"M√©todo de Pago"}),H("M√©todo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(De,{value:vs,onValueChange:Et,className:H("M√©todo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(U,{value:"efectivo",id:"efectivo"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($n,{className:"h-4 w-4 text-green-600"}),e.jsxs(j,{htmlFor:"efectivo",className:"cursor-pointer",children:["Efectivo"," ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Caja)"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(U,{value:"tarjeta",id:"tarjeta"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(kn,{className:"h-4 w-4 text-blue-800"}),e.jsxs(j,{htmlFor:"tarjeta",className:"cursor-pointer",children:["Tarjeta"," ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Bancos)"})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"comentarios",children:"Comentarios de la venta (Opcional)"}),e.jsx(ss,{id:"comentarios",placeholder:"Agrega cualquier comentario o nota sobre esta venta...",value:Ds,onChange:s=>Zs(s.target.value),rows:3,className:"resize-none"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(R,{size:"lg",className:"px-8",onClick:hn,disabled:Vt,children:[e.jsx(xa,{className:"mr-2 h-4 w-4"}),Vt?"Registrando...":"Registrar Ingreso"]})})]})]})]})]})}),e.jsx(es,{value:"resumen",className:"mt-6",children:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Registro Detallado de Ventas"}),e.jsx(oe,{children:"Historial completo de transacciones de ingresos"})]}),e.jsxs(Y,{children:[e.jsxs("div",{className:"mb-6 p-4 border rounded-lg bg-muted/30 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2 lg:col-span-2",children:[e.jsx(j,{children:"Rango de fechas"}),e.jsx(Un,{value:Wa,onChange:Ya})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"filtro-tipo",children:"Tipo de Ingreso"}),e.jsxs(he,{value:ue,onValueChange:Kt,children:[e.jsx(pe,{id:"filtro-tipo",children:e.jsx(ye,{placeholder:"Todos"})}),e.jsxs(je,{children:[e.jsx(T,{value:"todos",children:"Todos"}),e.jsx(T,{value:"precargados",children:"Precargados"}),e.jsx(T,{value:"inventariados",children:"Inventariados"}),e.jsx(T,{value:"general",children:"General"}),e.jsx(T,{value:"otros",children:"Otros"}),e.jsx(T,{value:"asiento_directo",children:"Venta de activo fijo"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"filtro-cuenta",children:"Cuenta"}),e.jsxs(he,{value:xe,onValueChange:Ht,children:[e.jsx(pe,{id:"filtro-cuenta",children:e.jsx(ye,{placeholder:"Todas"})}),e.jsxs(je,{children:[e.jsx(T,{value:"todas",children:"Todas"}),e.jsx(T,{value:"4001",children:"4001 - Ventas"}),e.jsx(T,{value:"4004",children:"4004 - Ventas Inventarios"}),e.jsx(T,{value:"4101",children:"4101 - Productos Financieros"}),e.jsx(T,{value:"4102",children:"4102 - Otros Productos"}),e.jsx(T,{value:"4103",children:"4103 - Ganancia en Venta de Activos"}),e.jsx(T,{value:"4103",children:"4002 - Devoluciones sobre ventas"}),e.jsx(T,{value:"4103",children:"4002 - Descuentos sobre ventas"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"filtro-subcuenta",children:"Subcuenta"}),e.jsxs(he,{value:se,onValueChange:Jt,children:[e.jsx(pe,{id:"filtro-subcuenta",children:e.jsx(ye,{placeholder:"Todas"})}),e.jsxs(je,{children:[e.jsx(T,{value:"todas",children:"Todas"}),e.jsx(T,{value:"sin-subcuenta",children:"Sin subcuenta"}),J.map(s=>e.jsx(T,{value:s.id,children:s.nombre},s.id))]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsx(R,{variant:"outline",size:"sm",onClick:()=>{Gt(void 0),Ut(""),qt(""),Kt("todos"),Ht("todas"),Jt("")},children:"Limpiar Filtros"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Resultados:"," ",(()=>{const s=Xe.map(n=>{const a=n.detalle_asientos.find(o=>o.cuenta_codigo.startsWith("4")&&Number(o.haber)>0);return{created_at:n.fecha,fecha:n.fecha,fecha_fixed:n.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(a==null?void 0:a.cuenta_codigo)||"",subcuenta_id:a==null?void 0:a.subcuenta_id}});return[...w??[],...s??[]].map(Ns).filter(n=>{const a=n.fecha_fixed??n.fecha??n.created_at,o=ks(a),d=!ue||ue==="todos"||n.tipo_ingreso===ue,x=!xe||xe==="todas"||n.cuenta_principal_codigo===xe,h=!se||se==="todas"||se==="sin-subcuenta"&&!n.subcuenta_id||n.subcuenta_id===se;return o&&d&&x&&h}).length})()]}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["Total: $",(()=>{const s=Xe.map(i=>{const n=i.detalle_asientos.find(a=>a.cuenta_codigo.startsWith("4")&&Number(a.haber)>0);return{created_at:i.fecha,fecha:i.fecha,fecha_fixed:i.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(n==null?void 0:n.cuenta_codigo)||"",subcuenta_id:n==null?void 0:n.subcuenta_id,monto_total:Number(n==null?void 0:n.haber)||0}}),r=[...de,...s].filter(i=>{const n=i.fecha_fixed??i.fecha??i.created_at,a=ks(n),o=!ue||ue==="todos"||i.tipo_ingreso===ue,d=!xe||xe==="todas"||i.cuenta_principal_codigo===xe,x=!se||se==="todas"||se==="sin-subcuenta"&&!i.subcuenta_id||i.subcuenta_id===se;return a&&o&&d&&x});return P(r.reduce((i,n)=>i+Number(n.monto_total||0),0))})()]}),e.jsxs("p",{className:"text-sm font-medium text-green-600",children:["Neto: $",(()=>{const s=Xe.map(i=>{const n=i.detalle_asientos.find(a=>a.cuenta_codigo.startsWith("4")&&Number(a.haber)>0);return{created_at:i.fecha,fecha:i.fecha,fecha_fixed:i.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(n==null?void 0:n.cuenta_codigo)||"",subcuenta_id:n==null?void 0:n.subcuenta_id,monto_neto:Number(n==null?void 0:n.haber)||0}}),r=[...de,...s].filter(i=>{const n=i.fecha_fixed??i.fecha??i.created_at,a=ks(n),o=!ue||ue==="todos"||i.tipo_ingreso===ue,d=!xe||xe==="todas"||i.cuenta_principal_codigo===xe,x=!se||se==="todas"||se==="sin-subcuenta"&&!i.subcuenta_id||i.subcuenta_id===se;return a&&o&&d&&x});return P(r.reduce((i,n)=>i+Number(n.monto_neto||0),0))})()]})]})]})]}),I?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando transacciones..."}):(()=>{const s=Xe.map(n=>{const a=n.detalle_asientos.find(o=>o.cuenta_codigo.startsWith("4")&&Number(o.haber)>0);return{id:n.id??n._id,descripcion:n.descripcion,monto_total:Number(a==null?void 0:a.haber)||0,monto_neto:Number(a==null?void 0:a.haber)||0,monto_descuento:0,monto_pagado:Number(a==null?void 0:a.haber)||0,monto_pendiente:0,tipo_ingreso:"asiento_directo",metodo_pago:"N/A",tipo_pago:"contado",cuenta_principal_codigo:(a==null?void 0:a.cuenta_codigo)||"",subcuenta_id:a==null?void 0:a.subcuenta_id,created_at:n.fecha,fecha:n.fecha,fecha_fixed:n.fecha,asiento_fecha:n.fecha,es_asiento_directo:!0,estado:"activo"}}),i=[...de,...s.map(Ns)].filter(n=>{const a=n.fecha_fixed??n.fecha??n.created_at,o=ks(a),d=!ue||ue==="todos"||n.tipo_ingreso===ue,x=!xe||xe==="todas"||n.cuenta_principal_codigo===xe,h=!se||se==="todas"||se==="sin-subcuenta"&&!n.subcuenta_id||n.subcuenta_id===se;return o&&d&&x&&h}).filter(n=>!String(n.descripcion||"").includes("CANCELACI√ìN:")).map(n=>{const a=n.estado==="cancelado";let o=null;return a&&n.transaccion_cancelacion_id&&(o=de.find(d=>d.id===n.transaccion_cancelacion_id)),{...n,esCancelada:a,transaccionReversion:o}});return i.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay transacciones que coincidan con los filtros"}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"text-sm font-medium text-muted-foreground",children:["Mostrando ",i.length," transacci√≥n(es)"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Tip: da clic en el √≠cono üìÑ para ver ‚ÄúInformaci√≥n general‚Äù y ‚ÄúRegistro contable‚Äù"})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-background",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/60",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap",children:"Fecha"}),e.jsx("th",{className:"text-left p-3 font-medium min-w-[320px]",children:"Descripci√≥n"}),e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap hidden md:table-cell",children:"Tipo"}),e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap hidden lg:table-cell",children:"Cuenta"}),e.jsx("th",{className:"text-right p-3 font-medium whitespace-nowrap",children:"Total"}),e.jsx("th",{className:"text-right p-3 font-medium whitespace-nowrap hidden md:table-cell",children:"Neto"}),e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap hidden md:table-cell",children:"Estado"}),e.jsx("th",{className:"text-right p-3 font-medium whitespace-nowrap",children:"Acciones"})]})}),e.jsx("tbody",{children:i.map(n=>{var l,p,g,y,b;const a=n,o=n.esCancelada,d=!1,x=a.fecha_fixed??a.fecha??a.created_at,h=(()=>{try{return new Date(x).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return String(x||"")}})(),c=Number(ge(a,"netas")||0);return e.jsxs("tr",{className:`border-t hover:bg-muted/30 ${o?"bg-red-50/60 dark:bg-red-950/20":""}`,children:[e.jsx("td",{className:"p-3 whitespace-nowrap text-muted-foreground",children:h}),e.jsxs("td",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium",children:a.descripcion}),a.es_asiento_directo&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200",children:"üìã Asiento Directo"}),o&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200",children:"‚ùå Cancelada"}),d]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("span",{className:"capitalize",children:a.metodo_pago||"N/A"})," ","‚Ä¢"," ",e.jsx("span",{className:"capitalize",children:a.tipo_pago||"N/A"}),a.subcuenta_id?e.jsxs(e.Fragment,{children:[" ","‚Ä¢"," ",e.jsxs("span",{className:"text-muted-foreground",children:["Subcuenta:"," ",((l=a.subcuentas)==null?void 0:l.nombre)||(()=>{const f=J.find(S=>S.id===a.subcuenta_id);return(f==null?void 0:f.nombre)||"Subcuenta no encontrada"})()]})]}):null]}),a.comentarios&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 dark:bg-blue-950/30 rounded text-xs",children:[e.jsxs("span",{className:"font-medium text-blue-700 dark:text-blue-300",children:["üí¨"," "]}),e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:String(a.comentarios).length>80?`${String(a.comentarios).substring(0,80)}...`:String(a.comentarios)})]}),o&&a.motivo_cancelacion&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"p-3 bg-red-100 dark:bg-red-950/40 rounded-md border border-red-300 dark:border-red-800",children:[e.jsx("p",{className:"text-xs font-medium text-red-700 dark:text-red-300 mb-1",children:"üìã Motivo de cancelaci√≥n:"}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:a.motivo_cancelacion}),e.jsxs("p",{className:"text-xs text-red-500 dark:text-red-500 mt-1",children:["Cancelada el:"," ",new Date(a.fecha_cancelacion).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.transaccionReversion&&e.jsxs("div",{className:"p-3 bg-orange-100 dark:bg-orange-950/40 rounded-md border border-orange-300 dark:border-orange-800",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-orange-700 dark:text-orange-300",children:"‚Ü©Ô∏è Asiento de Reversi√≥n Generado"})}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",n.transaccionReversion.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Monto reversado:"})," $",P(Math.abs(n.transaccionReversion.monto_total))]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",(()=>{const f=n.transaccionReversion.fecha_fixed??n.transaccionReversion.fecha??n.transaccionReversion.created_at;return new Date(f).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})()]})]})]})]})]}),e.jsx("td",{className:"p-3 hidden md:table-cell",children:e.jsx("span",{className:"capitalize",children:a.tipo_ingreso})}),e.jsx("td",{className:"p-3 hidden lg:table-cell",children:a.cuenta_principal_codigo||"-"}),e.jsxs("td",{className:"p-3 text-right font-bold text-primary whitespace-nowrap",children:["$",P(a.monto_total),a.monto_descuento>0&&e.jsxs("div",{className:"text-xs text-red-600 font-medium",children:["-$",P(a.monto_descuento)," desc."]})]}),e.jsx("td",{className:"p-3 text-right hidden md:table-cell whitespace-nowrap",children:e.jsxs("span",{className:"font-medium text-green-600",children:["$",P(c)]})}),e.jsx("td",{className:"p-3 hidden md:table-cell",children:o?e.jsx("span",{className:"text-red-600 font-medium",children:"Cancelada"}):e.jsx("span",{className:"text-muted-foreground",children:"Activa"})}),e.jsx("td",{className:"p-3 text-right whitespace-nowrap",children:e.jsxs("div",{className:"inline-flex items-center gap-2 justify-end",children:[e.jsxs(ds,{onOpenChange:f=>{if(f){const S=String(a._id??a.id??"");xn(S)}else As(null)},children:[e.jsx(fa,{asChild:!0,children:e.jsx(R,{variant:"outline",size:"sm",className:"h-8 px-2",children:e.jsx(ga,{className:"h-4 w-4"})})}),e.jsxs(ms,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(us,{children:[e.jsx(xs,{children:"Detalles de la Transacci√≥n"}),e.jsx(hs,{children:"Informaci√≥n completa y asientos contables en balanza"})]}),e.jsxs(ha,{defaultValue:"general",className:"w-full",children:[e.jsxs(pa,{className:"grid w-full grid-cols-2",children:[e.jsx(Ze,{value:"general",children:"Informaci√≥n General"}),e.jsx(Ze,{value:"contable",children:"Registros Contables"})]}),e.jsxs(es,{value:"general",className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Informaci√≥n General"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",a.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",a.tipo_ingreso]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"M√©todo de Pago:"})," ",a.metodo_pago||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo de Pago:"})," ",a.tipo_pago]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",(()=>{const f=a.fecha_fixed??a.fecha??a.created_at;try{return new Date(f).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return String(f||"")}})()]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Montos"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total:"})," $",P(a.monto_total)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descuento:"})," $",P(a.monto_descuento)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Neto:"})," $",P(a.monto_neto)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pagado:"})," $",P(a.monto_pagado||0)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pendiente:"})," $",P(a.monto_pendiente||0)]})]})]})]}),(a.cliente_nombre||a.cliente_telefono||a.cliente_email)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n del Cliente"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.cliente_nombre&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",a.cliente_nombre]}),a.cliente_telefono&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tel√©fono:"})," ",a.cliente_telefono]}),a.cliente_email&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",a.cliente_email]}),a.cliente_rfc&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"RFC:"})," ",a.cliente_rfc]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n Contable"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Cuenta Principal:"})," ",a.cuenta_principal??`${a.cuenta_principal_codigo}`]}),a.subcuenta_id?e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," ",((p=a.subcuentas)==null?void 0:p.nombre)||(()=>{const f=J.find(S=>S.id===a.subcuenta_id);return(f==null?void 0:f.nombre)||"Subcuenta no encontrada"})()]}):e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," Sin subcuenta asignada"]})]})]}),a.comentarios&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Comentarios"}),e.jsx("div",{className:"p-3 bg-muted rounded-md",children:e.jsx("p",{className:"text-sm",children:a.comentarios})})]})]}),e.jsxs(es,{value:"contable",className:"mt-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3",children:"Asientos en Balanza de Comprobaci√≥n"}),Ha?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando asientos contables..."}):Le?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"N√∫mero de Asiento:"})," ",Le.numero_asiento]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(Le.fecha).toLocaleDateString("es-ES")]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",Le.descripcion]})]})}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Cuenta"}),e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Descripci√≥n"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Debe"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Haber"})]})}),e.jsxs("tbody",{children:[(g=Le.detalles)==null?void 0:g.map((f,S)=>e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"p-3 text-sm",children:[e.jsx("div",{className:"font-medium",children:f.cuenta_codigo}),e.jsx("div",{className:"text-xs text-muted-foreground",children:f.cuenta_nombre})]}),e.jsx("td",{className:"p-3 text-sm",children:f.descripcion}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:f.debe>0?`$${P(f.debe)}`:"-"}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:f.haber>0?`$${P(f.haber)}`:"-"})]},S)),e.jsxs("tr",{className:"border-t-2 bg-muted/50 font-bold",children:[e.jsx("td",{colSpan:2,className:"p-3 text-sm",children:"TOTALES"}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",P((y=Le.detalles)==null?void 0:y.reduce((f,S)=>f+Number(S.debe),0))]}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",P((b=Le.detalles)==null?void 0:b.reduce((f,S)=>f+Number(S.haber),0))]})]})]})]})}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/30 rounded-md text-sm",children:[e.jsx("p",{className:"font-medium text-blue-700 dark:text-blue-300 mb-1",children:"üí° Informaci√≥n"}),e.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:"Este asiento contable refleja c√≥mo esta transacci√≥n afecta a las diferentes cuentas en la balanza de comprobaci√≥n y posteriormente en los estados financieros."})]})]}):e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg text-sm text-muted-foreground text-center",children:"No se encontraron asientos contables para esta transacci√≥n"})]})]})]})]}),!o&&!d&&e.jsx(R,{variant:"outline",size:"sm",className:"h-8 px-2 border-red-300 text-red-600 hover:bg-red-50 dark:border-red-800 dark:text-red-400 dark:hover:bg-red-950/30",onClick:()=>{jt(Ns(a)),Us(!0)},children:"‚ùå"})]})})]},a.id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t bg-muted/40",children:[e.jsx("td",{className:"p-3 text-sm font-medium",colSpan:4,children:"TOTALES"}),e.jsxs("td",{className:"p-3 text-right font-bold text-primary whitespace-nowrap",children:["$",P(i.reduce((n,a)=>n+Number(a.monto_total||0),0))]}),e.jsx("td",{className:"p-3 text-right hidden md:table-cell whitespace-nowrap",children:e.jsxs("span",{className:"font-bold text-green-600",children:["$",P(i.reduce((n,a)=>n+Number(ge(a,"netas")||0),0))]})}),e.jsx("td",{className:"p-3 hidden md:table-cell"}),e.jsx("td",{className:"p-3"})]})})]})})})]})})()]})]})}),e.jsx(es,{value:"analitica",className:"mt-6",children:(()=>{const s=Array.isArray(Xe)?Xe:[],r=(()=>{const d=new Date().getFullYear();let x=w.filter(h=>{var c;return h.estado!=="cancelado"&&!((c=h.descripcion)!=null&&c.includes("CANCELACI√ìN:"))});if(Z==="diario"){const h=me.toISOString().split("T")[0];x=x.filter(c=>c.asiento_fecha===h)}else if(Z==="mensual"){const h=V.getMonth(),c=V.getFullYear();x=x.filter(l=>{const p=l.asiento_fecha;if(!p)return!1;const g=Hs(p);return g.getMonth()===h&&g.getFullYear()===c})}else x=x.filter(h=>{const c=h.asiento_fecha;return c?Hs(c).getFullYear()===d:!1});return B==="ventas"?x.filter(h=>h.cuenta_principal_codigo==="4001"):x.filter(h=>{var c;return((c=h.cuenta_principal_codigo)==null?void 0:c.startsWith("4"))&&h.cuenta_principal_codigo!=="4001"&&h.cuenta_principal_codigo!=="4003"})})(),n=(()=>{const o=r.filter(h=>h.tipo_pago==="contado"||h.tipo_pago==="parcial");if(o.length===0)return[];const d={};o.forEach(h=>{const c=h.metodo_pago==="efectivo"?"Efectivo":"Tarjeta";d[c]=(d[c]||0)+(Number(ge(h,N))||0)});const x=Object.values(d).reduce((h,c)=>h+(Number(c)||0),0);return Object.entries(d).map(([h,c])=>({name:h,value:c,porcentaje:x>0?(c/x*100).toFixed(1):"0.0"}))})(),a=()=>B==="ventas"?r.length>0||(Number(O.ventasBrutas)||0)>0||(Number(O.descuentos)||0)>0:r.length>0||(Number(O.otrosIngresos)||0)>0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground mb-4",children:"Highlights de Ingresos"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Resumen del D√≠a"})}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(rs.ventasBrutas,F)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(rs.descuentos,F)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",D(rs.ventasNetas,F)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(rs.otrosIngresos,F)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",D(rs.totalIngresos,F)]})]})]})]}),e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Resumen del Mes"})}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(os.ventasBrutas,F)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(os.descuentos,F)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",D(os.ventasNetas,F)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(os.otrosIngresos,F)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",D(os.totalIngresos,F)]})]})]})]}),e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Resumen del A√±o"})}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(is.ventasBrutas,F)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(is.descuentos,F)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",D(is.ventasNetas,F)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(is.otrosIngresos,F)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",D(is.totalIngresos,F)]})]})]})]})]})]}),e.jsx("div",{className:"my-8 border-t-2 border-primary/20"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-foreground mb-6",children:["Anal√≠tica de ",B==="ventas"?"Ventas":"Otros Ingresos"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Tipo de Ingreso"}),e.jsx(oe,{children:"Selecciona qu√© analizar"})]}),e.jsx(Y,{children:e.jsxs(De,{value:B,onValueChange:o=>Va(o),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"ventas",id:"tipo-ventas"}),e.jsx(j,{htmlFor:"tipo-ventas",className:"cursor-pointer",children:"Ventas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"otros",id:"tipo-otros"}),e.jsx(j,{htmlFor:"tipo-otros",className:"cursor-pointer",children:"Otros Ingresos"})]})]})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Per√≠odo de An√°lisis"}),e.jsx(oe,{children:"Selecciona el per√≠odo"})]}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs(De,{value:Z,onValueChange:o=>Aa(o),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"diario",id:"period-daily"}),e.jsx(j,{htmlFor:"period-daily",className:"cursor-pointer",children:"Diario"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"mensual",id:"period-monthly"}),e.jsx(j,{htmlFor:"period-monthly",className:"cursor-pointer",children:"Mensual"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"anual",id:"period-annual"}),e.jsx(j,{htmlFor:"period-annual",className:"cursor-pointer",children:"Anual"})]})]}),Z==="diario"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(j,{className:"text-xs text-muted-foreground mb-2 block",children:"Fecha espec√≠fica"}),e.jsxs(Dt,{children:[e.jsx(It,{asChild:!0,children:e.jsxs(R,{variant:"outline",className:Js("w-full justify-start text-left font-normal",!me&&"text-muted-foreground"),size:"sm",children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"}),bs(me,"PPP",{locale:ts})]})}),e.jsx($t,{className:"w-auto p-0",align:"start",children:e.jsx(kt,{mode:"single",selected:me,onSelect:o=>o&&Ra(o),initialFocus:!0,className:"pointer-events-auto"})})]})]}),Z==="mensual"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(j,{className:"text-xs text-muted-foreground mb-2 block",children:"Mes espec√≠fico"}),e.jsxs(Dt,{children:[e.jsx(It,{asChild:!0,children:e.jsxs(R,{variant:"outline",className:Js("w-full justify-start text-left font-normal",!V&&"text-muted-foreground"),size:"sm",children:[e.jsx(Tt,{className:"mr-2 h-4 w-4"}),bs(V,"MMMM yyyy",{locale:ts})]})}),e.jsx($t,{className:"w-auto p-0",align:"start",children:e.jsx(kt,{mode:"single",selected:V,onSelect:o=>o&&Oa(o),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Formato de Cifras"}),e.jsx(oe,{children:"Visualizaci√≥n de montos"})]}),e.jsx(Y,{children:e.jsxs(De,{value:F,onValueChange:o=>Ea(o),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"general",id:"scale-general"}),e.jsx(j,{htmlFor:"scale-general",className:"cursor-pointer",children:"General"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"miles",id:"scale-thousands"}),e.jsx(j,{htmlFor:"scale-thousands",className:"cursor-pointer",children:"Miles (K)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"millones",id:"scale-millions"}),e.jsx(j,{htmlFor:"scale-millions",className:"cursor-pointer",children:"Millones (M)"})]})]})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Tipo de M√©trica"}),e.jsx(oe,{children:"Datos a visualizar"})]}),e.jsx(Y,{children:e.jsxs(De,{value:N,onValueChange:o=>Ma(o),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"brutas",id:"metric-brutas"}),e.jsx(j,{htmlFor:"metric-brutas",className:"cursor-pointer",children:"Ventas Brutas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"descuentos",id:"metric-descuentos"}),e.jsx(j,{htmlFor:"metric-descuentos",className:"cursor-pointer",children:"Descuentos"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(U,{value:"netas",id:"metric-netas"}),e.jsx(j,{htmlFor:"metric-netas",className:"cursor-pointer",children:"Ventas Netas"})]})]})})]})]}),e.jsxs(W,{className:"mb-6",children:[e.jsxs(q,{children:[e.jsxs(G,{children:["Evoluci√≥n de"," ",N==="descuentos"?"Descuentos":B==="otros"?"Otros Ingresos":N==="brutas"?"Ventas Brutas":"Ventas Netas"]}),e.jsx(oe,{children:(N==="descuentos"?"Descuentos aplicados":B==="otros"?"Otros ingresos":N==="brutas"?"Ventas brutas":"Ventas netas")+" - "+(Z==="diario"?"del d√≠a":Z==="mensual"?"por d√≠a del mes":"por mes del a√±o")})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"Cargando datos..."}):O.detallesPorPeriodo.length===0?e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"}):e.jsx("div",{className:"h-80",children:e.jsx(js,{width:"100%",height:"100%",children:e.jsxs(An,{data:O.detallesPorPeriodo.map(o=>({periodo:o.periodo,ventas:o.ventasBrutas,descuentos:o.descuentos,neto:o.ventasNetas,otrosIngresos:o.otrosIngresos})),children:[e.jsx(Na,{strokeDasharray:"3 3"}),e.jsx(ba,{dataKey:"periodo",tick:{fill:"#000000"}}),e.jsx(va,{tickFormatter:o=>D(o,F),tick:{fill:"#000000"}}),e.jsx(gs,{formatter:o=>[`$${D(Number(o),F)}`,""],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}}),e.jsx(En,{}),N==="descuentos"&&e.jsx(Ys,{type:"monotone",dataKey:"descuentos",stroke:"hsl(180 60% 70%)",name:"Descuentos",strokeWidth:2,children:e.jsx(fs,{dataKey:"descuentos",position:"top",formatter:o=>`$${D(o,F)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),N==="brutas"&&B==="ventas"&&e.jsx(Ys,{type:"monotone",dataKey:"ventas",stroke:"hsl(180 50% 55%)",name:"Ventas Brutas",strokeWidth:2,children:e.jsx(fs,{dataKey:"ventas",position:"top",formatter:o=>`$${D(o,F)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),N==="netas"&&B==="ventas"&&e.jsx(Ys,{type:"monotone",dataKey:"neto",stroke:"hsl(180 45% 45%)",name:"Ventas Netas",strokeWidth:2,children:e.jsx(fs,{dataKey:"neto",position:"top",formatter:o=>`$${D(o,F)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),B==="otros"&&N!=="descuentos"&&e.jsx(Ys,{type:"monotone",dataKey:"otrosIngresos",stroke:"hsl(140 50% 50%)",name:"Otros Ingresos",strokeWidth:2,children:e.jsx(fs,{dataKey:"otrosIngresos",position:"top",formatter:o=>`$${D(o,F)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})})]})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:[N==="brutas"?"Ventas Brutas":N==="descuentos"?"Descuentos":"Ventas Netas"," por Tipo"]}),e.jsxs(oe,{children:["Distribuci√≥n de"," ",N==="brutas"?"ventas brutas":N==="descuentos"?"descuentos":"ventas netas"," por categor√≠a"]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):a()?B==="otros"&&N==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(js,{width:"100%",height:"100%",children:e.jsxs(ya,{children:[e.jsx(wa,{data:(()=>{const o=B==="ventas"?N==="brutas"?O.ventasBrutas:N==="descuentos"?O.descuentos:O.ventasNetas:O.otrosIngresos;if(r.length===0&&(Number(o)||0)>0)return[{tipo:"Otros Ingresos",monto:Number(o)||0,porcentaje:"100.0"}];const d=r.reduce((h,c)=>{const l=(c==null?void 0:c.tipo_ingreso)||"sin_tipo";return h[l]=(h[l]||0)+(Number(ge(c,N))||0),h},{}),x=Object.values(d).reduce((h,c)=>h+(Number(c)||0),0);return Object.entries(d).map(([h,c])=>({tipo:String(h).charAt(0).toUpperCase()+String(h).slice(1),monto:Number(c)||0,porcentaje:x>0?((Number(c)||0)/x*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({tipo:o,porcentaje:d,monto:x})=>`${o}
${d}%
$${D(Number(x)||0,F)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:Object.keys(r.reduce((o,d)=>(o[(d==null?void 0:d.tipo_ingreso)||"sin_tipo"]=!0,o),{})).map((o,d)=>{const x=["hsl(180 50% 55%)","hsl(180 45% 45%)","hsl(180 55% 65%)","hsl(180 40% 40%)"];return e.jsx(Ks,{fill:x[d%4]},`cell-${d}`)})}),e.jsx(gs,{formatter:o=>[`$${D(Number(o),F)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:["Estado de Pagos - ",N==="brutas"?"Ventas Brutas":N==="descuentos"?"Descuentos":"Ventas Netas"]}),e.jsx(oe,{children:"Distribuci√≥n por estado de pago"})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):a()?B==="otros"&&N==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(js,{width:"100%",height:"100%",children:e.jsxs(ya,{children:[e.jsxs(wa,{data:(()=>{const o=B==="ventas"?N==="brutas"?O.ventasBrutas:N==="descuentos"?O.descuentos:O.ventasNetas:O.otrosIngresos;if(r.length===0&&(Number(o)||0)>0)return[{estado:"Pagado Total",monto:Number(o)||0,porcentaje:"100.0"}];const d=r.reduce((h,c)=>{let l="Por Cobrar";return c.tipo_pago==="contado"||c.monto_pagado&&c.monto_pendiente===0?l="Pagado Total":(c.tipo_pago==="parcial"||c.monto_pagado>0&&c.monto_pendiente>0)&&(l="Pago Parcial"),h[l]=(h[l]||0)+(Number(ge(c,N))||0),h},{}),x=Object.values(d).reduce((h,c)=>h+(Number(c)||0),0);return Object.entries(d).map(([h,c])=>({estado:h,monto:Number(c)||0,porcentaje:x>0?((Number(c)||0)/x*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({estado:o,porcentaje:d,monto:x})=>`${o}
${d}%
$${D(Number(x)||0,F)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:[e.jsx(Ks,{fill:"hsl(180 50% 55%)"}),e.jsx(Ks,{fill:"hsl(180 55% 65%)"}),e.jsx(Ks,{fill:"hsl(180 45% 45%)"})]}),e.jsx(gs,{formatter:o=>[`$${D(Number(o),F)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(W,{children:[e.jsxs(q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(G,{children:[N==="brutas"?"Ventas Brutas":N==="descuentos"?"Descuentos":"Ventas Netas"," por"," ",cs==="subcuenta"?"Subcuenta":"Cuenta"]}),e.jsxs(oe,{children:["Distribuci√≥n por ",cs==="subcuenta"?"subcuentas":"cuentas"," contables"]})]}),e.jsxs(he,{value:cs,onValueChange:o=>Ka(o),children:[e.jsx(pe,{className:"w-[150px]",children:e.jsx(ye,{})}),e.jsxs(je,{children:[e.jsx(T,{value:"subcuenta",children:"Por Subcuenta"}),e.jsx(T,{value:"cuenta",children:"Por Cuenta"})]})]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):a()?B==="otros"&&N==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(js,{width:"100%",height:"100%",children:e.jsxs(Mn,{data:(()=>{const o=B==="ventas"?N==="brutas"?O.ventasBrutas:N==="descuentos"?O.descuentos:O.ventasNetas:O.otrosIngresos;if(r.length===0&&(Number(o)||0)>0)return[{subcuenta:"Sin detalle",monto:Number(o)||0}];const d=r.reduce((c,l)=>{var g;let p;if(cs==="subcuenta")p=l.subcuenta_id?((g=J.find(y=>y.id===l.subcuenta_id))==null?void 0:g.nombre)||"Subcuenta desconocida":"Sin subcuenta asignada";else{const y=fe.find(b=>b.codigo===l.cuenta_principal_codigo);p=y?`${l.cuenta_principal_codigo} - ${y.nombre}`:l.cuenta_principal_codigo||"Sin cuenta"}return c[p]=(c[p]||0)+(Number(ge(l,N))||0),c},{}),x=Object.values(d).reduce((c,l)=>c+(Number(l)||0),0);if((Number(o)||0)-x>.01){const c={};s.forEach(l=>{const g=(Array.isArray(l.detalle_asientos)?l.detalle_asientos:[]).find(k=>String(k.cuenta_codigo||"").startsWith("4")&&Number(k.haber)>0);if(!g)return;const y=Number(g.haber)||0,b=String(g.cuenta_codigo||""),f=fe.find(k=>k.codigo===b),S=(f==null?void 0:f.nombre)||"Otros ingresos";let $;if(cs==="cuenta")$=`${b} - ${S}`;else{const k=g.subcuenta_id,A=J.find(te=>te.id===k);$=(A==null?void 0:A.nombre)||"Sin subcuenta asignada"}c[$]=(c[$]||0)+y}),Object.entries(c).forEach(([l,p])=>{d[l]=(d[l]||0)+(Number(p)||0)})}return Object.entries(d).map(([c,l])=>({subcuenta:c,monto:Number(l)||0}))})(),layout:"vertical",children:[e.jsx(Na,{strokeDasharray:"3 3"}),e.jsx(ba,{type:"number",tickFormatter:o=>D(o,F),tick:{fill:"#000000"},domain:[0,o=>o*1.2]}),e.jsx(va,{type:"category",dataKey:"subcuenta",width:150,tick:{fill:"#000000"}}),e.jsx(gs,{formatter:o=>[`$${D(Number(o),F)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}}),e.jsx(Vn,{dataKey:"monto",fill:"hsl(180 50% 55%)",children:e.jsx(fs,{dataKey:"monto",position:"right",formatter:o=>`$${D(o,F)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"M√©todos de Pago Recibidos"}),e.jsxs(oe,{children:["Distribuci√≥n de"," ",N==="brutas"?"ventas brutas":N==="descuentos"?"descuentos":"ventas netas"," por m√©todo de pago"]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):a()?B==="otros"&&N==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):n.length===0?e.jsxs("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:["No hay transacciones con m√©todo de pago en este per√≠odo",e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-2 block",children:"Las ventas a cr√©dito no tienen m√©todo de pago asignado"})]}):e.jsx("div",{className:"h-64",children:e.jsx(js,{width:"100%",height:"100%",children:e.jsx(Rn,{data:n,dataKey:"value",aspectRatio:4/3,stroke:"#fff",fill:"#8884d8",content:e.jsx(Wn,{}),children:e.jsx(gs,{content:e.jsx(qn,{scaleFormat:F})})})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:[N==="brutas"?"Ventas Brutas":N==="descuentos"?"Descuentos":"Ventas Netas"," por Producto"]}),e.jsxs(oe,{children:["Ranking de productos ",N==="descuentos"?"con m√°s descuentos":"m√°s vendidos"]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):a()?e.jsx("div",{className:"space-y-3",children:(()=>{if(B==="otros"&&N==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const o=B==="ventas"?N==="brutas"?O.ventasBrutas:N==="descuentos"?O.descuentos:O.ventasNetas:O.otrosIngresos;if(r.length===0&&(Number(o)||0)>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(Ie,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin detalle de producto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",D(Number(o)||0,F)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Ie,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",D(Number(o)||0,F)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const d={};r.forEach(c=>{if(c.tipo_ingreso==="inventariados"&&String(c.descripcion||"").startsWith("Venta de ")){const l=String(c.descripcion).replace("Venta de ","").trim(),p=Fe.find(g=>g.nombre.toLowerCase()===l.toLowerCase());d[l]||(d[l]={nombre:l,transacciones:0,monto:0,imagen:p==null?void 0:p.imagen_url,tieneAsignacion:!0}),d[l].transacciones+=1,d[l].monto+=Number(ge(c,N))||0}}),r.forEach(c=>{if(c.tipo_ingreso==="precargados"){let l=[];String(c.descripcion||"").startsWith("Venta: ")?l=String(c.descripcion).replace("Venta: ","").split(", ").map(f=>{const S=f.match(/^(.+?) \(x(\d+)\)$/);return S?{nombre:S[1].trim(),cantidad:parseInt(S[2])}:{nombre:f.trim(),cantidad:1}}):String(c.descripcion||"").startsWith("Venta de ")?l=[{nombre:String(c.descripcion).replace("Venta de ","").trim(),cantidad:1}]:l=[{nombre:String(c.descripcion||"Sin descripci√≥n"),cantidad:1}];const p=Number(ge(c,N))||0,g=[];let y=0;l.forEach(({nombre:b,cantidad:f})=>{const S=Se.find(k=>k.nombre.toLowerCase()===b.toLowerCase()),$=Number(S==null?void 0:S.precio)||0;g.push({nombre:b,cantidad:f,precioBase:$}),y+=$*f}),g.forEach(({nombre:b,cantidad:f,precioBase:S})=>{const $=Se.find(le=>le.nombre.toLowerCase()===b.toLowerCase()),k=S*f,A=y>0?k/y:1/Math.max(g.length,1),te=p*A;d[b]||(d[b]={nombre:b,transacciones:0,monto:0,imagen:$==null?void 0:$.imagen_url,tieneAsignacion:!!$}),d[b].transacciones+=1,d[b].monto+=Number(te)||0})}if(c.tipo_ingreso==="general"||c.tipo_ingreso==="inventariados"&&!String(c.descripcion||"").startsWith("Venta de ")){const l="Ingresos sin producto asignado";d[l]||(d[l]={nombre:l,transacciones:0,monto:0,tieneAsignacion:!1}),d[l].transacciones+=1,d[l].monto+=Number(ge(c,N))||0}if(c.tipo_ingreso==="otros"){const l=String(c.descripcion||"Otros ingresos");d[l]||(d[l]={nombre:l,transacciones:0,monto:0,tieneAsignacion:!1}),d[l].transacciones+=1,d[l].monto+=Number(ge(c,N))||0}});const x=Object.values(d).sort((c,l)=>(Number(l.monto)||0)-(Number(c.monto)||0));if(B==="otros"){const c=r.filter(p=>p.tipo_ingreso==="otros").reduce((p,g)=>p+(Number(ge(g,N))||0),0);if((Number(o)||0)-c>.01){const p={};s.forEach(g=>{const b=(Array.isArray(g.detalle_asientos)?g.detalle_asientos:[]).find(A=>String(A.cuenta_codigo||"").startsWith("4")&&Number(A.haber)>0);if(!b)return;const f=Number(b.haber)||0,S=String(b.cuenta_codigo||""),$=fe.find(A=>A.codigo===S);let k;String(g.numero_asiento||"").startsWith("BAJA-")?k=($==null?void 0:$.nombre)||"Ganancia en Venta de Activos":k=String(g.descripcion||($==null?void 0:$.nombre)||"Otros ingresos"),p[k]||(p[k]={monto:0,count:0}),p[k].monto+=f,p[k].count+=1}),Object.entries(p).forEach(([g,y])=>{(Number(y.monto)||0)>.01&&x.push({nombre:g,transacciones:y.count,monto:y.monto,tieneAsignacion:!1})})}}const h=x.slice(0,10);return e.jsxs(e.Fragment,{children:[h.map(c=>{const l=x.reduce((g,y)=>g+(Number(y.monto)||0),0),p=l>0?((Number(c.monto)||0)/l*100).toFixed(1):"0.0";return e.jsxs("div",{className:`flex items-center gap-3 p-3 border rounded-lg ${c.tieneAsignacion?"":"border-amber-500/50 bg-amber-50/50 dark:bg-amber-950/20"}`,children:[c.imagen?e.jsx("img",{src:c.imagen,alt:c.nombre,className:"w-12 h-12 rounded-md object-cover flex-shrink-0"}):e.jsx("div",{className:`w-12 h-12 rounded-md flex items-center justify-center flex-shrink-0 ${c.tieneAsignacion?"bg-muted":"bg-amber-100 dark:bg-amber-900/30"}`,children:e.jsx(Ie,{className:`w-5 h-5 ${c.tieneAsignacion?"text-muted-foreground":"text-amber-600 dark:text-amber-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium truncate",children:c.nombre}),!c.tieneAsignacion&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-200 flex-shrink-0",children:"Sin asignar"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c.transacciones," ",c.transacciones===1?"transacci√≥n":"transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",D(Number(c.monto)||0,F)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[p,"%"]})})]},c.nombre)}),(()=>{const c=x.reduce((l,p)=>l+(Number(p.monto)||0),0);return c>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Ie,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x.reduce((l,p)=>l+(Number(p.transacciones)||0),0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",D(c,F)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:[N==="brutas"?"Ventas Brutas":N==="descuentos"?"Descuentos":"Ventas Netas"," por Cliente"]}),e.jsxs(oe,{children:["Ranking de ",N==="descuentos"?"clientes con m√°s descuentos":"mejores clientes"]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):a()?e.jsx("div",{className:"space-y-3",children:(()=>{if(B==="otros"&&N==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const o=B==="ventas"?N==="brutas"?O.ventasBrutas:N==="descuentos"?O.descuentos:O.ventasNetas:O.otrosIngresos;if(r.length===0&&(Number(o)||0)>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ps,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin cliente asignado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",D(Number(o)||0,F)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(ps,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",D(Number(o)||0,F)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const d=r.reduce((l,p)=>{const g=String((p==null?void 0:p.cliente_nombre)||"Sin cliente asignado");return l[g]||(l[g]={nombre:g,transacciones:0,monto:0,email:p==null?void 0:p.cliente_email,telefono:p==null?void 0:p.cliente_telefono}),l[g].transacciones+=1,l[g].monto+=Number(ge(p,N))||0,l},{}),x=Object.values(d).sort((l,p)=>(Number(p.monto)||0)-(Number(l.monto)||0)),h=x.reduce((l,p)=>l+(Number(p.monto)||0),0);if(B==="otros"){const l=(Number(o)||0)-h;if(l>.01){const p=x.find(g=>g.nombre==="Sin cliente asignado");p?(p.monto+=l,p.transacciones+=s.length):x.push({nombre:"Sin cliente asignado",transacciones:s.length,monto:l}),x.sort((g,y)=>(Number(y.monto)||0)-(Number(g.monto)||0))}}const c=x.slice(0,10);return e.jsxs(e.Fragment,{children:[c.map(l=>{const p=x.reduce((y,b)=>y+(Number(b.monto)||0),0),g=p>0?((Number(l.monto)||0)/p*100).toFixed(1):"0.0";return e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ps,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:l.nombre}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-0.5",children:[e.jsxs("p",{children:[l.transacciones," ",l.transacciones===1?"compra":"compras"]}),l.telefono&&e.jsx("p",{className:"text-xs",children:l.telefono}),l.email&&e.jsx("p",{className:"text-xs truncate",children:l.email})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",D(Number(l.monto)||0,F)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[g,"%"]})})]},l.nombre)}),(()=>{const l=x.reduce((p,g)=>p+(Number(g.monto)||0),0);return l>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(ps,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x.reduce((p,g)=>p+(Number(g.transacciones)||0),0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",D(l,F)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]})]})]})]})})()}),e.jsx(es,{value:"catalogo",className:"mt-6",children:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{className:"flex items-center justify-between",children:["Cat√°logo de Productos",e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(R,{variant:"outline",size:"sm",onClick:()=>{Sa(),ae({title:"Actualizado",description:"La lista de productos se ha actualizado correctamente"})},children:[e.jsx(On,{className:"mr-2 h-4 w-4"}),"Actualizar"]}),e.jsxs(ds,{open:Qa,onOpenChange:xt,children:[e.jsx(fa,{asChild:!0,children:e.jsxs(R,{children:[e.jsx(Pt,{className:"mr-2 h-4 w-4"}),"Nuevo Producto"]})}),e.jsxs(ms,{className:"sm:max-w-[425px]",children:[e.jsxs(us,{children:[e.jsx(xs,{children:"Agregar Nuevo Producto"}),e.jsx(hs,{children:"Completa la informaci√≥n del producto para agregarlo al cat√°logo."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-name",className:"text-right",children:"Nombre"}),e.jsx(z,{id:"product-name",value:ht,onChange:s=>Xt(s.target.value),className:"col-span-3",placeholder:"Nombre del producto"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-image",className:"text-right",children:"Imagen"}),e.jsx(z,{id:"product-image",type:"file",accept:"image/*",onChange:s=>{var t;return na(((t=s.target.files)==null?void 0:t[0])||null)},className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-price",className:"text-right",children:"Precio"}),e.jsx(z,{id:"product-price",type:"number",value:pt,onChange:s=>Zt(s.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-account",className:"text-right",children:"Cuenta"}),e.jsxs("div",{className:"col-span-3 flex items-center p-2 border rounded-md bg-muted/50",children:[e.jsx("span",{className:"text-sm font-medium",children:"4001 - Ventas"}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"(cuenta fija)"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(he,{value:ta,onValueChange:s=>aa(s==="none"?"":s),children:[e.jsx(pe,{className:"col-span-3",children:e.jsx(ye,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(je,{children:[e.jsx(T,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),J.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>e.jsx(T,{value:s.id,children:s.nombre},s.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(ss,{id:"product-description",value:ea,onChange:s=>sa(s.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]})]}),e.jsxs(Gs,{children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>xt(!1),children:"Cancelar"}),e.jsx(R,{onClick:gn,disabled:zs,children:zs?"Guardando...":"Guardar Producto"})]})]})]}),e.jsx(ds,{open:sn,onOpenChange:qs,children:e.jsxs(ms,{className:"sm:max-w-[425px]",children:[e.jsxs(us,{children:[e.jsx(xs,{children:"Editar Producto"}),e.jsx(hs,{children:"Modifica la informaci√≥n del producto."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-name",className:"text-right",children:"Nombre *"}),e.jsx(z,{id:"edit-product-name",value:Nt,onChange:s=>bt(s.target.value),className:"col-span-3",placeholder:"Ej: Consultor√≠a, Producto X"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-price",className:"text-right",children:"Precio *"}),e.jsx(z,{id:"edit-product-price",type:"number",value:vt,onChange:s=>yt(s.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-image",className:"text-right",children:"Imagen"}),e.jsxs("div",{className:"col-span-3 space-y-2",children:[e.jsx(z,{id:"edit-product-image",type:"file",accept:"image/*",onChange:fn}),ca&&e.jsx("div",{className:"aspect-square w-24 mx-auto",children:e.jsx("img",{src:ca,alt:"Preview",className:"w-full h-full object-cover rounded-md"})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(ss,{id:"edit-product-description",value:ia,onChange:s=>wt(s.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(he,{value:la||"none",onValueChange:s=>da(s==="none"?"":s),children:[e.jsx(pe,{className:"col-span-3",children:e.jsx(ye,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(je,{children:[e.jsx(T,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),J.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>e.jsx(T,{value:s.id,children:s.nombre},s.id))]})]})]})]}),e.jsxs(Gs,{children:[e.jsx(R,{type:"button",variant:"outline",onClick:()=>qs(!1),children:"Cancelar"}),e.jsx(R,{onClick:Nn,disabled:zs,children:zs?"Actualizando...":"Actualizar Producto"})]})]})})]})]}),e.jsx(oe,{children:"Gestiona el cat√°logo de productos y servicios con cuentas contables asignadas"})]}),e.jsxs(Y,{children:[e.jsxs(Ve,{className:"mb-6",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsxs(Re,{children:[e.jsx("strong",{children:"Recomendaci√≥n:"}),' Asignar subcuentas a cada producto ayuda a llevar un mejor control contable. La cuenta predeterminada es "4001 - Ventas".']})]}),e.jsx("div",{className:"space-y-6",children:Qs?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):Se.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay productos de servicios registrados a√∫n"}):e.jsxs("div",{className:"space-y-6",children:[J.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>{const t=Se.filter(r=>r.subcuenta_id===s.id);return t.length===0?null:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{className:"text-lg flex items-center",children:[e.jsx(Ie,{className:"mr-2 h-5 w-5"}),"Subcuenta: ",s.nombre]}),e.jsxs(oe,{children:[t.length," producto",t.length!==1?"s":""]})]}),e.jsx(Y,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(r=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[r.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:r.imagen_url,alt:r.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:r.nombre}),r.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:r.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",r.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{variant:"outline",size:"sm",onClick:()=>ua(r),className:"flex-1",children:"Editar"}),e.jsx(R,{variant:"outline",size:"sm",onClick:()=>At.mutate(r.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},r.id))})})]},s.id)}),(()=>{const s=Se.filter(t=>!t.subcuenta_id);return s.length===0?null:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{className:"text-lg flex items-center",children:[e.jsx(ja,{className:"mr-2 h-5 w-5"}),"Cuenta General: 4001 - Ventas"]}),e.jsxs(oe,{children:[s.length," producto",s.length!==1?"s":""," sin subcuenta espec√≠fica"]})]}),e.jsx(Y,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(t=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[t.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:t.nombre}),t.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",t.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(R,{variant:"outline",size:"sm",onClick:()=>ua(t),className:"flex-1",children:"Editar"}),e.jsx(R,{variant:"outline",size:"sm",onClick:()=>At.mutate(t.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},t.id))})})]})})()]})})]})]})})]}),e.jsx(ds,{open:en,onOpenChange:Us,children:e.jsxs(ms,{children:[e.jsxs(us,{children:[e.jsx(xs,{children:"‚ùå Cancelar Transacci√≥n"}),e.jsx(hs,{children:"Esta acci√≥n crear√° un asiento contable de reversi√≥n. La transacci√≥n original quedar√° marcada como cancelada pero mantendr√° toda su trazabilidad."})]}),e.jsxs("div",{className:"space-y-4",children:[qe&&e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Transacci√≥n a cancelar:"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",qe.descripcion]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Monto:"})," $",P(qe.monto_total)]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(qe.created_at).toLocaleDateString("es-ES")]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"motivo-cancelacion",children:"Motivo de la Cancelaci√≥n *"}),e.jsx(ss,{id:"motivo-cancelacion",placeholder:"Ej: Error en registro, cliente cancel√≥ pedido, etc.",value:Ws,onChange:s=>gt(s.target.value),rows:3})]}),e.jsxs(Ve,{children:[e.jsx(L,{className:"h-4 w-4"}),e.jsxs(Re,{className:"text-xs",children:[e.jsx("strong",{children:"¬øQu√© suceder√°?"}),e.jsxs("ul",{className:"list-disc ml-4 mt-1 space-y-1",children:[e.jsx("li",{children:"Se crear√° un asiento de reversi√≥n autom√°ticamente"}),e.jsx("li",{children:'La transacci√≥n original se marcar√° como "cancelada"'}),e.jsx("li",{children:"Si es venta de inventario, el stock se restaurar√°"}),e.jsx("li",{children:"Ambas transacciones quedar√°n visibles para auditor√≠a"})]})]})]})]}),e.jsxs(Gs,{children:[e.jsx(R,{variant:"outline",onClick:()=>{Us(!1),gt(""),jt(null)},disabled:ft,children:"Cancelar"}),e.jsx(R,{variant:"destructive",onClick:pn,disabled:ft||!Ws.trim(),children:ft?"Cancelando...":"Confirmar Cancelaci√≥n"})]})]})})]})]})};export{Hn as default};
