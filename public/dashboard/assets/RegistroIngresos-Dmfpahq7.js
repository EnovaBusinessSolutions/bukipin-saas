import{c as Nn,r as h,a as bn,f as bs,e as ts,j as e,b as Ks,P as Ft,d as Dt,B as z,C as It,g as Tt,h as $t,u as vn,i as yn,k as wn,l as Sn,m as Cn,n as _n,o as Pn,p as Fn,q as Dn,s as In,D as ds,t as ms,v as us,w as xs,x as B,y as hs,S as Me,z as ua,R as De,A as q,L as j,I as U,E as Ys,F as ae,T as xa,G as ha,H as Ze,J as es,K as W,M as Y,N as G,O as oe,Q as H,U as pa,V as Ie,W as ga,X as ps,Y as Ve,Z as Re,_ as pe,$ as ge,a0 as ye,a1 as je,a2 as k,a3 as ss,a4 as Tn,a5 as $n,a6 as ja,a7 as gs,a8 as kn,a9 as fa,aa as Na,ab as ba,ac as js,ad as An,ae as Gs,af as va,ag as ya,ah as Hs,ai as En,aj as Mn,ak as Vn,al as Rn,am as On,an as _t}from"./index-DDry69G7.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ln=Nn("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),zn=m=>{const _=(m==null?void 0:m.data)??m??[];return Array.isArray(_)?_:[]},Bn=(m=10)=>{const[_,P]=h.useState([]),[S,T]=h.useState(!0),[ce,ue]=h.useState(null),Q=async()=>{try{T(!0),ue(null);const Z=await bn(`/api/transacciones/ingresos/recientes?limit=${encodeURIComponent(String(m))}`,{method:"GET"}),we=zn(Z).map(Ne=>{var Ge;return{...Ne,asiento_fecha:Ne.asiento_fecha??(Array.isArray(Ne.asiento)&&Ne.asiento.length>0?((Ge=Ne.asiento[0])==null?void 0:Ge.fecha)??null:null)}});P(we)}catch(Z){console.error("Error fetching transacciones recientes:",Z),ue((Z==null?void 0:Z.message)||"Error desconocido")}finally{T(!1)}};return h.useEffect(()=>{let Z=!0;Q();const we=window.setInterval(()=>{Z&&Q()},3e4);return()=>{Z=!1,window.clearInterval(we)}},[m]),{transacciones:_,loading:S,error:ce,refetch:Q}};function Un({value:m,onChange:_,className:P,placeholder:S="Selecciona un rango",disabled:T}){const ce=h.useMemo(()=>m!=null&&m.from?m.to?`${bs(m.from,"dd/MM/yyyy",{locale:ts})} ‚Äì ${bs(m.to,"dd/MM/yyyy",{locale:ts})}`:bs(m.from,"dd/MM/yyyy",{locale:ts}):S,[m,S]);return e.jsx("div",{className:Ks("grid gap-2",P),children:e.jsxs(Ft,{children:[e.jsx(Dt,{asChild:!0,children:e.jsxs(z,{type:"button",variant:"outline",disabled:T,className:Ks("w-full justify-start text-left font-normal",!(m!=null&&m.from)&&"text-muted-foreground"),children:[e.jsx(It,{className:"mr-2 h-4 w-4"}),ce]})}),e.jsxs(Tt,{className:"w-auto p-0",align:"start",children:[e.jsx($t,{initialFocus:!0,mode:"range",numberOfMonths:2,selected:m,onSelect:_,locale:ts,defaultMonth:(m==null?void 0:m.from)??new Date}),e.jsxs("div",{className:"flex items-center justify-between gap-2 border-t p-2",children:[e.jsx(z,{type:"button",variant:"ghost",size:"sm",onClick:()=>_(void 0),children:"Limpiar"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:m!=null&&m.from&&!(m!=null&&m.to)?"Elige la fecha fin":" "})]})]})]})})}async function Te(m,_={}){const P=await fetch(m,{credentials:"include",headers:{"Content-Type":"application/json",..._.headers||{}},..._}),S=await P.json().catch(()=>({}));if(!P.ok){const T=(S==null?void 0:S.error)||(S==null?void 0:S.message)||`HTTP ${P.status}`;throw new Error(T)}return(S==null?void 0:S.data)??S}async function Pt(m,_={}){const P=(_==null?void 0:_.body)??{};try{if(m==="registrar-ingreso")return{data:await Te("/api/ingresos",{method:"POST",body:JSON.stringify(P)}),error:null};if(m==="cancelar-ingreso"){const T=P==null?void 0:P.transaccionId;return{data:await Te(`/api/ingresos/${encodeURIComponent(T)}/cancelar`,{method:"POST",body:JSON.stringify({motivoCancelacion:P==null?void 0:P.motivoCancelacion})}),error:null}}return{data:await Te(`/api/functions/${encodeURIComponent(m)}`,{method:"POST",body:JSON.stringify(P)}),error:null}}catch(S){return{data:null,error:{message:(S==null?void 0:S.message)||String(S)}}}}const Ye=m=>{if(m==null)return 0;const _=typeof m=="string"?Number(m):m;return Number.isFinite(_)?_:0},I=m=>Ye(m).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),A=(m,_)=>{const P=Ye(m);let S=P,T="";return _==="miles"?(S=P/1e3,T=" K"):_==="millones"&&(S=P/1e6,T=" M"),S.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})+T},Ns=m=>{if(!m)return m;const _=m.id??m._id,P=m.fecha??m.createdAt??m.created_at??m.updatedAt??m.updated_at,S=P?String(P):void 0,T=S?S.slice(0,10):m.created_at,ce=Ye(m.monto_total??m.montoTotal??m.total??m.monto_total),ue=Ye(m.monto_descuento??m.montoDescuento??m.descuento),Q=Ye(m.monto_neto??m.montoNeto??m.neto??ce-ue),Z=Ye(m.monto_pagado??m.montoPagado??m.pagado??Q),fe=Ye(m.saldo_pendiente??m.saldoPendiente??m.pendiente??Math.max(0,Q-Z)),we=m.tipo_ingreso??m.tipoIngreso??m.tipo,Ne=m.metodo_pago??m.metodoPago,Ge=m.tipo_pago??m.tipoPago;return{...m,id:_,_id:m._id??_,created_at:m.created_at??T,fecha:m.fecha??S,tipo_ingreso:we,tipoIngreso:m.tipoIngreso??we,metodo_pago:Ne,metodoPago:m.metodoPago??Ne,tipo_pago:Ge,tipoPago:m.tipoPago??Ge,monto_total:ce,montoTotal:m.montoTotal??ce,total:m.total??ce,monto_descuento:ue,montoDescuento:m.montoDescuento??ue,monto_neto:Q,montoNeto:m.montoNeto??Q,neto:m.neto??Q,monto_pagado:Z,montoPagado:m.montoPagado??Z,pagado:m.pagado??Z,saldo_pendiente:fe,saldoPendiente:m.saldoPendiente??fe,pendiente:m.pendiente??fe}},ie=(m,_)=>{const P=Ns(m);return _==="brutas"?P.monto_total||0:_==="descuentos"?P.monto_descuento||0:_==="netas"&&(P.monto_neto||P.monto_total)||0},fs=m=>{const _=(m??"").toString().slice(0,10),[P,S,T]=_.split("-").map(Number);return new Date(P,(S||1)-1,T||1)},qn=m=>{const{x:_,y:P,width:S,height:T,name:ce,value:ue,porcentaje:Q}=m,fe=ce==="Efectivo"?"hsl(180 50% 55%)":"hsl(180 45% 45%)",we=S>100&&T>70;return e.jsxs("g",{children:[e.jsx("rect",{x:_,y:P,width:S,height:T,fill:fe,stroke:"#fff",strokeWidth:2}),we&&e.jsxs(e.Fragment,{children:[e.jsx("text",{x:_+S/2,y:P+T/2-20,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontWeight:"bold",fontSize:"16px",style:{userSelect:"none"},children:ce}),e.jsxs("text",{x:_+S/2,y:P+T/2+5,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:["$",A(ue,"general")]}),e.jsxs("text",{x:_+S/2,y:P+T/2+25,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:[Q,"%"]})]})]})},Wn=({active:m,payload:_,scaleFormat:P})=>{if(m&&_&&_.length){const S=_[0].payload,T=S.name==="Efectivo";return e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-lg p-3",children:[e.jsx("p",{className:"font-bold text-foreground mb-1",children:S.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Monto: ",e.jsxs("span",{className:"font-semibold text-foreground",children:["$",A(S.value,P)]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Porcentaje: ",e.jsxs("span",{className:"font-semibold text-foreground",children:[S.porcentaje,"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2 italic",children:T?"Se registra en Efectivo (Caja)":"Se registra en Bancos"})]})}return null},Kn=()=>{const{ventasResumen:m,loading:_,refetch:P}=vn(),{transacciones:S,loading:T,refetch:ce}=Bn(1e3),ue=(S??[]).map(Ns),{data:Q=[]}=yn(),{data:Z}=wn(),fe=(Z==null?void 0:Z.cuentasFlat)||[],{data:we=[],isLoading:Ne,refetch:Ge}=Sn(),{data:Se=[],isLoading:Js,refetch:wa}=Cn(),{data:ke=[],isLoading:Sa}=_n(),Ca=Pn(),_a=Fn(),kt=Dn(),Pa=In(),[M,He]=h.useState(""),[Fa,Da]=h.useState(!1),[Ia,Ta]=h.useState(""),[vs,At]=h.useState(""),[E,Et]=h.useState(""),[be,Oe]=h.useState(""),[ys,Ke]=h.useState(""),[Mt,ws]=h.useState(!1),[X,Vt]=h.useState(""),[ve,Qs]=h.useState(""),[Je,Ss]=h.useState(""),[Ce,Cs]=h.useState(""),[_e,_s]=h.useState(""),[$e,Ps]=h.useState(""),[Fs,Rt]=h.useState(""),[Pe,Ot]=h.useState(""),[Ds,Xs]=h.useState(""),[Ae,Is]=h.useState([]),[$a,as]=h.useState(!1),[y,Ts]=h.useState(null),[Qe,Zs]=h.useState("historico"),[le,ns]=h.useState(""),[V,ka]=h.useState("diario"),[$,Aa]=h.useState("general"),[N,Ea]=h.useState("brutas"),[R,Ma]=h.useState("ventas"),[de,Va]=h.useState(new Date),[O,Ra]=h.useState(new Date),[rs,Oa]=h.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[os,La]=h.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[is,za]=h.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[L,Lt]=h.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]}),[Yn,$s]=h.useState([]),[Xe,Ba]=h.useState([]),[zt,Bt]=h.useState(""),[Ut,qt]=h.useState(""),[Ua,Wt]=h.useState(void 0);function Yt(s){const t=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),i=String(s.getDate()).padStart(2,"0");return`${t}-${r}-${i}`}function qa(s){const[t,r,i]=String(s).split("-").map(Number);return!t||!r||!i?null:new Date(t,r-1,i,0,0,0,0)}function Wa(s){const[t,r,i]=String(s).split("-").map(Number);return!t||!r||!i?null:new Date(t,r-1,i,23,59,59,999)}const ks=s=>{const t=fs(s),r=zt?qa(zt):null,i=Ut?Wa(Ut):null;return!(r&&t<r||i&&t>i)},Ya=s=>{Wt(s);const t=s==null?void 0:s.from,r=s==null?void 0:s.to;Bt(t?Yt(t):""),qt(r?Yt(r):"")},[xe,Gt]=h.useState("todos"),[he,Ht]=h.useState("todas"),[te,Kt]=h.useState(""),[cs,Ga]=h.useState("subcuenta"),[Le,As]=h.useState(null),[Ha,et]=h.useState(!1),[ne,st]=h.useState(""),[ze,ls]=h.useState(""),[Ee,tt]=h.useState("1"),[Es,at]=h.useState(0),[nt,Ms]=h.useState(!0),[rt,ot]=h.useState("0"),[Be,it]=h.useState("monto"),[K,Vs]=h.useState([]),[Ue,ct]=h.useState(""),[Rs,lt]=h.useState(""),[Os,dt]=h.useState("1"),[mt,Jt]=h.useState("0"),[qe,Ka]=h.useState("monto"),[se,Ls]=h.useState([]),[Ja,ut]=h.useState(!1),[xt,Qt]=h.useState(""),[ht,Xt]=h.useState(""),[Zt,ea]=h.useState(""),[Gn,Qa]=h.useState("4001"),[sa,ta]=h.useState(""),[Xa,aa]=h.useState(null);h.useState(null);const[zs,Bs]=h.useState(!1),[Za,Us]=h.useState(!1),[We,pt]=h.useState(null),[qs,gt]=h.useState(""),[jt,na]=h.useState(!1),[en,Ws]=h.useState(!1),[sn,ra]=h.useState(null),[ft,Nt]=h.useState(""),[bt,vt]=h.useState(""),[oa,yt]=h.useState(""),[tn,wt]=h.useState(null),[ia,St]=h.useState(null),[ca,la]=h.useState(""),Fe=we||[],an=s=>{var r;st(s);const t=Fe.find(i=>i.id===s);if(t){const i=t.precio_venta,n=i&&i>0?i.toString():((r=t.costo_unitario)==null?void 0:r.toString())||"0",a=i&&i>0;Ms(a),ls(n),at(t.cantidad_stock||0),Ke(`Venta de ${t.nombre}`);const d=((i&&i>0?i:t.costo_unitario||0)*parseFloat(Ee)).toFixed(2);Oe(d)}},nn=s=>{if(ls(s),ne&&s){const t=(parseFloat(s)*parseFloat(Ee||"1")).toFixed(2);Oe(t)}},rn=()=>{if(!Ue)return;const s=Se.find(d=>d.id===Ue);if(!s)return;const t=parseFloat(Os)||1,r=parseFloat(mt)||0,i=s.precio*t,n=qe==="porcentaje"?i*(r/100):r,a=Math.max(0,i-n),c=se.findIndex(d=>d.id===Ue);if(c!==-1){const d=[...se];d[c].cantidad+=t,d[c].descuento+=n;const x=d[c].precio*d[c].cantidad;d[c].subtotal=Math.max(0,x-d[c].descuento),Ls(d)}else Ls([...se,{id:s.id,nombre:s.nombre,precio:s.precio,cantidad:t,descuento:n,subtotal:a,imagen_url:s.imagen_url}]);ct(""),dt("1"),lt(""),Jt("0")},on=s=>{Ls(se.filter(t=>t.id!==s))},cn=()=>{if(!ne)return;const s=Fe.find(x=>x.id===ne);if(!s)return;const t=parseFloat(Ee)||1,r=parseFloat(ze)||0,i=parseFloat(rt)||0,n=r*t,a=Be==="porcentaje"?n*(i/100):i,c=Math.max(0,n-a),d=K.findIndex(x=>x.id===ne);if(d!==-1){const x=[...K];x[d].cantidad+=t,x[d].descuento+=a;const p=x[d].precioUnitario*x[d].cantidad;x[d].subtotal=Math.max(0,p-x[d].descuento),Vs(x)}else Vs([...K,{id:ne,nombre:s.nombre,precioUnitario:r,cantidad:t,descuento:a,subtotal:c,stockDisponible:s.cantidad_stock||0,costoUnitario:s.costo_unitario||0,imagen_url:s.imagen_url}]);st(""),tt("1"),ls(""),ot("0"),it("monto"),at(0),Ms(!0),ae({title:"‚úÖ Producto agregado",description:`${s.nombre} agregado a la venta`})},ln=s=>{Vs(K.filter(t=>t.id!==s)),ae({title:"Producto eliminado",description:"El producto ha sido removido de la venta"})};h.useEffect(()=>{if(M==="precargados"&&se.length>0){const s=se.reduce((t,r)=>t+r.subtotal,0).toFixed(2);Oe(s),Ke(`Venta de ${se.length} producto(s)`)}},[se,M]),h.useEffect(()=>{if(M==="inventariados"&&K.length>0){const s=K.reduce((t,r)=>t+r.subtotal,0).toFixed(2);Oe(s),Ke(`Venta de ${K.length} producto(s) de inventario`)}},[K,M]);const dn=s=>{ct(s);const t=Se.find(r=>r.id===s);t&&lt(t.precio.toString())},da=()=>{const s=[];return M||s.push("Tipo de Ingreso"),M==="precargados"?se.length===0&&s.push("Debe agregar al menos un producto"):M==="inventariados"?K.length===0&&s.push("Debe agregar al menos un producto del inventario"):(M==="general"||M==="otros")&&(ys.trim()||s.push("Descripci√≥n")),M!=="precargados"&&M!=="inventariados"&&(!be||parseFloat(be)<=0)&&s.push("Monto Total"),(E==="credito"||E==="parcial")&&(X||s.push("Tipo de Cliente"),X==="recurrente"&&!ve&&s.push("Cliente Seleccionado"),X==="nuevo"&&(Je.trim()||s.push("Nombre del Cliente"),Ce.trim()||s.push("Tel√©fono del Cliente"),_e.trim()||s.push("Email del Cliente")),Fs||s.push("Fecha de Vencimiento"),E==="parcial"&&((!Pe||parseFloat(Pe)<=0)&&s.push("Monto Abonado"),be&&Pe&&parseFloat(Pe)>=parseFloat(be)&&s.push("Monto Abonado debe ser menor al total"))),(E==="contado"||E==="parcial")&&!vs&&s.push("M√©todo de Pago"),E||s.push("Tipo de Pago"),s},J=s=>da().includes(s),mn=(s,t,r)=>{const i=[];return!ke||ke.length===0||ke.forEach(n=>{n.telefono&&s&&n.telefono.trim()===s.trim()&&i.push(`El tel√©fono ${s} ya est√° registrado para el cliente "${n.nombre}"`),n.email&&t&&n.email.trim().toLowerCase()===t.trim().toLowerCase()&&i.push(`El correo ${t} ya est√° registrado para el cliente "${n.nombre}"`),n.rfc&&r&&n.rfc.trim().toUpperCase()===r.trim().toUpperCase()&&i.push(`El RFC ${r} ya est√° registrado para el cliente "${n.nombre}"`)}),i};h.useEffect(()=>{if(X==="nuevo"&&(Ce||_e||$e)){const s=mn(Ce,_e,$e);Is(s)}else Is([])},[Ce,_e,$e,X,ke]),h.useEffect(()=>{(async()=>{var t;try{const r=await Te("/api/ingresos/asientos-directos"),i=(r==null?void 0:r.asientos)??((t=r==null?void 0:r.data)==null?void 0:t.asientos)??r??[],n=null;if(!i)return;const a=i.filter(c=>c.detalle_asientos.some(d=>d.cuenta_codigo.startsWith("4")&&d.cuenta_codigo!=="4003"&&Number(d.haber)>0));Ba(a)}catch(r){console.error("Error al cargar asientos directos:",r)}})()},[]),h.useEffect(()=>{(async()=>{var t,r;try{let i,n;V==="diario"?(i=new Date(de),i.setHours(0,0,0,0),n=new Date(de),n.setHours(23,59,59,999)):V==="mensual"?(i=new Date(O.getFullYear(),O.getMonth(),1),n=new Date(O.getFullYear(),O.getMonth()+1,0,23,59,59,999)):(i=new Date(new Date().getFullYear(),0,1),n=new Date(new Date().getFullYear(),11,31,23,59,59,999));const a=await Te(`/api/ingresos/asientos?start=${encodeURIComponent(i.toISOString().split("T")[0])}&end=${encodeURIComponent(n.toISOString().split("T")[0])}`),c=(a==null?void 0:a.asientos)??((t=a==null?void 0:a.data)==null?void 0:t.asientos)??[],d=(a==null?void 0:a.detalles)??((r=a==null?void 0:a.data)==null?void 0:r.detalles)??[],x=null;if(!c||c.length===0){Lt({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]});return}const p=c.map(v=>v.id);let o=0,l=0,u=0;const f={};c.forEach(v=>{const g=d.filter(F=>F.asiento_id===v.id),b=fs(v.fecha);let C;V==="diario"?C="Hoy":V==="mensual"?C=`D√≠a ${b.getDate()}`:C=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][b.getMonth()],f[C]||(f[C]={ventasBrutas:0,descuentos:0,otrosIngresos:0}),g.forEach(F=>{const D=F.debe||0,ee=F.haber||0,me=F.cuenta_codigo;if(R==="ventas"){if(me==="4001"){const re=ee-D;o+=re,f[C].ventasBrutas+=re}if(me==="4003"){const re=D-ee;l+=re,f[C].descuentos+=re}}else if(me.startsWith("4")&&me!=="4001"&&me!=="4003"){const re=ee-D;u+=re,f[C].otrosIngresos+=re}})});let w=[];if(V==="diario"){const v=f.Hoy||{ventasBrutas:0,descuentos:0,otrosIngresos:0};w=[{periodo:"Hoy",ventasBrutas:v.ventasBrutas,descuentos:v.descuentos,ventasNetas:v.ventasBrutas-v.descuentos,otrosIngresos:v.otrosIngresos}]}else if(V==="mensual"){const v=new Date(O.getFullYear(),O.getMonth()+1,0).getDate();w=Array.from({length:v},(g,b)=>{const F=`D√≠a ${b+1}`,D=f[F]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:F,ventasBrutas:D.ventasBrutas,descuentos:D.descuentos,ventasNetas:D.ventasBrutas-D.descuentos,otrosIngresos:D.otrosIngresos}})}else w=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"].map(g=>{const b=f[g]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:g,ventasBrutas:b.ventasBrutas,descuentos:b.descuentos,ventasNetas:b.ventasBrutas-b.descuentos,otrosIngresos:b.otrosIngresos}});Lt({ventasBrutas:o,descuentos:l,ventasNetas:o-l,otrosIngresos:u,detallesPorPeriodo:w})}catch(i){console.error("Error calculando anal√≠ticas desde asientos:",i)}})()},[V,de,O,R]),h.useEffect(()=>{(async()=>{try{const r=async d=>{var F;const x=new Date;let p,o;if(d==="dia")p=de.toISOString().split("T")[0],o=p;else if(d==="mes"){const D=O.getMonth(),ee=O.getFullYear(),me=new Date(ee,D,1),re=new Date(ee,D+1,0);p=me.toISOString().split("T")[0],o=re.toISOString().split("T")[0]}else{const D=x.getFullYear();p=`${D}-01-01`,o=`${D}-12-31`}const l=await Te(`/api/ingresos/detalles?start=${encodeURIComponent(p)}&end=${encodeURIComponent(o)}`),u=(l==null?void 0:l.detalles)??((F=l==null?void 0:l.data)==null?void 0:F.detalles)??l??[],f=null;let w=0,v=0,g=0;(u||[]).forEach(D=>{const ee=Number(D.debe)||0,me=Number(D.haber)||0,re=D.cuenta_codigo;re==="4001"?w+=me-ee:re==="4003"?v+=ee-me:re!=null&&re.startsWith("4")&&(g+=me-ee)});const b=w-v,C=b+g;return{ventasBrutas:w,descuentos:v,ventasNetas:b,otrosIngresos:g,totalIngresos:C}},i=async()=>{var d;try{let x,p=new Date;V==="diario"?(x=new Date(de),x.setHours(0,0,0,0),p=new Date(de),p.setHours(23,59,59,999)):V==="mensual"?(x=new Date(O.getFullYear(),O.getMonth(),1),p=new Date(O.getFullYear(),O.getMonth()+1,0,23,59,59,999)):(x=new Date(O.getFullYear(),0,1),p=new Date(O.getFullYear(),11,31,23,59,59,999));const o=await Te(`/api/inventario/movimientos?tipo=venta&start=${encodeURIComponent(x.toISOString())}&end=${encodeURIComponent(p.toISOString())}`),l=(o==null?void 0:o.movimientos)??((d=o==null?void 0:o.data)==null?void 0:d.movimientos)??o??[],u=null;$s(l||[])}catch(x){console.error("Error en cargarMovimientosInventario:",x),$s([])}},[n,a,c]=await Promise.all([r("dia"),r("mes"),r("ano")]);Oa(n),La(a),za(c)}catch(r){console.error("Error calculando totales:",r)}})(),(async()=>{var r;try{let i,n=new Date;V==="diario"?(i=new Date(de),i.setHours(0,0,0,0),n=new Date(de),n.setHours(23,59,59,999)):V==="mensual"?(i=new Date(O.getFullYear(),O.getMonth(),1),n=new Date(O.getFullYear(),O.getMonth()+1,0,23,59,59,999)):(i=new Date(O.getFullYear(),0,1),n=new Date(O.getFullYear(),11,31,23,59,59,999));const a=await Te(`/api/inventario/movimientos?tipo=venta&start=${encodeURIComponent(i.toISOString())}&end=${encodeURIComponent(n.toISOString())}`),c=(a==null?void 0:a.movimientos)??((r=a==null?void 0:a.data)==null?void 0:r.movimientos)??a??[],d=null;$s(c||[])}catch(i){console.error("Error en loadMovimientos:",i),$s([])}})()},[de,O,V,S]);const un=async s=>{var r,i;const t=String(s??"").trim();if(et(!0),As(null),!t||t==="undefined"||t==="null"){et(!1);return}try{const n=await Te(`/api/asientos/by-transaccion?source=ingreso&id=${encodeURIComponent(t)}`),a=(n==null?void 0:n.asiento)??((r=n==null?void 0:n.data)==null?void 0:r.asiento)??n??null;As(a)}catch(n){const a=String((n==null?void 0:n.message)??"");(n==null?void 0:n.status)===404||((i=n==null?void 0:n.response)==null?void 0:i.status)===404||a.includes("404")||(console.error("Error en loadAsientosContables:",n),ae({title:"Error",description:"Error inesperado al cargar asientos",variant:"destructive"})),As(null)}finally{et(!1)}},xn=async()=>{var t;const s=da();if(s.length>0){ae({title:"‚ö†Ô∏è Campos requeridos faltantes",description:`Debes completar: ${s.join(", ")}`,variant:"destructive"});return}if(M==="inventariados"){if(K.length===0){ae({title:"‚ö†Ô∏è No hay productos",description:"Debes agregar al menos un producto del inventario a la venta",variant:"destructive"});return}for(const r of K)if(r.cantidad>r.stockDisponible){const i=Fe.find(n=>n.id===r.id);Ts({productName:r.nombre,requested:r.cantidad,available:r.stockDisponible,costoPorUnidad:(i==null?void 0:i.costo_unitario)||0,costoTotal:((i==null?void 0:i.costo_unitario)||0)*r.cantidad}),as(!0);return}await Ct();return}if(M==="inventariados"&&ne){const r=parseFloat(Ee||"1");if(r>Es){const i=Fe.find(d=>d.id===ne);let n=(i==null?void 0:i.costo_unitario)||0;if(n===0){const d=await Te(`/api/inventario/productos/${encodeURIComponent(ne)}/movimientos?tipo=compra`),x=(d==null?void 0:d.movimientos)??((t=d==null?void 0:d.data)==null?void 0:t.movimientos)??d??[];if(x&&x.length>0){let p=0,o=0;for(const l of x)l.costo_unitario>0&&l.cantidad>0&&(p+=l.costo_unitario*l.cantidad,o+=l.cantidad);o>0&&(n=p/o)}}const a=r-Es,c=n*a;Ts({productName:(i==null?void 0:i.nombre)||"Producto",requested:r,available:Es,costoPorUnidad:n,costoTotal:c}),as(!0);return}}X==="nuevo"&&Ae.length>0&&!confirm(`Se detectaron posibles duplicados:

${Ae.join(`
`)}

¬øDeseas continuar registrando este cliente de todas formas?`)||await Ct()},Ct=async()=>{ws(!0);try{let s=null;if(X==="nuevo"&&Je.trim())try{s=(await Pa.mutateAsync({nombre:Je.trim(),email:_e.trim()||void 0,telefono:Ce.trim()||void 0,rfc:$e.trim()||void 0})).id}catch(p){console.error("Error creating client:",p),ae({title:"Error al crear cliente",description:"No se pudo crear el cliente nuevo",variant:"destructive"}),ws(!1);return}else X==="recurrente"&&ve&&(s=ve);const t=Fe.find(p=>p.id===ne);let r=ys,i=Number(be||"0"),n=null,a=0;if(M==="precargados"&&se.length>0){const p=Se.find(u=>u.id===se[0].id);n=(p==null?void 0:p.subcuenta_id)||null;const o=se.reduce((u,f)=>u+f.precio*f.cantidad,0),l=se.reduce((u,f)=>u+f.descuento,0);i=o,a=l,r=`Venta: ${se.map(u=>`${u.nombre} (x${u.cantidad})`).join(", ")}`}else M==="inventariados"&&(r="Venta de productos inventariados",i=0,n=null);M!=="precargados"&&(a=Fa?Number(Ia||"0"):0);const c=Math.max(0,Number((i-a).toFixed(2)));let d=0,x=0;if(E==="contado"?(d=c,x=0):E==="parcial"?(d=Number(Pe||"0"),x=Math.max(0,c-d)):E==="credito"&&(d=0,x=c),M==="inventariados"&&K.length>0){const p=K.reduce((w,v)=>w+v.precioUnitario*v.cantidad,0),o=K.reduce((w,v)=>w+v.descuento,0),l=p-o;let u=0,f=0;E==="contado"?(u=l,f=0):E==="parcial"?(u=Number(Pe||"0"),f=Math.max(0,l-u)):E==="credito"&&(u=0,f=l);for(const w of K){const v=Fe.find(me=>me.id===w.id);if(!v)continue;const g=K.length===1?`Venta de ${w.nombre}`:`Venta m√∫ltiple (${K.length} productos): ${w.nombre}`,b=w.subtotal/l,C=u*b,F=f*b,{data:D,error:ee}=await Pt("registrar-ingreso",{body:{tipoIngreso:"inventariados",descripcion:g,montoTotal:w.precioUnitario*w.cantidad,montoDescuento:w.descuento,cuentaPrincipalCodigo:"4001",subcuentaId:v.subcuenta_id||null,metodoPago:vs,tipoPago:E,montoPagado:C,montoPendiente:F,clienteNombre:Je.trim()||null,clienteTelefono:Ce.trim()||null,clienteEmail:_e.trim()||null,clienteRFC:$e.trim()||null,clienteId:s,fechaVencimiento:Fs||null,comentarios:Ds.trim()||null,productoId:w.id,cantidadVendida:w.cantidad,precioVenta:w.precioUnitario,costoPersonalizado:Qe==="personalizado"&&le?parseFloat(le):void 0}});if(ee)throw ee}ae({title:"‚úÖ Venta registrada exitosamente",description:`Se registraron ${K.length} productos del inventario`,duration:5e3})}else{if(!r||i<=0){ae({title:"‚ö†Ô∏è Datos incompletos",description:"Selecciona un producto v√°lido o ingresa una descripci√≥n y monto.",variant:"destructive"}),ws(!1);return}const{data:p,error:o}=await Pt("registrar-ingreso",{body:{tipoIngreso:M,descripcion:r,montoTotal:i,montoDescuento:a,cuentaPrincipalCodigo:M==="otros"?"4102":"4001",subcuentaId:n||void 0,metodoPago:vs,tipoPago:E,montoPagado:d,montoPendiente:x,clienteNombre:Je.trim()||null,clienteTelefono:Ce.trim()||null,clienteEmail:_e.trim()||null,clienteRFC:$e.trim()||null,clienteId:s,fechaVencimiento:Fs||null,comentarios:Ds.trim()||null,...M==="inventariados"&&t?{productoId:t.id,cantidadVendida:Number(Ee||"1"),precioVenta:Number(ze||"0"),costoPersonalizado:Qe==="personalizado"&&le?Number(le):void 0}:{}}});if(o)throw o;ae({title:"Ingreso registrado",description:`Asiento ${p.numeroAsiento} creado correctamente`})}await Promise.all([P(),ce()]),M==="inventariados"&&window.location.reload(),He(""),Ke(""),Oe(""),Ta(""),Da(!1),At(""),Et(""),Vt(""),Qs(""),Ss(""),Cs(""),_s(""),Ps(""),Rt(""),Ot(""),Xs(""),Is([]),ct(""),lt(""),dt("1"),Ls([]),st(""),ls(""),tt("1"),at(0),Ms(!0),Vs([]),ot("0"),it("monto")}catch(s){ae({title:"Error",description:s.message||"Error al registrar el ingreso",variant:"destructive"})}finally{ws(!1)}},hn=async()=>{if(!We||!qs.trim()){ae({title:"‚ö†Ô∏è Motivo requerido",description:"Debes ingresar el motivo de la cancelaci√≥n",variant:"destructive"});return}na(!0);try{console.log("Cancelando transacci√≥n:",We.id);const{data:s,error:t}=await Pt("cancelar-ingreso",{body:{transaccionId:We.id,motivoCancelacion:qs.trim()}});if(console.log("Respuesta de edge function:",{data:s,error:t}),t)throw console.error("Error de edge function:",t),new Error(t.message||JSON.stringify(t));if(s!=null&&s.error)throw console.error("Error en data:",s),new Error(s.error);ae({title:"‚úì Transacci√≥n cancelada",description:`Asiento de reversi√≥n ${(s==null?void 0:s.numeroAsientoReversion)||"creado"} correctamente`}),await Promise.all([P(),ce()]),gt(""),pt(null),Us(!1)}catch(s){console.error("Error completo al cancelar:",s),ae({title:"‚ùå Error al cancelar",description:(s==null?void 0:s.message)||(s==null?void 0:s.toString())||"No se pudo cancelar la transacci√≥n",variant:"destructive"})}finally{na(!1)}},pn=s=>{switch(s){case"precargados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ve,{children:[e.jsx(B,{className:"h-4 w-4"}),e.jsxs(Re,{children:[e.jsx("strong",{children:"Recordatorio:"}),' Para registrar ventas de productos precargados, primero debes agregar los productos al cat√°logo desde la pesta√±a "Cat√°logo de Productos".']})]}),e.jsxs(W,{className:"bg-muted/50",children:[e.jsx(Y,{className:"pb-3",children:e.jsx(G,{className:"text-base",children:"Agregar Productos a la Venta"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"producto-precargado",children:"Seleccionar Producto"}),e.jsxs(pe,{value:Ue,onValueChange:dn,children:[e.jsx(ge,{children:e.jsx(ye,{placeholder:Js?"Cargando productos...":"Seleccionar producto del cat√°logo"})}),e.jsx(je,{className:"max-h-80 z-50 bg-background border border-border w-full",children:Js?e.jsx(k,{value:"loading",disabled:!0,children:"Cargando productos..."}):Se.length===0?e.jsx(k,{value:"empty",disabled:!0,children:"No hay productos de servicios registrados"}):Se.map(t=>e.jsx(k,{value:t.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate mb-1",children:t.nombre}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",I(t.precio)]})]})]})},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cantidad",children:"Cantidad"}),e.jsx(U,{id:"cantidad",type:"number",placeholder:"1",min:"1",value:Os,onChange:t=>dt(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"precio-unitario",children:"Precio Unitario"}),e.jsx(U,{id:"precio-unitario",type:"number",placeholder:"0.00",value:Rs,readOnly:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"descuento-producto",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(De,{value:qe,onValueChange:t=>Ka(t),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"monto",id:"descuento-monto"}),e.jsx(j,{htmlFor:"descuento-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"porcentaje",id:"descuento-porcentaje"}),e.jsx(j,{htmlFor:"descuento-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(U,{id:"descuento-producto",type:"number",placeholder:qe==="porcentaje"?"0":"0.00",min:"0",max:qe==="porcentaje"?"100":void 0,step:qe==="porcentaje"?"1":"0.01",value:mt,onChange:t=>Jt(t.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:qe==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Subtotal con Descuento"}),e.jsx(U,{type:"text",value:Ue&&Rs?(()=>{const t=parseFloat(Rs)*parseFloat(Os||"1"),r=parseFloat(mt||"0"),i=qe==="porcentaje"?Math.max(0,t-t*r/100):Math.max(0,t-r);return`$${I(i)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(z,{type:"button",onClick:rn,disabled:!Ue,className:"w-full",variant:"secondary",children:[e.jsx(_t,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),se.length>0&&e.jsxs(W,{children:[e.jsx(Y,{className:"pb-3",children:e.jsxs(G,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",se.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",I(se.reduce((t,r)=>t+r.subtotal,0))]})]})}),e.jsx(H,{children:e.jsx("div",{className:"space-y-2",children:se.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[t.cantidad," x $",I(t.precio)," = $",I(t.cantidad*t.precio)]}),t.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",I(t.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",I(t.subtotal)]})]})]})]}),e.jsx(z,{type:"button",variant:"ghost",size:"sm",onClick:()=>on(t.id),className:"text-destructive hover:text-destructive",children:e.jsx(B,{className:"h-4 w-4"})})]},`${t.id}-${r}`))})})]}),J("Debe agregar al menos un producto")&&e.jsxs(Ve,{variant:"destructive",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx(Re,{children:"Debes agregar al menos un producto a la venta"})]})]});case"inventariados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ve,{children:[e.jsx(B,{className:"h-4 w-4"}),e.jsxs(Re,{children:[e.jsx("strong",{children:"Ventas desde Inventario:"})," Selecciona productos, aplica descuentos opcionales y agr√©galos a la venta. Si vendes m√°s de lo disponible, se te pedir√° confirmar la sobreventa."]})]}),e.jsxs(W,{className:"bg-muted/50",children:[e.jsx(Y,{className:"pb-3",children:e.jsx(G,{className:"text-base",children:"Agregar Productos del Inventario"})}),e.jsxs(H,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"producto-inventario",children:"Seleccionar Producto"}),e.jsxs(pe,{value:ne,onValueChange:an,children:[e.jsx(ge,{children:e.jsx(ye,{placeholder:Ne?"Cargando inventario...":"Seleccionar producto del inventario"})}),e.jsx(je,{className:"max-h-80 z-50 bg-background border border-border w-full",children:Ne?e.jsx(k,{value:"loading",disabled:!0,children:"Cargando inventario..."}):Fe.length===0?e.jsx(k,{value:"empty",disabled:!0,children:"No hay productos con stock disponible"}):Fe.map(t=>e.jsx(k,{value:t.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.nombre}),e.jsxs("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full flex-shrink-0 ml-2",children:["Stock: ",t.cantidad_stock||0]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Costo: $",t.costo_unitario||0]}),t.precio_venta&&t.precio_venta>0?e.jsxs("span",{className:"text-xs text-green-600 font-medium",children:["Venta: $",t.precio_venta]}):e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"‚ö†Ô∏è Sin precio"})]})]})]})},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cantidad-inv",children:"Cantidad a Vender"}),e.jsx(U,{id:"cantidad-inv",type:"number",min:"1",value:Ee,onChange:t=>tt(t.target.value)}),ne&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Stock disponible: ",Es," unidades"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"precio-inv",children:"Precio Unitario"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(De,{value:nt?"registrado":"personalizado",onValueChange:t=>{const r=t==="registrado";if(Ms(r),r&&ne){const i=Fe.find(n=>n.id===ne);if(i){const n=i.precio_venta||i.costo_unitario||0;ls(n.toString())}}},className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"registrado",id:"precio-registrado"}),e.jsx(j,{htmlFor:"precio-registrado",className:"text-sm cursor-pointer",children:"Precio registrado"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"personalizado",id:"precio-personalizado"}),e.jsx(j,{htmlFor:"precio-personalizado",className:"text-sm cursor-pointer",children:"Personalizado"})]})]}),e.jsx(U,{id:"precio-inv",type:"number",step:"0.01",min:"0",value:ze,onChange:t=>nn(t.target.value),readOnly:nt,className:nt?"bg-muted":""})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"descuento-inv",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(De,{value:Be,onValueChange:t=>it(t),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"monto",id:"descuento-inv-monto"}),e.jsx(j,{htmlFor:"descuento-inv-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"porcentaje",id:"descuento-inv-porcentaje"}),e.jsx(j,{htmlFor:"descuento-inv-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(U,{id:"descuento-inv",type:"number",placeholder:Be==="porcentaje"?"0":"0.00",min:"0",max:Be==="porcentaje"?"100":void 0,step:Be==="porcentaje"?"1":"0.01",value:rt,onChange:t=>ot(t.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Be==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Subtotal con Descuento"}),e.jsx(U,{type:"text",value:ne&&ze?(()=>{const t=parseFloat(ze)*parseFloat(Ee||"1"),r=parseFloat(rt||"0"),i=Be==="porcentaje"?Math.max(0,t-t*r/100):Math.max(0,t-r);return`$${I(i)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(z,{type:"button",onClick:cn,disabled:!ne||!ze,className:"w-full",variant:"secondary",children:[e.jsx(_t,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),K.length>0&&e.jsxs(W,{children:[e.jsx(Y,{className:"pb-3",children:e.jsxs(G,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",K.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",I(K.reduce((t,r)=>t+r.subtotal,0))]})]})}),e.jsx(H,{children:e.jsx("div",{className:"space-y-2",children:K.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:t.imagen_url?e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[t.cantidad," x $",I(t.precioUnitario)," = $",I(t.cantidad*t.precioUnitario)]}),t.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",I(t.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",I(t.subtotal)]}),e.jsxs("span",{className:"text-xs",children:["Stock disponible: ",t.stockDisponible]})]})]})]}),e.jsx(z,{type:"button",variant:"ghost",size:"sm",onClick:()=>ln(t.id),className:"text-destructive hover:text-destructive",children:e.jsx(B,{className:"h-4 w-4"})})]},`${t.id}-${r}`))})})]})]});case"general":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"descripcion-general",children:"Descripci√≥n del Ingreso"}),J("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(U,{id:"descripcion-general",placeholder:"Ej: Servicio de consultor√≠a",value:ys,onChange:t=>Ke(t.target.value),className:J("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cuenta-contable",children:"Cuenta Contable"}),e.jsxs(pe,{defaultValue:"4001",children:[e.jsx(ge,{children:e.jsx(ye,{placeholder:"4001 - Ventas"})}),e.jsx(je,{children:e.jsx(k,{value:"4001",children:"4001 - Ventas"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"subcuenta",children:"Subcuenta (Opcional)"}),e.jsxs(pe,{children:[e.jsx(ge,{children:e.jsx(ye,{placeholder:"Seleccionar subcuenta"})}),e.jsx(je,{children:e.jsx(k,{value:"sub1",children:"Subcuenta ejemplo"})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"monto-general",children:"Monto"}),J("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(U,{id:"monto-general",type:"number",placeholder:"0.00",value:be,onChange:t=>Oe(t.target.value),className:J("Monto Total")?"border-destructive":""})]})]});case"otros":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ve,{children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx(Re,{children:"Este ingreso se ligar√° a la cuenta 4102 - Otros Productos."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"descripcion-otros",children:"Descripci√≥n del Ingreso Extraordinario"}),J("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(ss,{id:"descripcion-otros",placeholder:"Ej: Venta extraordinaria de equipo usado, donaci√≥n recibida, etc.",value:ys,onChange:t=>Ke(t.target.value),className:J("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"monto-otros",children:"Monto"}),J("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(U,{id:"monto-otros",type:"number",placeholder:"0.00",value:be,onChange:t=>Oe(t.target.value),className:J("Monto Total")?"border-destructive":""})]})]});default:return null}},gn=async()=>{if(!xt.trim()||!ht.trim()){ae({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}Bs(!0);try{await Ca.mutateAsync({nombre:xt.trim(),precio:parseFloat(ht),descripcion:Zt.trim()||void 0,subcuentaId:sa||void 0,imagen:Xa||void 0}),Qt(""),Xt(""),ea(""),Qa("4001"),ta(""),aa(null),ut(!1)}catch{}finally{Bs(!1)}},ma=s=>{var t;ra(s),Nt(s.nombre),vt(((t=s.precio)==null?void 0:t.toString())||""),yt(s.descripcion||""),St(s.imagen_url||null),wt(null),la(s.subcuenta_id||""),Ws(!0)},jn=s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];if(t){wt(t);const i=new FileReader;i.onloadend=()=>{St(i.result)},i.readAsDataURL(t)}},fn=async()=>{if(!ft.trim()||!bt.trim()){ae({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}Bs(!0);try{await _a.mutateAsync({id:sn.id,nombre:ft.trim(),precio:parseFloat(bt),descripcion:oa.trim()||void 0,imagen:tn||void 0,subcuentaId:ca||null}),Ws(!1),ra(null),Nt(""),vt(""),yt(""),wt(null),St(null)}catch{}finally{Bs(!1)}};return e.jsxs("div",{className:"h-full overflow-hidden flex flex-col",children:[e.jsx(ds,{open:$a,onOpenChange:as,children:e.jsxs(ms,{children:[e.jsxs(us,{children:[e.jsxs(xs,{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(B,{className:"h-5 w-5"}),"Advertencia: Inventario Insuficiente"]}),e.jsxs(hs,{className:"space-y-3 pt-4",children:[e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-950/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx("p",{className:"font-medium mb-2",children:"Est√°s a punto de vender un producto sin suficiente inventario:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Producto:"}),e.jsx("span",{className:"font-medium",children:y==null?void 0:y.productName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cantidad solicitada:"}),e.jsx("span",{className:"font-medium",children:y==null?void 0:y.requested})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Stock disponible:"}),e.jsx("span",{className:"font-medium",children:y==null?void 0:y.available})]}),e.jsx(Me,{}),e.jsxs("div",{className:"flex justify-between text-orange-600",children:[e.jsx("span",{className:"font-medium",children:"Faltante:"}),e.jsx("span",{className:"font-bold",children:((y==null?void 0:y.requested)||0)-((y==null?void 0:y.available)||0)})]})]})]}),(y==null?void 0:y.costoPorUnidad)&&y.costoPorUnidad>0&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border-2 border-blue-300 dark:border-blue-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ua,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),e.jsx("p",{className:"font-bold text-blue-700 dark:text-blue-300",children:"üìä Costo Promedio Hist√≥rico"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Costo promedio calculado:"}),e.jsxs("span",{className:"text-lg font-bold text-blue-700 dark:text-blue-300",children:["$",I(y.costoPorUnidad)," por unidad"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Este costo se calcul√≥ autom√°ticamente del promedio ponderado de todas tus compras anteriores de este producto. Puedes usar este costo sugerido o ingresar uno personalizado si conoces el costo real de esta venta."})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"font-medium mb-3 text-blue-700 dark:text-blue-400",children:"Impacto en el inventario:"}),y!=null&&y.costoPorUnidad&&y.costoPorUnidad>0?e.jsxs(e.Fragment,{children:[e.jsxs(De,{value:Qe,onValueChange:s=>{Zs(s),s==="historico"&&ns("")},className:"space-y-3 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"historico",id:"costo-historico"}),e.jsxs(j,{htmlFor:"costo-historico",className:"text-sm cursor-pointer",children:["Usar costo hist√≥rico: ",e.jsxs("strong",{className:"text-blue-700 dark:text-blue-400",children:["$",I(y.costoPorUnidad)]})," por unidad"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"personalizado",id:"costo-personalizado"}),e.jsx(j,{htmlFor:"costo-personalizado",className:"text-sm cursor-pointer",children:"Ingresar costo personalizado"})]})]}),Qe==="personalizado"&&e.jsxs("div",{className:"mb-3",children:[e.jsx(j,{htmlFor:"costo-custom",className:"text-xs",children:"Costo unitario personalizado"}),e.jsx(U,{id:"costo-custom",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:le,onChange:s=>ns(s.target.value),className:"mt-1"})]}),e.jsx(Me,{className:"my-3"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Costo por unidad aplicado:"}),e.jsxs("span",{className:"font-medium",children:["$",I(Qe==="personalizado"&&le?le:y.costoPorUnidad)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",I((Qe==="personalizado"&&le?Number(le):y.costoPorUnidad)*(((y==null?void 0:y.requested)||0)-((y==null?void 0:y.available)||0)))]})]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"‚ö†Ô∏è Este producto no tiene costo hist√≥rico registrado."}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"costo-requerido",className:"text-xs",children:"Ingresa el costo unitario para esta transacci√≥n"}),e.jsx(U,{id:"costo-requerido",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:le,onChange:s=>ns(s.target.value),className:"mt-1"})]}),le&&Number(le)>0&&e.jsxs(e.Fragment,{children:[e.jsx(Me,{}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",I(Number(le)*(((y==null?void 0:y.requested)||0)-((y==null?void 0:y.available)||0)))]})]})]})]})]}),e.jsxs("p",{className:"text-sm",children:["Si contin√∫as, el inventario quedar√° en ",e.jsxs("strong",{className:"text-destructive",children:["negativo (",((y==null?void 0:y.available)||0)-((y==null?void 0:y.requested)||0)," unidades)"]}),". Esto se reflejar√° en tu control de inventario con el valor mostrado arriba."]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"¬øDeseas continuar con la venta de todas formas?"})]})]}),e.jsxs(Ys,{className:"gap-2 sm:gap-0",children:[e.jsx(z,{variant:"outline",onClick:()=>{as(!1),Ts(null),Zs("historico"),ns("")},children:"Cancelar"}),e.jsxs(z,{variant:"destructive",onClick:async()=>{if((!(y!=null&&y.costoPorUnidad)||y.costoPorUnidad===0)&&(!le||Number(le)<=0)){ae({title:"Costo requerido",description:"Debes ingresar un costo unitario para continuar",variant:"destructive"});return}as(!1),Ts(null),await Ct(),Zs("historico"),ns("")},children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),"Continuar con la Venta"]})]})]})}),e.jsxs("div",{className:"p-6 border-b bg-background",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Registro de Ingresos"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Registra ventas, gestiona cat√°logos y analiza ingresos de la empresa"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[e.jsxs(xa,{defaultValue:"registro",className:"w-full",children:[e.jsxs(ha,{className:"grid w-full grid-cols-4",children:[e.jsx(Ze,{value:"registro",children:"Registro de Ingresos"}),e.jsx(Ze,{value:"resumen",children:"Resumen de Ventas"}),e.jsx(Ze,{value:"analitica",children:"Anal√≠tica de Ventas"}),e.jsx(Ze,{value:"catalogo",children:"Cat√°logo de Productos"})]}),e.jsx(es,{value:"registro",className:"mt-6 space-y-6",children:e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsx(G,{children:"Nuevo Registro de Ingreso"}),e.jsx(oe,{children:"Selecciona el tipo de ingreso y completa la informaci√≥n requerida"})]}),e.jsxs(H,{className:"space-y-6",children:[!M&&e.jsxs("div",{className:"space-y-4",children:[e.jsx(j,{className:"text-base font-semibold",children:"Selecciona el tipo de ingreso que deseas registrar"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6",children:[e.jsxs("button",{type:"button",onClick:()=>He("precargados"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(pa,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Productos Precargados"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Del cat√°logo de servicios/productos"})]}),e.jsxs("button",{type:"button",onClick:()=>He("inventariados"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Ie,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Productos Inventariados"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Del inventario registrado"})]}),e.jsxs("button",{type:"button",onClick:()=>He("general"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(ga,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Ingreso General"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Operaci√≥n no inventariada"})]}),e.jsxs("button",{type:"button",onClick:()=>He("otros"),className:"border rounded-2xl bg-muted/20 hover:bg-muted/40 transition p-8 min-h-[180px] flex flex-col items-center justify-center text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-muted flex items-center justify-center mb-4",children:e.jsx(Ln,{className:"h-7 w-7 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Otros Ingresos"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Extraordinarios, donaciones"})]})]})]}),M&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(z,{type:"button",variant:"ghost",size:"sm",className:"px-0",onClick:()=>He(""),children:"‚Üê Volver al men√∫ de selecci√≥n"}),e.jsxs("div",{className:"space-y-6 p-4 border rounded-lg bg-muted/20",children:[pn(M),e.jsx(Me,{}),e.jsx("div",{className:"space-y-4",children:M==="precargados"&&Ue||M==="inventariados"&&ne?e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"C√°lculo Autom√°tico"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cantidad:"}),e.jsx("span",{children:M==="precargados"?Os:Ee})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Precio Unitario:"}),e.jsxs("span",{children:["$",M==="precargados"?Rs:ze]})]}),e.jsx(Me,{}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",be]})]})]})]}):null}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"font-medium",children:"Estado del Pago"}),J("Tipo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(De,{value:E,onValueChange:Et,className:J("Tipo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{value:"contado",id:"contado"}),e.jsx(j,{htmlFor:"contado",className:"cursor-pointer",children:"Pago Total"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{value:"parcial",id:"parcial"}),e.jsx(j,{htmlFor:"parcial",className:"cursor-pointer",children:"Pago parcial"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{value:"credito",id:"credito"}),e.jsx(j,{htmlFor:"credito",className:"cursor-pointer",children:"Adeudo Total"})]})]}),E==="parcial"&&e.jsxs("div",{className:"ml-6 p-4 border rounded-lg bg-blue-50 dark:bg-blue-950/20 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"monto-abonado",children:"Monto que se va a pagar"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),J("Monto Abonado")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(U,{id:"monto-abonado",type:"number",step:"0.01",placeholder:"0.00",value:Pe,onChange:s=>Ot(s.target.value),className:J("Monto Abonado")?"border-destructive":""})]}),be&&Pe&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-3 bg-white dark:bg-gray-900 rounded border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de la venta"}),e.jsxs("p",{className:"text-lg font-semibold text-primary",children:["$",I(be)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Se pagar√° ahora"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:["$",I(Pe)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Queda pendiente"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["$",I(parseFloat(be)-parseFloat(Pe))]})]})]})]})]}),e.jsx(Me,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ps,{className:"h-5 w-5"}),e.jsx(j,{className:"font-medium",children:"Datos del Cliente"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:E==="contado"?"Opcional - Para anal√≠ticas y comentarios":"Obligatorio para cuentas por cobrar"})]}),E==="contado"&&e.jsxs(Ve,{children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx(Re,{children:"Asignar cliente es opcional para pagos totales. √ötil para anal√≠ticas de ventas y seguimiento de clientes."})]}),(E==="parcial"||E==="credito")&&e.jsxs(Ve,{children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx(Re,{children:"Se registrar√° en Cuentas por Cobrar para an√°lisis de vencimientos"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{className:"font-medium",children:"Tipo de Cliente"}),e.jsxs(pe,{value:X,onValueChange:s=>{Vt(s),Qs(""),Ss(""),Cs(""),_s(""),Ps(""),Is([])},children:[e.jsx(ge,{children:e.jsx(ye,{placeholder:E==="contado"?"Opcional - Selecciona para anal√≠ticas":"Selecciona el tipo de cliente"})}),e.jsxs(je,{children:[e.jsx(k,{value:"nuevo",children:"Cliente Nuevo"}),e.jsx(k,{value:"recurrente",children:"Cliente Recurrente"})]})]})]}),X==="recurrente"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cliente-existente",children:"Seleccionar Cliente"}),(()=>{const s=ke.find(t=>t.id===ve);return e.jsxs(pe,{value:ve??"",onValueChange:t=>{Qs(t);const r=ke.find(i=>i.id===t);r&&(Ss(r.nombre),Cs(r.telefono||""),_s(r.email||""),Ps(r.rfc||""))},children:[e.jsx(ge,{className:"h-auto py-2",children:s?e.jsxs("div",{className:"flex flex-col text-left leading-tight",children:[e.jsx("span",{className:"font-medium",children:s.nombre}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.telefono?`Tel: ${s.telefono}`:"",s.telefono&&s.email?" ‚Ä¢ ":"",s.email?`Email: ${s.email}`:"",s.source==="transaction"?" ‚Ä¢ (De transacci√≥n)":""]})]}):e.jsx("span",{className:"text-muted-foreground",children:"Buscar cliente existente..."})}),e.jsx(je,{className:"p-1",children:Sa?e.jsx("div",{className:"px-2 py-2 text-sm text-muted-foreground",children:"Cargando clientes..."}):ke.length===0?e.jsx("div",{className:"px-2 py-2 text-sm text-muted-foreground",children:"No hay clientes registrados"}):ke.map(t=>e.jsx(k,{value:t.id,className:"py-2",children:e.jsxs("div",{className:"flex flex-col text-left leading-tight",children:[e.jsx("span",{className:"font-medium",children:t.nombre}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.telefono?`Tel: ${t.telefono}`:"",t.telefono&&t.email?" ‚Ä¢ ":"",t.email?`Email: ${t.email}`:"",t.source==="transaction"?" ‚Ä¢ (De transacci√≥n)":""]})]})},t.id))})]})})(),!!ve&&e.jsx("p",{className:"text-xs text-green-600",children:"‚úì Datos del cliente cargados autom√°ticamente"})]}),(X==="nuevo"||X==="recurrente"&&ve)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cliente-nombre",children:"Nombre del Cliente"}),e.jsx(U,{id:"cliente-nombre",type:"text",placeholder:"Nombre completo",value:Je,onChange:s=>Ss(s.target.value),disabled:X==="recurrente"&&ve!==""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"cliente-telefono",children:"N√∫mero de Tel√©fono"}),(E==="parcial"||E==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),J("Tel√©fono del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(U,{id:"cliente-telefono",type:"tel",placeholder:"Ej: +52 55 1234 5678",value:Ce,onChange:s=>Cs(s.target.value),className:J("Tel√©fono del Cliente")?"border-destructive":"",disabled:X==="recurrente"&&ve!==""}),X==="nuevo"&&Ae.some(s=>s.includes(Ce)&&s.includes("tel√©fono"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Ae.find(s=>s.includes(Ce)&&s.includes("tel√©fono"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"cliente-email",children:"Correo Electr√≥nico"}),(E==="parcial"||E==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),J("Email del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(U,{id:"cliente-email",type:"email",placeholder:"cliente@ejemplo.com",value:_e,onChange:s=>_s(s.target.value),className:J("Email del Cliente")?"border-destructive":"",disabled:X==="recurrente"&&ve!==""}),X==="nuevo"&&Ae.some(s=>s.includes(_e)&&s.includes("correo"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Ae.find(s=>s.includes(_e)&&s.includes("correo"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"cliente-rfc",children:"RFC (ID Fiscal) - Opcional"}),e.jsx(U,{id:"cliente-rfc",type:"text",placeholder:"RFC123456ABC1",value:$e,onChange:s=>Ps(s.target.value.toUpperCase()),maxLength:13,disabled:X==="recurrente"&&ve!==""}),X==="nuevo"&&Ae.some(s=>s.includes($e)&&s.includes("RFC"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Ae.find(s=>s.includes($e)&&s.includes("RFC"))})]})]}),(E==="parcial"||E==="credito")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{htmlFor:"fecha-vencimiento",children:"Fecha de Vencimiento"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),J("Fecha de Vencimiento")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(U,{id:"fecha-vencimiento",type:"date",value:Fs,onChange:s=>Rt(s.target.value),className:J("Fecha de Vencimiento")?"border-destructive":"",min:new Date().toISOString().split("T")[0]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Fecha l√≠mite para el pago"," ",E==="parcial"?"del monto pendiente":"completo"]})]}),E==="contado"&&X&&e.jsxs("div",{className:"col-span-full space-y-2",children:[e.jsx(j,{htmlFor:"comentario-venta",children:"Comentarios de la venta (Opcional)"}),e.jsx(ss,{id:"comentario-venta",placeholder:"Detalles adicionales sobre esta venta, preferencias del cliente, etc.",value:Ds,onChange:s=>Xs(s.target.value),rows:2}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Informaci√≥n √∫til para futuras ventas y an√°lisis del cliente"})]})]})]}),e.jsx(Me,{}),(E==="contado"||E==="parcial")&&e.jsxs(e.Fragment,{children:[e.jsx(Me,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{className:"font-medium",children:"M√©todo de Pago"}),J("M√©todo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(De,{value:vs,onValueChange:At,className:J("M√©todo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{value:"efectivo",id:"efectivo"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Tn,{className:"h-4 w-4 text-green-600"}),e.jsxs(j,{htmlFor:"efectivo",className:"cursor-pointer",children:["Efectivo"," ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Caja)"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{value:"tarjeta",id:"tarjeta"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($n,{className:"h-4 w-4 text-blue-800"}),e.jsxs(j,{htmlFor:"tarjeta",className:"cursor-pointer",children:["Tarjeta"," ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Bancos)"})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"comentarios",children:"Comentarios de la venta (Opcional)"}),e.jsx(ss,{id:"comentarios",placeholder:"Agrega cualquier comentario o nota sobre esta venta...",value:Ds,onChange:s=>Xs(s.target.value),rows:3,className:"resize-none"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(z,{size:"lg",className:"px-8",onClick:xn,disabled:Mt,children:[e.jsx(ua,{className:"mr-2 h-4 w-4"}),Mt?"Registrando...":"Registrar Ingreso"]})})]})]})]})]})}),e.jsx(es,{value:"resumen",className:"mt-6",children:e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsx(G,{children:"Registro Detallado de Ventas"}),e.jsx(oe,{children:"Historial completo de transacciones de ingresos"})]}),e.jsxs(H,{children:[e.jsxs("div",{className:"mb-6 p-4 border rounded-lg bg-muted/30 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2 lg:col-span-2",children:[e.jsx(j,{children:"Rango de fechas"}),e.jsx(Un,{value:Ua,onChange:Ya})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"filtro-tipo",children:"Tipo de Ingreso"}),e.jsxs(pe,{value:xe,onValueChange:Gt,children:[e.jsx(ge,{id:"filtro-tipo",children:e.jsx(ye,{placeholder:"Todos"})}),e.jsxs(je,{children:[e.jsx(k,{value:"todos",children:"Todos"}),e.jsx(k,{value:"precargados",children:"Precargados"}),e.jsx(k,{value:"inventariados",children:"Inventariados"}),e.jsx(k,{value:"general",children:"General"}),e.jsx(k,{value:"otros",children:"Otros"}),e.jsx(k,{value:"asiento_directo",children:"Venta de activo fijo"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"filtro-cuenta",children:"Cuenta"}),e.jsxs(pe,{value:he,onValueChange:Ht,children:[e.jsx(ge,{id:"filtro-cuenta",children:e.jsx(ye,{placeholder:"Todas"})}),e.jsxs(je,{children:[e.jsx(k,{value:"todas",children:"Todas"}),e.jsx(k,{value:"4001",children:"4001 - Ventas"}),e.jsx(k,{value:"4004",children:"4004 - Ventas Inventarios"}),e.jsx(k,{value:"4101",children:"4101 - Productos Financieros"}),e.jsx(k,{value:"4102",children:"4102 - Otros Productos"}),e.jsx(k,{value:"4103",children:"4103 - Ganancia en Venta de Activos"}),e.jsx(k,{value:"4103",children:"4002 - Devoluciones sobre ventas"}),e.jsx(k,{value:"4103",children:"4002 - Descuentos sobre ventas"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"filtro-subcuenta",children:"Subcuenta"}),e.jsxs(pe,{value:te,onValueChange:Kt,children:[e.jsx(ge,{id:"filtro-subcuenta",children:e.jsx(ye,{placeholder:"Todas"})}),e.jsxs(je,{children:[e.jsx(k,{value:"todas",children:"Todas"}),e.jsx(k,{value:"sin-subcuenta",children:"Sin subcuenta"}),Q.map(s=>e.jsx(k,{value:s.id,children:s.nombre},s.id))]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsx(z,{variant:"outline",size:"sm",onClick:()=>{Wt(void 0),Bt(""),qt(""),Gt("todos"),Ht("todas"),Kt("")},children:"Limpiar Filtros"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Resultados:"," ",(()=>{const s=Xe.map(n=>{const a=n.detalle_asientos.find(c=>c.cuenta_codigo.startsWith("4")&&Number(c.haber)>0);return{created_at:n.fecha,fecha:n.fecha,fecha_fixed:n.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(a==null?void 0:a.cuenta_codigo)||"",subcuenta_id:a==null?void 0:a.subcuenta_id}});return[...S??[],...s??[]].map(Ns).filter(n=>{const a=n.fecha_fixed??n.fecha??n.created_at,c=ks(a),d=!xe||xe==="todos"||n.tipo_ingreso===xe,x=!he||he==="todas"||n.cuenta_principal_codigo===he,p=!te||te==="todas"||te==="sin-subcuenta"&&!n.subcuenta_id||n.subcuenta_id===te;return c&&d&&x&&p}).length})()]}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["Total: $",(()=>{const s=Xe.map(i=>{const n=i.detalle_asientos.find(a=>a.cuenta_codigo.startsWith("4")&&Number(a.haber)>0);return{created_at:i.fecha,fecha:i.fecha,fecha_fixed:i.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(n==null?void 0:n.cuenta_codigo)||"",subcuenta_id:n==null?void 0:n.subcuenta_id,monto_total:Number(n==null?void 0:n.haber)||0}}),r=[...ue,...s].filter(i=>{const n=i.fecha_fixed??i.fecha??i.created_at,a=ks(n),c=!xe||xe==="todos"||i.tipo_ingreso===xe,d=!he||he==="todas"||i.cuenta_principal_codigo===he,x=!te||te==="todas"||te==="sin-subcuenta"&&!i.subcuenta_id||i.subcuenta_id===te;return a&&c&&d&&x});return I(r.reduce((i,n)=>i+Number(n.monto_total||0),0))})()]}),e.jsxs("p",{className:"text-sm font-medium text-green-600",children:["Neto: $",(()=>{const s=Xe.map(i=>{const n=i.detalle_asientos.find(a=>a.cuenta_codigo.startsWith("4")&&Number(a.haber)>0);return{created_at:i.fecha,fecha:i.fecha,fecha_fixed:i.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(n==null?void 0:n.cuenta_codigo)||"",subcuenta_id:n==null?void 0:n.subcuenta_id,monto_neto:Number(n==null?void 0:n.haber)||0}}),r=[...ue,...s].filter(i=>{const n=i.fecha_fixed??i.fecha??i.created_at,a=ks(n),c=!xe||xe==="todos"||i.tipo_ingreso===xe,d=!he||he==="todas"||i.cuenta_principal_codigo===he,x=!te||te==="todas"||te==="sin-subcuenta"&&!i.subcuenta_id||i.subcuenta_id===te;return a&&c&&d&&x});return I(r.reduce((i,n)=>i+Number(n.monto_neto||0),0))})()]})]})]})]}),T?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando transacciones..."}):(()=>{const s=Xe.map(n=>{const a=n.detalle_asientos.find(c=>c.cuenta_codigo.startsWith("4")&&Number(c.haber)>0);return{id:n.id??n._id,descripcion:n.descripcion,monto_total:Number(a==null?void 0:a.haber)||0,monto_neto:Number(a==null?void 0:a.haber)||0,monto_descuento:0,monto_pagado:Number(a==null?void 0:a.haber)||0,monto_pendiente:0,tipo_ingreso:"asiento_directo",metodo_pago:"N/A",tipo_pago:"contado",cuenta_principal_codigo:(a==null?void 0:a.cuenta_codigo)||"",subcuenta_id:a==null?void 0:a.subcuenta_id,created_at:n.fecha,fecha:n.fecha,fecha_fixed:n.fecha,asiento_fecha:n.fecha,es_asiento_directo:!0,estado:"activo"}}),i=[...ue,...s.map(Ns)].filter(n=>{const a=n.fecha_fixed??n.fecha??n.created_at,c=ks(a),d=!xe||xe==="todos"||n.tipo_ingreso===xe,x=!he||he==="todas"||n.cuenta_principal_codigo===he,p=!te||te==="todas"||te==="sin-subcuenta"&&!n.subcuenta_id||n.subcuenta_id===te;return c&&d&&x&&p}).filter(n=>!String(n.descripcion||"").includes("CANCELACI√ìN:")).map(n=>{const a=n.estado==="cancelado";let c=null;return a&&n.transaccion_cancelacion_id&&(c=ue.find(d=>d.id===n.transaccion_cancelacion_id)),{...n,esCancelada:a,transaccionReversion:c}});return i.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay transacciones que coincidan con los filtros"}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"text-sm font-medium text-muted-foreground",children:["Mostrando ",i.length," transacci√≥n(es)"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Tip: da clic en el √≠cono üìÑ para ver ‚ÄúInformaci√≥n general‚Äù y ‚ÄúRegistro contable‚Äù"})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-background",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/60",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap",children:"Fecha"}),e.jsx("th",{className:"text-left p-3 font-medium min-w-[320px]",children:"Descripci√≥n"}),e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap hidden md:table-cell",children:"Tipo"}),e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap hidden lg:table-cell",children:"Cuenta"}),e.jsx("th",{className:"text-right p-3 font-medium whitespace-nowrap",children:"Total"}),e.jsx("th",{className:"text-right p-3 font-medium whitespace-nowrap hidden md:table-cell",children:"Neto"}),e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap hidden md:table-cell",children:"Estado"}),e.jsx("th",{className:"text-right p-3 font-medium whitespace-nowrap",children:"Acciones"})]})}),e.jsx("tbody",{children:i.map(n=>{var l,u,f,w,v;const a=n,c=n.esCancelada,d=!1,x=a.fecha_fixed??a.fecha??a.created_at,p=(()=>{try{return new Date(x).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return String(x||"")}})(),o=Number(ie(a,"netas")||0);return e.jsxs("tr",{className:`border-t hover:bg-muted/30 ${c?"bg-red-50/60 dark:bg-red-950/20":""}`,children:[e.jsx("td",{className:"p-3 whitespace-nowrap text-muted-foreground",children:p}),e.jsxs("td",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium",children:a.descripcion}),a.es_asiento_directo&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200",children:"üìã Asiento Directo"}),c&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200",children:"‚ùå Cancelada"}),d]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("span",{className:"capitalize",children:a.metodo_pago||"N/A"})," ","‚Ä¢"," ",e.jsx("span",{className:"capitalize",children:a.tipo_pago||"N/A"}),a.subcuenta_id?e.jsxs(e.Fragment,{children:[" ","‚Ä¢"," ",e.jsxs("span",{className:"text-muted-foreground",children:["Subcuenta:"," ",((l=a.subcuentas)==null?void 0:l.nombre)||(()=>{const g=Q.find(b=>b.id===a.subcuenta_id);return(g==null?void 0:g.nombre)||"Subcuenta no encontrada"})()]})]}):null]}),a.comentarios&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 dark:bg-blue-950/30 rounded text-xs",children:[e.jsxs("span",{className:"font-medium text-blue-700 dark:text-blue-300",children:["üí¨"," "]}),e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:String(a.comentarios).length>80?`${String(a.comentarios).substring(0,80)}...`:String(a.comentarios)})]}),c&&a.motivo_cancelacion&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"p-3 bg-red-100 dark:bg-red-950/40 rounded-md border border-red-300 dark:border-red-800",children:[e.jsx("p",{className:"text-xs font-medium text-red-700 dark:text-red-300 mb-1",children:"üìã Motivo de cancelaci√≥n:"}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:a.motivo_cancelacion}),e.jsxs("p",{className:"text-xs text-red-500 dark:text-red-500 mt-1",children:["Cancelada el:"," ",new Date(a.fecha_cancelacion).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.transaccionReversion&&e.jsxs("div",{className:"p-3 bg-orange-100 dark:bg-orange-950/40 rounded-md border border-orange-300 dark:border-orange-800",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-orange-700 dark:text-orange-300",children:"‚Ü©Ô∏è Asiento de Reversi√≥n Generado"})}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",n.transaccionReversion.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Monto reversado:"})," $",I(Math.abs(n.transaccionReversion.monto_total))]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",(()=>{const g=n.transaccionReversion.fecha_fixed??n.transaccionReversion.fecha??n.transaccionReversion.created_at;return new Date(g).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})})()]})]})]})]})]}),e.jsx("td",{className:"p-3 hidden md:table-cell",children:e.jsx("span",{className:"capitalize",children:a.tipo_ingreso})}),e.jsx("td",{className:"p-3 hidden lg:table-cell",children:a.cuenta_principal_codigo||"-"}),e.jsxs("td",{className:"p-3 text-right font-bold text-primary whitespace-nowrap",children:["$",I(a.monto_total),a.monto_descuento>0&&e.jsxs("div",{className:"text-xs text-red-600 font-medium",children:["-$",I(a.monto_descuento)," desc."]})]}),e.jsx("td",{className:"p-3 text-right hidden md:table-cell whitespace-nowrap",children:e.jsxs("span",{className:"font-medium text-green-600",children:["$",I(o)]})}),e.jsx("td",{className:"p-3 hidden md:table-cell",children:c?e.jsx("span",{className:"text-red-600 font-medium",children:"Cancelada"}):e.jsx("span",{className:"text-muted-foreground",children:"Activa"})}),e.jsx("td",{className:"p-3 text-right whitespace-nowrap",children:e.jsxs("div",{className:"inline-flex items-center gap-2 justify-end",children:[e.jsxs(ds,{onOpenChange:g=>{if(g){const b=String(a._id??a.id??"");un(b)}else As(null)},children:[e.jsx(ja,{asChild:!0,children:e.jsx(z,{variant:"outline",size:"sm",className:"h-8 px-2",children:e.jsx(ga,{className:"h-4 w-4"})})}),e.jsxs(ms,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(us,{children:[e.jsx(xs,{children:"Detalles de la Transacci√≥n"}),e.jsx(hs,{children:"Informaci√≥n completa y asientos contables en balanza"})]}),e.jsxs(xa,{defaultValue:"general",className:"w-full",children:[e.jsxs(ha,{className:"grid w-full grid-cols-2",children:[e.jsx(Ze,{value:"general",children:"Informaci√≥n General"}),e.jsx(Ze,{value:"contable",children:"Registros Contables"})]}),e.jsxs(es,{value:"general",className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Informaci√≥n General"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",a.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",a.tipo_ingreso]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"M√©todo de Pago:"})," ",a.metodo_pago||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo de Pago:"})," ",a.tipo_pago]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",(()=>{const g=a.fecha_fixed??a.fecha??a.created_at;try{return new Date(g).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return String(g||"")}})()]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Montos"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total:"})," $",I(a.monto_total)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descuento:"})," $",I(a.monto_descuento)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Neto:"})," $",I(a.monto_neto)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pagado:"})," $",I(a.monto_pagado||0)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pendiente:"})," $",I(a.monto_pendiente||0)]})]})]})]}),(a.cliente_nombre||a.cliente_telefono||a.cliente_email)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n del Cliente"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[a.cliente_nombre&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",a.cliente_nombre]}),a.cliente_telefono&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tel√©fono:"})," ",a.cliente_telefono]}),a.cliente_email&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",a.cliente_email]}),a.cliente_rfc&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"RFC:"})," ",a.cliente_rfc]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n Contable"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Cuenta Principal:"})," ",a.cuenta_principal??`${a.cuenta_principal_codigo}`]}),a.subcuenta_id?e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," ",((u=a.subcuentas)==null?void 0:u.nombre)||(()=>{const g=Q.find(b=>b.id===a.subcuenta_id);return(g==null?void 0:g.nombre)||"Subcuenta no encontrada"})()]}):e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," Sin subcuenta asignada"]})]})]}),a.comentarios&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Comentarios"}),e.jsx("div",{className:"p-3 bg-muted rounded-md",children:e.jsx("p",{className:"text-sm",children:a.comentarios})})]})]}),e.jsxs(es,{value:"contable",className:"mt-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3",children:"Asientos en Balanza de Comprobaci√≥n"}),Ha?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando asientos contables..."}):Le?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"N√∫mero de Asiento:"})," ",Le.numero_asiento]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(Le.fecha).toLocaleDateString("es-ES")]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",Le.descripcion]})]})}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Cuenta"}),e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Descripci√≥n"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Debe"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Haber"})]})}),e.jsxs("tbody",{children:[(f=Le.detalles)==null?void 0:f.map((g,b)=>e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"p-3 text-sm",children:[e.jsx("div",{className:"font-medium",children:g.cuenta_codigo}),e.jsx("div",{className:"text-xs text-muted-foreground",children:g.cuenta_nombre})]}),e.jsx("td",{className:"p-3 text-sm",children:g.descripcion}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:g.debe>0?`$${I(g.debe)}`:"-"}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:g.haber>0?`$${I(g.haber)}`:"-"})]},b)),e.jsxs("tr",{className:"border-t-2 bg-muted/50 font-bold",children:[e.jsx("td",{colSpan:2,className:"p-3 text-sm",children:"TOTALES"}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",I((w=Le.detalles)==null?void 0:w.reduce((g,b)=>g+Number(b.debe),0))]}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",I((v=Le.detalles)==null?void 0:v.reduce((g,b)=>g+Number(b.haber),0))]})]})]})]})}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/30 rounded-md text-sm",children:[e.jsx("p",{className:"font-medium text-blue-700 dark:text-blue-300 mb-1",children:"üí° Informaci√≥n"}),e.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:"Este asiento contable refleja c√≥mo esta transacci√≥n afecta a las diferentes cuentas en la balanza de comprobaci√≥n y posteriormente en los estados financieros."})]})]}):e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg text-sm text-muted-foreground text-center",children:"No se encontraron asientos contables para esta transacci√≥n"})]})]})]})]}),!c&&!d&&e.jsx(z,{variant:"outline",size:"sm",className:"h-8 px-2 border-red-300 text-red-600 hover:bg-red-50 dark:border-red-800 dark:text-red-400 dark:hover:bg-red-950/30",onClick:()=>{pt(Ns(a)),Us(!0)},children:"‚ùå"})]})})]},a.id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t bg-muted/40",children:[e.jsx("td",{className:"p-3 text-sm font-medium",colSpan:4,children:"TOTALES"}),e.jsxs("td",{className:"p-3 text-right font-bold text-primary whitespace-nowrap",children:["$",I(i.reduce((n,a)=>n+Number(a.monto_total||0),0))]}),e.jsx("td",{className:"p-3 text-right hidden md:table-cell whitespace-nowrap",children:e.jsxs("span",{className:"font-bold text-green-600",children:["$",I(i.reduce((n,a)=>n+Number(ie(a,"netas")||0),0))]})}),e.jsx("td",{className:"p-3 hidden md:table-cell"}),e.jsx("td",{className:"p-3"})]})})]})})})]})})()]})]})}),e.jsx(es,{value:"analitica",className:"mt-6",children:(()=>{const s=Array.isArray(Xe)?Xe:[],r=(()=>{const d=new Date().getFullYear();let x=S.filter(p=>{var o;return p.estado!=="cancelado"&&!((o=p.descripcion)!=null&&o.includes("CANCELACI√ìN:"))});if(V==="diario"){const p=de.toISOString().split("T")[0];x=x.filter(o=>o.asiento_fecha===p)}else if(V==="mensual"){const p=O.getMonth(),o=O.getFullYear();x=x.filter(l=>{const u=l.asiento_fecha;if(!u)return!1;const f=fs(u);return f.getMonth()===p&&f.getFullYear()===o})}else x=x.filter(p=>{const o=p.asiento_fecha;return o?fs(o).getFullYear()===d:!1});return R==="ventas"?x.filter(p=>p.cuenta_principal_codigo==="4001"):x.filter(p=>{var o;return((o=p.cuenta_principal_codigo)==null?void 0:o.startsWith("4"))&&p.cuenta_principal_codigo!=="4001"&&p.cuenta_principal_codigo!=="4003"})})(),n=(()=>{const c=r.filter(p=>p.tipo_pago==="contado"||p.tipo_pago==="parcial");if(c.length===0)return[];const d={};c.forEach(p=>{const o=p.metodo_pago==="efectivo"?"Efectivo":"Tarjeta";d[o]=(d[o]||0)+(Number(ie(p,N))||0)});const x=Object.values(d).reduce((p,o)=>p+(Number(o)||0),0);return Object.entries(d).map(([p,o])=>({name:p,value:o,porcentaje:x>0?(o/x*100).toFixed(1):"0.0"}))})(),a=()=>R==="ventas"?r.length>0||(Number(L.ventasBrutas)||0)>0||(Number(L.descuentos)||0)>0:r.length>0||(Number(L.otrosIngresos)||0)>0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground mb-4",children:"Highlights de Ingresos"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(W,{children:[e.jsx(Y,{className:"pb-3",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Resumen del D√≠a"})}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",A(rs.ventasBrutas,$)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",A(rs.descuentos,$)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",A(rs.ventasNetas,$)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",A(rs.otrosIngresos,$)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",A(rs.totalIngresos,$)]})]})]})]}),e.jsxs(W,{children:[e.jsx(Y,{className:"pb-3",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Resumen del Mes"})}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",A(os.ventasBrutas,$)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",A(os.descuentos,$)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",A(os.ventasNetas,$)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",A(os.otrosIngresos,$)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",A(os.totalIngresos,$)]})]})]})]}),e.jsxs(W,{children:[e.jsx(Y,{className:"pb-3",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Resumen del A√±o"})}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",A(is.ventasBrutas,$)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",A(is.descuentos,$)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",A(is.ventasNetas,$)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",A(is.otrosIngresos,$)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",A(is.totalIngresos,$)]})]})]})]})]})]}),e.jsx("div",{className:"my-8 border-t-2 border-primary/20"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-foreground mb-6",children:["Anal√≠tica de ",R==="ventas"?"Ventas":"Otros Ingresos"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsx(G,{children:"Tipo de Ingreso"}),e.jsx(oe,{children:"Selecciona qu√© analizar"})]}),e.jsx(H,{children:e.jsxs(De,{value:R,onValueChange:c=>Ma(c),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"ventas",id:"tipo-ventas"}),e.jsx(j,{htmlFor:"tipo-ventas",className:"cursor-pointer",children:"Ventas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"otros",id:"tipo-otros"}),e.jsx(j,{htmlFor:"tipo-otros",className:"cursor-pointer",children:"Otros Ingresos"})]})]})})]}),e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsx(G,{children:"Per√≠odo de An√°lisis"}),e.jsx(oe,{children:"Selecciona el per√≠odo"})]}),e.jsxs(H,{className:"space-y-3",children:[e.jsxs(De,{value:V,onValueChange:c=>ka(c),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"diario",id:"period-daily"}),e.jsx(j,{htmlFor:"period-daily",className:"cursor-pointer",children:"Diario"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"mensual",id:"period-monthly"}),e.jsx(j,{htmlFor:"period-monthly",className:"cursor-pointer",children:"Mensual"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"anual",id:"period-annual"}),e.jsx(j,{htmlFor:"period-annual",className:"cursor-pointer",children:"Anual"})]})]}),V==="diario"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(j,{className:"text-xs text-muted-foreground mb-2 block",children:"Fecha espec√≠fica"}),e.jsxs(Ft,{children:[e.jsx(Dt,{asChild:!0,children:e.jsxs(z,{variant:"outline",className:Ks("w-full justify-start text-left font-normal",!de&&"text-muted-foreground"),size:"sm",children:[e.jsx(It,{className:"mr-2 h-4 w-4"}),bs(de,"PPP",{locale:ts})]})}),e.jsx(Tt,{className:"w-auto p-0",align:"start",children:e.jsx($t,{mode:"single",selected:de,onSelect:c=>c&&Va(c),initialFocus:!0,className:"pointer-events-auto"})})]})]}),V==="mensual"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(j,{className:"text-xs text-muted-foreground mb-2 block",children:"Mes espec√≠fico"}),e.jsxs(Ft,{children:[e.jsx(Dt,{asChild:!0,children:e.jsxs(z,{variant:"outline",className:Ks("w-full justify-start text-left font-normal",!O&&"text-muted-foreground"),size:"sm",children:[e.jsx(It,{className:"mr-2 h-4 w-4"}),bs(O,"MMMM yyyy",{locale:ts})]})}),e.jsx(Tt,{className:"w-auto p-0",align:"start",children:e.jsx($t,{mode:"single",selected:O,onSelect:c=>c&&Ra(c),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsx(G,{children:"Formato de Cifras"}),e.jsx(oe,{children:"Visualizaci√≥n de montos"})]}),e.jsx(H,{children:e.jsxs(De,{value:$,onValueChange:c=>Aa(c),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"general",id:"scale-general"}),e.jsx(j,{htmlFor:"scale-general",className:"cursor-pointer",children:"General"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"miles",id:"scale-thousands"}),e.jsx(j,{htmlFor:"scale-thousands",className:"cursor-pointer",children:"Miles (K)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"millones",id:"scale-millions"}),e.jsx(j,{htmlFor:"scale-millions",className:"cursor-pointer",children:"Millones (M)"})]})]})})]}),e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsx(G,{children:"Tipo de M√©trica"}),e.jsx(oe,{children:"Datos a visualizar"})]}),e.jsx(H,{children:e.jsxs(De,{value:N,onValueChange:c=>Ea(c),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"brutas",id:"metric-brutas"}),e.jsx(j,{htmlFor:"metric-brutas",className:"cursor-pointer",children:"Ventas Brutas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"descuentos",id:"metric-descuentos"}),e.jsx(j,{htmlFor:"metric-descuentos",className:"cursor-pointer",children:"Descuentos"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{value:"netas",id:"metric-netas"}),e.jsx(j,{htmlFor:"metric-netas",className:"cursor-pointer",children:"Ventas Netas"})]})]})})]})]}),e.jsxs(W,{className:"mb-6",children:[e.jsxs(Y,{children:[e.jsxs(G,{children:["Evoluci√≥n de"," ",N==="descuentos"?"Descuentos":R==="otros"?"Otros Ingresos":N==="brutas"?"Ventas Brutas":"Ventas Netas"]}),e.jsx(oe,{children:(N==="descuentos"?"Descuentos aplicados":R==="otros"?"Otros ingresos":N==="brutas"?"Ventas brutas":"Ventas netas")+" - "+(V==="diario"?"del d√≠a":V==="mensual"?"por d√≠a del mes":"por mes del a√±o")})]}),e.jsx(H,{children:T?e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"Cargando datos..."}):(()=>{const c=g=>Number(g)||0,d=V==="diario"?de:V==="mensual"?O:new Date,x=d.getFullYear(),p=d.getMonth(),o=new Map,l=g=>V==="diario"?"D√≠a":V==="mensual"?`D√≠a ${g.getDate()}`:`Mes ${g.getMonth()+1}`;for(const g of r){const b=g.asiento_fecha;if(!b)continue;const C=fs(b);if(Number.isNaN(C.getTime()))continue;if(V==="diario"){const ee=de.toISOString().split("T")[0];if(b!==ee)continue}else if(V==="mensual"){if(C.getFullYear()!==x||C.getMonth()!==p)continue}else if(C.getFullYear()!==x)continue;const F=l(C),D=o.get(F)||{ventas:0,descuentos:0,neto:0,otrosIngresos:0};R==="ventas"?(D.ventas+=c(ie(g,"brutas")),D.descuentos+=c(ie(g,"descuentos")),D.neto+=c(ie(g,"netas"))):D.otrosIngresos+=c(ie(g,N)),o.set(F,D)}let u=[];if(V==="mensual"){const g=new Date(x,p+1,0).getDate();u=Array.from({length:g},(b,C)=>{const F=`D√≠a ${C+1}`,D=o.get(F)||{ventas:0,descuentos:0,neto:0,otrosIngresos:0};return{periodo:F,...D}})}else V==="anual"?u=Array.from({length:12},(g,b)=>{const C=`Mes ${b+1}`,F=o.get(C)||{ventas:0,descuentos:0,neto:0,otrosIngresos:0};return{periodo:C,...F}}):u=[{periodo:"D√≠a",...o.get("D√≠a")||{ventas:0,descuentos:0,neto:0,otrosIngresos:0}}];const f=c(R==="ventas"?N==="brutas"?L.ventasBrutas:N==="descuentos"?L.descuentos:L.ventasNetas:L.otrosIngresos);return u.reduce((g,b)=>N==="descuentos"?g+c(b.descuentos):R==="otros"?g+c(b.otrosIngresos):N==="brutas"?g+c(b.ventas):g+c(b.neto),0)<=0&&f>0&&(u=[{periodo:V==="anual"?"Total":"D√≠a",ventas:N==="brutas"?f:0,descuentos:N==="descuentos"?f:0,neto:N==="netas"?f:0,otrosIngresos:R==="otros"?f:0}]),u.some(g=>c(g.ventas)>0||c(g.neto)>0||c(g.descuentos)>0||c(g.otrosIngresos)>0)?e.jsx("div",{className:"h-80",children:e.jsx(gs,{width:"100%",height:"100%",children:e.jsxs(kn,{data:u,margin:{top:10,right:16,left:0,bottom:0},children:[e.jsx(fa,{strokeDasharray:"3 3",stroke:"hsl(var(--border))",vertical:!1}),e.jsx(Na,{dataKey:"periodo",tick:{fill:"hsl(var(--muted-foreground))",fontSize:12},tickLine:!1,axisLine:{stroke:"hsl(var(--border))"},interval:"preserveStartEnd"}),e.jsx(ba,{tickFormatter:g=>A(Number(g),$),tick:{fill:"hsl(var(--muted-foreground))",fontSize:12},tickLine:!1,axisLine:{stroke:"hsl(var(--border))"}}),e.jsx(js,{formatter:g=>[`$${A(Number(g),$)}`,""],contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"10px",color:"hsl(var(--foreground))",boxShadow:"0 8px 24px rgba(0,0,0,.12)"},itemStyle:{color:"hsl(var(--foreground))",fontWeight:600},labelStyle:{color:"hsl(var(--muted-foreground))",fontWeight:600},wrapperStyle:{zIndex:1e3}}),e.jsx(An,{}),N==="descuentos"&&e.jsx(Gs,{type:"monotone",dataKey:"descuentos",stroke:"hsl(0 72% 55%)",name:"Descuentos",strokeWidth:3,dot:!1,activeDot:{r:5}}),N==="brutas"&&R==="ventas"&&e.jsx(Gs,{type:"monotone",dataKey:"ventas",stroke:"hsl(var(--primary))",name:"Ventas Brutas",strokeWidth:3,dot:!1,activeDot:{r:5}}),N==="netas"&&R==="ventas"&&e.jsx(Gs,{type:"monotone",dataKey:"neto",stroke:"hsl(180 45% 45%)",name:"Ventas Netas",strokeWidth:3,dot:!1,activeDot:{r:5}}),R==="otros"&&N!=="descuentos"&&e.jsx(Gs,{type:"monotone",dataKey:"otrosIngresos",stroke:"hsl(140 50% 45%)",name:"Otros Ingresos",strokeWidth:3,dot:!1,activeDot:{r:5}})]})})}):e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})()})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsxs(G,{children:[N==="brutas"?"Ventas Brutas":N==="descuentos"?"Descuentos":"Ventas Netas"," por Tipo"]}),e.jsxs(oe,{children:["Distribuci√≥n de"," ",N==="brutas"?"ventas brutas":N==="descuentos"?"descuentos":"ventas netas"," por categor√≠a"]})]}),e.jsx(H,{children:T?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):a()?R==="otros"&&N==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(gs,{width:"100%",height:"100%",children:e.jsxs(va,{children:[e.jsx(ya,{data:(()=>{const c=R==="ventas"?N==="brutas"?L.ventasBrutas:N==="descuentos"?L.descuentos:L.ventasNetas:L.otrosIngresos;if(r.length===0&&(Number(c)||0)>0)return[{tipo:"Otros Ingresos",monto:Number(c)||0,porcentaje:"100.0"}];const d=r.reduce((p,o)=>{const l=(o==null?void 0:o.tipo_ingreso)||"sin_tipo";return p[l]=(p[l]||0)+(Number(ie(o,N))||0),p},{}),x=Object.values(d).reduce((p,o)=>p+(Number(o)||0),0);return Object.entries(d).map(([p,o])=>({tipo:String(p).charAt(0).toUpperCase()+String(p).slice(1),monto:Number(o)||0,porcentaje:x>0?((Number(o)||0)/x*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({tipo:c,porcentaje:d,monto:x})=>`${c}
${d}%
$${A(Number(x)||0,$)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:Object.keys(r.reduce((c,d)=>(c[(d==null?void 0:d.tipo_ingreso)||"sin_tipo"]=!0,c),{})).map((c,d)=>{const x=["hsl(180 50% 55%)","hsl(180 45% 45%)","hsl(180 55% 65%)","hsl(180 40% 40%)"];return e.jsx(Hs,{fill:x[d%4]},`cell-${d}`)})}),e.jsx(js,{formatter:c=>[`$${A(Number(c),$)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsxs(G,{children:["Estado de Pagos - ",N==="brutas"?"Ventas Brutas":N==="descuentos"?"Descuentos":"Ventas Netas"]}),e.jsx(oe,{children:"Distribuci√≥n por estado de pago"})]}),e.jsx(H,{children:T?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):a()?R==="otros"&&N==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(gs,{width:"100%",height:"100%",children:e.jsxs(va,{children:[e.jsxs(ya,{data:(()=>{const c=R==="ventas"?N==="brutas"?L.ventasBrutas:N==="descuentos"?L.descuentos:L.ventasNetas:L.otrosIngresos;if(r.length===0&&(Number(c)||0)>0)return[{estado:"Pagado Total",monto:Number(c)||0,porcentaje:"100.0"}];const d=r.reduce((p,o)=>{let l="Por Cobrar";return o.tipo_pago==="contado"||o.monto_pagado&&o.monto_pendiente===0?l="Pagado Total":(o.tipo_pago==="parcial"||o.monto_pagado>0&&o.monto_pendiente>0)&&(l="Pago Parcial"),p[l]=(p[l]||0)+(Number(ie(o,N))||0),p},{}),x=Object.values(d).reduce((p,o)=>p+(Number(o)||0),0);return Object.entries(d).map(([p,o])=>({estado:p,monto:Number(o)||0,porcentaje:x>0?((Number(o)||0)/x*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({estado:c,porcentaje:d,monto:x})=>`${c}
${d}%
$${A(Number(x)||0,$)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:[e.jsx(Hs,{fill:"hsl(180 50% 55%)"}),e.jsx(Hs,{fill:"hsl(180 55% 65%)"}),e.jsx(Hs,{fill:"hsl(180 45% 45%)"})]}),e.jsx(js,{formatter:c=>[`$${A(Number(c),$)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(W,{children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(G,{children:[N==="brutas"?"Ventas Brutas":N==="descuentos"?"Descuentos":"Ventas Netas"," por"," ",cs==="subcuenta"?"Subcuenta":"Cuenta"]}),e.jsxs(oe,{children:["Distribuci√≥n por ",cs==="subcuenta"?"subcuentas":"cuentas"," contables"]})]}),e.jsxs(pe,{value:cs,onValueChange:c=>Ga(c),children:[e.jsx(ge,{className:"w-[150px]",children:e.jsx(ye,{})}),e.jsxs(je,{children:[e.jsx(k,{value:"subcuenta",children:"Por Subcuenta"}),e.jsx(k,{value:"cuenta",children:"Por Cuenta"})]})]})]}),e.jsx(H,{children:T?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):a()?R==="otros"&&N==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(gs,{width:"100%",height:"100%",children:e.jsxs(En,{data:(()=>{const c=R==="ventas"?N==="brutas"?L.ventasBrutas:N==="descuentos"?L.descuentos:L.ventasNetas:L.otrosIngresos;if(r.length===0&&(Number(c)||0)>0)return[{subcuenta:"Sin detalle",monto:Number(c)||0}];const d=r.reduce((o,l)=>{var f;let u;if(cs==="subcuenta")u=l.subcuenta_id?((f=Q.find(w=>w.id===l.subcuenta_id))==null?void 0:f.nombre)||"Subcuenta desconocida":"Sin subcuenta asignada";else{const w=fe.find(v=>v.codigo===l.cuenta_principal_codigo);u=w?`${l.cuenta_principal_codigo} - ${w.nombre}`:l.cuenta_principal_codigo||"Sin cuenta"}return o[u]=(o[u]||0)+(Number(ie(l,N))||0),o},{}),x=Object.values(d).reduce((o,l)=>o+(Number(l)||0),0);if((Number(c)||0)-x>.01){const o={};s.forEach(l=>{const f=(Array.isArray(l.detalle_asientos)?l.detalle_asientos:[]).find(F=>String(F.cuenta_codigo||"").startsWith("4")&&Number(F.haber)>0);if(!f)return;const w=Number(f.haber)||0,v=String(f.cuenta_codigo||""),g=fe.find(F=>F.codigo===v),b=(g==null?void 0:g.nombre)||"Otros ingresos";let C;if(cs==="cuenta")C=`${v} - ${b}`;else{const F=f.subcuenta_id,D=Q.find(ee=>ee.id===F);C=(D==null?void 0:D.nombre)||"Sin subcuenta asignada"}o[C]=(o[C]||0)+w}),Object.entries(o).forEach(([l,u])=>{d[l]=(d[l]||0)+(Number(u)||0)})}return Object.entries(d).map(([o,l])=>({subcuenta:o,monto:Number(l)||0}))})(),layout:"vertical",children:[e.jsx(fa,{strokeDasharray:"3 3"}),e.jsx(Na,{type:"number",tickFormatter:c=>A(c,$),tick:{fill:"#000000"},domain:[0,c=>c*1.2]}),e.jsx(ba,{type:"category",dataKey:"subcuenta",width:150,tick:{fill:"#000000"}}),e.jsx(js,{formatter:c=>[`$${A(Number(c),$)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}}),e.jsx(Mn,{dataKey:"monto",fill:"hsl(180 50% 55%)",children:e.jsx(Vn,{dataKey:"monto",position:"right",formatter:c=>`$${A(c,$)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsx(G,{children:"M√©todos de Pago Recibidos"}),e.jsxs(oe,{children:["Distribuci√≥n de"," ",N==="brutas"?"ventas brutas":N==="descuentos"?"descuentos":"ventas netas"," por m√©todo de pago"]})]}),e.jsx(H,{children:T?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):a()?R==="otros"&&N==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):n.length===0?e.jsxs("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:["No hay transacciones con m√©todo de pago en este per√≠odo",e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-2 block",children:"Las ventas a cr√©dito no tienen m√©todo de pago asignado"})]}):e.jsx("div",{className:"h-64",children:e.jsx(gs,{width:"100%",height:"100%",children:e.jsx(Rn,{data:n,dataKey:"value",aspectRatio:4/3,stroke:"#fff",fill:"#8884d8",content:e.jsx(qn,{}),children:e.jsx(js,{content:e.jsx(Wn,{scaleFormat:$})})})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsxs(G,{children:[N==="brutas"?"Ventas Brutas":N==="descuentos"?"Descuentos":"Ventas Netas"," por Producto"]}),e.jsxs(oe,{children:["Ranking de productos ",N==="descuentos"?"con m√°s descuentos":"m√°s vendidos"]})]}),e.jsx(H,{children:T?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):a()?e.jsx("div",{className:"space-y-3",children:(()=>{if(R==="otros"&&N==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const c=R==="ventas"?N==="brutas"?L.ventasBrutas:N==="descuentos"?L.descuentos:L.ventasNetas:L.otrosIngresos;if(r.length===0&&(Number(c)||0)>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(Ie,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin detalle de producto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",A(Number(c)||0,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Ie,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",A(Number(c)||0,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const d={};r.forEach(o=>{if(o.tipo_ingreso==="inventariados"&&String(o.descripcion||"").startsWith("Venta de ")){const l=String(o.descripcion).replace("Venta de ","").trim(),u=Fe.find(f=>f.nombre.toLowerCase()===l.toLowerCase());d[l]||(d[l]={nombre:l,transacciones:0,monto:0,imagen:u==null?void 0:u.imagen_url,tieneAsignacion:!0}),d[l].transacciones+=1,d[l].monto+=Number(ie(o,N))||0}}),r.forEach(o=>{if(o.tipo_ingreso==="precargados"){let l=[];String(o.descripcion||"").startsWith("Venta: ")?l=String(o.descripcion).replace("Venta: ","").split(", ").map(g=>{const b=g.match(/^(.+?) \(x(\d+)\)$/);return b?{nombre:b[1].trim(),cantidad:parseInt(b[2])}:{nombre:g.trim(),cantidad:1}}):String(o.descripcion||"").startsWith("Venta de ")?l=[{nombre:String(o.descripcion).replace("Venta de ","").trim(),cantidad:1}]:l=[{nombre:String(o.descripcion||"Sin descripci√≥n"),cantidad:1}];const u=Number(ie(o,N))||0,f=[];let w=0;l.forEach(({nombre:v,cantidad:g})=>{const b=Se.find(F=>F.nombre.toLowerCase()===v.toLowerCase()),C=Number(b==null?void 0:b.precio)||0;f.push({nombre:v,cantidad:g,precioBase:C}),w+=C*g}),f.forEach(({nombre:v,cantidad:g,precioBase:b})=>{const C=Se.find(me=>me.nombre.toLowerCase()===v.toLowerCase()),F=b*g,D=w>0?F/w:1/Math.max(f.length,1),ee=u*D;d[v]||(d[v]={nombre:v,transacciones:0,monto:0,imagen:C==null?void 0:C.imagen_url,tieneAsignacion:!!C}),d[v].transacciones+=1,d[v].monto+=Number(ee)||0})}if(o.tipo_ingreso==="general"||o.tipo_ingreso==="inventariados"&&!String(o.descripcion||"").startsWith("Venta de ")){const l="Ingresos sin producto asignado";d[l]||(d[l]={nombre:l,transacciones:0,monto:0,tieneAsignacion:!1}),d[l].transacciones+=1,d[l].monto+=Number(ie(o,N))||0}if(o.tipo_ingreso==="otros"){const l=String(o.descripcion||"Otros ingresos");d[l]||(d[l]={nombre:l,transacciones:0,monto:0,tieneAsignacion:!1}),d[l].transacciones+=1,d[l].monto+=Number(ie(o,N))||0}});const x=Object.values(d).sort((o,l)=>(Number(l.monto)||0)-(Number(o.monto)||0));if(R==="otros"){const o=r.filter(u=>u.tipo_ingreso==="otros").reduce((u,f)=>u+(Number(ie(f,N))||0),0);if((Number(c)||0)-o>.01){const u={};s.forEach(f=>{const v=(Array.isArray(f.detalle_asientos)?f.detalle_asientos:[]).find(D=>String(D.cuenta_codigo||"").startsWith("4")&&Number(D.haber)>0);if(!v)return;const g=Number(v.haber)||0,b=String(v.cuenta_codigo||""),C=fe.find(D=>D.codigo===b);let F;String(f.numero_asiento||"").startsWith("BAJA-")?F=(C==null?void 0:C.nombre)||"Ganancia en Venta de Activos":F=String(f.descripcion||(C==null?void 0:C.nombre)||"Otros ingresos"),u[F]||(u[F]={monto:0,count:0}),u[F].monto+=g,u[F].count+=1}),Object.entries(u).forEach(([f,w])=>{(Number(w.monto)||0)>.01&&x.push({nombre:f,transacciones:w.count,monto:w.monto,tieneAsignacion:!1})})}}const p=x.slice(0,10);return e.jsxs(e.Fragment,{children:[p.map(o=>{const l=x.reduce((f,w)=>f+(Number(w.monto)||0),0),u=l>0?((Number(o.monto)||0)/l*100).toFixed(1):"0.0";return e.jsxs("div",{className:`flex items-center gap-3 p-3 border rounded-lg ${o.tieneAsignacion?"":"border-amber-500/50 bg-amber-50/50 dark:bg-amber-950/20"}`,children:[o.imagen?e.jsx("img",{src:o.imagen,alt:o.nombre,className:"w-12 h-12 rounded-md object-cover flex-shrink-0"}):e.jsx("div",{className:`w-12 h-12 rounded-md flex items-center justify-center flex-shrink-0 ${o.tieneAsignacion?"bg-muted":"bg-amber-100 dark:bg-amber-900/30"}`,children:e.jsx(Ie,{className:`w-5 h-5 ${o.tieneAsignacion?"text-muted-foreground":"text-amber-600 dark:text-amber-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium truncate",children:o.nombre}),!o.tieneAsignacion&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-200 flex-shrink-0",children:"Sin asignar"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[o.transacciones," ",o.transacciones===1?"transacci√≥n":"transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",A(Number(o.monto)||0,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[u,"%"]})})]},o.nombre)}),(()=>{const o=x.reduce((l,u)=>l+(Number(u.monto)||0),0);return o>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Ie,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x.reduce((l,u)=>l+(Number(u.transacciones)||0),0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",A(o,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsxs(G,{children:[N==="brutas"?"Ventas Brutas":N==="descuentos"?"Descuentos":"Ventas Netas"," por Cliente"]}),e.jsxs(oe,{children:["Ranking de ",N==="descuentos"?"clientes con m√°s descuentos":"mejores clientes"]})]}),e.jsx(H,{children:T?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):a()?e.jsx("div",{className:"space-y-3",children:(()=>{if(R==="otros"&&N==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const c=R==="ventas"?N==="brutas"?L.ventasBrutas:N==="descuentos"?L.descuentos:L.ventasNetas:L.otrosIngresos;if(r.length===0&&(Number(c)||0)>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ps,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin cliente asignado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",A(Number(c)||0,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(ps,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",A(Number(c)||0,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const d=r.reduce((l,u)=>{const f=String((u==null?void 0:u.cliente_nombre)||"Sin cliente asignado");return l[f]||(l[f]={nombre:f,transacciones:0,monto:0,email:u==null?void 0:u.cliente_email,telefono:u==null?void 0:u.cliente_telefono}),l[f].transacciones+=1,l[f].monto+=Number(ie(u,N))||0,l},{}),x=Object.values(d).sort((l,u)=>(Number(u.monto)||0)-(Number(l.monto)||0)),p=x.reduce((l,u)=>l+(Number(u.monto)||0),0);if(R==="otros"){const l=(Number(c)||0)-p;if(l>.01){const u=x.find(f=>f.nombre==="Sin cliente asignado");u?(u.monto+=l,u.transacciones+=s.length):x.push({nombre:"Sin cliente asignado",transacciones:s.length,monto:l}),x.sort((f,w)=>(Number(w.monto)||0)-(Number(f.monto)||0))}}const o=x.slice(0,10);return e.jsxs(e.Fragment,{children:[o.map(l=>{const u=x.reduce((w,v)=>w+(Number(v.monto)||0),0),f=u>0?((Number(l.monto)||0)/u*100).toFixed(1):"0.0";return e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ps,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:l.nombre}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-0.5",children:[e.jsxs("p",{children:[l.transacciones," ",l.transacciones===1?"compra":"compras"]}),l.telefono&&e.jsx("p",{className:"text-xs",children:l.telefono}),l.email&&e.jsx("p",{className:"text-xs truncate",children:l.email})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",A(Number(l.monto)||0,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[f,"%"]})})]},l.nombre)}),(()=>{const l=x.reduce((u,f)=>u+(Number(f.monto)||0),0);return l>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(ps,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x.reduce((u,f)=>u+(Number(f.transacciones)||0),0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",A(l,$)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]})]})]})]})})()}),e.jsx(es,{value:"catalogo",className:"mt-6",children:e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsxs(G,{className:"flex items-center justify-between",children:["Cat√°logo de Productos",e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>{wa(),ae({title:"Actualizado",description:"La lista de productos se ha actualizado correctamente"})},children:[e.jsx(On,{className:"mr-2 h-4 w-4"}),"Actualizar"]}),e.jsxs(ds,{open:Ja,onOpenChange:ut,children:[e.jsx(ja,{asChild:!0,children:e.jsxs(z,{children:[e.jsx(_t,{className:"mr-2 h-4 w-4"}),"Nuevo Producto"]})}),e.jsxs(ms,{className:"sm:max-w-[425px]",children:[e.jsxs(us,{children:[e.jsx(xs,{children:"Agregar Nuevo Producto"}),e.jsx(hs,{children:"Completa la informaci√≥n del producto para agregarlo al cat√°logo."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-name",className:"text-right",children:"Nombre"}),e.jsx(U,{id:"product-name",value:xt,onChange:s=>Qt(s.target.value),className:"col-span-3",placeholder:"Nombre del producto"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-image",className:"text-right",children:"Imagen"}),e.jsx(U,{id:"product-image",type:"file",accept:"image/*",onChange:s=>{var t;return aa(((t=s.target.files)==null?void 0:t[0])||null)},className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-price",className:"text-right",children:"Precio"}),e.jsx(U,{id:"product-price",type:"number",value:ht,onChange:s=>Xt(s.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-account",className:"text-right",children:"Cuenta"}),e.jsxs("div",{className:"col-span-3 flex items-center p-2 border rounded-md bg-muted/50",children:[e.jsx("span",{className:"text-sm font-medium",children:"4001 - Ventas"}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"(cuenta fija)"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(pe,{value:sa,onValueChange:s=>ta(s==="none"?"":s),children:[e.jsx(ge,{className:"col-span-3",children:e.jsx(ye,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(je,{children:[e.jsx(k,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),Q.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>e.jsx(k,{value:s.id,children:s.nombre},s.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(ss,{id:"product-description",value:Zt,onChange:s=>ea(s.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]})]}),e.jsxs(Ys,{children:[e.jsx(z,{type:"button",variant:"outline",onClick:()=>ut(!1),children:"Cancelar"}),e.jsx(z,{onClick:gn,disabled:zs,children:zs?"Guardando...":"Guardar Producto"})]})]})]}),e.jsx(ds,{open:en,onOpenChange:Ws,children:e.jsxs(ms,{className:"sm:max-w-[425px]",children:[e.jsxs(us,{children:[e.jsx(xs,{children:"Editar Producto"}),e.jsx(hs,{children:"Modifica la informaci√≥n del producto."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-name",className:"text-right",children:"Nombre *"}),e.jsx(U,{id:"edit-product-name",value:ft,onChange:s=>Nt(s.target.value),className:"col-span-3",placeholder:"Ej: Consultor√≠a, Producto X"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-price",className:"text-right",children:"Precio *"}),e.jsx(U,{id:"edit-product-price",type:"number",value:bt,onChange:s=>vt(s.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-image",className:"text-right",children:"Imagen"}),e.jsxs("div",{className:"col-span-3 space-y-2",children:[e.jsx(U,{id:"edit-product-image",type:"file",accept:"image/*",onChange:jn}),ia&&e.jsx("div",{className:"aspect-square w-24 mx-auto",children:e.jsx("img",{src:ia,alt:"Preview",className:"w-full h-full object-cover rounded-md"})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(ss,{id:"edit-product-description",value:oa,onChange:s=>yt(s.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(j,{htmlFor:"edit-product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(pe,{value:ca||"none",onValueChange:s=>la(s==="none"?"":s),children:[e.jsx(ge,{className:"col-span-3",children:e.jsx(ye,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(je,{children:[e.jsx(k,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),Q.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>e.jsx(k,{value:s.id,children:s.nombre},s.id))]})]})]})]}),e.jsxs(Ys,{children:[e.jsx(z,{type:"button",variant:"outline",onClick:()=>Ws(!1),children:"Cancelar"}),e.jsx(z,{onClick:fn,disabled:zs,children:zs?"Actualizando...":"Actualizar Producto"})]})]})})]})]}),e.jsx(oe,{children:"Gestiona el cat√°logo de productos y servicios con cuentas contables asignadas"})]}),e.jsxs(H,{children:[e.jsxs(Ve,{className:"mb-6",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsxs(Re,{children:[e.jsx("strong",{children:"Recomendaci√≥n:"}),' Asignar subcuentas a cada producto ayuda a llevar un mejor control contable. La cuenta predeterminada es "4001 - Ventas".']})]}),e.jsx("div",{className:"space-y-6",children:Js?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):Se.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay productos de servicios registrados a√∫n"}):e.jsxs("div",{className:"space-y-6",children:[Q.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>{const t=Se.filter(r=>r.subcuenta_id===s.id);return t.length===0?null:e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsxs(G,{className:"text-lg flex items-center",children:[e.jsx(Ie,{className:"mr-2 h-5 w-5"}),"Subcuenta: ",s.nombre]}),e.jsxs(oe,{children:[t.length," producto",t.length!==1?"s":""]})]}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(r=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[r.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:r.imagen_url,alt:r.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:r.nombre}),r.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:r.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",r.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{variant:"outline",size:"sm",onClick:()=>ma(r),className:"flex-1",children:"Editar"}),e.jsx(z,{variant:"outline",size:"sm",onClick:()=>kt.mutate(r.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},r.id))})})]},s.id)}),(()=>{const s=Se.filter(t=>!t.subcuenta_id);return s.length===0?null:e.jsxs(W,{children:[e.jsxs(Y,{children:[e.jsxs(G,{className:"text-lg flex items-center",children:[e.jsx(pa,{className:"mr-2 h-5 w-5"}),"Cuenta General: 4001 - Ventas"]}),e.jsxs(oe,{children:[s.length," producto",s.length!==1?"s":""," sin subcuenta espec√≠fica"]})]}),e.jsx(H,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(t=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[t.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:t.imagen_url,alt:t.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:t.nombre}),t.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",t.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{variant:"outline",size:"sm",onClick:()=>ma(t),className:"flex-1",children:"Editar"}),e.jsx(z,{variant:"outline",size:"sm",onClick:()=>kt.mutate(t.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},t.id))})})]})})()]})})]})]})})]}),e.jsx(ds,{open:Za,onOpenChange:Us,children:e.jsxs(ms,{children:[e.jsxs(us,{children:[e.jsx(xs,{children:"‚ùå Cancelar Transacci√≥n"}),e.jsx(hs,{children:"Esta acci√≥n crear√° un asiento contable de reversi√≥n. La transacci√≥n original quedar√° marcada como cancelada pero mantendr√° toda su trazabilidad."})]}),e.jsxs("div",{className:"space-y-4",children:[We&&e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Transacci√≥n a cancelar:"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",We.descripcion]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Monto:"})," $",I(We.monto_total)]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(We.created_at).toLocaleDateString("es-ES")]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"motivo-cancelacion",children:"Motivo de la Cancelaci√≥n *"}),e.jsx(ss,{id:"motivo-cancelacion",placeholder:"Ej: Error en registro, cliente cancel√≥ pedido, etc.",value:qs,onChange:s=>gt(s.target.value),rows:3})]}),e.jsxs(Ve,{children:[e.jsx(B,{className:"h-4 w-4"}),e.jsxs(Re,{className:"text-xs",children:[e.jsx("strong",{children:"¬øQu√© suceder√°?"}),e.jsxs("ul",{className:"list-disc ml-4 mt-1 space-y-1",children:[e.jsx("li",{children:"Se crear√° un asiento de reversi√≥n autom√°ticamente"}),e.jsx("li",{children:'La transacci√≥n original se marcar√° como "cancelada"'}),e.jsx("li",{children:"Si es venta de inventario, el stock se restaurar√°"}),e.jsx("li",{children:"Ambas transacciones quedar√°n visibles para auditor√≠a"})]})]})]})]}),e.jsxs(Ys,{children:[e.jsx(z,{variant:"outline",onClick:()=>{Us(!1),gt(""),pt(null)},disabled:jt,children:"Cancelar"}),e.jsx(z,{variant:"destructive",onClick:hn,disabled:jt||!qs.trim(),children:jt?"Cancelando...":"Confirmar Cancelaci√≥n"})]})]})})]})]})};export{Kn as default};
