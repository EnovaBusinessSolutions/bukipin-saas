import{c as bn,r as u,a as vn,f as Ns,e as ts,j as e,b as Hs,P as Ft,d as Dt,B as M,C as It,g as Tt,h as $t,u as yn,i as wn,k as Cn,l as Sn,m as _n,n as Pn,o as Fn,p as Dn,q as In,s as Tn,D as ls,t as ds,v as ms,w as us,x as R,y as xs,S as Ve,z as xa,R as ye,A,L as p,I as O,E as qs,F as te,T as ha,G as pa,H as Ze,J as es,K as W,M as q,N as G,O as re,Q as Y,U as ja,V as Ie,W as ga,X as hs,Y as Re,Z as Oe,_ as he,$ as pe,a0 as we,a1 as je,a2 as T,a3 as ss,a4 as $n,a5 as kn,a6 as fa,a7 as ps,a8 as An,a9 as Na,aa as ba,ab as va,ac as js,ad as En,ae as Gs,af as gs,ag as ya,ah as wa,ai as Ys,aj as Mn,ak as Vn,al as Rn,am as On,an as _t}from"./index-CUtJfB3r.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ln=bn("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),zn=d=>{const C=(d==null?void 0:d.data)??d??[];return Array.isArray(C)?C:[]},Bn=(d=10)=>{const[C,S]=u.useState([]),[y,I]=u.useState(!0),[oe,le]=u.useState(null),J=async()=>{try{I(!0),le(null);const X=await vn(`/api/transacciones/ingresos/recientes?limit=${encodeURIComponent(String(d))}`,{method:"GET"}),Ce=zn(X).map(Ne=>{var Ke;return{...Ne,asiento_fecha:Ne.asiento_fecha??(Array.isArray(Ne.asiento)&&Ne.asiento.length>0?((Ke=Ne.asiento[0])==null?void 0:Ke.fecha)??null:null)}});S(Ce)}catch(X){console.error("Error fetching transacciones recientes:",X),le((X==null?void 0:X.message)||"Error desconocido")}finally{I(!1)}};return u.useEffect(()=>{let X=!0;J();const Ce=window.setInterval(()=>{X&&J()},3e4);return()=>{X=!1,window.clearInterval(Ce)}},[d]),{transacciones:C,loading:y,error:oe,refetch:J}};function Un({value:d,onChange:C,className:S,placeholder:y="Selecciona un rango",disabled:I}){const oe=u.useMemo(()=>d!=null&&d.from?d.to?`${Ns(d.from,"dd/MM/yyyy",{locale:ts})} ‚Äì ${Ns(d.to,"dd/MM/yyyy",{locale:ts})}`:Ns(d.from,"dd/MM/yyyy",{locale:ts}):y,[d,y]);return e.jsx("div",{className:Hs("grid gap-2",S),children:e.jsxs(Ft,{children:[e.jsx(Dt,{asChild:!0,children:e.jsxs(M,{type:"button",variant:"outline",disabled:I,className:Hs("w-full justify-start text-left font-normal",!(d!=null&&d.from)&&"text-muted-foreground"),children:[e.jsx(It,{className:"mr-2 h-4 w-4"}),oe]})}),e.jsxs(Tt,{className:"w-auto p-0",align:"start",children:[e.jsx($t,{initialFocus:!0,mode:"range",numberOfMonths:2,selected:d,onSelect:C,locale:ts,defaultMonth:(d==null?void 0:d.from)??new Date}),e.jsxs("div",{className:"flex items-center justify-between gap-2 border-t p-2",children:[e.jsx(M,{type:"button",variant:"ghost",size:"sm",onClick:()=>C(void 0),children:"Limpiar"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:d!=null&&d.from&&!(d!=null&&d.to)?"Elige la fecha fin":" "})]})]})]})})}async function Te(d,C={}){const S=await fetch(d,{credentials:"include",headers:{"Content-Type":"application/json",...C.headers||{}},...C}),y=await S.json().catch(()=>({}));if(!S.ok){const I=(y==null?void 0:y.error)||(y==null?void 0:y.message)||`HTTP ${S.status}`;throw new Error(I)}return(y==null?void 0:y.data)??y}async function Pt(d,C={}){const S=(C==null?void 0:C.body)??{};try{if(d==="registrar-ingreso")return{data:await Te("/api/ingresos",{method:"POST",body:JSON.stringify(S)}),error:null};if(d==="cancelar-ingreso"){const I=S==null?void 0:S.transaccionId;return{data:await Te(`/api/ingresos/${encodeURIComponent(I)}/cancelar`,{method:"POST",body:JSON.stringify({motivoCancelacion:S==null?void 0:S.motivoCancelacion})}),error:null}}return{data:await Te(`/api/functions/${encodeURIComponent(d)}`,{method:"POST",body:JSON.stringify(S)}),error:null}}catch(y){return{data:null,error:{message:(y==null?void 0:y.message)||String(y)}}}}const Ye=d=>{if(d==null)return 0;const C=typeof d=="string"?Number(d):d;return Number.isFinite(C)?C:0},_=d=>Ye(d).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),D=(d,C)=>{const S=Ye(d);let y=S,I="";return C==="miles"?(y=S/1e3,I=" K"):C==="millones"&&(y=S/1e6,I=" M"),y.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})+I},fs=d=>{if(!d)return d;const C=d.id??d._id,S=d.fecha??d.createdAt??d.created_at??d.updatedAt??d.updated_at,y=S?String(S):void 0,I=y?y.slice(0,10):d.created_at,oe=Ye(d.monto_total??d.montoTotal??d.total??d.monto_total),le=Ye(d.monto_descuento??d.montoDescuento??d.descuento),J=Ye(d.monto_neto??d.montoNeto??d.neto??oe-le),X=Ye(d.monto_pagado??d.montoPagado??d.pagado??J),fe=Ye(d.saldo_pendiente??d.saldoPendiente??d.pendiente??Math.max(0,J-X)),Ce=d.tipo_ingreso??d.tipoIngreso??d.tipo,Ne=d.metodo_pago??d.metodoPago,Ke=d.tipo_pago??d.tipoPago;return{...d,id:C,_id:d._id??C,created_at:d.created_at??I,fecha:d.fecha??y,tipo_ingreso:Ce,tipoIngreso:d.tipoIngreso??Ce,metodo_pago:Ne,metodoPago:d.metodoPago??Ne,tipo_pago:Ke,tipoPago:d.tipoPago??Ke,monto_total:oe,montoTotal:d.montoTotal??oe,total:d.total??oe,monto_descuento:le,montoDescuento:d.montoDescuento??le,monto_neto:J,montoNeto:d.montoNeto??J,neto:d.neto??J,monto_pagado:X,montoPagado:d.montoPagado??X,pagado:d.pagado??X,saldo_pendiente:fe,saldoPendiente:d.saldoPendiente??fe,pendiente:d.pendiente??fe}},ge=(d,C)=>{const S=fs(d);return C==="brutas"?S.monto_total||0:C==="descuentos"?S.monto_descuento||0:C==="netas"&&(S.monto_neto||S.monto_total)||0},Ks=d=>{const C=(d??"").toString().slice(0,10),[S,y,I]=C.split("-").map(Number);return new Date(S,(y||1)-1,I||1)},Wn=d=>{const{x:C,y:S,width:y,height:I,name:oe,value:le,porcentaje:J}=d,fe=oe==="Efectivo"?"hsl(180 50% 55%)":"hsl(180 45% 45%)",Ce=y>100&&I>70;return e.jsxs("g",{children:[e.jsx("rect",{x:C,y:S,width:y,height:I,fill:fe,stroke:"#fff",strokeWidth:2}),Ce&&e.jsxs(e.Fragment,{children:[e.jsx("text",{x:C+y/2,y:S+I/2-20,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontWeight:"bold",fontSize:"16px",style:{userSelect:"none"},children:oe}),e.jsxs("text",{x:C+y/2,y:S+I/2+5,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:["$",D(le,"general")]}),e.jsxs("text",{x:C+y/2,y:S+I/2+25,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:[J,"%"]})]})]})},qn=({active:d,payload:C,scaleFormat:S})=>{if(d&&C&&C.length){const y=C[0].payload,I=y.name==="Efectivo";return e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-lg p-3",children:[e.jsx("p",{className:"font-bold text-foreground mb-1",children:y.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Monto: ",e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(y.value,S)]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Porcentaje: ",e.jsxs("span",{className:"font-semibold text-foreground",children:[y.porcentaje,"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2 italic",children:I?"Se registra en Efectivo (Caja)":"Se registra en Bancos"})]})}return null},Hn=()=>{const{ventasResumen:d,loading:C,refetch:S}=yn(),{transacciones:y,loading:I,refetch:oe}=Bn(1e3),le=(y??[]).map(fs),{data:J=[]}=wn(),{data:X}=Cn(),fe=(X==null?void 0:X.cuentasFlat)||[],{data:Ce=[],isLoading:Ne,refetch:Ke}=Sn(),{data:Se=[],isLoading:Js,refetch:Ca}=_n(),{data:ke=[],isLoading:Sa}=Pn(),_a=Fn(),Pa=Dn(),kt=In(),Fa=Tn(),[k,At]=u.useState(""),[Da,Ia]=u.useState(!1),[Ta,$a]=u.useState(""),[bs,Et]=u.useState(""),[$,Mt]=u.useState(""),[be,Le]=u.useState(""),[vs,He]=u.useState(""),[Vt,ys]=u.useState(!1),[Q,Rt]=u.useState(""),[ve,Qs]=u.useState(""),[Je,ws]=u.useState(""),[_e,Cs]=u.useState(""),[Pe,Ss]=u.useState(""),[$e,_s]=u.useState(""),[Ps,Ot]=u.useState(""),[Fe,Lt]=u.useState(""),[Fs,Xs]=u.useState(""),[Ae,Ds]=u.useState([]),[ka,as]=u.useState(!1),[N,Is]=u.useState(null),[Qe,Zs]=u.useState("historico"),[ie,ns]=u.useState(""),[Z,Aa]=u.useState("diario"),[P,Ea]=u.useState("general"),[f,Ma]=u.useState("brutas"),[L,Va]=u.useState("ventas"),[de,Ra]=u.useState(new Date),[E,Oa]=u.useState(new Date),[rs,La]=u.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[os,za]=u.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[is,Ba]=u.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[V,zt]=u.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]}),[Gn,Ts]=u.useState([]),[Ee,Ua]=u.useState([]),[Bt,Ut]=u.useState(""),[Wt,qt]=u.useState(""),[Wa,Gt]=u.useState(void 0);function Yt(s){const a=s.getFullYear(),i=String(s.getMonth()+1).padStart(2,"0"),o=String(s.getDate()).padStart(2,"0");return`${a}-${i}-${o}`}function qa(s){const[a,i,o]=String(s).split("-").map(Number);return!a||!i||!o?null:new Date(a,i-1,o,0,0,0,0)}function Ga(s){const[a,i,o]=String(s).split("-").map(Number);return!a||!i||!o?null:new Date(a,i-1,o,23,59,59,999)}const $s=s=>{const a=Ks(s),i=Bt?qa(Bt):null,o=Wt?Ga(Wt):null;return!(i&&a<i||o&&a>o)},Ya=s=>{Gt(s);const a=s==null?void 0:s.from,i=s==null?void 0:s.to;Ut(a?Yt(a):""),qt(i?Yt(i):"")},[me,Kt]=u.useState("todos"),[ue,Ht]=u.useState("todas"),[se,Jt]=u.useState(""),[Xe,Ka]=u.useState("subcuenta"),[ze,ks]=u.useState(null),[Ha,et]=u.useState(!1),[ae,st]=u.useState(""),[Be,cs]=u.useState(""),[Me,tt]=u.useState("1"),[As,at]=u.useState(0),[nt,Es]=u.useState(!0),[rt,ot]=u.useState("0"),[Ue,it]=u.useState("monto"),[K,Ms]=u.useState([]),[We,ct]=u.useState(""),[Vs,lt]=u.useState(""),[Rs,dt]=u.useState("1"),[mt,Qt]=u.useState("0"),[qe,Ja]=u.useState("monto"),[ee,Os]=u.useState([]),[Qa,ut]=u.useState(!1),[xt,Xt]=u.useState(""),[ht,Zt]=u.useState(""),[ea,sa]=u.useState(""),[Yn,Xa]=u.useState("4001"),[ta,aa]=u.useState(""),[Za,na]=u.useState(null);u.useState(null);const[Ls,zs]=u.useState(!1),[en,Bs]=u.useState(!1),[Ge,pt]=u.useState(null),[Us,jt]=u.useState(""),[gt,ra]=u.useState(!1),[sn,Ws]=u.useState(!1),[tn,oa]=u.useState(null),[ft,Nt]=u.useState(""),[bt,vt]=u.useState(""),[ia,yt]=u.useState(""),[an,wt]=u.useState(null),[ca,Ct]=u.useState(null),[la,da]=u.useState(""),De=Ce||[],nn=s=>{var i;st(s);const a=De.find(o=>o.id===s);if(a){const o=a.precio_venta,n=o&&o>0?o.toString():((i=a.costo_unitario)==null?void 0:i.toString())||"0",t=o&&o>0;Es(t),cs(n),at(a.cantidad_stock||0),He(`Venta de ${a.nombre}`);const l=((o&&o>0?o:a.costo_unitario||0)*parseFloat(Me)).toFixed(2);Le(l)}},rn=s=>{if(cs(s),ae&&s){const a=(parseFloat(s)*parseFloat(Me||"1")).toFixed(2);Le(a)}},on=()=>{if(!We)return;const s=Se.find(l=>l.id===We);if(!s)return;const a=parseFloat(Rs)||1,i=parseFloat(mt)||0,o=s.precio*a,n=qe==="porcentaje"?o*(i/100):i,t=Math.max(0,o-n),m=ee.findIndex(l=>l.id===We);if(m!==-1){const l=[...ee];l[m].cantidad+=a,l[m].descuento+=n;const x=l[m].precio*l[m].cantidad;l[m].subtotal=Math.max(0,x-l[m].descuento),Os(l)}else Os([...ee,{id:s.id,nombre:s.nombre,precio:s.precio,cantidad:a,descuento:n,subtotal:t,imagen_url:s.imagen_url}]);ct(""),dt("1"),lt(""),Qt("0")},cn=s=>{Os(ee.filter(a=>a.id!==s))},ln=()=>{if(!ae)return;const s=De.find(x=>x.id===ae);if(!s)return;const a=parseFloat(Me)||1,i=parseFloat(Be)||0,o=parseFloat(rt)||0,n=i*a,t=Ue==="porcentaje"?n*(o/100):o,m=Math.max(0,n-t),l=K.findIndex(x=>x.id===ae);if(l!==-1){const x=[...K];x[l].cantidad+=a,x[l].descuento+=t;const r=x[l].precioUnitario*x[l].cantidad;x[l].subtotal=Math.max(0,r-x[l].descuento),Ms(x)}else Ms([...K,{id:ae,nombre:s.nombre,precioUnitario:i,cantidad:a,descuento:t,subtotal:m,stockDisponible:s.cantidad_stock||0,costoUnitario:s.costo_unitario||0,imagen_url:s.imagen_url}]);st(""),tt("1"),cs(""),ot("0"),it("monto"),at(0),Es(!0),te({title:"‚úÖ Producto agregado",description:`${s.nombre} agregado a la venta`})},dn=s=>{Ms(K.filter(a=>a.id!==s)),te({title:"Producto eliminado",description:"El producto ha sido removido de la venta"})};u.useEffect(()=>{if(k==="precargados"&&ee.length>0){const s=ee.reduce((a,i)=>a+i.subtotal,0).toFixed(2);Le(s),He(`Venta de ${ee.length} producto(s)`)}},[ee,k]),u.useEffect(()=>{if(k==="inventariados"&&K.length>0){const s=K.reduce((a,i)=>a+i.subtotal,0).toFixed(2);Le(s),He(`Venta de ${K.length} producto(s) de inventario`)}},[K,k]);const mn=s=>{ct(s);const a=Se.find(i=>i.id===s);a&&lt(a.precio.toString())},ma=()=>{const s=[];return k||s.push("Tipo de Ingreso"),k==="precargados"?ee.length===0&&s.push("Debe agregar al menos un producto"):k==="inventariados"?K.length===0&&s.push("Debe agregar al menos un producto del inventario"):(k==="general"||k==="otros")&&(vs.trim()||s.push("Descripci√≥n")),k!=="precargados"&&k!=="inventariados"&&(!be||parseFloat(be)<=0)&&s.push("Monto Total"),($==="credito"||$==="parcial")&&(Q||s.push("Tipo de Cliente"),Q==="recurrente"&&!ve&&s.push("Cliente Seleccionado"),Q==="nuevo"&&(Je.trim()||s.push("Nombre del Cliente"),_e.trim()||s.push("Tel√©fono del Cliente"),Pe.trim()||s.push("Email del Cliente")),Ps||s.push("Fecha de Vencimiento"),$==="parcial"&&((!Fe||parseFloat(Fe)<=0)&&s.push("Monto Abonado"),be&&Fe&&parseFloat(Fe)>=parseFloat(be)&&s.push("Monto Abonado debe ser menor al total"))),($==="contado"||$==="parcial")&&!bs&&s.push("M√©todo de Pago"),$||s.push("Tipo de Pago"),s},H=s=>ma().includes(s),un=(s,a,i)=>{const o=[];return!ke||ke.length===0||ke.forEach(n=>{n.telefono&&s&&n.telefono.trim()===s.trim()&&o.push(`El tel√©fono ${s} ya est√° registrado para el cliente "${n.nombre}"`),n.email&&a&&n.email.trim().toLowerCase()===a.trim().toLowerCase()&&o.push(`El correo ${a} ya est√° registrado para el cliente "${n.nombre}"`),n.rfc&&i&&n.rfc.trim().toUpperCase()===i.trim().toUpperCase()&&o.push(`El RFC ${i} ya est√° registrado para el cliente "${n.nombre}"`)}),o};u.useEffect(()=>{if(Q==="nuevo"&&(_e||Pe||$e)){const s=un(_e,Pe,$e);Ds(s)}else Ds([])},[_e,Pe,$e,Q,ke]),u.useEffect(()=>{(async()=>{var a;try{const i=await Te("/api/ingresos/asientos-directos"),o=(i==null?void 0:i.asientos)??((a=i==null?void 0:i.data)==null?void 0:a.asientos)??i??[],n=null;if(!o)return;const t=o.filter(m=>m.detalle_asientos.some(l=>l.cuenta_codigo.startsWith("4")&&l.cuenta_codigo!=="4003"&&Number(l.haber)>0));Ua(t)}catch(i){console.error("Error al cargar asientos directos:",i)}})()},[]),u.useEffect(()=>{(async()=>{var a,i;try{let o,n;Z==="diario"?(o=new Date(de),o.setHours(0,0,0,0),n=new Date(de),n.setHours(23,59,59,999)):Z==="mensual"?(o=new Date(E.getFullYear(),E.getMonth(),1),n=new Date(E.getFullYear(),E.getMonth()+1,0,23,59,59,999)):(o=new Date(new Date().getFullYear(),0,1),n=new Date(new Date().getFullYear(),11,31,23,59,59,999));const t=await Te(`/api/ingresos/asientos?start=${encodeURIComponent(o.toISOString().split("T")[0])}&end=${encodeURIComponent(n.toISOString().split("T")[0])}`),m=(t==null?void 0:t.asientos)??((a=t==null?void 0:t.data)==null?void 0:a.asientos)??[],l=(t==null?void 0:t.detalles)??((i=t==null?void 0:t.data)==null?void 0:i.detalles)??[],x=null;if(!m||m.length===0){zt({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]});return}const r=m.map(g=>g.id);let c=0,h=0,j=0;const b={};m.forEach(g=>{const w=l.filter(B=>B.asiento_id===g.id),F=Ks(g.fecha);let z;Z==="diario"?z="Hoy":Z==="mensual"?z=`D√≠a ${F.getDate()}`:z=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][F.getMonth()],b[z]||(b[z]={ventasBrutas:0,descuentos:0,otrosIngresos:0}),w.forEach(B=>{const U=B.debe||0,ce=B.haber||0,xe=B.cuenta_codigo;if(L==="ventas"){if(xe==="4001"){const ne=ce-U;c+=ne,b[z].ventasBrutas+=ne}if(xe==="4003"){const ne=U-ce;h+=ne,b[z].descuentos+=ne}}else if(xe.startsWith("4")&&xe!=="4001"&&xe!=="4003"){const ne=ce-U;j+=ne,b[z].otrosIngresos+=ne}})});let v=[];if(Z==="diario"){const g=b.Hoy||{ventasBrutas:0,descuentos:0,otrosIngresos:0};v=[{periodo:"Hoy",ventasBrutas:g.ventasBrutas,descuentos:g.descuentos,ventasNetas:g.ventasBrutas-g.descuentos,otrosIngresos:g.otrosIngresos}]}else if(Z==="mensual"){const g=new Date(E.getFullYear(),E.getMonth()+1,0).getDate();v=Array.from({length:g},(w,F)=>{const B=`D√≠a ${F+1}`,U=b[B]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:B,ventasBrutas:U.ventasBrutas,descuentos:U.descuentos,ventasNetas:U.ventasBrutas-U.descuentos,otrosIngresos:U.otrosIngresos}})}else v=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"].map(w=>{const F=b[w]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:w,ventasBrutas:F.ventasBrutas,descuentos:F.descuentos,ventasNetas:F.ventasBrutas-F.descuentos,otrosIngresos:F.otrosIngresos}});zt({ventasBrutas:c,descuentos:h,ventasNetas:c-h,otrosIngresos:j,detallesPorPeriodo:v})}catch(o){console.error("Error calculando anal√≠ticas desde asientos:",o)}})()},[Z,de,E,L]),u.useEffect(()=>{(async()=>{try{const i=async l=>{var B;const x=new Date;let r,c;if(l==="dia")r=de.toISOString().split("T")[0],c=r;else if(l==="mes"){const U=E.getMonth(),ce=E.getFullYear(),xe=new Date(ce,U,1),ne=new Date(ce,U+1,0);r=xe.toISOString().split("T")[0],c=ne.toISOString().split("T")[0]}else{const U=x.getFullYear();r=`${U}-01-01`,c=`${U}-12-31`}const h=await Te(`/api/ingresos/detalles?start=${encodeURIComponent(r)}&end=${encodeURIComponent(c)}`),j=(h==null?void 0:h.detalles)??((B=h==null?void 0:h.data)==null?void 0:B.detalles)??h??[],b=null;let v=0,g=0,w=0;(j||[]).forEach(U=>{const ce=Number(U.debe)||0,xe=Number(U.haber)||0,ne=U.cuenta_codigo;ne==="4001"?v+=xe-ce:ne==="4003"?g+=ce-xe:ne!=null&&ne.startsWith("4")&&(w+=xe-ce)});const F=v-g,z=F+w;return{ventasBrutas:v,descuentos:g,ventasNetas:F,otrosIngresos:w,totalIngresos:z}},o=async()=>{var l;try{let x,r=new Date;Z==="diario"?(x=new Date(de),x.setHours(0,0,0,0),r=new Date(de),r.setHours(23,59,59,999)):Z==="mensual"?(x=new Date(E.getFullYear(),E.getMonth(),1),r=new Date(E.getFullYear(),E.getMonth()+1,0,23,59,59,999)):(x=new Date(E.getFullYear(),0,1),r=new Date(E.getFullYear(),11,31,23,59,59,999));const c=await Te(`/api/inventario/movimientos?tipo=venta&start=${encodeURIComponent(x.toISOString())}&end=${encodeURIComponent(r.toISOString())}`),h=(c==null?void 0:c.movimientos)??((l=c==null?void 0:c.data)==null?void 0:l.movimientos)??c??[],j=null;Ts(h||[])}catch(x){console.error("Error en cargarMovimientosInventario:",x),Ts([])}},[n,t,m]=await Promise.all([i("dia"),i("mes"),i("ano")]);La(n),za(t),Ba(m)}catch(i){console.error("Error calculando totales:",i)}})(),(async()=>{var i;try{let o,n=new Date;Z==="diario"?(o=new Date(de),o.setHours(0,0,0,0),n=new Date(de),n.setHours(23,59,59,999)):Z==="mensual"?(o=new Date(E.getFullYear(),E.getMonth(),1),n=new Date(E.getFullYear(),E.getMonth()+1,0,23,59,59,999)):(o=new Date(E.getFullYear(),0,1),n=new Date(E.getFullYear(),11,31,23,59,59,999));const t=await Te(`/api/inventario/movimientos?tipo=venta&start=${encodeURIComponent(o.toISOString())}&end=${encodeURIComponent(n.toISOString())}`),m=(t==null?void 0:t.movimientos)??((i=t==null?void 0:t.data)==null?void 0:i.movimientos)??t??[],l=null;Ts(m||[])}catch(o){console.error("Error en loadMovimientos:",o),Ts([])}})()},[de,E,Z,y]);const xn=async s=>{var i,o;const a=String(s??"").trim();if(et(!0),ks(null),!a||a==="undefined"||a==="null"){et(!1);return}try{const n=await Te(`/api/asientos/by-transaccion?source=ingreso&id=${encodeURIComponent(a)}`),t=(n==null?void 0:n.asiento)??((i=n==null?void 0:n.data)==null?void 0:i.asiento)??n??null;ks(t)}catch(n){const t=String((n==null?void 0:n.message)??"");(n==null?void 0:n.status)===404||((o=n==null?void 0:n.response)==null?void 0:o.status)===404||t.includes("404")||(console.error("Error en loadAsientosContables:",n),te({title:"Error",description:"Error inesperado al cargar asientos",variant:"destructive"})),ks(null)}finally{et(!1)}},hn=async()=>{var a;const s=ma();if(s.length>0){te({title:"‚ö†Ô∏è Campos requeridos faltantes",description:`Debes completar: ${s.join(", ")}`,variant:"destructive"});return}if(k==="inventariados"){if(K.length===0){te({title:"‚ö†Ô∏è No hay productos",description:"Debes agregar al menos un producto del inventario a la venta",variant:"destructive"});return}for(const i of K)if(i.cantidad>i.stockDisponible){const o=De.find(n=>n.id===i.id);Is({productName:i.nombre,requested:i.cantidad,available:i.stockDisponible,costoPorUnidad:(o==null?void 0:o.costo_unitario)||0,costoTotal:((o==null?void 0:o.costo_unitario)||0)*i.cantidad}),as(!0);return}await St();return}if(k==="inventariados"&&ae){const i=parseFloat(Me||"1");if(i>As){const o=De.find(l=>l.id===ae);let n=(o==null?void 0:o.costo_unitario)||0;if(n===0){const l=await Te(`/api/inventario/productos/${encodeURIComponent(ae)}/movimientos?tipo=compra`),x=(l==null?void 0:l.movimientos)??((a=l==null?void 0:l.data)==null?void 0:a.movimientos)??l??[];if(x&&x.length>0){let r=0,c=0;for(const h of x)h.costo_unitario>0&&h.cantidad>0&&(r+=h.costo_unitario*h.cantidad,c+=h.cantidad);c>0&&(n=r/c)}}const t=i-As,m=n*t;Is({productName:(o==null?void 0:o.nombre)||"Producto",requested:i,available:As,costoPorUnidad:n,costoTotal:m}),as(!0);return}}Q==="nuevo"&&Ae.length>0&&!confirm(`Se detectaron posibles duplicados:

${Ae.join(`
`)}

¬øDeseas continuar registrando este cliente de todas formas?`)||await St()},St=async()=>{ys(!0);try{let s=null;if(Q==="nuevo"&&Je.trim())try{s=(await Fa.mutateAsync({nombre:Je.trim(),email:Pe.trim()||void 0,telefono:_e.trim()||void 0,rfc:$e.trim()||void 0})).id}catch(r){console.error("Error creating client:",r),te({title:"Error al crear cliente",description:"No se pudo crear el cliente nuevo",variant:"destructive"}),ys(!1);return}else Q==="recurrente"&&ve&&(s=ve);const a=De.find(r=>r.id===ae);let i=vs,o=Number(be||"0"),n=null,t=0;if(k==="precargados"&&ee.length>0){const r=Se.find(j=>j.id===ee[0].id);n=(r==null?void 0:r.subcuenta_id)||null;const c=ee.reduce((j,b)=>j+b.precio*b.cantidad,0),h=ee.reduce((j,b)=>j+b.descuento,0);o=c,t=h,i=`Venta: ${ee.map(j=>`${j.nombre} (x${j.cantidad})`).join(", ")}`}else k==="inventariados"&&(i="Venta de productos inventariados",o=0,n=null);k!=="precargados"&&(t=Da?Number(Ta||"0"):0);const m=Math.max(0,Number((o-t).toFixed(2)));let l=0,x=0;if($==="contado"?(l=m,x=0):$==="parcial"?(l=Number(Fe||"0"),x=Math.max(0,m-l)):$==="credito"&&(l=0,x=m),k==="inventariados"&&K.length>0){const r=K.reduce((v,g)=>v+g.precioUnitario*g.cantidad,0),c=K.reduce((v,g)=>v+g.descuento,0),h=r-c;let j=0,b=0;$==="contado"?(j=h,b=0):$==="parcial"?(j=Number(Fe||"0"),b=Math.max(0,h-j)):$==="credito"&&(j=0,b=h);for(const v of K){const g=De.find(xe=>xe.id===v.id);if(!g)continue;const w=K.length===1?`Venta de ${v.nombre}`:`Venta m√∫ltiple (${K.length} productos): ${v.nombre}`,F=v.subtotal/h,z=j*F,B=b*F,{data:U,error:ce}=await Pt("registrar-ingreso",{body:{tipoIngreso:"inventariados",descripcion:w,montoTotal:v.precioUnitario*v.cantidad,montoDescuento:v.descuento,cuentaPrincipalCodigo:"4001",subcuentaId:g.subcuenta_id||null,metodoPago:bs,tipoPago:$,montoPagado:z,montoPendiente:B,clienteNombre:Je.trim()||null,clienteTelefono:_e.trim()||null,clienteEmail:Pe.trim()||null,clienteRFC:$e.trim()||null,clienteId:s,fechaVencimiento:Ps||null,comentarios:Fs.trim()||null,productoId:v.id,cantidadVendida:v.cantidad,precioVenta:v.precioUnitario,costoPersonalizado:Qe==="personalizado"&&ie?parseFloat(ie):void 0}});if(ce)throw ce}te({title:"‚úÖ Venta registrada exitosamente",description:`Se registraron ${K.length} productos del inventario`,duration:5e3})}else{if(!i||o<=0){te({title:"‚ö†Ô∏è Datos incompletos",description:"Selecciona un producto v√°lido o ingresa una descripci√≥n y monto.",variant:"destructive"}),ys(!1);return}const{data:r,error:c}=await Pt("registrar-ingreso",{body:{tipoIngreso:k,descripcion:i,montoTotal:o,montoDescuento:t,cuentaPrincipalCodigo:k==="otros"?"4102":"4001",subcuentaId:n||void 0,metodoPago:bs,tipoPago:$,montoPagado:l,montoPendiente:x,clienteNombre:Je.trim()||null,clienteTelefono:_e.trim()||null,clienteEmail:Pe.trim()||null,clienteRFC:$e.trim()||null,clienteId:s,fechaVencimiento:Ps||null,comentarios:Fs.trim()||null,...k==="inventariados"&&a?{productoId:a.id,cantidadVendida:Number(Me||"1"),precioVenta:Number(Be||"0"),costoPersonalizado:Qe==="personalizado"&&ie?Number(ie):void 0}:{}}});if(c)throw c;te({title:"Ingreso registrado",description:`Asiento ${r.numeroAsiento} creado correctamente`})}await Promise.all([S(),oe()]),k==="inventariados"&&window.location.reload(),At(""),He(""),Le(""),$a(""),Ia(!1),Et(""),Mt(""),Rt(""),Qs(""),ws(""),Cs(""),Ss(""),_s(""),Ot(""),Lt(""),Xs(""),Ds([]),ct(""),lt(""),dt("1"),Os([]),st(""),cs(""),tt("1"),at(0),Es(!0),Ms([]),ot("0"),it("monto")}catch(s){te({title:"Error",description:s.message||"Error al registrar el ingreso",variant:"destructive"})}finally{ys(!1)}},pn=async()=>{if(!Ge||!Us.trim()){te({title:"‚ö†Ô∏è Motivo requerido",description:"Debes ingresar el motivo de la cancelaci√≥n",variant:"destructive"});return}ra(!0);try{console.log("Cancelando transacci√≥n:",Ge.id);const{data:s,error:a}=await Pt("cancelar-ingreso",{body:{transaccionId:Ge.id,motivoCancelacion:Us.trim()}});if(console.log("Respuesta de edge function:",{data:s,error:a}),a)throw console.error("Error de edge function:",a),new Error(a.message||JSON.stringify(a));if(s!=null&&s.error)throw console.error("Error en data:",s),new Error(s.error);te({title:"‚úì Transacci√≥n cancelada",description:`Asiento de reversi√≥n ${(s==null?void 0:s.numeroAsientoReversion)||"creado"} correctamente`}),await Promise.all([S(),oe()]),jt(""),pt(null),Bs(!1)}catch(s){console.error("Error completo al cancelar:",s),te({title:"‚ùå Error al cancelar",description:(s==null?void 0:s.message)||(s==null?void 0:s.toString())||"No se pudo cancelar la transacci√≥n",variant:"destructive"})}finally{ra(!1)}},jn=s=>{switch(s){case"precargados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Re,{children:[e.jsx(R,{className:"h-4 w-4"}),e.jsxs(Oe,{children:[e.jsx("strong",{children:"Recordatorio:"}),' Para registrar ventas de productos precargados, primero debes agregar los productos al cat√°logo desde la pesta√±a "Cat√°logo de Productos".']})]}),e.jsxs(W,{className:"bg-muted/50",children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-base",children:"Agregar Productos a la Venta"})}),e.jsxs(Y,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"producto-precargado",children:"Seleccionar Producto"}),e.jsxs(he,{value:We,onValueChange:mn,children:[e.jsx(pe,{children:e.jsx(we,{placeholder:Js?"Cargando productos...":"Seleccionar producto del cat√°logo"})}),e.jsx(je,{className:"max-h-80 z-50 bg-background border border-border w-full",children:Js?e.jsx(T,{value:"loading",disabled:!0,children:"Cargando productos..."}):Se.length===0?e.jsx(T,{value:"empty",disabled:!0,children:"No hay productos de servicios registrados"}):Se.map(a=>e.jsx(T,{value:a.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:a.imagen_url?e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate mb-1",children:a.nombre}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",_(a.precio)]})]})]})},a.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cantidad",children:"Cantidad"}),e.jsx(O,{id:"cantidad",type:"number",placeholder:"1",min:"1",value:Rs,onChange:a=>dt(a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"precio-unitario",children:"Precio Unitario"}),e.jsx(O,{id:"precio-unitario",type:"number",placeholder:"0.00",value:Vs,readOnly:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"descuento-producto",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(ye,{value:qe,onValueChange:a=>Ja(a),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"monto",id:"descuento-monto"}),e.jsx(p,{htmlFor:"descuento-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"porcentaje",id:"descuento-porcentaje"}),e.jsx(p,{htmlFor:"descuento-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(O,{id:"descuento-producto",type:"number",placeholder:qe==="porcentaje"?"0":"0.00",min:"0",max:qe==="porcentaje"?"100":void 0,step:qe==="porcentaje"?"1":"0.01",value:mt,onChange:a=>Qt(a.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:qe==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Subtotal con Descuento"}),e.jsx(O,{type:"text",value:We&&Vs?(()=>{const a=parseFloat(Vs)*parseFloat(Rs||"1"),i=parseFloat(mt||"0"),o=qe==="porcentaje"?Math.max(0,a-a*i/100):Math.max(0,a-i);return`$${_(o)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(M,{type:"button",onClick:on,disabled:!We,className:"w-full",variant:"secondary",children:[e.jsx(_t,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),ee.length>0&&e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsxs(G,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",ee.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",_(ee.reduce((a,i)=>a+i.subtotal,0))]})]})}),e.jsx(Y,{children:e.jsx("div",{className:"space-y-2",children:ee.map((a,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:a.imagen_url?e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:a.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[a.cantidad," x $",_(a.precio)," = $",_(a.cantidad*a.precio)]}),a.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",_(a.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",_(a.subtotal)]})]})]})]}),e.jsx(M,{type:"button",variant:"ghost",size:"sm",onClick:()=>cn(a.id),className:"text-destructive hover:text-destructive",children:e.jsx(R,{className:"h-4 w-4"})})]},`${a.id}-${i}`))})})]}),H("Debe agregar al menos un producto")&&e.jsxs(Re,{variant:"destructive",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx(Oe,{children:"Debes agregar al menos un producto a la venta"})]})]});case"inventariados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Re,{children:[e.jsx(R,{className:"h-4 w-4"}),e.jsxs(Oe,{children:[e.jsx("strong",{children:"Ventas desde Inventario:"})," Selecciona productos, aplica descuentos opcionales y agr√©galos a la venta. Si vendes m√°s de lo disponible, se te pedir√° confirmar la sobreventa."]})]}),e.jsxs(W,{className:"bg-muted/50",children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-base",children:"Agregar Productos del Inventario"})}),e.jsxs(Y,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"producto-inventario",children:"Seleccionar Producto"}),e.jsxs(he,{value:ae,onValueChange:nn,children:[e.jsx(pe,{children:e.jsx(we,{placeholder:Ne?"Cargando inventario...":"Seleccionar producto del inventario"})}),e.jsx(je,{className:"max-h-80 z-50 bg-background border border-border w-full",children:Ne?e.jsx(T,{value:"loading",disabled:!0,children:"Cargando inventario..."}):De.length===0?e.jsx(T,{value:"empty",disabled:!0,children:"No hay productos con stock disponible"}):De.map(a=>e.jsx(T,{value:a.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:a.imagen_url?e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:a.nombre}),e.jsxs("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full flex-shrink-0 ml-2",children:["Stock: ",a.cantidad_stock||0]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Costo: $",a.costo_unitario||0]}),a.precio_venta&&a.precio_venta>0?e.jsxs("span",{className:"text-xs text-green-600 font-medium",children:["Venta: $",a.precio_venta]}):e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"‚ö†Ô∏è Sin precio"})]})]})]})},a.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cantidad-inv",children:"Cantidad a Vender"}),e.jsx(O,{id:"cantidad-inv",type:"number",min:"1",value:Me,onChange:a=>tt(a.target.value)}),ae&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Stock disponible: ",As," unidades"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"precio-inv",children:"Precio Unitario"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ye,{value:nt?"registrado":"personalizado",onValueChange:a=>{const i=a==="registrado";if(Es(i),i&&ae){const o=De.find(n=>n.id===ae);if(o){const n=o.precio_venta||o.costo_unitario||0;cs(n.toString())}}},className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"registrado",id:"precio-registrado"}),e.jsx(p,{htmlFor:"precio-registrado",className:"text-sm cursor-pointer",children:"Precio registrado"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"personalizado",id:"precio-personalizado"}),e.jsx(p,{htmlFor:"precio-personalizado",className:"text-sm cursor-pointer",children:"Personalizado"})]})]}),e.jsx(O,{id:"precio-inv",type:"number",step:"0.01",min:"0",value:Be,onChange:a=>rn(a.target.value),readOnly:nt,className:nt?"bg-muted":""})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"descuento-inv",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(ye,{value:Ue,onValueChange:a=>it(a),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"monto",id:"descuento-inv-monto"}),e.jsx(p,{htmlFor:"descuento-inv-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"porcentaje",id:"descuento-inv-porcentaje"}),e.jsx(p,{htmlFor:"descuento-inv-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(O,{id:"descuento-inv",type:"number",placeholder:Ue==="porcentaje"?"0":"0.00",min:"0",max:Ue==="porcentaje"?"100":void 0,step:Ue==="porcentaje"?"1":"0.01",value:rt,onChange:a=>ot(a.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Ue==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Subtotal con Descuento"}),e.jsx(O,{type:"text",value:ae&&Be?(()=>{const a=parseFloat(Be)*parseFloat(Me||"1"),i=parseFloat(rt||"0"),o=Ue==="porcentaje"?Math.max(0,a-a*i/100):Math.max(0,a-i);return`$${_(o)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(M,{type:"button",onClick:ln,disabled:!ae||!Be,className:"w-full",variant:"secondary",children:[e.jsx(_t,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),K.length>0&&e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsxs(G,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",K.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",_(K.reduce((a,i)=>a+i.subtotal,0))]})]})}),e.jsx(Y,{children:e.jsx("div",{className:"space-y-2",children:K.map((a,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:a.imagen_url?e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(Ie,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:a.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[a.cantidad," x $",_(a.precioUnitario)," = $",_(a.cantidad*a.precioUnitario)]}),a.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",_(a.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",_(a.subtotal)]}),e.jsxs("span",{className:"text-xs",children:["Stock disponible: ",a.stockDisponible]})]})]})]}),e.jsx(M,{type:"button",variant:"ghost",size:"sm",onClick:()=>dn(a.id),className:"text-destructive hover:text-destructive",children:e.jsx(R,{className:"h-4 w-4"})})]},`${a.id}-${i}`))})})]})]});case"general":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"descripcion-general",children:"Descripci√≥n del Ingreso"}),H("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(O,{id:"descripcion-general",placeholder:"Ej: Servicio de consultor√≠a",value:vs,onChange:a=>He(a.target.value),className:H("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cuenta-contable",children:"Cuenta Contable"}),e.jsxs(he,{defaultValue:"4001",children:[e.jsx(pe,{children:e.jsx(we,{placeholder:"4001 - Ventas"})}),e.jsx(je,{children:e.jsx(T,{value:"4001",children:"4001 - Ventas"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"subcuenta",children:"Subcuenta (Opcional)"}),e.jsxs(he,{children:[e.jsx(pe,{children:e.jsx(we,{placeholder:"Seleccionar subcuenta"})}),e.jsx(je,{children:e.jsx(T,{value:"sub1",children:"Subcuenta ejemplo"})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"monto-general",children:"Monto"}),H("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(O,{id:"monto-general",type:"number",placeholder:"0.00",value:be,onChange:a=>Le(a.target.value),className:H("Monto Total")?"border-destructive":""})]})]});case"otros":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Re,{children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx(Oe,{children:"Este ingreso se ligar√° a la cuenta 4102 - Otros Productos."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"descripcion-otros",children:"Descripci√≥n del Ingreso Extraordinario"}),H("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(ss,{id:"descripcion-otros",placeholder:"Ej: Venta extraordinaria de equipo usado, donaci√≥n recibida, etc.",value:vs,onChange:a=>He(a.target.value),className:H("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"monto-otros",children:"Monto"}),H("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(O,{id:"monto-otros",type:"number",placeholder:"0.00",value:be,onChange:a=>Le(a.target.value),className:H("Monto Total")?"border-destructive":""})]})]});default:return null}},gn=async()=>{if(!xt.trim()||!ht.trim()){te({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}zs(!0);try{await _a.mutateAsync({nombre:xt.trim(),precio:parseFloat(ht),descripcion:ea.trim()||void 0,subcuentaId:ta||void 0,imagen:Za||void 0}),Xt(""),Zt(""),sa(""),Xa("4001"),aa(""),na(null),ut(!1)}catch{}finally{zs(!1)}},ua=s=>{var a;oa(s),Nt(s.nombre),vt(((a=s.precio)==null?void 0:a.toString())||""),yt(s.descripcion||""),Ct(s.imagen_url||null),wt(null),da(s.subcuenta_id||""),Ws(!0)},fn=s=>{var i;const a=(i=s.target.files)==null?void 0:i[0];if(a){wt(a);const o=new FileReader;o.onloadend=()=>{Ct(o.result)},o.readAsDataURL(a)}},Nn=async()=>{if(!ft.trim()||!bt.trim()){te({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}zs(!0);try{await Pa.mutateAsync({id:tn.id,nombre:ft.trim(),precio:parseFloat(bt),descripcion:ia.trim()||void 0,imagen:an||void 0,subcuentaId:la||null}),Ws(!1),oa(null),Nt(""),vt(""),yt(""),wt(null),Ct(null)}catch{}finally{zs(!1)}};return e.jsxs("div",{className:"h-full overflow-hidden flex flex-col",children:[e.jsx(ls,{open:ka,onOpenChange:as,children:e.jsxs(ds,{children:[e.jsxs(ms,{children:[e.jsxs(us,{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(R,{className:"h-5 w-5"}),"Advertencia: Inventario Insuficiente"]}),e.jsxs(xs,{className:"space-y-3 pt-4",children:[e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-950/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx("p",{className:"font-medium mb-2",children:"Est√°s a punto de vender un producto sin suficiente inventario:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Producto:"}),e.jsx("span",{className:"font-medium",children:N==null?void 0:N.productName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cantidad solicitada:"}),e.jsx("span",{className:"font-medium",children:N==null?void 0:N.requested})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Stock disponible:"}),e.jsx("span",{className:"font-medium",children:N==null?void 0:N.available})]}),e.jsx(Ve,{}),e.jsxs("div",{className:"flex justify-between text-orange-600",children:[e.jsx("span",{className:"font-medium",children:"Faltante:"}),e.jsx("span",{className:"font-bold",children:((N==null?void 0:N.requested)||0)-((N==null?void 0:N.available)||0)})]})]})]}),(N==null?void 0:N.costoPorUnidad)&&N.costoPorUnidad>0&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border-2 border-blue-300 dark:border-blue-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(xa,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),e.jsx("p",{className:"font-bold text-blue-700 dark:text-blue-300",children:"üìä Costo Promedio Hist√≥rico"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Costo promedio calculado:"}),e.jsxs("span",{className:"text-lg font-bold text-blue-700 dark:text-blue-300",children:["$",_(N.costoPorUnidad)," por unidad"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Este costo se calcul√≥ autom√°ticamente del promedio ponderado de todas tus compras anteriores de este producto. Puedes usar este costo sugerido o ingresar uno personalizado si conoces el costo real de esta venta."})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"font-medium mb-3 text-blue-700 dark:text-blue-400",children:"Impacto en el inventario:"}),N!=null&&N.costoPorUnidad&&N.costoPorUnidad>0?e.jsxs(e.Fragment,{children:[e.jsxs(ye,{value:Qe,onValueChange:s=>{Zs(s),s==="historico"&&ns("")},className:"space-y-3 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"historico",id:"costo-historico"}),e.jsxs(p,{htmlFor:"costo-historico",className:"text-sm cursor-pointer",children:["Usar costo hist√≥rico: ",e.jsxs("strong",{className:"text-blue-700 dark:text-blue-400",children:["$",_(N.costoPorUnidad)]})," por unidad"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"personalizado",id:"costo-personalizado"}),e.jsx(p,{htmlFor:"costo-personalizado",className:"text-sm cursor-pointer",children:"Ingresar costo personalizado"})]})]}),Qe==="personalizado"&&e.jsxs("div",{className:"mb-3",children:[e.jsx(p,{htmlFor:"costo-custom",className:"text-xs",children:"Costo unitario personalizado"}),e.jsx(O,{id:"costo-custom",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:ie,onChange:s=>ns(s.target.value),className:"mt-1"})]}),e.jsx(Ve,{className:"my-3"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Costo por unidad aplicado:"}),e.jsxs("span",{className:"font-medium",children:["$",_(Qe==="personalizado"&&ie?ie:N.costoPorUnidad)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",_((Qe==="personalizado"&&ie?Number(ie):N.costoPorUnidad)*(((N==null?void 0:N.requested)||0)-((N==null?void 0:N.available)||0)))]})]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"‚ö†Ô∏è Este producto no tiene costo hist√≥rico registrado."}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"costo-requerido",className:"text-xs",children:"Ingresa el costo unitario para esta transacci√≥n"}),e.jsx(O,{id:"costo-requerido",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:ie,onChange:s=>ns(s.target.value),className:"mt-1"})]}),ie&&Number(ie)>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ve,{}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",_(Number(ie)*(((N==null?void 0:N.requested)||0)-((N==null?void 0:N.available)||0)))]})]})]})]})]}),e.jsxs("p",{className:"text-sm",children:["Si contin√∫as, el inventario quedar√° en ",e.jsxs("strong",{className:"text-destructive",children:["negativo (",((N==null?void 0:N.available)||0)-((N==null?void 0:N.requested)||0)," unidades)"]}),". Esto se reflejar√° en tu control de inventario con el valor mostrado arriba."]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"¬øDeseas continuar con la venta de todas formas?"})]})]}),e.jsxs(qs,{className:"gap-2 sm:gap-0",children:[e.jsx(M,{variant:"outline",onClick:()=>{as(!1),Is(null),Zs("historico"),ns("")},children:"Cancelar"}),e.jsxs(M,{variant:"destructive",onClick:async()=>{if((!(N!=null&&N.costoPorUnidad)||N.costoPorUnidad===0)&&(!ie||Number(ie)<=0)){te({title:"Costo requerido",description:"Debes ingresar un costo unitario para continuar",variant:"destructive"});return}as(!1),Is(null),await St(),Zs("historico"),ns("")},children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Continuar con la Venta"]})]})]})}),e.jsxs("div",{className:"p-6 border-b bg-background",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Registro de Ingresos"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Registra ventas, gestiona cat√°logos y analiza ingresos de la empresa"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[e.jsxs(ha,{defaultValue:"registro",className:"w-full",children:[e.jsxs(pa,{className:"grid w-full grid-cols-4",children:[e.jsx(Ze,{value:"registro",children:"Registro de Ingresos"}),e.jsx(Ze,{value:"resumen",children:"Resumen de Ventas"}),e.jsx(Ze,{value:"analitica",children:"Anal√≠tica de Ventas"}),e.jsx(Ze,{value:"catalogo",children:"Cat√°logo de Productos"})]}),e.jsx(es,{value:"registro",className:"mt-6 space-y-6",children:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Nuevo Registro de Ingreso"}),e.jsx(re,{children:"Selecciona el tipo de ingreso y completa la informaci√≥n requerida"})]}),e.jsxs(Y,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(p,{className:"text-base font-semibold",children:"Tipo de Ingreso"}),e.jsx(ye,{value:k,onValueChange:At,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"relative border rounded-xl hover:bg-muted/50 transition",children:[e.jsx("div",{className:"absolute left-4 top-4",children:e.jsx(A,{value:"precargados",id:"precargados"})}),e.jsxs(p,{htmlFor:"precargados",className:"cursor-pointer flex flex-col items-center justify-center text-center p-8 min-h-[180px]",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-muted flex items-center justify-center mb-3",children:e.jsx(ja,{className:"h-6 w-6 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Productos Precargados"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Del cat√°logo de servicios/productos"})]})]}),e.jsxs("div",{className:"relative border rounded-xl hover:bg-muted/50 transition",children:[e.jsx("div",{className:"absolute left-4 top-4",children:e.jsx(A,{value:"inventariados",id:"inventariados"})}),e.jsxs(p,{htmlFor:"inventariados",className:"cursor-pointer flex flex-col items-center justify-center text-center p-8 min-h-[180px]",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-muted flex items-center justify-center mb-3",children:e.jsx(Ie,{className:"h-6 w-6 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Productos Inventariados"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Del inventario registrado"})]})]}),e.jsxs("div",{className:"relative border rounded-xl hover:bg-muted/50 transition",children:[e.jsx("div",{className:"absolute left-4 top-4",children:e.jsx(A,{value:"general",id:"general"})}),e.jsxs(p,{htmlFor:"general",className:"cursor-pointer flex flex-col items-center justify-center text-center p-8 min-h-[180px]",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-muted flex items-center justify-center mb-3",children:e.jsx(ga,{className:"h-6 w-6 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Ingreso General"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Operaci√≥n no inventariada"})]})]}),e.jsxs("div",{className:"relative border rounded-xl hover:bg-muted/50 transition",children:[e.jsx("div",{className:"absolute left-4 top-4",children:e.jsx(A,{value:"otros",id:"otros"})}),e.jsxs(p,{htmlFor:"otros",className:"cursor-pointer flex flex-col items-center justify-center text-center p-8 min-h-[180px]",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-muted flex items-center justify-center mb-3",children:e.jsx(Ln,{className:"h-6 w-6 text-primary"})}),e.jsx("div",{className:"font-semibold text-base",children:"Otros Ingresos"}),e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:"Extraordinarios, donaciones"})]})]})]})})]}),k&&e.jsxs("div",{className:"space-y-6 p-4 border rounded-lg bg-muted/20",children:[jn(k),e.jsx(Ve,{}),e.jsx("div",{className:"space-y-4",children:k==="precargados"&&We||k==="inventariados"&&ae?e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"C√°lculo Autom√°tico"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cantidad:"}),e.jsx("span",{children:k==="precargados"?Rs:Me})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Precio Unitario:"}),e.jsxs("span",{children:["$",k==="precargados"?Vs:Be]})]}),e.jsx(Ve,{}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",be]})]})]})]}):null}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{className:"font-medium",children:"Estado del Pago"}),H("Tipo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(ye,{value:$,onValueChange:Mt,className:H("Tipo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{value:"contado",id:"contado"}),e.jsx(p,{htmlFor:"contado",className:"cursor-pointer",children:"Pago Total"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{value:"parcial",id:"parcial"}),e.jsx(p,{htmlFor:"parcial",className:"cursor-pointer",children:"Pago parcial"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{value:"credito",id:"credito"}),e.jsx(p,{htmlFor:"credito",className:"cursor-pointer",children:"Adeudo Total"})]})]}),$==="parcial"&&e.jsxs("div",{className:"ml-6 p-4 border rounded-lg bg-blue-50 dark:bg-blue-950/20 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"monto-abonado",children:"Monto que se va a pagar"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Monto Abonado")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(O,{id:"monto-abonado",type:"number",step:"0.01",placeholder:"0.00",value:Fe,onChange:s=>Lt(s.target.value),className:H("Monto Abonado")?"border-destructive":""})]}),be&&Fe&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-3 bg-white dark:bg-gray-900 rounded border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de la venta"}),e.jsxs("p",{className:"text-lg font-semibold text-primary",children:["$",_(be)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Se pagar√° ahora"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:["$",_(Fe)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Queda pendiente"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["$",_(parseFloat(be)-parseFloat(Fe))]})]})]})]})]}),e.jsx(Ve,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(hs,{className:"h-5 w-5"}),e.jsx(p,{className:"font-medium",children:"Datos del Cliente"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:$==="contado"?"Opcional - Para anal√≠ticas y comentarios":"Obligatorio para cuentas por cobrar"})]}),$==="contado"&&e.jsxs(Re,{children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx(Oe,{children:"Asignar cliente es opcional para pagos totales. √ötil para anal√≠ticas de ventas y seguimiento de clientes."})]}),($==="parcial"||$==="credito")&&e.jsxs(Re,{children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx(Oe,{children:"Se registrar√° en Cuentas por Cobrar para an√°lisis de vencimientos"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"font-medium",children:"Tipo de Cliente"}),e.jsxs(he,{value:Q,onValueChange:s=>{Rt(s),Qs(""),ws(""),Cs(""),Ss(""),_s(""),Ds([])},children:[e.jsx(pe,{children:e.jsx(we,{placeholder:$==="contado"?"Opcional - Selecciona para anal√≠ticas":"Selecciona el tipo de cliente"})}),e.jsxs(je,{children:[e.jsx(T,{value:"nuevo",children:"Cliente Nuevo"}),e.jsx(T,{value:"recurrente",children:"Cliente Recurrente"})]})]})]}),Q==="recurrente"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cliente-existente",children:"Seleccionar Cliente"}),(()=>{const s=ke.find(a=>a.id===ve);return e.jsxs(he,{value:ve??"",onValueChange:a=>{Qs(a);const i=ke.find(o=>o.id===a);i&&(ws(i.nombre),Cs(i.telefono||""),Ss(i.email||""),_s(i.rfc||""))},children:[e.jsx(pe,{className:"h-auto py-2",children:s?e.jsxs("div",{className:"flex flex-col text-left leading-tight",children:[e.jsx("span",{className:"font-medium",children:s.nombre}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.telefono?`Tel: ${s.telefono}`:"",s.telefono&&s.email?" ‚Ä¢ ":"",s.email?`Email: ${s.email}`:"",s.source==="transaction"?" ‚Ä¢ (De transacci√≥n)":""]})]}):e.jsx("span",{className:"text-muted-foreground",children:"Buscar cliente existente..."})}),e.jsx(je,{className:"p-1",children:Sa?e.jsx("div",{className:"px-2 py-2 text-sm text-muted-foreground",children:"Cargando clientes..."}):ke.length===0?e.jsx("div",{className:"px-2 py-2 text-sm text-muted-foreground",children:"No hay clientes registrados"}):ke.map(a=>e.jsx(T,{value:a.id,className:"py-2",children:e.jsxs("div",{className:"flex flex-col text-left leading-tight",children:[e.jsx("span",{className:"font-medium",children:a.nombre}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[a.telefono?`Tel: ${a.telefono}`:"",a.telefono&&a.email?" ‚Ä¢ ":"",a.email?`Email: ${a.email}`:"",a.source==="transaction"?" ‚Ä¢ (De transacci√≥n)":""]})]})},a.id))})]})})(),!!ve&&e.jsx("p",{className:"text-xs text-green-600",children:"‚úì Datos del cliente cargados autom√°ticamente"})]}),(Q==="nuevo"||Q==="recurrente"&&ve)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cliente-nombre",children:"Nombre del Cliente"}),e.jsx(O,{id:"cliente-nombre",type:"text",placeholder:"Nombre completo",value:Je,onChange:s=>ws(s.target.value),disabled:Q==="recurrente"&&ve!==""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"cliente-telefono",children:"N√∫mero de Tel√©fono"}),($==="parcial"||$==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Tel√©fono del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(O,{id:"cliente-telefono",type:"tel",placeholder:"Ej: +52 55 1234 5678",value:_e,onChange:s=>Cs(s.target.value),className:H("Tel√©fono del Cliente")?"border-destructive":"",disabled:Q==="recurrente"&&ve!==""}),Q==="nuevo"&&Ae.some(s=>s.includes(_e)&&s.includes("tel√©fono"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Ae.find(s=>s.includes(_e)&&s.includes("tel√©fono"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"cliente-email",children:"Correo Electr√≥nico"}),($==="parcial"||$==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Email del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(O,{id:"cliente-email",type:"email",placeholder:"cliente@ejemplo.com",value:Pe,onChange:s=>Ss(s.target.value),className:H("Email del Cliente")?"border-destructive":"",disabled:Q==="recurrente"&&ve!==""}),Q==="nuevo"&&Ae.some(s=>s.includes(Pe)&&s.includes("correo"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Ae.find(s=>s.includes(Pe)&&s.includes("correo"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cliente-rfc",children:"RFC (ID Fiscal) - Opcional"}),e.jsx(O,{id:"cliente-rfc",type:"text",placeholder:"RFC123456ABC1",value:$e,onChange:s=>_s(s.target.value.toUpperCase()),maxLength:13,disabled:Q==="recurrente"&&ve!==""}),Q==="nuevo"&&Ae.some(s=>s.includes($e)&&s.includes("RFC"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Ae.find(s=>s.includes($e)&&s.includes("RFC"))})]})]}),($==="parcial"||$==="credito")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"fecha-vencimiento",children:"Fecha de Vencimiento"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Fecha de Vencimiento")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(O,{id:"fecha-vencimiento",type:"date",value:Ps,onChange:s=>Ot(s.target.value),className:H("Fecha de Vencimiento")?"border-destructive":"",min:new Date().toISOString().split("T")[0]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Fecha l√≠mite para el pago"," ",$==="parcial"?"del monto pendiente":"completo"]})]}),$==="contado"&&Q&&e.jsxs("div",{className:"col-span-full space-y-2",children:[e.jsx(p,{htmlFor:"comentario-venta",children:"Comentarios de la venta (Opcional)"}),e.jsx(ss,{id:"comentario-venta",placeholder:"Detalles adicionales sobre esta venta, preferencias del cliente, etc.",value:Fs,onChange:s=>Xs(s.target.value),rows:2}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Informaci√≥n √∫til para futuras ventas y an√°lisis del cliente"})]})]})]}),e.jsx(Ve,{}),($==="contado"||$==="parcial")&&e.jsxs(e.Fragment,{children:[e.jsx(Ve,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{className:"font-medium",children:"M√©todo de Pago"}),H("M√©todo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(ye,{value:bs,onValueChange:Et,className:H("M√©todo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{value:"efectivo",id:"efectivo"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($n,{className:"h-4 w-4 text-green-600"}),e.jsxs(p,{htmlFor:"efectivo",className:"cursor-pointer",children:["Efectivo"," ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Caja)"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{value:"tarjeta",id:"tarjeta"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(kn,{className:"h-4 w-4 text-blue-800"}),e.jsxs(p,{htmlFor:"tarjeta",className:"cursor-pointer",children:["Tarjeta"," ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Bancos)"})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"comentarios",children:"Comentarios de la venta (Opcional)"}),e.jsx(ss,{id:"comentarios",placeholder:"Agrega cualquier comentario o nota sobre esta venta...",value:Fs,onChange:s=>Xs(s.target.value),rows:3,className:"resize-none"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(M,{size:"lg",className:"px-8",onClick:hn,disabled:Vt,children:[e.jsx(xa,{className:"mr-2 h-4 w-4"}),Vt?"Registrando...":"Registrar Ingreso"]})})]})]})]})}),e.jsx(es,{value:"resumen",className:"mt-6",children:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Registro Detallado de Ventas"}),e.jsx(re,{children:"Historial completo de transacciones de ingresos"})]}),e.jsxs(Y,{children:[e.jsxs("div",{className:"mb-6 p-4 border rounded-lg bg-muted/30 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2 lg:col-span-2",children:[e.jsx(p,{children:"Rango de fechas"}),e.jsx(Un,{value:Wa,onChange:Ya})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"filtro-tipo",children:"Tipo de Ingreso"}),e.jsxs(he,{value:me,onValueChange:Kt,children:[e.jsx(pe,{id:"filtro-tipo",children:e.jsx(we,{placeholder:"Todos"})}),e.jsxs(je,{children:[e.jsx(T,{value:"todos",children:"Todos"}),e.jsx(T,{value:"precargados",children:"Precargados"}),e.jsx(T,{value:"inventariados",children:"Inventariados"}),e.jsx(T,{value:"general",children:"General"}),e.jsx(T,{value:"otros",children:"Otros"}),e.jsx(T,{value:"asiento_directo",children:"Venta de activo fijo"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"filtro-cuenta",children:"Cuenta"}),e.jsxs(he,{value:ue,onValueChange:Ht,children:[e.jsx(pe,{id:"filtro-cuenta",children:e.jsx(we,{placeholder:"Todas"})}),e.jsxs(je,{children:[e.jsx(T,{value:"todas",children:"Todas"}),e.jsx(T,{value:"4001",children:"4001 - Ventas"}),e.jsx(T,{value:"4004",children:"4004 - Ventas Inventarios"}),e.jsx(T,{value:"4101",children:"4101 - Productos Financieros"}),e.jsx(T,{value:"4102",children:"4102 - Otros Productos"}),e.jsx(T,{value:"4103",children:"4103 - Ganancia en Venta de Activos"}),e.jsx(T,{value:"4103",children:"4002 - Devoluciones sobre ventas"}),e.jsx(T,{value:"4103",children:"4002 - Descuentos sobre ventas"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"filtro-subcuenta",children:"Subcuenta"}),e.jsxs(he,{value:se,onValueChange:Jt,children:[e.jsx(pe,{id:"filtro-subcuenta",children:e.jsx(we,{placeholder:"Todas"})}),e.jsxs(je,{children:[e.jsx(T,{value:"todas",children:"Todas"}),e.jsx(T,{value:"sin-subcuenta",children:"Sin subcuenta"}),J.map(s=>e.jsx(T,{value:s.id,children:s.nombre},s.id))]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:()=>{Gt(void 0),Ut(""),qt(""),Kt("todos"),Ht("todas"),Jt("")},children:"Limpiar Filtros"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Resultados: ",(()=>{const s=Ee.map(n=>{const t=n.detalle_asientos.find(m=>m.cuenta_codigo.startsWith("4")&&Number(m.haber)>0);return{created_at:n.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(t==null?void 0:t.cuenta_codigo)||"",subcuenta_id:t==null?void 0:t.subcuenta_id}});return[...y??[],...s??[]].map(fs).filter(n=>{const t=$s(n.created_at),m=!me||me==="todos"||n.tipo_ingreso===me,l=!ue||ue==="todas"||n.cuenta_principal_codigo===ue,x=!se||se==="todas"||se==="sin-subcuenta"&&!n.subcuenta_id||n.subcuenta_id===se;return t&&m&&l&&x}).length})()]}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["Total: $",(()=>{const s=Ee.map(o=>{const n=o.detalle_asientos.find(t=>t.cuenta_codigo.startsWith("4")&&Number(t.haber)>0);return{created_at:o.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(n==null?void 0:n.cuenta_codigo)||"",subcuenta_id:n==null?void 0:n.subcuenta_id,monto_total:Number(n==null?void 0:n.haber)||0}}),i=[...le,...s].filter(o=>{const n=$s(o.created_at),t=!me||me==="todos"||o.tipo_ingreso===me,m=!ue||ue==="todas"||o.cuenta_principal_codigo===ue,l=!se||se==="todas"||se==="sin-subcuenta"&&!o.subcuenta_id||o.subcuenta_id===se;return n&&t&&m&&m&&l});return _(i.reduce((o,n)=>o+n.monto_total,0))})()]}),e.jsxs("p",{className:"text-sm font-medium text-green-600",children:["Neto: $",(()=>{const s=Ee.map(o=>{const n=o.detalle_asientos.find(t=>t.cuenta_codigo.startsWith("4")&&Number(t.haber)>0);return{created_at:o.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(n==null?void 0:n.cuenta_codigo)||"",subcuenta_id:n==null?void 0:n.subcuenta_id,monto_neto:Number(n==null?void 0:n.haber)||0}}),i=[...le,...s].filter(o=>{const n=$s(o.created_at),t=!me||me==="todos"||o.tipo_ingreso===me,m=!ue||ue==="todas"||o.cuenta_principal_codigo===ue,l=!se||se==="todas"||se==="sin-subcuenta"&&!o.subcuenta_id||o.subcuenta_id===se;return n&&t&&m&&l});return _(i.reduce((o,n)=>o+n.monto_neto,0))})()]})]})]})]}),I?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando transacciones..."}):(()=>{const s=Ee.map(n=>{const t=n.detalle_asientos.find(m=>m.cuenta_codigo.startsWith("4")&&Number(m.haber)>0);return{id:n.id??n._id,descripcion:n.descripcion,monto_total:Number(t==null?void 0:t.haber)||0,monto_neto:Number(t==null?void 0:t.haber)||0,monto_descuento:0,monto_pagado:Number(t==null?void 0:t.haber)||0,monto_pendiente:0,tipo_ingreso:"asiento_directo",metodo_pago:"N/A",tipo_pago:"contado",cuenta_principal_codigo:(t==null?void 0:t.cuenta_codigo)||"",subcuenta_id:t==null?void 0:t.subcuenta_id,created_at:n.fecha,asiento_fecha:n.fecha,es_asiento_directo:!0,estado:"activo"}}),o=[...le,...s.map(fs)].filter(n=>{const t=$s(n.created_at),m=!me||me==="todos"||n.tipo_ingreso===me,l=!ue||ue==="todas"||n.cuenta_principal_codigo===ue,x=!se||se==="todas"||se==="sin-subcuenta"&&!n.subcuenta_id||n.subcuenta_id===se;return t&&m&&l&&x}).filter(n=>!n.descripcion.includes("CANCELACI√ìN:")).map(n=>{const t=n.estado==="cancelado";let m=null;return t&&n.transaccion_cancelacion_id&&(m=le.find(l=>l.id===n.transaccion_cancelacion_id)),{...n,esCancelada:t,transaccionReversion:m}});return o.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay transacciones que coincidan con los filtros"}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"text-sm font-medium text-muted-foreground",children:["Mostrando ",o.length," transacci√≥n(es)"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Tip: da clic en el √≠cono üìÑ para ver ‚ÄúInformaci√≥n general‚Äù y ‚ÄúRegistro contable‚Äù"})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-background",children:e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/60",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap",children:"Fecha"}),e.jsx("th",{className:"text-left p-3 font-medium min-w-[320px]",children:"Descripci√≥n"}),e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap hidden md:table-cell",children:"Tipo"}),e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap hidden lg:table-cell",children:"Cuenta"}),e.jsx("th",{className:"text-right p-3 font-medium whitespace-nowrap",children:"Total"}),e.jsx("th",{className:"text-right p-3 font-medium whitespace-nowrap hidden md:table-cell",children:"Neto"}),e.jsx("th",{className:"text-left p-3 font-medium whitespace-nowrap hidden md:table-cell",children:"Estado"}),e.jsx("th",{className:"text-right p-3 font-medium whitespace-nowrap",children:"Acciones"})]})}),e.jsx("tbody",{children:o.map(n=>{var c,h,j,b,v;const t=n,m=n.esCancelada,l=!1,x=(()=>{try{return new Date(t.created_at).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return String(t.created_at||"")}})(),r=Number(ge(t,"netas")||0);return e.jsxs("tr",{className:`border-t hover:bg-muted/30 ${m?"bg-red-50/60 dark:bg-red-950/20":""}`,children:[e.jsx("td",{className:"p-3 whitespace-nowrap text-muted-foreground",children:x}),e.jsxs("td",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-medium",children:t.descripcion}),t.es_asiento_directo&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200",children:"üìã Asiento Directo"}),m&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200",children:"‚ùå Cancelada"}),l]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("span",{className:"capitalize",children:t.metodo_pago||"N/A"})," ","‚Ä¢"," ",e.jsx("span",{className:"capitalize",children:t.tipo_pago||"N/A"}),t.subcuenta_id?e.jsxs(e.Fragment,{children:[" ","‚Ä¢"," ",e.jsxs("span",{className:"text-muted-foreground",children:["Subcuenta:"," ",((c=t.subcuentas)==null?void 0:c.nombre)||(()=>{const g=J.find(w=>w.id===t.subcuenta_id);return(g==null?void 0:g.nombre)||"Subcuenta no encontrada"})()]})]}):null]}),t.comentarios&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 dark:bg-blue-950/30 rounded text-xs",children:[e.jsx("span",{className:"font-medium text-blue-700 dark:text-blue-300",children:"üí¨ "}),e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:String(t.comentarios).length>80?`${String(t.comentarios).substring(0,80)}...`:String(t.comentarios)})]}),m&&t.motivo_cancelacion&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"p-3 bg-red-100 dark:bg-red-950/40 rounded-md border border-red-300 dark:border-red-800",children:[e.jsx("p",{className:"text-xs font-medium text-red-700 dark:text-red-300 mb-1",children:"üìã Motivo de cancelaci√≥n:"}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:t.motivo_cancelacion}),e.jsxs("p",{className:"text-xs text-red-500 dark:text-red-500 mt-1",children:["Cancelada el: ",new Date(t.fecha_cancelacion).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.transaccionReversion&&e.jsxs("div",{className:"p-3 bg-orange-100 dark:bg-orange-950/40 rounded-md border border-orange-300 dark:border-orange-800",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-orange-700 dark:text-orange-300",children:"‚Ü©Ô∏è Asiento de Reversi√≥n Generado"})}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",n.transaccionReversion.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Monto reversado:"})," $",_(Math.abs(n.transaccionReversion.monto_total))]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(n.transaccionReversion.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})]})]}),e.jsx("td",{className:"p-3 hidden md:table-cell",children:e.jsx("span",{className:"capitalize",children:t.tipo_ingreso})}),e.jsx("td",{className:"p-3 hidden lg:table-cell",children:t.cuenta_principal_codigo||"-"}),e.jsxs("td",{className:"p-3 text-right font-bold text-primary whitespace-nowrap",children:["$",_(t.monto_total),t.monto_descuento>0&&e.jsxs("div",{className:"text-xs text-red-600 font-medium",children:["-$",_(t.monto_descuento)," desc."]})]}),e.jsx("td",{className:"p-3 text-right hidden md:table-cell whitespace-nowrap",children:e.jsxs("span",{className:"font-medium text-green-600",children:["$",_(r)]})}),e.jsx("td",{className:"p-3 hidden md:table-cell",children:m?e.jsx("span",{className:"text-red-600 font-medium",children:"Cancelada"}):e.jsx("span",{className:"text-muted-foreground",children:"Activa"})}),e.jsx("td",{className:"p-3 text-right whitespace-nowrap",children:e.jsxs("div",{className:"inline-flex items-center gap-2 justify-end",children:[e.jsxs(ls,{onOpenChange:g=>{if(g){const w=String(t._id??t.id??"");xn(w)}else ks(null)},children:[e.jsx(fa,{asChild:!0,children:e.jsx(M,{variant:"outline",size:"sm",className:"h-8 px-2",children:e.jsx(ga,{className:"h-4 w-4"})})}),e.jsxs(ds,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ms,{children:[e.jsx(us,{children:"Detalles de la Transacci√≥n"}),e.jsx(xs,{children:"Informaci√≥n completa y asientos contables en balanza"})]}),e.jsxs(ha,{defaultValue:"general",className:"w-full",children:[e.jsxs(pa,{className:"grid w-full grid-cols-2",children:[e.jsx(Ze,{value:"general",children:"Informaci√≥n General"}),e.jsx(Ze,{value:"contable",children:"Registros Contables"})]}),e.jsxs(es,{value:"general",className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Informaci√≥n General"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",t.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",t.tipo_ingreso]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"M√©todo de Pago:"})," ",t.metodo_pago||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo de Pago:"})," ",t.tipo_pago]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(t.created_at).toLocaleString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Montos"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total:"})," $",_(t.monto_total)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descuento:"})," $",_(t.monto_descuento)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Neto:"})," $",_(t.monto_neto)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pagado:"})," $",_(t.monto_pagado||0)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pendiente:"})," $",_(t.monto_pendiente||0)]})]})]})]}),(t.cliente_nombre||t.cliente_telefono||t.cliente_email)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n del Cliente"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.cliente_nombre&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",t.cliente_nombre]}),t.cliente_telefono&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tel√©fono:"})," ",t.cliente_telefono]}),t.cliente_email&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",t.cliente_email]}),t.cliente_rfc&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"RFC:"})," ",t.cliente_rfc]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n Contable"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Cuenta Principal:"})," ",t.cuenta_principal??`${t.cuenta_principal_codigo}`]}),t.subcuenta_id?e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," ",((h=t.subcuentas)==null?void 0:h.nombre)||(()=>{const g=J.find(w=>w.id===t.subcuenta_id);return(g==null?void 0:g.nombre)||"Subcuenta no encontrada"})()]}):e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," Sin subcuenta asignada"]})]})]}),t.comentarios&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Comentarios"}),e.jsx("div",{className:"p-3 bg-muted rounded-md",children:e.jsx("p",{className:"text-sm",children:t.comentarios})})]})]}),e.jsxs(es,{value:"contable",className:"mt-4",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3",children:"Asientos en Balanza de Comprobaci√≥n"}),Ha?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando asientos contables..."}):ze?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"N√∫mero de Asiento:"})," ",ze.numero_asiento]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(ze.fecha).toLocaleDateString("es-ES")]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",ze.descripcion]})]})}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Cuenta"}),e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Descripci√≥n"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Debe"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Haber"})]})}),e.jsxs("tbody",{children:[(j=ze.detalles)==null?void 0:j.map((g,w)=>e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"p-3 text-sm",children:[e.jsx("div",{className:"font-medium",children:g.cuenta_codigo}),e.jsx("div",{className:"text-xs text-muted-foreground",children:g.cuenta_nombre})]}),e.jsx("td",{className:"p-3 text-sm",children:g.descripcion}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:g.debe>0?`$${_(g.debe)}`:"-"}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:g.haber>0?`$${_(g.haber)}`:"-"})]},w)),e.jsxs("tr",{className:"border-t-2 bg-muted/50 font-bold",children:[e.jsx("td",{colSpan:2,className:"p-3 text-sm",children:"TOTALES"}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",_((b=ze.detalles)==null?void 0:b.reduce((g,w)=>g+Number(w.debe),0))]}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",_((v=ze.detalles)==null?void 0:v.reduce((g,w)=>g+Number(w.haber),0))]})]})]})]})}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/30 rounded-md text-sm",children:[e.jsx("p",{className:"font-medium text-blue-700 dark:text-blue-300 mb-1",children:"üí° Informaci√≥n"}),e.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:"Este asiento contable refleja c√≥mo esta transacci√≥n afecta a las diferentes cuentas en la balanza de comprobaci√≥n y posteriormente en los estados financieros."})]})]}):e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg text-sm text-muted-foreground text-center",children:"No se encontraron asientos contables para esta transacci√≥n"})]})]})]})]}),!m&&!l&&e.jsx(M,{variant:"outline",size:"sm",className:"h-8 px-2 border-red-300 text-red-600 hover:bg-red-50 dark:border-red-800 dark:text-red-400 dark:hover:bg-red-950/30",onClick:()=>{pt(fs(t)),Bs(!0)},children:"‚ùå"})]})})]},t.id)})}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t bg-muted/40",children:[e.jsx("td",{className:"p-3 text-sm font-medium",colSpan:4,children:"TOTALES"}),e.jsxs("td",{className:"p-3 text-right font-bold text-primary whitespace-nowrap",children:["$",_(o.reduce((n,t)=>n+Number(t.monto_total||0),0))]}),e.jsx("td",{className:"p-3 text-right hidden md:table-cell whitespace-nowrap",children:e.jsxs("span",{className:"font-bold text-green-600",children:["$",_(o.reduce((n,t)=>n+Number(ge(t,"netas")||0),0))]})}),e.jsx("td",{className:"p-3 hidden md:table-cell"}),e.jsx("td",{className:"p-3"})]})})]})})})]})})()]})]})}),e.jsx(es,{value:"analitica",className:"mt-6",children:(()=>{const a=(()=>{const t=new Date;t.getMonth();const m=t.getFullYear();let l=y.filter(x=>x.estado!=="cancelado"&&!x.descripcion.includes("CANCELACI√ìN:"));if(Z==="diario"){const x=de.toISOString().split("T")[0];l=l.filter(r=>r.asiento_fecha===x)}else if(Z==="mensual"){const x=E.getMonth(),r=E.getFullYear();l=l.filter(c=>{const h=c.asiento_fecha;if(!h)return!1;const j=Ks(h);return j.getMonth()===x&&j.getFullYear()===r})}else l=l.filter(x=>{const r=x.asiento_fecha;return r?Ks(r).getFullYear()===m:!1});return L==="ventas"?l.filter(x=>x.cuenta_principal_codigo==="4001"):l.filter(x=>{var r;return((r=x.cuenta_principal_codigo)==null?void 0:r.startsWith("4"))&&x.cuenta_principal_codigo!=="4001"&&x.cuenta_principal_codigo!=="4003"})})(),o=(()=>{const t=a.filter(x=>x.tipo_pago==="contado"||x.tipo_pago==="parcial");if(t.length===0)return[];const m={};t.forEach(x=>{const r=x.metodo_pago==="efectivo"?"Efectivo":"Tarjeta";m[r]=(m[r]||0)+ge(x,f)});const l=Object.values(m).reduce((x,r)=>x+r,0);return Object.entries(m).map(([x,r])=>({name:x,value:r,porcentaje:l>0?(r/l*100).toFixed(1):"0.0"}))})(),n=()=>L==="ventas"?a.length>0||V.ventasBrutas>0||V.descuentos>0:a.length>0||V.otrosIngresos>0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground mb-4",children:"Highlights de Ingresos"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Resumen del D√≠a"})}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(rs.ventasBrutas,P)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(rs.descuentos,P)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",D(rs.ventasNetas,P)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(rs.otrosIngresos,P)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",D(rs.totalIngresos,P)]})]})]})]}),e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Resumen del Mes"})}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(os.ventasBrutas,P)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(os.descuentos,P)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",D(os.ventasNetas,P)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(os.otrosIngresos,P)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",D(os.totalIngresos,P)]})]})]})]}),e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Resumen del A√±o"})}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(is.ventasBrutas,P)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(is.descuentos,P)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",D(is.ventasNetas,P)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",D(is.otrosIngresos,P)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",D(is.totalIngresos,P)]})]})]})]})]})]}),e.jsx("div",{className:"my-8 border-t-2 border-primary/20"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-foreground mb-6",children:["Anal√≠tica de ",L==="ventas"?"Ventas":"Otros Ingresos"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Tipo de Ingreso"}),e.jsx(re,{children:"Selecciona qu√© analizar"})]}),e.jsx(Y,{children:e.jsxs(ye,{value:L,onValueChange:t=>Va(t),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"ventas",id:"tipo-ventas"}),e.jsx(p,{htmlFor:"tipo-ventas",className:"cursor-pointer",children:"Ventas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"otros",id:"tipo-otros"}),e.jsx(p,{htmlFor:"tipo-otros",className:"cursor-pointer",children:"Otros Ingresos"})]})]})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Per√≠odo de An√°lisis"}),e.jsx(re,{children:"Selecciona el per√≠odo"})]}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs(ye,{value:Z,onValueChange:t=>Aa(t),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"diario",id:"period-daily"}),e.jsx(p,{htmlFor:"period-daily",className:"cursor-pointer",children:"Diario"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"mensual",id:"period-monthly"}),e.jsx(p,{htmlFor:"period-monthly",className:"cursor-pointer",children:"Mensual"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"anual",id:"period-annual"}),e.jsx(p,{htmlFor:"period-annual",className:"cursor-pointer",children:"Anual"})]})]}),Z==="diario"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(p,{className:"text-xs text-muted-foreground mb-2 block",children:"Fecha espec√≠fica"}),e.jsxs(Ft,{children:[e.jsx(Dt,{asChild:!0,children:e.jsxs(M,{variant:"outline",className:Hs("w-full justify-start text-left font-normal",!de&&"text-muted-foreground"),size:"sm",children:[e.jsx(It,{className:"mr-2 h-4 w-4"}),Ns(de,"PPP",{locale:ts})]})}),e.jsx(Tt,{className:"w-auto p-0",align:"start",children:e.jsx($t,{mode:"single",selected:de,onSelect:t=>t&&Ra(t),initialFocus:!0,className:"pointer-events-auto"})})]})]}),Z==="mensual"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(p,{className:"text-xs text-muted-foreground mb-2 block",children:"Mes espec√≠fico"}),e.jsxs(Ft,{children:[e.jsx(Dt,{asChild:!0,children:e.jsxs(M,{variant:"outline",className:Hs("w-full justify-start text-left font-normal",!E&&"text-muted-foreground"),size:"sm",children:[e.jsx(It,{className:"mr-2 h-4 w-4"}),Ns(E,"MMMM yyyy",{locale:ts})]})}),e.jsx(Tt,{className:"w-auto p-0",align:"start",children:e.jsx($t,{mode:"single",selected:E,onSelect:t=>t&&Oa(t),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Formato de Cifras"}),e.jsx(re,{children:"Visualizaci√≥n de montos"})]}),e.jsx(Y,{children:e.jsxs(ye,{value:P,onValueChange:t=>Ea(t),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"general",id:"scale-general"}),e.jsx(p,{htmlFor:"scale-general",className:"cursor-pointer",children:"General"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"miles",id:"scale-thousands"}),e.jsx(p,{htmlFor:"scale-thousands",className:"cursor-pointer",children:"Miles (K)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"millones",id:"scale-millions"}),e.jsx(p,{htmlFor:"scale-millions",className:"cursor-pointer",children:"Millones (M)"})]})]})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Tipo de M√©trica"}),e.jsx(re,{children:"Datos a visualizar"})]}),e.jsx(Y,{children:e.jsxs(ye,{value:f,onValueChange:t=>Ma(t),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"brutas",id:"metric-brutas"}),e.jsx(p,{htmlFor:"metric-brutas",className:"cursor-pointer",children:"Ventas Brutas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"descuentos",id:"metric-descuentos"}),e.jsx(p,{htmlFor:"metric-descuentos",className:"cursor-pointer",children:"Descuentos"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"netas",id:"metric-netas"}),e.jsx(p,{htmlFor:"metric-netas",className:"cursor-pointer",children:"Ventas Netas"})]})]})})]})]}),e.jsxs(W,{className:"mb-6",children:[e.jsxs(q,{children:[e.jsxs(G,{children:["Evoluci√≥n de ",f==="descuentos"?"Descuentos":L==="otros"?"Otros Ingresos":f==="brutas"?"Ventas Brutas":"Ventas Netas"]}),e.jsxs(re,{children:[f==="descuentos"?"Descuentos aplicados":L==="otros"?"Otros ingresos":f==="brutas"?"Ventas brutas":"Ventas netas"," - ",Z==="diario"?"del d√≠a":Z==="mensual"?"por d√≠a del mes":"por mes del a√±o"]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"Cargando datos..."}):V.detallesPorPeriodo.length===0?e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"}):e.jsx("div",{className:"h-80",children:e.jsx(ps,{width:"100%",height:"100%",children:e.jsxs(An,{data:V.detallesPorPeriodo.map(t=>({periodo:t.periodo,ventas:t.ventasBrutas,descuentos:t.descuentos,neto:t.ventasNetas,otrosIngresos:t.otrosIngresos})),children:[e.jsx(Na,{strokeDasharray:"3 3"}),e.jsx(ba,{dataKey:"periodo",tick:{fill:"#000000"}}),e.jsx(va,{tickFormatter:t=>D(t,P),tick:{fill:"#000000"}}),e.jsx(js,{formatter:t=>[`$${D(Number(t),P)}`,""],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}}),e.jsx(En,{}),f==="descuentos"&&e.jsx(Gs,{type:"monotone",dataKey:"descuentos",stroke:"hsl(180 60% 70%)",name:"Descuentos",strokeWidth:2,children:e.jsx(gs,{dataKey:"descuentos",position:"top",formatter:t=>`$${D(t,P)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),f==="brutas"&&L==="ventas"&&e.jsx(Gs,{type:"monotone",dataKey:"ventas",stroke:"hsl(180 50% 55%)",name:"Ventas Brutas",strokeWidth:2,children:e.jsx(gs,{dataKey:"ventas",position:"top",formatter:t=>`$${D(t,P)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),f==="netas"&&L==="ventas"&&e.jsx(Gs,{type:"monotone",dataKey:"neto",stroke:"hsl(180 45% 45%)",name:"Ventas Netas",strokeWidth:2,children:e.jsx(gs,{dataKey:"neto",position:"top",formatter:t=>`$${D(t,P)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),L==="otros"&&f!=="descuentos"&&e.jsx(Gs,{type:"monotone",dataKey:"otrosIngresos",stroke:"hsl(140 50% 50%)",name:"Otros Ingresos",strokeWidth:2,children:e.jsx(gs,{dataKey:"otrosIngresos",position:"top",formatter:t=>`$${D(t,P)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})})]})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:[f==="brutas"?"Ventas Brutas":f==="descuentos"?"Descuentos":"Ventas Netas"," por Tipo"]}),e.jsxs(re,{children:["Distribuci√≥n de ",f==="brutas"?"ventas brutas":f==="descuentos"?"descuentos":"ventas netas"," por categor√≠a"]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):n()?L==="otros"&&f==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(ps,{width:"100%",height:"100%",children:e.jsxs(ya,{children:[e.jsx(wa,{data:(()=>{const t=L==="ventas"?f==="brutas"?V.ventasBrutas:f==="descuentos"?V.descuentos:V.ventasNetas:V.otrosIngresos;if(a.length===0&&t>0)return[{tipo:"Otros Ingresos",monto:t,porcentaje:"100.0"}];const m=a.reduce((x,r)=>(x[r.tipo_ingreso]=(x[r.tipo_ingreso]||0)+ge(r,f),x),{}),l=Object.values(m).reduce((x,r)=>x+r,0);return Object.entries(m).map(([x,r])=>({tipo:x.charAt(0).toUpperCase()+x.slice(1),monto:r,porcentaje:l>0?(r/l*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({tipo:t,porcentaje:m,monto:l})=>`${t}
${m}%
$${D(l,P)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:Object.keys(a.reduce((t,m)=>(t[m.tipo_ingreso]=!0,t),{})).map((t,m)=>{const l=["hsl(180 50% 55%)","hsl(180 45% 45%)","hsl(180 55% 65%)","hsl(180 40% 40%)"];return e.jsx(Ys,{fill:l[m%4]},`cell-${m}`)})}),e.jsx(js,{formatter:t=>[`$${D(Number(t),P)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:["Estado de Pagos - ",f==="brutas"?"Ventas Brutas":f==="descuentos"?"Descuentos":"Ventas Netas"]}),e.jsx(re,{children:"Distribuci√≥n por estado de pago"})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):n()?L==="otros"&&f==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(ps,{width:"100%",height:"100%",children:e.jsxs(ya,{children:[e.jsxs(wa,{data:(()=>{const t=L==="ventas"?f==="brutas"?V.ventasBrutas:f==="descuentos"?V.descuentos:V.ventasNetas:V.otrosIngresos;if(a.length===0&&t>0)return[{estado:"Pagado Total",monto:t,porcentaje:"100.0"}];const m=a.reduce((x,r)=>{let c="Por Cobrar";return r.tipo_pago==="contado"||r.monto_pagado&&r.monto_pendiente===0?c="Pagado Total":(r.tipo_pago==="parcial"||r.monto_pagado>0&&r.monto_pendiente>0)&&(c="Pago Parcial"),x[c]=(x[c]||0)+ge(r,f),x},{}),l=Object.values(m).reduce((x,r)=>x+r,0);return Object.entries(m).map(([x,r])=>({estado:x,monto:r,porcentaje:l>0?(r/l*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({estado:t,porcentaje:m,monto:l})=>`${t}
${m}%
$${D(l,P)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:[e.jsx(Ys,{fill:"hsl(180 50% 55%)"}),e.jsx(Ys,{fill:"hsl(180 55% 65%)"}),e.jsx(Ys,{fill:"hsl(180 45% 45%)"})]}),e.jsx(js,{formatter:t=>[`$${D(Number(t),P)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(W,{children:[e.jsxs(q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(G,{children:[f==="brutas"?"Ventas Brutas":f==="descuentos"?"Descuentos":"Ventas Netas"," por ",Xe==="subcuenta"?"Subcuenta":"Cuenta"]}),e.jsxs(re,{children:["Distribuci√≥n por ",Xe==="subcuenta"?"subcuentas":"cuentas"," contables"]})]}),e.jsxs(he,{value:Xe,onValueChange:t=>Ka(t),children:[e.jsx(pe,{className:"w-[150px]",children:e.jsx(we,{})}),e.jsxs(je,{children:[e.jsx(T,{value:"subcuenta",children:"Por Subcuenta"}),e.jsx(T,{value:"cuenta",children:"Por Cuenta"})]})]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):n()?L==="otros"&&f==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(ps,{width:"100%",height:"100%",children:e.jsxs(Mn,{data:(()=>{const t=L==="ventas"?f==="brutas"?V.ventasBrutas:f==="descuentos"?V.descuentos:V.ventasNetas:V.otrosIngresos;if(a.length===0&&t>0)return[{subcuenta:"Sin detalle",monto:t}];const m=a.reduce((r,c)=>{var j;let h;if(Xe==="subcuenta")h=c.subcuenta_id?((j=J.find(b=>b.id===c.subcuenta_id))==null?void 0:j.nombre)||"Subcuenta desconocida":"Sin subcuenta asignada";else{const b=fe.find(v=>v.codigo===c.cuenta_principal_codigo);h=b?`${c.cuenta_principal_codigo} - ${b.nombre}`:c.cuenta_principal_codigo||"Sin cuenta"}return r[h]=(r[h]||0)+ge(c,f),r},{}),l=Object.values(m).reduce((r,c)=>r+c,0);if(t-l>.01){const r={};Ee.forEach(c=>{const h=c.detalle_asientos.find(F=>F.cuenta_codigo.startsWith("4")&&Number(F.haber)>0);if(!h)return;const j=Number(h.haber)||0,b=h.cuenta_codigo,v=fe.find(F=>F.codigo===b),g=(v==null?void 0:v.nombre)||"Otros ingresos";let w;if(Xe==="cuenta")w=`${b} - ${g}`;else if(Xe==="subcuenta"){const F=h.subcuenta_id,z=J.find(B=>B.id===F);w=(z==null?void 0:z.nombre)||"Sin subcuenta asignada"}else w=g;r[w]=(r[w]||0)+j}),Object.entries(r).forEach(([c,h])=>{m[c]=(m[c]||0)+h})}return Object.entries(m).map(([r,c])=>({subcuenta:r,monto:c}))})(),layout:"vertical",children:[e.jsx(Na,{strokeDasharray:"3 3"}),e.jsx(ba,{type:"number",tickFormatter:t=>D(t,P),tick:{fill:"#000000"},domain:[0,t=>t*1.2]}),e.jsx(va,{type:"category",dataKey:"subcuenta",width:150,tick:{fill:"#000000"}}),e.jsx(js,{formatter:t=>[`$${D(Number(t),P)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}}),e.jsx(Vn,{dataKey:"monto",fill:"hsl(180 50% 55%)",children:e.jsx(gs,{dataKey:"monto",position:"right",formatter:t=>`$${D(t,P)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"M√©todos de Pago Recibidos"}),e.jsxs(re,{children:["Distribuci√≥n de ",f==="brutas"?"ventas brutas":f==="descuentos"?"descuentos":"ventas netas"," por m√©todo de pago"]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):n()?L==="otros"&&f==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):o.length===0?e.jsxs("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:["No hay transacciones con m√©todo de pago en este per√≠odo",e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-2 block",children:"Las ventas a cr√©dito no tienen m√©todo de pago asignado"})]}):e.jsx("div",{className:"h-64",children:e.jsx(ps,{width:"100%",height:"100%",children:e.jsx(Rn,{data:o,dataKey:"value",aspectRatio:4/3,stroke:"#fff",fill:"#8884d8",content:e.jsx(Wn,{}),children:e.jsx(js,{content:e.jsx(qn,{scaleFormat:P})})})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:[f==="brutas"?"Ventas Brutas":f==="descuentos"?"Descuentos":"Ventas Netas"," por Producto"]}),e.jsxs(re,{children:["Ranking de productos ",f==="descuentos"?"con m√°s descuentos":"m√°s vendidos"]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):n()?e.jsx("div",{className:"space-y-3",children:(()=>{if(L==="otros"&&f==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const t=L==="ventas"?f==="brutas"?V.ventasBrutas:f==="descuentos"?V.descuentos:V.ventasNetas:V.otrosIngresos;if(a.length===0&&t>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(Ie,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin detalle de producto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",D(t,P)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Ie,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",D(t,P)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const m={};a.forEach(r=>{if(r.tipo_ingreso==="inventariados"&&r.descripcion.startsWith("Venta de ")){const c=r.descripcion.replace("Venta de ","").trim(),h=De.find(j=>j.nombre.toLowerCase()===c.toLowerCase());m[c]||(m[c]={nombre:c,transacciones:0,monto:0,imagen:h==null?void 0:h.imagen_url,tieneAsignacion:!0}),m[c].transacciones+=1,m[c].monto+=ge(r,f)}}),a.forEach(r=>{if(r.tipo_ingreso==="precargados"){let c=[];r.descripcion.startsWith("Venta: ")?c=r.descripcion.replace("Venta: ","").split(", ").map(g=>{const w=g.match(/^(.+?) \(x(\d+)\)$/);return w?{nombre:w[1].trim(),cantidad:parseInt(w[2])}:{nombre:g.trim(),cantidad:1}}):r.descripcion.startsWith("Venta de ")?c=[{nombre:r.descripcion.replace("Venta de ","").trim(),cantidad:1}]:c=[{nombre:r.descripcion,cantidad:1}];const h=ge(r,f),j=[];let b=0;c.forEach(({nombre:v,cantidad:g})=>{const w=Se.find(z=>z.nombre.toLowerCase()===v.toLowerCase()),F=(w==null?void 0:w.precio)||0;j.push({nombre:v,cantidad:g,precioBase:F}),b+=F*g}),j.forEach(({nombre:v,cantidad:g,precioBase:w})=>{const F=Se.find(ce=>ce.nombre.toLowerCase()===v.toLowerCase()),z=w*g,B=b>0?z/b:1/j.length,U=h*B;m[v]||(m[v]={nombre:v,transacciones:0,monto:0,imagen:F==null?void 0:F.imagen_url,tieneAsignacion:!!F}),m[v].transacciones+=1,m[v].monto+=U})}if(r.tipo_ingreso==="general"||r.tipo_ingreso==="inventariados"&&!r.descripcion.startsWith("Venta de")){const c="Ingresos sin producto asignado";m[c]||(m[c]={nombre:c,transacciones:0,monto:0,tieneAsignacion:!1}),m[c].transacciones+=1,m[c].monto+=ge(r,f)}if(r.tipo_ingreso==="otros"){const c=r.descripcion||"Otros ingresos";m[c]||(m[c]={nombre:c,transacciones:0,monto:0,tieneAsignacion:!1}),m[c].transacciones+=1,m[c].monto+=ge(r,f)}});const l=Object.values(m).sort((r,c)=>c.monto-r.monto);if(l.reduce((r,c)=>r+c.monto,0),L==="otros"){const r=a.filter(h=>h.tipo_ingreso==="otros").reduce((h,j)=>h+ge(j,f),0);if(t-r>.01){const h={};Ee.forEach(j=>{var z;const b=j.detalle_asientos.find(B=>B.cuenta_codigo.startsWith("4")&&Number(B.haber)>0);if(!b)return;const v=Number(b.haber)||0,g=b.cuenta_codigo,w=fe.find(B=>B.codigo===g);let F;(z=j.numero_asiento)!=null&&z.startsWith("BAJA-")?F=(w==null?void 0:w.nombre)||"Ganancia en Venta de Activos":F=j.descripcion||(w==null?void 0:w.nombre)||"Otros ingresos",h[F]||(h[F]={monto:0,count:0}),h[F].monto+=v,h[F].count+=1}),Object.entries(h).forEach(([j,b])=>{b.monto>.01&&l.push({nombre:j,transacciones:b.count,monto:b.monto,tieneAsignacion:!1})})}}const x=l.slice(0,10);return e.jsxs(e.Fragment,{children:[x.map(r=>{const c=l.reduce((j,b)=>j+b.monto,0),h=c>0?(r.monto/c*100).toFixed(1):"0.0";return e.jsxs("div",{className:`flex items-center gap-3 p-3 border rounded-lg ${r.tieneAsignacion?"":"border-amber-500/50 bg-amber-50/50 dark:bg-amber-950/20"}`,children:[r.imagen?e.jsx("img",{src:r.imagen,alt:r.nombre,className:"w-12 h-12 rounded-md object-cover flex-shrink-0"}):e.jsx("div",{className:`w-12 h-12 rounded-md flex items-center justify-center flex-shrink-0 ${r.tieneAsignacion?"bg-muted":"bg-amber-100 dark:bg-amber-900/30"}`,children:e.jsx(Ie,{className:`w-5 h-5 ${r.tieneAsignacion?"text-muted-foreground":"text-amber-600 dark:text-amber-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium truncate",children:r.nombre}),!r.tieneAsignacion&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-200 flex-shrink-0",children:"Sin asignar"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.transacciones," ",r.transacciones===1?"transacci√≥n":"transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",D(r.monto,P)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[h,"%"]})})]},r.nombre)}),(()=>{const r=l.reduce((c,h)=>c+h.monto,0);return r>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(Ie,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[l.reduce((c,h)=>c+h.transacciones,0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",D(r,P)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:[f==="brutas"?"Ventas Brutas":f==="descuentos"?"Descuentos":"Ventas Netas"," por Cliente"]}),e.jsxs(re,{children:["Ranking de ",f==="descuentos"?"clientes con m√°s descuentos":"mejores clientes"]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):n()?e.jsx("div",{className:"space-y-3",children:(()=>{if(L==="otros"&&f==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const t=L==="ventas"?f==="brutas"?V.ventasBrutas:f==="descuentos"?V.descuentos:V.ventasNetas:V.otrosIngresos;if(a.length===0&&t>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(hs,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin cliente asignado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",D(t,P)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(hs,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",D(t,P)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const m=a.reduce((c,h)=>{const j=h.cliente_nombre||"Sin cliente asignado";return c[j]||(c[j]={nombre:j,transacciones:0,monto:0,email:h.cliente_email,telefono:h.cliente_telefono}),c[j].transacciones+=1,c[j].monto+=ge(h,f),c},{}),l=Object.values(m).sort((c,h)=>h.monto-c.monto),x=l.reduce((c,h)=>c+h.monto,0);if(L==="otros"){const c=t-x;if(c>.01){const h=l.find(j=>j.nombre==="Sin cliente asignado");h?(h.monto+=c,h.transacciones+=Ee.length):l.push({nombre:"Sin cliente asignado",transacciones:Ee.length,monto:c}),l.sort((j,b)=>b.monto-j.monto)}}const r=l.slice(0,10);return e.jsxs(e.Fragment,{children:[r.map(c=>{const h=l.reduce((b,v)=>b+v.monto,0),j=h>0?(c.monto/h*100).toFixed(1):"0.0";return e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(hs,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:c.nombre}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-0.5",children:[e.jsxs("p",{children:[c.transacciones," ",c.transacciones===1?"compra":"compras"]}),c.telefono&&e.jsx("p",{className:"text-xs",children:c.telefono}),c.email&&e.jsx("p",{className:"text-xs truncate",children:c.email})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",D(c.monto,P)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[j,"%"]})})]},c.nombre)}),(()=>{const c=l.reduce((h,j)=>h+j.monto,0);return c>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(hs,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[l.reduce((h,j)=>h+j.transacciones,0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",D(c,P)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]})]})]})]})})()}),e.jsx(es,{value:"catalogo",className:"mt-6",children:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{className:"flex items-center justify-between",children:["Cat√°logo de Productos",e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(M,{variant:"outline",size:"sm",onClick:()=>{Ca(),te({title:"Actualizado",description:"La lista de productos se ha actualizado correctamente"})},children:[e.jsx(On,{className:"mr-2 h-4 w-4"}),"Actualizar"]}),e.jsxs(ls,{open:Qa,onOpenChange:ut,children:[e.jsx(fa,{asChild:!0,children:e.jsxs(M,{children:[e.jsx(_t,{className:"mr-2 h-4 w-4"}),"Nuevo Producto"]})}),e.jsxs(ds,{className:"sm:max-w-[425px]",children:[e.jsxs(ms,{children:[e.jsx(us,{children:"Agregar Nuevo Producto"}),e.jsx(xs,{children:"Completa la informaci√≥n del producto para agregarlo al cat√°logo."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"product-name",className:"text-right",children:"Nombre"}),e.jsx(O,{id:"product-name",value:xt,onChange:s=>Xt(s.target.value),className:"col-span-3",placeholder:"Nombre del producto"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"product-image",className:"text-right",children:"Imagen"}),e.jsx(O,{id:"product-image",type:"file",accept:"image/*",onChange:s=>{var a;return na(((a=s.target.files)==null?void 0:a[0])||null)},className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"product-price",className:"text-right",children:"Precio"}),e.jsx(O,{id:"product-price",type:"number",value:ht,onChange:s=>Zt(s.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"product-account",className:"text-right",children:"Cuenta"}),e.jsxs("div",{className:"col-span-3 flex items-center p-2 border rounded-md bg-muted/50",children:[e.jsx("span",{className:"text-sm font-medium",children:"4001 - Ventas"}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"(cuenta fija)"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(he,{value:ta,onValueChange:s=>aa(s==="none"?"":s),children:[e.jsx(pe,{className:"col-span-3",children:e.jsx(we,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(je,{children:[e.jsx(T,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),J.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>e.jsx(T,{value:s.id,children:s.nombre},s.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(ss,{id:"product-description",value:ea,onChange:s=>sa(s.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]})]}),e.jsxs(qs,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:()=>ut(!1),children:"Cancelar"}),e.jsx(M,{onClick:gn,disabled:Ls,children:Ls?"Guardando...":"Guardar Producto"})]})]})]}),e.jsx(ls,{open:sn,onOpenChange:Ws,children:e.jsxs(ds,{className:"sm:max-w-[425px]",children:[e.jsxs(ms,{children:[e.jsx(us,{children:"Editar Producto"}),e.jsx(xs,{children:"Modifica la informaci√≥n del producto."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"edit-product-name",className:"text-right",children:"Nombre *"}),e.jsx(O,{id:"edit-product-name",value:ft,onChange:s=>Nt(s.target.value),className:"col-span-3",placeholder:"Ej: Consultor√≠a, Producto X"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"edit-product-price",className:"text-right",children:"Precio *"}),e.jsx(O,{id:"edit-product-price",type:"number",value:bt,onChange:s=>vt(s.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"edit-product-image",className:"text-right",children:"Imagen"}),e.jsxs("div",{className:"col-span-3 space-y-2",children:[e.jsx(O,{id:"edit-product-image",type:"file",accept:"image/*",onChange:fn}),ca&&e.jsx("div",{className:"aspect-square w-24 mx-auto",children:e.jsx("img",{src:ca,alt:"Preview",className:"w-full h-full object-cover rounded-md"})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"edit-product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(ss,{id:"edit-product-description",value:ia,onChange:s=>yt(s.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"edit-product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(he,{value:la||"none",onValueChange:s=>da(s==="none"?"":s),children:[e.jsx(pe,{className:"col-span-3",children:e.jsx(we,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(je,{children:[e.jsx(T,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),J.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>e.jsx(T,{value:s.id,children:s.nombre},s.id))]})]})]})]}),e.jsxs(qs,{children:[e.jsx(M,{type:"button",variant:"outline",onClick:()=>Ws(!1),children:"Cancelar"}),e.jsx(M,{onClick:Nn,disabled:Ls,children:Ls?"Actualizando...":"Actualizar Producto"})]})]})})]})]}),e.jsx(re,{children:"Gestiona el cat√°logo de productos y servicios con cuentas contables asignadas"})]}),e.jsxs(Y,{children:[e.jsxs(Re,{className:"mb-6",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsxs(Oe,{children:[e.jsx("strong",{children:"Recomendaci√≥n:"}),' Asignar subcuentas a cada producto ayuda a llevar un mejor control contable. La cuenta predeterminada es "4001 - Ventas".']})]}),e.jsx("div",{className:"space-y-6",children:Js?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):Se.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay productos de servicios registrados a√∫n"}):e.jsxs("div",{className:"space-y-6",children:[J.filter(s=>s.cuenta_madre_codigo==="4001").map(s=>{const a=Se.filter(i=>i.subcuenta_id===s.id);return a.length===0?null:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{className:"text-lg flex items-center",children:[e.jsx(Ie,{className:"mr-2 h-5 w-5"}),"Subcuenta: ",s.nombre]}),e.jsxs(re,{children:[a.length," producto",a.length!==1?"s":""]})]}),e.jsx(Y,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(i=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[i.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:i.imagen_url,alt:i.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:i.nombre}),i.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:i.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",i.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:()=>ua(i),className:"flex-1",children:"Editar"}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>kt.mutate(i.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},i.id))})})]},s.id)}),(()=>{const s=Se.filter(a=>!a.subcuenta_id);return s.length===0?null:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{className:"text-lg flex items-center",children:[e.jsx(ja,{className:"mr-2 h-5 w-5"}),"Cuenta General: 4001 - Ventas"]}),e.jsxs(re,{children:[s.length," producto",s.length!==1?"s":""," sin subcuenta espec√≠fica"]})]}),e.jsx(Y,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(a=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[a.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:a.nombre}),a.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:a.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",a.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(M,{variant:"outline",size:"sm",onClick:()=>ua(a),className:"flex-1",children:"Editar"}),e.jsx(M,{variant:"outline",size:"sm",onClick:()=>kt.mutate(a.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},a.id))})})]})})()]})})]})]})})]}),e.jsx(ls,{open:en,onOpenChange:Bs,children:e.jsxs(ds,{children:[e.jsxs(ms,{children:[e.jsx(us,{children:"‚ùå Cancelar Transacci√≥n"}),e.jsx(xs,{children:"Esta acci√≥n crear√° un asiento contable de reversi√≥n. La transacci√≥n original quedar√° marcada como cancelada pero mantendr√° toda su trazabilidad."})]}),e.jsxs("div",{className:"space-y-4",children:[Ge&&e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Transacci√≥n a cancelar:"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",Ge.descripcion]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Monto:"})," $",_(Ge.monto_total)]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(Ge.created_at).toLocaleDateString("es-ES")]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"motivo-cancelacion",children:"Motivo de la Cancelaci√≥n *"}),e.jsx(ss,{id:"motivo-cancelacion",placeholder:"Ej: Error en registro, cliente cancel√≥ pedido, etc.",value:Us,onChange:s=>jt(s.target.value),rows:3})]}),e.jsxs(Re,{children:[e.jsx(R,{className:"h-4 w-4"}),e.jsxs(Oe,{className:"text-xs",children:[e.jsx("strong",{children:"¬øQu√© suceder√°?"}),e.jsxs("ul",{className:"list-disc ml-4 mt-1 space-y-1",children:[e.jsx("li",{children:"Se crear√° un asiento de reversi√≥n autom√°ticamente"}),e.jsx("li",{children:'La transacci√≥n original se marcar√° como "cancelada"'}),e.jsx("li",{children:"Si es venta de inventario, el stock se restaurar√°"}),e.jsx("li",{children:"Ambas transacciones quedar√°n visibles para auditor√≠a"})]})]})]})]}),e.jsxs(qs,{children:[e.jsx(M,{variant:"outline",onClick:()=>{Bs(!1),jt(""),pt(null)},disabled:gt,children:"Cancelar"}),e.jsx(M,{variant:"destructive",onClick:pn,disabled:gt||!Us.trim(),children:gt?"Cancelando...":"Confirmar Cancelaci√≥n"})]})]})})]})]})};export{Hn as default};
