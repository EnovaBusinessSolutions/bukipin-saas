import{c as dn,r as u,a as mn,u as un,b as xn,d as hn,e as pn,f as jn,g as gn,h as fn,i as vn,j as Nn,k as bn,l as e,D as is,m as cs,n as ls,o as ds,C as R,p as ms,S as Re,q as sa,R as be,s as A,L as p,I as V,t as zs,B as L,v as ae,T as yn,w as wn,x as Ls,y as Bs,z as W,A as q,E as G,F as oe,G as Y,H as ta,P as ye,J as bt,U as us,K as Oe,M as ze,N as pe,O as je,Q as ge,V as fe,W as T,X as es,Y as Cn,Z as _n,_ as aa,$ as na,a0 as ra,a1 as oa,a2 as ia,a3 as ca,a4 as la,a5 as da,a6 as xs,a7 as Sn,a8 as ma,a9 as ua,aa as xa,ab as hs,ac as Pn,ad as Us,ae as ps,af as ha,ag as pa,ah as Ws,ai as Fn,aj as Dn,ak as In,al as Tn,am as yt,an as ja}from"./index-VASw-Iq-.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $n=dn("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]),kn=h=>{const D=(h==null?void 0:h.data)??h??[];return Array.isArray(D)?D:[]},An=(h=10)=>{const[D,w]=u.useState([]),[b,I]=u.useState(!0),[de,ee]=u.useState(null),ie=async()=>{try{I(!0),ee(null);const Q=await mn(`/api/transacciones/ingresos/recientes?limit=${encodeURIComponent(String(h))}`,{method:"GET"}),ve=kn(Q).map(Te=>{var se;return{...Te,asiento_fecha:Te.asiento_fecha??(Array.isArray(Te.asiento)&&Te.asiento.length>0?((se=Te.asiento[0])==null?void 0:se.fecha)??null:null)}});w(ve)}catch(Q){console.error("Error fetching transacciones recientes:",Q),ee((Q==null?void 0:Q.message)||"Error desconocido")}finally{I(!1)}};return u.useEffect(()=>{let Q=!0;ie();const ve=window.setInterval(()=>{Q&&ie()},3e4);return()=>{Q=!1,window.clearInterval(ve)}},[h]),{transacciones:D,loading:b,error:de,refetch:ie}};async function Ie(h,D={}){const w=await fetch(h,{credentials:"include",headers:{"Content-Type":"application/json",...D.headers||{}},...D}),b=await w.json().catch(()=>({}));if(!w.ok){const I=(b==null?void 0:b.error)||(b==null?void 0:b.message)||`HTTP ${w.status}`;throw new Error(I)}return(b==null?void 0:b.data)??b}async function wt(h,D={}){const w=(D==null?void 0:D.body)??{};try{if(h==="registrar-ingreso")return{data:await Ie("/api/ingresos",{method:"POST",body:JSON.stringify(w)}),error:null};if(h==="cancelar-ingreso"){const I=w==null?void 0:w.transaccionId;return{data:await Ie(`/api/ingresos/${encodeURIComponent(I)}/cancelar`,{method:"POST",body:JSON.stringify({motivoCancelacion:w==null?void 0:w.motivoCancelacion})}),error:null}}return{data:await Ie(`/api/functions/${encodeURIComponent(h)}`,{method:"POST",body:JSON.stringify(w)}),error:null}}catch(b){return{data:null,error:{message:(b==null?void 0:b.message)||String(b)}}}}const He=h=>{if(h==null)return 0;const D=typeof h=="string"?Number(h):h;return Number.isFinite(D)?D:0},P=h=>He(h).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}),F=(h,D)=>{const w=He(h);let b=w,I="";return D==="miles"?(b=w/1e3,I=" K"):D==="millones"&&(b=w/1e6,I=" M"),b.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})+I},ga=h=>{if(!h)return h;const D=h.id??h._id,w=h.fecha??h.createdAt??h.created_at??h.updatedAt??h.updated_at,b=w?String(w):void 0,I=b?b.slice(0,10):h.created_at,de=He(h.monto_total??h.montoTotal??h.total??h.monto_total),ee=He(h.monto_descuento??h.montoDescuento??h.descuento),ie=He(h.monto_neto??h.montoNeto??h.neto??de-ee),Q=He(h.monto_pagado??h.montoPagado??h.pagado??ie),Ce=He(h.saldo_pendiente??h.saldoPendiente??h.pendiente??Math.max(0,ie-Q)),ve=h.tipo_ingreso??h.tipoIngreso??h.tipo,Te=h.metodo_pago??h.metodoPago,se=h.tipo_pago??h.tipoPago;return{...h,id:D,_id:h._id??D,created_at:h.created_at??I,fecha:h.fecha??b,tipo_ingreso:ve,tipoIngreso:h.tipoIngreso??ve,metodo_pago:Te,metodoPago:h.metodoPago??Te,tipo_pago:se,tipoPago:h.tipoPago??se,monto_total:de,montoTotal:h.montoTotal??de,total:h.total??de,monto_descuento:ee,montoDescuento:h.montoDescuento??ee,monto_neto:ie,montoNeto:h.montoNeto??ie,neto:h.neto??ie,monto_pagado:Q,montoPagado:h.montoPagado??Q,pagado:h.pagado??Q,saldo_pendiente:Ce,saldoPendiente:h.saldoPendiente??Ce,pendiente:h.pendiente??Ce}},we=(h,D)=>{const w=ga(h);return D==="brutas"?w.monto_total||0:D==="descuentos"?w.monto_descuento||0:D==="netas"&&(w.monto_neto||w.monto_total)||0},Ct=h=>{const D=(h??"").toString().slice(0,10),[w,b,I]=D.split("-").map(Number);return new Date(w,(b||1)-1,I||1)},En=h=>{const{x:D,y:w,width:b,height:I,name:de,value:ee,porcentaje:ie}=h,Ce=de==="Efectivo"?"hsl(180 50% 55%)":"hsl(180 45% 45%)",ve=b>100&&I>70;return e.jsxs("g",{children:[e.jsx("rect",{x:D,y:w,width:b,height:I,fill:Ce,stroke:"#fff",strokeWidth:2}),ve&&e.jsxs(e.Fragment,{children:[e.jsx("text",{x:D+b/2,y:w+I/2-20,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontWeight:"bold",fontSize:"16px",style:{userSelect:"none"},children:de}),e.jsxs("text",{x:D+b/2,y:w+I/2+5,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:["$",F(ee,"general")]}),e.jsxs("text",{x:D+b/2,y:w+I/2+25,textAnchor:"middle",dominantBaseline:"middle",fill:"#000000",fontSize:"14px",fontWeight:"600",style:{userSelect:"none"},children:[ie,"%"]})]})]})},Vn=({active:h,payload:D,scaleFormat:w})=>{if(h&&D&&D.length){const b=D[0].payload,I=b.name==="Efectivo";return e.jsxs("div",{className:"bg-background border border-border rounded-lg shadow-lg p-3",children:[e.jsx("p",{className:"font-bold text-foreground mb-1",children:b.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Monto: ",e.jsxs("span",{className:"font-semibold text-foreground",children:["$",F(b.value,w)]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Porcentaje: ",e.jsxs("span",{className:"font-semibold text-foreground",children:[b.porcentaje,"%"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2 italic",children:I?"Se registra en Efectivo (Caja)":"Se registra en Bancos"})]})}return null},zn=()=>{const{ventasResumen:h,loading:D,refetch:w}=un(),{transacciones:b,loading:I,refetch:de}=An(1e3),{data:ee=[]}=xn(),{data:ie}=hn(),Q=(ie==null?void 0:ie.cuentasFlat)||[],{data:Ce=[],isLoading:ve,refetch:Te}=pn(),{data:se=[],isLoading:qs,refetch:fa}=jn(),{data:Le=[],isLoading:va}=gn(),Na=fn(),ba=vn(),_t=Nn(),ya=bn(),[k,St]=u.useState(""),[wa,Ca]=u.useState(!1),[_a,Sa]=u.useState(""),[js,Pt]=u.useState(""),[$,Ft]=u.useState(""),[Ne,Be]=u.useState(""),[gs,Je]=u.useState(""),[Dt,fs]=u.useState(!1),[J,It]=u.useState(""),[_e,Gs]=u.useState(""),[Qe,vs]=u.useState(""),[Se,Ns]=u.useState(""),[Pe,bs]=u.useState(""),[$e,ys]=u.useState(""),[ws,Tt]=u.useState(""),[Fe,$t]=u.useState(""),[Cs,Ys]=u.useState(""),[Ee,_s]=u.useState([]),[Pa,ss]=u.useState(!1),[N,Ss]=u.useState(null),[Xe,Ks]=u.useState("historico"),[ce,ts]=u.useState(""),[X,Fa]=u.useState("diario"),[C,Da]=u.useState("general"),[v,Ia]=u.useState("brutas"),[O,Ta]=u.useState("ventas"),[me,$a]=u.useState(new Date),[E,ka]=u.useState(new Date),[as,Aa]=u.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[ns,Ea]=u.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[rs,Va]=u.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,totalIngresos:0}),[M,kt]=u.useState({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]}),[Mn,Ps]=u.useState([]),[Ve,Ma]=u.useState([]),[ke,At]=u.useState(""),[Ae,Et]=u.useState(""),[ue,Vt]=u.useState("todos"),[xe,Mt]=u.useState("todas"),[te,Rt]=u.useState(""),[Ze,Ra]=u.useState("subcuenta"),[Ue,Fs]=u.useState(null),[Oa,Hs]=u.useState(!1),[ne,Js]=u.useState(""),[We,os]=u.useState(""),[Me,Qs]=u.useState("1"),[Ds,Xs]=u.useState(0),[Zs,Is]=u.useState(!0),[et,st]=u.useState("0"),[qe,tt]=u.useState("monto"),[K,Ts]=u.useState([]),[Ge,at]=u.useState(""),[$s,nt]=u.useState(""),[ks,rt]=u.useState("1"),[ot,Ot]=u.useState("0"),[Ye,za]=u.useState("monto"),[Z,As]=u.useState([]),[La,it]=u.useState(!1),[ct,zt]=u.useState(""),[lt,Lt]=u.useState(""),[Bt,Ut]=u.useState(""),[Rn,Ba]=u.useState("4001"),[Wt,qt]=u.useState(""),[Ua,Gt]=u.useState(null);u.useState(null);const[Es,Vs]=u.useState(!1),[Wa,Ms]=u.useState(!1),[Ke,dt]=u.useState(null),[Rs,mt]=u.useState(""),[ut,Yt]=u.useState(!1),[qa,Os]=u.useState(!1),[Ga,Kt]=u.useState(null),[xt,ht]=u.useState(""),[pt,jt]=u.useState(""),[Ht,gt]=u.useState(""),[Ya,ft]=u.useState(null),[Jt,vt]=u.useState(null),[Qt,Xt]=u.useState(""),De=Ce||[],Ka=t=>{var l;Js(t);const a=De.find(i=>i.id===t);if(a){const i=a.precio_venta,n=i&&i>0?i.toString():((l=a.costo_unitario)==null?void 0:l.toString())||"0",s=i&&i>0;Is(s),os(n),Xs(a.cantidad_stock||0),Je(`Venta de ${a.nombre}`);const c=((i&&i>0?i:a.costo_unitario||0)*parseFloat(Me)).toFixed(2);Be(c)}},Ha=t=>{if(os(t),ne&&t){const a=(parseFloat(t)*parseFloat(Me||"1")).toFixed(2);Be(a)}},Ja=()=>{if(!Ge)return;const t=se.find(c=>c.id===Ge);if(!t)return;const a=parseFloat(ks)||1,l=parseFloat(ot)||0,i=t.precio*a,n=Ye==="porcentaje"?i*(l/100):l,s=Math.max(0,i-n),d=Z.findIndex(c=>c.id===Ge);if(d!==-1){const c=[...Z];c[d].cantidad+=a,c[d].descuento+=n;const m=c[d].precio*c[d].cantidad;c[d].subtotal=Math.max(0,m-c[d].descuento),As(c)}else As([...Z,{id:t.id,nombre:t.nombre,precio:t.precio,cantidad:a,descuento:n,subtotal:s,imagen_url:t.imagen_url}]);at(""),rt("1"),nt(""),Ot("0")},Qa=t=>{As(Z.filter(a=>a.id!==t))},Xa=()=>{if(!ne)return;const t=De.find(m=>m.id===ne);if(!t)return;const a=parseFloat(Me)||1,l=parseFloat(We)||0,i=parseFloat(et)||0,n=l*a,s=qe==="porcentaje"?n*(i/100):i,d=Math.max(0,n-s),c=K.findIndex(m=>m.id===ne);if(c!==-1){const m=[...K];m[c].cantidad+=a,m[c].descuento+=s;const r=m[c].precioUnitario*m[c].cantidad;m[c].subtotal=Math.max(0,r-m[c].descuento),Ts(m)}else Ts([...K,{id:ne,nombre:t.nombre,precioUnitario:l,cantidad:a,descuento:s,subtotal:d,stockDisponible:t.cantidad_stock||0,costoUnitario:t.costo_unitario||0,imagen_url:t.imagen_url}]);Js(""),Qs("1"),os(""),st("0"),tt("monto"),Xs(0),Is(!0),ae({title:"‚úÖ Producto agregado",description:`${t.nombre} agregado a la venta`})},Za=t=>{Ts(K.filter(a=>a.id!==t)),ae({title:"Producto eliminado",description:"El producto ha sido removido de la venta"})};u.useEffect(()=>{if(k==="precargados"&&Z.length>0){const t=Z.reduce((a,l)=>a+l.subtotal,0).toFixed(2);Be(t),Je(`Venta de ${Z.length} producto(s)`)}},[Z,k]),u.useEffect(()=>{if(k==="inventariados"&&K.length>0){const t=K.reduce((a,l)=>a+l.subtotal,0).toFixed(2);Be(t),Je(`Venta de ${K.length} producto(s) de inventario`)}},[K,k]);const en=t=>{at(t);const a=se.find(l=>l.id===t);a&&nt(a.precio.toString())},Zt=()=>{const t=[];return k||t.push("Tipo de Ingreso"),k==="precargados"?Z.length===0&&t.push("Debe agregar al menos un producto"):k==="inventariados"?K.length===0&&t.push("Debe agregar al menos un producto del inventario"):(k==="general"||k==="otros")&&(gs.trim()||t.push("Descripci√≥n")),k!=="precargados"&&k!=="inventariados"&&(!Ne||parseFloat(Ne)<=0)&&t.push("Monto Total"),($==="credito"||$==="parcial")&&(J||t.push("Tipo de Cliente"),J==="recurrente"&&!_e&&t.push("Cliente Seleccionado"),J==="nuevo"&&(Qe.trim()||t.push("Nombre del Cliente"),Se.trim()||t.push("Tel√©fono del Cliente"),Pe.trim()||t.push("Email del Cliente")),ws||t.push("Fecha de Vencimiento"),$==="parcial"&&((!Fe||parseFloat(Fe)<=0)&&t.push("Monto Abonado"),Ne&&Fe&&parseFloat(Fe)>=parseFloat(Ne)&&t.push("Monto Abonado debe ser menor al total"))),($==="contado"||$==="parcial")&&!js&&t.push("M√©todo de Pago"),$||t.push("Tipo de Pago"),t},H=t=>Zt().includes(t),sn=(t,a,l)=>{const i=[];return!Le||Le.length===0||Le.forEach(n=>{n.telefono&&t&&n.telefono.trim()===t.trim()&&i.push(`El tel√©fono ${t} ya est√° registrado para el cliente "${n.nombre}"`),n.email&&a&&n.email.trim().toLowerCase()===a.trim().toLowerCase()&&i.push(`El correo ${a} ya est√° registrado para el cliente "${n.nombre}"`),n.rfc&&l&&n.rfc.trim().toUpperCase()===l.trim().toUpperCase()&&i.push(`El RFC ${l} ya est√° registrado para el cliente "${n.nombre}"`)}),i};u.useEffect(()=>{if(J==="nuevo"&&(Se||Pe||$e)){const t=sn(Se,Pe,$e);_s(t)}else _s([])},[Se,Pe,$e,J,Le]),u.useEffect(()=>{(async()=>{var a;try{const l=await Ie("/api/ingresos/asientos-directos"),i=(l==null?void 0:l.asientos)??((a=l==null?void 0:l.data)==null?void 0:a.asientos)??l??[],n=null;if(!i)return;const s=i.filter(d=>d.detalle_asientos.some(c=>c.cuenta_codigo.startsWith("4")&&c.cuenta_codigo!=="4003"&&Number(c.haber)>0));Ma(s)}catch(l){console.error("Error al cargar asientos directos:",l)}})()},[]),u.useEffect(()=>{(async()=>{var a,l;try{let i,n;X==="diario"?(i=new Date(me),i.setHours(0,0,0,0),n=new Date(me),n.setHours(23,59,59,999)):X==="mensual"?(i=new Date(E.getFullYear(),E.getMonth(),1),n=new Date(E.getFullYear(),E.getMonth()+1,0,23,59,59,999)):(i=new Date(new Date().getFullYear(),0,1),n=new Date(new Date().getFullYear(),11,31,23,59,59,999));const s=await Ie(`/api/ingresos/asientos?start=${encodeURIComponent(i.toISOString().split("T")[0])}&end=${encodeURIComponent(n.toISOString().split("T")[0])}`),d=(s==null?void 0:s.asientos)??((a=s==null?void 0:s.data)==null?void 0:a.asientos)??[],c=(s==null?void 0:s.detalles)??((l=s==null?void 0:s.data)==null?void 0:l.detalles)??[],m=null;if(!d||d.length===0){kt({ventasBrutas:0,descuentos:0,ventasNetas:0,otrosIngresos:0,detallesPorPeriodo:[]});return}const r=d.map(y=>y.id);let o=0,x=0,g=0;const j={};d.forEach(y=>{const _=c.filter(B=>B.asiento_id===y.id),S=Ct(y.fecha);let z;X==="diario"?z="Hoy":X==="mensual"?z=`D√≠a ${S.getDate()}`:z=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"][S.getMonth()],j[z]||(j[z]={ventasBrutas:0,descuentos:0,otrosIngresos:0}),_.forEach(B=>{const U=B.debe||0,le=B.haber||0,he=B.cuenta_codigo;if(O==="ventas"){if(he==="4001"){const re=le-U;o+=re,j[z].ventasBrutas+=re}if(he==="4003"){const re=U-le;x+=re,j[z].descuentos+=re}}else if(he.startsWith("4")&&he!=="4001"&&he!=="4003"){const re=le-U;g+=re,j[z].otrosIngresos+=re}})});let f=[];if(X==="diario"){const y=j.Hoy||{ventasBrutas:0,descuentos:0,otrosIngresos:0};f=[{periodo:"Hoy",ventasBrutas:y.ventasBrutas,descuentos:y.descuentos,ventasNetas:y.ventasBrutas-y.descuentos,otrosIngresos:y.otrosIngresos}]}else if(X==="mensual"){const y=new Date(E.getFullYear(),E.getMonth()+1,0).getDate();f=Array.from({length:y},(_,S)=>{const B=`D√≠a ${S+1}`,U=j[B]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:B,ventasBrutas:U.ventasBrutas,descuentos:U.descuentos,ventasNetas:U.ventasBrutas-U.descuentos,otrosIngresos:U.otrosIngresos}})}else f=["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"].map(_=>{const S=j[_]||{ventasBrutas:0,descuentos:0,otrosIngresos:0};return{periodo:_,ventasBrutas:S.ventasBrutas,descuentos:S.descuentos,ventasNetas:S.ventasBrutas-S.descuentos,otrosIngresos:S.otrosIngresos}});kt({ventasBrutas:o,descuentos:x,ventasNetas:o-x,otrosIngresos:g,detallesPorPeriodo:f})}catch(i){console.error("Error calculando anal√≠ticas desde asientos:",i)}})()},[X,me,E,O]),u.useEffect(()=>{(async()=>{try{const l=async c=>{var B;const m=new Date;let r,o;if(c==="dia")r=me.toISOString().split("T")[0],o=r;else if(c==="mes"){const U=E.getMonth(),le=E.getFullYear(),he=new Date(le,U,1),re=new Date(le,U+1,0);r=he.toISOString().split("T")[0],o=re.toISOString().split("T")[0]}else{const U=m.getFullYear();r=`${U}-01-01`,o=`${U}-12-31`}const x=await Ie(`/api/ingresos/detalles?start=${encodeURIComponent(r)}&end=${encodeURIComponent(o)}`),g=(x==null?void 0:x.detalles)??((B=x==null?void 0:x.data)==null?void 0:B.detalles)??x??[],j=null;let f=0,y=0,_=0;(g||[]).forEach(U=>{const le=Number(U.debe)||0,he=Number(U.haber)||0,re=U.cuenta_codigo;re==="4001"?f+=he-le:re==="4003"?y+=le-he:re!=null&&re.startsWith("4")&&(_+=he-le)});const S=f-y,z=S+_;return{ventasBrutas:f,descuentos:y,ventasNetas:S,otrosIngresos:_,totalIngresos:z}},i=async()=>{var c;try{let m,r=new Date;X==="diario"?(m=new Date(me),m.setHours(0,0,0,0),r=new Date(me),r.setHours(23,59,59,999)):X==="mensual"?(m=new Date(E.getFullYear(),E.getMonth(),1),r=new Date(E.getFullYear(),E.getMonth()+1,0,23,59,59,999)):(m=new Date(E.getFullYear(),0,1),r=new Date(E.getFullYear(),11,31,23,59,59,999));const o=await Ie(`/api/inventario/movimientos?tipo=venta&start=${encodeURIComponent(m.toISOString())}&end=${encodeURIComponent(r.toISOString())}`),x=(o==null?void 0:o.movimientos)??((c=o==null?void 0:o.data)==null?void 0:c.movimientos)??o??[],g=null;Ps(x||[])}catch(m){console.error("Error en cargarMovimientosInventario:",m),Ps([])}},[n,s,d]=await Promise.all([l("dia"),l("mes"),l("ano")]);Aa(n),Ea(s),Va(d)}catch(l){console.error("Error calculando totales:",l)}})(),(async()=>{var l;try{let i,n=new Date;X==="diario"?(i=new Date(me),i.setHours(0,0,0,0),n=new Date(me),n.setHours(23,59,59,999)):X==="mensual"?(i=new Date(E.getFullYear(),E.getMonth(),1),n=new Date(E.getFullYear(),E.getMonth()+1,0,23,59,59,999)):(i=new Date(E.getFullYear(),0,1),n=new Date(E.getFullYear(),11,31,23,59,59,999));const s=await Ie(`/api/inventario/movimientos?tipo=venta&start=${encodeURIComponent(i.toISOString())}&end=${encodeURIComponent(n.toISOString())}`),d=(s==null?void 0:s.movimientos)??((l=s==null?void 0:s.data)==null?void 0:l.movimientos)??s??[],c=null;Ps(d||[])}catch(i){console.error("Error en loadMovimientos:",i),Ps([])}})()},[me,E,X,b]);const tn=async t=>{var l,i;const a=String(t??"").trim();if(Hs(!0),Fs(null),!a||a==="undefined"||a==="null"){Hs(!1);return}try{const n=await Ie(`/api/asientos/by-transaccion?source=ingreso&id=${encodeURIComponent(a)}`),s=(n==null?void 0:n.asiento)??((l=n==null?void 0:n.data)==null?void 0:l.asiento)??n??null;Fs(s)}catch(n){const s=String((n==null?void 0:n.message)??"");(n==null?void 0:n.status)===404||((i=n==null?void 0:n.response)==null?void 0:i.status)===404||s.includes("404")||(console.error("Error en loadAsientosContables:",n),ae({title:"Error",description:"Error inesperado al cargar asientos",variant:"destructive"})),Fs(null)}finally{Hs(!1)}},an=async()=>{var a;const t=Zt();if(t.length>0){ae({title:"‚ö†Ô∏è Campos requeridos faltantes",description:`Debes completar: ${t.join(", ")}`,variant:"destructive"});return}if(k==="inventariados"){if(K.length===0){ae({title:"‚ö†Ô∏è No hay productos",description:"Debes agregar al menos un producto del inventario a la venta",variant:"destructive"});return}for(const l of K)if(l.cantidad>l.stockDisponible){const i=De.find(n=>n.id===l.id);Ss({productName:l.nombre,requested:l.cantidad,available:l.stockDisponible,costoPorUnidad:(i==null?void 0:i.costo_unitario)||0,costoTotal:((i==null?void 0:i.costo_unitario)||0)*l.cantidad}),ss(!0);return}await Nt();return}if(k==="inventariados"&&ne){const l=parseFloat(Me||"1");if(l>Ds){const i=De.find(c=>c.id===ne);let n=(i==null?void 0:i.costo_unitario)||0;if(n===0){const c=await Ie(`/api/inventario/productos/${encodeURIComponent(ne)}/movimientos?tipo=compra`),m=(c==null?void 0:c.movimientos)??((a=c==null?void 0:c.data)==null?void 0:a.movimientos)??c??[];if(m&&m.length>0){let r=0,o=0;for(const x of m)x.costo_unitario>0&&x.cantidad>0&&(r+=x.costo_unitario*x.cantidad,o+=x.cantidad);o>0&&(n=r/o)}}const s=l-Ds,d=n*s;Ss({productName:(i==null?void 0:i.nombre)||"Producto",requested:l,available:Ds,costoPorUnidad:n,costoTotal:d}),ss(!0);return}}J==="nuevo"&&Ee.length>0&&!confirm(`Se detectaron posibles duplicados:

${Ee.join(`
`)}

¬øDeseas continuar registrando este cliente de todas formas?`)||await Nt()},Nt=async()=>{fs(!0);try{let t=null;if(J==="nuevo"&&Qe.trim())try{t=(await ya.mutateAsync({nombre:Qe.trim(),email:Pe.trim()||void 0,telefono:Se.trim()||void 0,rfc:$e.trim()||void 0})).id}catch(r){console.error("Error creating client:",r),ae({title:"Error al crear cliente",description:"No se pudo crear el cliente nuevo",variant:"destructive"}),fs(!1);return}else J==="recurrente"&&_e&&(t=_e);const a=De.find(r=>r.id===ne);let l=gs,i=Number(Ne||"0"),n=null,s=0;if(k==="precargados"&&Z.length>0){const r=se.find(g=>g.id===Z[0].id);n=(r==null?void 0:r.subcuenta_id)||null;const o=Z.reduce((g,j)=>g+j.precio*j.cantidad,0),x=Z.reduce((g,j)=>g+j.descuento,0);i=o,s=x,l=`Venta: ${Z.map(g=>`${g.nombre} (x${g.cantidad})`).join(", ")}`}else k==="inventariados"&&(l="Venta de productos inventariados",i=0,n=null);k!=="precargados"&&(s=wa?Number(_a||"0"):0);const d=Math.max(0,Number((i-s).toFixed(2)));let c=0,m=0;if($==="contado"?(c=d,m=0):$==="parcial"?(c=Number(Fe||"0"),m=Math.max(0,d-c)):$==="credito"&&(c=0,m=d),k==="inventariados"&&K.length>0){const r=K.reduce((f,y)=>f+y.precioUnitario*y.cantidad,0),o=K.reduce((f,y)=>f+y.descuento,0),x=r-o;let g=0,j=0;$==="contado"?(g=x,j=0):$==="parcial"?(g=Number(Fe||"0"),j=Math.max(0,x-g)):$==="credito"&&(g=0,j=x);for(const f of K){const y=De.find(he=>he.id===f.id);if(!y)continue;const _=K.length===1?`Venta de ${f.nombre}`:`Venta m√∫ltiple (${K.length} productos): ${f.nombre}`,S=f.subtotal/x,z=g*S,B=j*S,{data:U,error:le}=await wt("registrar-ingreso",{body:{tipoIngreso:"inventariados",descripcion:_,montoTotal:f.precioUnitario*f.cantidad,montoDescuento:f.descuento,cuentaPrincipalCodigo:"4001",subcuentaId:y.subcuenta_id||null,metodoPago:js,tipoPago:$,montoPagado:z,montoPendiente:B,clienteNombre:Qe.trim()||null,clienteTelefono:Se.trim()||null,clienteEmail:Pe.trim()||null,clienteRFC:$e.trim()||null,clienteId:t,fechaVencimiento:ws||null,comentarios:Cs.trim()||null,productoId:f.id,cantidadVendida:f.cantidad,precioVenta:f.precioUnitario,costoPersonalizado:Xe==="personalizado"&&ce?parseFloat(ce):void 0}});if(le)throw le}ae({title:"‚úÖ Venta registrada exitosamente",description:`Se registraron ${K.length} productos del inventario`,duration:5e3})}else{if(!l||i<=0){ae({title:"‚ö†Ô∏è Datos incompletos",description:"Selecciona un producto v√°lido o ingresa una descripci√≥n y monto.",variant:"destructive"}),fs(!1);return}const{data:r,error:o}=await wt("registrar-ingreso",{body:{tipoIngreso:k,descripcion:l,montoTotal:i,montoDescuento:s,cuentaPrincipalCodigo:k==="otros"?"4102":"4001",subcuentaId:n||void 0,metodoPago:js,tipoPago:$,montoPagado:c,montoPendiente:m,clienteNombre:Qe.trim()||null,clienteTelefono:Se.trim()||null,clienteEmail:Pe.trim()||null,clienteRFC:$e.trim()||null,clienteId:t,fechaVencimiento:ws||null,comentarios:Cs.trim()||null,...k==="inventariados"&&a&&{productoId:a.id,cantidadVendida:Number(Me||"1"),precioVenta:Number(We||"0"),costoPersonalizado:Xe==="personalizado"&&ce?Number(ce):void 0}}});if(o)throw o;ae({title:"Ingreso registrado",description:`Asiento ${r.numeroAsiento} creado correctamente`})}await Promise.all([w(),de()]),k==="inventariados"&&window.location.reload(),St(""),Je(""),Be(""),Sa(""),Ca(!1),Pt(""),Ft(""),It(""),Gs(""),vs(""),Ns(""),bs(""),ys(""),Tt(""),$t(""),Ys(""),_s([]),at(""),nt(""),rt("1"),As([]),Js(""),os(""),Qs("1"),Xs(0),Is(!0),Ts([]),st("0"),tt("monto")}catch(t){ae({title:"Error",description:t.message||"Error al registrar el ingreso",variant:"destructive"})}finally{fs(!1)}},nn=async()=>{if(!Ke||!Rs.trim()){ae({title:"‚ö†Ô∏è Motivo requerido",description:"Debes ingresar el motivo de la cancelaci√≥n",variant:"destructive"});return}Yt(!0);try{console.log("Cancelando transacci√≥n:",Ke.id);const{data:t,error:a}=await wt("cancelar-ingreso",{body:{transaccionId:Ke.id,motivoCancelacion:Rs.trim()}});if(console.log("Respuesta de edge function:",{data:t,error:a}),a)throw console.error("Error de edge function:",a),new Error(a.message||JSON.stringify(a));if(t!=null&&t.error)throw console.error("Error en data:",t),new Error(t.error);ae({title:"‚úì Transacci√≥n cancelada",description:`Asiento de reversi√≥n ${(t==null?void 0:t.numeroAsientoReversion)||"creado"} correctamente`}),await Promise.all([w(),de()]),mt(""),dt(null),Ms(!1)}catch(t){console.error("Error completo al cancelar:",t),ae({title:"‚ùå Error al cancelar",description:(t==null?void 0:t.message)||(t==null?void 0:t.toString())||"No se pudo cancelar la transacci√≥n",variant:"destructive"})}finally{Yt(!1)}},rn=t=>{switch(t){case"precargados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Oe,{children:[e.jsx(R,{className:"h-4 w-4"}),e.jsxs(ze,{children:[e.jsx("strong",{children:"Recordatorio:"}),' Para registrar ventas de productos precargados, primero debes agregar los productos al cat√°logo desde la pesta√±a "Cat√°logo de Productos".']})]}),e.jsxs(W,{className:"bg-muted/50",children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-base",children:"Agregar Productos a la Venta"})}),e.jsxs(Y,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"producto-precargado",children:"Seleccionar Producto"}),e.jsxs(pe,{value:Ge,onValueChange:en,children:[e.jsx(je,{children:e.jsx(ge,{placeholder:qs?"Cargando productos...":"Seleccionar producto del cat√°logo"})}),e.jsx(fe,{className:"max-h-80 z-50 bg-background border border-border w-full",children:qs?e.jsx(T,{value:"loading",disabled:!0,children:"Cargando productos..."}):se.length===0?e.jsx(T,{value:"empty",disabled:!0,children:"No hay productos de servicios registrados"}):se.map(a=>e.jsx(T,{value:a.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:a.imagen_url?e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(ye,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate mb-1",children:a.nombre}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["$",P(a.precio)]})]})]})},a.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cantidad",children:"Cantidad"}),e.jsx(V,{id:"cantidad",type:"number",placeholder:"1",min:"1",value:ks,onChange:a=>rt(a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"precio-unitario",children:"Precio Unitario"}),e.jsx(V,{id:"precio-unitario",type:"number",placeholder:"0.00",value:$s,readOnly:!0,className:"bg-muted"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"descuento-producto",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(be,{value:Ye,onValueChange:a=>za(a),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"monto",id:"descuento-monto"}),e.jsx(p,{htmlFor:"descuento-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"porcentaje",id:"descuento-porcentaje"}),e.jsx(p,{htmlFor:"descuento-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(V,{id:"descuento-producto",type:"number",placeholder:Ye==="porcentaje"?"0":"0.00",min:"0",max:Ye==="porcentaje"?"100":void 0,step:Ye==="porcentaje"?"1":"0.01",value:ot,onChange:a=>Ot(a.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Ye==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Subtotal con Descuento"}),e.jsx(V,{type:"text",value:Ge&&$s?(()=>{const a=parseFloat($s)*parseFloat(ks||"1"),l=parseFloat(ot||"0"),i=Ye==="porcentaje"?Math.max(0,a-a*l/100):Math.max(0,a-l);return`$${P(i)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(L,{type:"button",onClick:Ja,disabled:!Ge,className:"w-full",variant:"secondary",children:[e.jsx(yt,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),Z.length>0&&e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsxs(G,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",Z.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",P(Z.reduce((a,l)=>a+l.subtotal,0))]})]})}),e.jsx(Y,{children:e.jsx("div",{className:"space-y-2",children:Z.map((a,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:a.imagen_url?e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(ye,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:a.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[a.cantidad," x $",P(a.precio)," = $",P(a.cantidad*a.precio)]}),a.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",P(a.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",P(a.subtotal)]})]})]})]}),e.jsx(L,{type:"button",variant:"ghost",size:"sm",onClick:()=>Qa(a.id),className:"text-destructive hover:text-destructive",children:e.jsx(R,{className:"h-4 w-4"})})]},`${a.id}-${l}`))})})]}),H("Debe agregar al menos un producto")&&e.jsxs(Oe,{variant:"destructive",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx(ze,{children:"Debes agregar al menos un producto a la venta"})]})]});case"inventariados":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Oe,{children:[e.jsx(R,{className:"h-4 w-4"}),e.jsxs(ze,{children:[e.jsx("strong",{children:"Ventas desde Inventario:"})," Selecciona productos, aplica descuentos opcionales y agr√©galos a la venta. Si vendes m√°s de lo disponible, se te pedir√° confirmar la sobreventa."]})]}),e.jsxs(W,{className:"bg-muted/50",children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-base",children:"Agregar Productos del Inventario"})}),e.jsxs(Y,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"producto-inventario",children:"Seleccionar Producto"}),e.jsxs(pe,{value:ne,onValueChange:Ka,children:[e.jsx(je,{children:e.jsx(ge,{placeholder:ve?"Cargando inventario...":"Seleccionar producto del inventario"})}),e.jsx(fe,{className:"max-h-80 z-50 bg-background border border-border w-full",children:ve?e.jsx(T,{value:"loading",disabled:!0,children:"Cargando inventario..."}):De.length===0?e.jsx(T,{value:"empty",disabled:!0,children:"No hay productos con stock disponible"}):De.map(a=>e.jsx(T,{value:a.id,className:"py-3 px-3 h-auto",children:e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsx("div",{className:"w-10 h-10 rounded-md overflow-hidden bg-muted flex-shrink-0",children:a.imagen_url?e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(ye,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:a.nombre}),e.jsxs("span",{className:"text-xs bg-primary/10 text-primary px-2 py-0.5 rounded-full flex-shrink-0 ml-2",children:["Stock: ",a.cantidad_stock||0]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Costo: $",a.costo_unitario||0]}),a.precio_venta&&a.precio_venta>0?e.jsxs("span",{className:"text-xs text-green-600 font-medium",children:["Venta: $",a.precio_venta]}):e.jsx("span",{className:"text-xs text-orange-600 font-medium",children:"‚ö†Ô∏è Sin precio"})]})]})]})},a.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cantidad-inv",children:"Cantidad a Vender"}),e.jsx(V,{id:"cantidad-inv",type:"number",min:"1",value:Me,onChange:a=>Qs(a.target.value)}),ne&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Stock disponible: ",Ds," unidades"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"precio-inv",children:"Precio Unitario"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(be,{value:Zs?"registrado":"personalizado",onValueChange:a=>{const l=a==="registrado";if(Is(l),l&&ne){const i=De.find(n=>n.id===ne);if(i){const n=i.precio_venta||i.costo_unitario||0;os(n.toString())}}},className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"registrado",id:"precio-registrado"}),e.jsx(p,{htmlFor:"precio-registrado",className:"text-sm cursor-pointer",children:"Precio registrado"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"personalizado",id:"precio-personalizado"}),e.jsx(p,{htmlFor:"precio-personalizado",className:"text-sm cursor-pointer",children:"Personalizado"})]})]}),e.jsx(V,{id:"precio-inv",type:"number",step:"0.01",min:"0",value:We,onChange:a=>Ha(a.target.value),readOnly:Zs,className:Zs?"bg-muted":""})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"descuento-inv",children:"Descuento (opcional)"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(be,{value:qe,onValueChange:a=>tt(a),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"monto",id:"descuento-inv-monto"}),e.jsx(p,{htmlFor:"descuento-inv-monto",className:"cursor-pointer",children:"Monto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"porcentaje",id:"descuento-inv-porcentaje"}),e.jsx(p,{htmlFor:"descuento-inv-porcentaje",className:"cursor-pointer",children:"%"})]})]})}),e.jsx(V,{id:"descuento-inv",type:"number",placeholder:qe==="porcentaje"?"0":"0.00",min:"0",max:qe==="porcentaje"?"100":void 0,step:qe==="porcentaje"?"1":"0.01",value:et,onChange:a=>st(a.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:qe==="porcentaje"?"Descuento en porcentaje (0-100%)":"Descuento en monto fijo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{children:"Subtotal con Descuento"}),e.jsx(V,{type:"text",value:ne&&We?(()=>{const a=parseFloat(We)*parseFloat(Me||"1"),l=parseFloat(et||"0"),i=qe==="porcentaje"?Math.max(0,a-a*l/100):Math.max(0,a-l);return`$${P(i)}`})():"$0.00",readOnly:!0,className:"bg-muted font-medium"})]})]}),e.jsxs(L,{type:"button",onClick:Xa,disabled:!ne||!We,className:"w-full",variant:"secondary",children:[e.jsx(yt,{className:"h-4 w-4 mr-2"}),"Agregar Producto"]})]})]}),K.length>0&&e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsxs(G,{className:"text-base flex items-center justify-between",children:[e.jsxs("span",{children:["Productos en la Venta (",K.length,")"]}),e.jsxs("span",{className:"text-primary",children:["$",P(K.reduce((a,l)=>a+l.subtotal,0))]})]})}),e.jsx(Y,{children:e.jsx("div",{className:"space-y-2",children:K.map((a,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:a.imagen_url?e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-muted flex items-center justify-center",children:e.jsx(ye,{className:"w-5 h-5 text-muted-foreground"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:a.nombre}),e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[a.cantidad," x $",P(a.precioUnitario)," = $",P(a.cantidad*a.precioUnitario)]}),a.descuento>0&&e.jsxs("span",{className:"text-orange-600",children:["Descuento: -$",P(a.descuento)]}),e.jsxs("span",{className:"text-primary font-medium",children:["Total: $",P(a.subtotal)]}),e.jsxs("span",{className:"text-xs",children:["Stock disponible: ",a.stockDisponible]})]})]})]}),e.jsx(L,{type:"button",variant:"ghost",size:"sm",onClick:()=>Za(a.id),className:"text-destructive hover:text-destructive",children:e.jsx(R,{className:"h-4 w-4"})})]},`${a.id}-${l}`))})})]})]});case"general":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"descripcion-general",children:"Descripci√≥n del Ingreso"}),H("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(V,{id:"descripcion-general",placeholder:"Ej: Servicio de consultor√≠a",value:gs,onChange:a=>Je(a.target.value),className:H("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cuenta-contable",children:"Cuenta Contable"}),e.jsxs(pe,{defaultValue:"4001",children:[e.jsx(je,{children:e.jsx(ge,{placeholder:"4001 - Ventas"})}),e.jsx(fe,{children:e.jsx(T,{value:"4001",children:"4001 - Ventas"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"subcuenta",children:"Subcuenta (Opcional)"}),e.jsxs(pe,{children:[e.jsx(je,{children:e.jsx(ge,{placeholder:"Seleccionar subcuenta"})}),e.jsx(fe,{children:e.jsx(T,{value:"sub1",children:"Subcuenta ejemplo"})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"monto-general",children:"Monto"}),H("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(V,{id:"monto-general",type:"number",placeholder:"0.00",value:Ne,onChange:a=>Be(a.target.value),className:H("Monto Total")?"border-destructive":""})]})]});case"otros":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Oe,{children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx(ze,{children:"Este ingreso se ligar√° a la cuenta 4102 - Otros Productos."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"descripcion-otros",children:"Descripci√≥n del Ingreso Extraordinario"}),H("Descripci√≥n")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(es,{id:"descripcion-otros",placeholder:"Ej: Venta extraordinaria de equipo usado, donaci√≥n recibida, etc.",value:gs,onChange:a=>Je(a.target.value),className:H("Descripci√≥n")?"border-destructive":""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"monto-otros",children:"Monto"}),H("Monto Total")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(V,{id:"monto-otros",type:"number",placeholder:"0.00",value:Ne,onChange:a=>Be(a.target.value),className:H("Monto Total")?"border-destructive":""})]})]});default:return null}},on=async()=>{if(!ct.trim()||!lt.trim()){ae({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}Vs(!0);try{await Na.mutateAsync({nombre:ct.trim(),precio:parseFloat(lt),descripcion:Bt.trim()||void 0,subcuentaId:Wt||void 0,imagen:Ua||void 0}),zt(""),Lt(""),Ut(""),Ba("4001"),qt(""),Gt(null),it(!1)}catch{}finally{Vs(!1)}},ea=t=>{var a;Kt(t),ht(t.nombre),jt(((a=t.precio)==null?void 0:a.toString())||""),gt(t.descripcion||""),vt(t.imagen_url||null),ft(null),Xt(t.subcuenta_id||""),Os(!0)},cn=t=>{var l;const a=(l=t.target.files)==null?void 0:l[0];if(a){ft(a);const i=new FileReader;i.onloadend=()=>{vt(i.result)},i.readAsDataURL(a)}},ln=async()=>{if(!xt.trim()||!pt.trim()){ae({title:"Error",description:"El nombre y precio del producto son obligatorios",variant:"destructive"});return}Vs(!0);try{await ba.mutateAsync({id:Ga.id,nombre:xt.trim(),precio:parseFloat(pt),descripcion:Ht.trim()||void 0,imagen:Ya||void 0,subcuentaId:Qt||null}),Os(!1),Kt(null),ht(""),jt(""),gt(""),ft(null),vt(null)}catch{}finally{Vs(!1)}};return e.jsxs("div",{className:"h-full overflow-hidden flex flex-col",children:[e.jsx(is,{open:Pa,onOpenChange:ss,children:e.jsxs(cs,{children:[e.jsxs(ls,{children:[e.jsxs(ds,{className:"flex items-center gap-2 text-orange-600",children:[e.jsx(R,{className:"h-5 w-5"}),"Advertencia: Inventario Insuficiente"]}),e.jsxs(ms,{className:"space-y-3 pt-4",children:[e.jsxs("div",{className:"p-4 bg-orange-50 dark:bg-orange-950/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[e.jsx("p",{className:"font-medium mb-2",children:"Est√°s a punto de vender un producto sin suficiente inventario:"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Producto:"}),e.jsx("span",{className:"font-medium",children:N==null?void 0:N.productName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cantidad solicitada:"}),e.jsx("span",{className:"font-medium",children:N==null?void 0:N.requested})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Stock disponible:"}),e.jsx("span",{className:"font-medium",children:N==null?void 0:N.available})]}),e.jsx(Re,{}),e.jsxs("div",{className:"flex justify-between text-orange-600",children:[e.jsx("span",{className:"font-medium",children:"Faltante:"}),e.jsx("span",{className:"font-bold",children:((N==null?void 0:N.requested)||0)-((N==null?void 0:N.available)||0)})]})]})]}),(N==null?void 0:N.costoPorUnidad)&&N.costoPorUnidad>0&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border-2 border-blue-300 dark:border-blue-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(sa,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"}),e.jsx("p",{className:"font-bold text-blue-700 dark:text-blue-300",children:"üìä Costo Promedio Hist√≥rico"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Costo promedio calculado:"}),e.jsxs("span",{className:"text-lg font-bold text-blue-700 dark:text-blue-300",children:["$",P(N.costoPorUnidad)," por unidad"]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Este costo se calcul√≥ autom√°ticamente del promedio ponderado de todas tus compras anteriores de este producto. Puedes usar este costo sugerido o ingresar uno personalizado si conoces el costo real de esta venta."})]})]}),e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("p",{className:"font-medium mb-3 text-blue-700 dark:text-blue-400",children:"Impacto en el inventario:"}),N!=null&&N.costoPorUnidad&&N.costoPorUnidad>0?e.jsxs(e.Fragment,{children:[e.jsxs(be,{value:Xe,onValueChange:t=>{Ks(t),t==="historico"&&ts("")},className:"space-y-3 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"historico",id:"costo-historico"}),e.jsxs(p,{htmlFor:"costo-historico",className:"text-sm cursor-pointer",children:["Usar costo hist√≥rico: ",e.jsxs("strong",{className:"text-blue-700 dark:text-blue-400",children:["$",P(N.costoPorUnidad)]})," por unidad"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"personalizado",id:"costo-personalizado"}),e.jsx(p,{htmlFor:"costo-personalizado",className:"text-sm cursor-pointer",children:"Ingresar costo personalizado"})]})]}),Xe==="personalizado"&&e.jsxs("div",{className:"mb-3",children:[e.jsx(p,{htmlFor:"costo-custom",className:"text-xs",children:"Costo unitario personalizado"}),e.jsx(V,{id:"costo-custom",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:ce,onChange:t=>ts(t.target.value),className:"mt-1"})]}),e.jsx(Re,{className:"my-3"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Costo por unidad aplicado:"}),e.jsxs("span",{className:"font-medium",children:["$",P(Xe==="personalizado"&&ce?ce:N.costoPorUnidad)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",P((Xe==="personalizado"&&ce?Number(ce):N.costoPorUnidad)*(((N==null?void 0:N.requested)||0)-((N==null?void 0:N.available)||0)))]})]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400",children:"‚ö†Ô∏è Este producto no tiene costo hist√≥rico registrado."}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"costo-requerido",className:"text-xs",children:"Ingresa el costo unitario para esta transacci√≥n"}),e.jsx(V,{id:"costo-requerido",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:ce,onChange:t=>ts(t.target.value),className:"mt-1"})]}),ce&&Number(ce)>0&&e.jsxs(e.Fragment,{children:[e.jsx(Re,{}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Valor inventario negativo:"}),e.jsxs("span",{className:"font-bold text-destructive",children:["-$",P(Number(ce)*(((N==null?void 0:N.requested)||0)-((N==null?void 0:N.available)||0)))]})]})]})]})]}),e.jsxs("p",{className:"text-sm",children:["Si contin√∫as, el inventario quedar√° en ",e.jsxs("strong",{className:"text-destructive",children:["negativo (",((N==null?void 0:N.available)||0)-((N==null?void 0:N.requested)||0)," unidades)"]}),". Esto se reflejar√° en tu control de inventario con el valor mostrado arriba."]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"¬øDeseas continuar con la venta de todas formas?"})]})]}),e.jsxs(zs,{className:"gap-2 sm:gap-0",children:[e.jsx(L,{variant:"outline",onClick:()=>{ss(!1),Ss(null),Ks("historico"),ts("")},children:"Cancelar"}),e.jsxs(L,{variant:"destructive",onClick:async()=>{if((!(N!=null&&N.costoPorUnidad)||N.costoPorUnidad===0)&&(!ce||Number(ce)<=0)){ae({title:"Costo requerido",description:"Debes ingresar un costo unitario para continuar",variant:"destructive"});return}ss(!1),Ss(null),await Nt(),Ks("historico"),ts("")},children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Continuar con la Venta"]})]})]})}),e.jsxs("div",{className:"p-6 border-b bg-background",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Registro de Ingresos"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Registra ventas, gestiona cat√°logos y analiza ingresos de la empresa"})]}),e.jsxs("div",{className:"flex-1 overflow-auto p-6",children:[e.jsxs(yn,{defaultValue:"registro",className:"w-full",children:[e.jsxs(wn,{className:"grid w-full grid-cols-4",children:[e.jsx(Ls,{value:"registro",children:"Registro de Ingresos"}),e.jsx(Ls,{value:"resumen",children:"Resumen de Ventas"}),e.jsx(Ls,{value:"analitica",children:"Anal√≠tica de Ventas"}),e.jsx(Ls,{value:"catalogo",children:"Cat√°logo de Productos"})]}),e.jsx(Bs,{value:"registro",className:"mt-6 space-y-6",children:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Nuevo Registro de Ingreso"}),e.jsx(oe,{children:"Selecciona el tipo de ingreso y completa la informaci√≥n requerida"})]}),e.jsxs(Y,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(p,{className:"text-base font-semibold",children:"Tipo de Ingreso"}),e.jsx(be,{value:k,onValueChange:St,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50",children:[e.jsx(A,{value:"precargados",id:"precargados"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ta,{className:"h-5 w-5 text-primary"}),e.jsx(p,{htmlFor:"precargados",className:"cursor-pointer flex-1",children:e.jsx("div",{className:"font-medium",children:"Productos Precargados"})})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50",children:[e.jsx(A,{value:"inventariados",id:"inventariados"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"h-5 w-5 text-primary"}),e.jsxs(p,{htmlFor:"inventariados",className:"cursor-pointer flex-1",children:[e.jsx("div",{className:"font-medium",children:"Productos Inventariados"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Del inventario registrado"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50",children:[e.jsx(A,{value:"general",id:"general"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(bt,{className:"h-5 w-5 text-primary"}),e.jsxs(p,{htmlFor:"general",className:"cursor-pointer flex-1",children:[e.jsx("div",{className:"font-medium",children:"Ingreso General"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Operaci√≥n no inventariada"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 p-4 border rounded-lg hover:bg-muted/50",children:[e.jsx(A,{value:"otros",id:"otros"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($n,{className:"h-5 w-5 text-primary"}),e.jsxs(p,{htmlFor:"otros",className:"cursor-pointer flex-1",children:[e.jsx("div",{className:"font-medium",children:"Otros Ingresos"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Extraordinarios, donaciones"})]})]})]})]})})]}),k&&e.jsxs("div",{className:"space-y-6 p-4 border rounded-lg bg-muted/20",children:[rn(k),e.jsx(Re,{}),e.jsx("div",{className:"space-y-4",children:(k==="precargados"&&Ge||k==="inventariados"&&ne)&&e.jsxs("div",{className:"p-4 bg-blue-50 dark:bg-blue-950/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsx("h4",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"C√°lculo Autom√°tico"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Cantidad:"}),e.jsx("span",{children:k==="precargados"?ks:Me})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Precio Unitario:"}),e.jsxs("span",{children:["$",k==="precargados"?$s:We]})]}),e.jsx(Re,{}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",Ne]})]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{className:"font-medium",children:"Estado del Pago"}),H("Tipo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(be,{value:$,onValueChange:Ft,className:H("Tipo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{value:"contado",id:"contado"}),e.jsx(p,{htmlFor:"contado",className:"cursor-pointer",children:"Pago Total"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{value:"parcial",id:"parcial"}),e.jsx(p,{htmlFor:"parcial",className:"cursor-pointer",children:"Pago parcial"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{value:"credito",id:"credito"}),e.jsx(p,{htmlFor:"credito",className:"cursor-pointer",children:"Adeudo Total"})]})]}),$==="parcial"&&e.jsxs("div",{className:"ml-6 p-4 border rounded-lg bg-blue-50 dark:bg-blue-950/20 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"monto-abonado",children:"Monto que se va a pagar"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Monto Abonado")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(V,{id:"monto-abonado",type:"number",step:"0.01",placeholder:"0.00",value:Fe,onChange:t=>$t(t.target.value),className:H("Monto Abonado")?"border-destructive":""})]}),Ne&&Fe&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-3 bg-white dark:bg-gray-900 rounded border",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total de la venta"}),e.jsxs("p",{className:"text-lg font-semibold text-primary",children:["$",P(Ne)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Se pagar√° ahora"}),e.jsxs("p",{className:"text-lg font-semibold text-green-600",children:["$",P(Fe)]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Queda pendiente"}),e.jsxs("p",{className:"text-lg font-semibold text-orange-600",children:["$",P(parseFloat(Ne)-parseFloat(Fe))]})]})]})]})]}),e.jsx(Re,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(us,{className:"h-5 w-5"}),e.jsx(p,{className:"font-medium",children:"Datos del Cliente"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:$==="contado"?"Opcional - Para anal√≠ticas y comentarios":"Obligatorio para cuentas por cobrar"})]}),$==="contado"&&e.jsxs(Oe,{children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx(ze,{children:"Asignar cliente es opcional para pagos totales. √ötil para anal√≠ticas de ventas y seguimiento de clientes."})]}),($==="parcial"||$==="credito")&&e.jsxs(Oe,{children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx(ze,{children:"Se registrar√° en Cuentas por Cobrar para an√°lisis de vencimientos"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{className:"font-medium",children:"Tipo de Cliente"}),e.jsxs(pe,{value:J,onValueChange:t=>{It(t),Gs(""),vs(""),Ns(""),bs(""),ys(""),_s([])},children:[e.jsx(je,{children:e.jsx(ge,{placeholder:$==="contado"?"Opcional - Selecciona para anal√≠ticas":"Selecciona el tipo de cliente"})}),e.jsxs(fe,{children:[e.jsx(T,{value:"nuevo",children:"Cliente Nuevo"}),e.jsx(T,{value:"recurrente",children:"Cliente Recurrente"})]})]})]}),J==="recurrente"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cliente-existente",children:"Seleccionar Cliente"}),e.jsxs(pe,{value:_e,onValueChange:t=>{Gs(t);const a=Le.find(l=>l.id===t);a&&(vs(a.nombre),Ns(a.telefono||""),bs(a.email||""),ys(a.rfc||""))},children:[e.jsx(je,{children:e.jsx(ge,{placeholder:"Buscar cliente existente"})}),e.jsx(fe,{children:va?e.jsx("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:"Cargando clientes..."}):Le.length===0?e.jsx("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:"No hay clientes registrados"}):Le.map(t=>e.jsx(T,{value:t.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.nombre}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.telefono&&`Tel: ${t.telefono}`,t.email&&` ‚Ä¢ Email: ${t.email}`,t.source==="transaction"&&" ‚Ä¢ (De transacci√≥n)"]})]})},t.id))})]}),_e&&e.jsx("p",{className:"text-xs text-muted-foreground text-green-600",children:"‚úì Datos del cliente cargados autom√°ticamente"})]}),(J==="nuevo"||J==="recurrente"&&_e)&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cliente-nombre",children:"Nombre del Cliente"}),e.jsx(V,{id:"cliente-nombre",type:"text",placeholder:"Nombre completo",value:Qe,onChange:t=>vs(t.target.value),disabled:J==="recurrente"&&_e!==""})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"cliente-telefono",children:"N√∫mero de Tel√©fono"}),($==="parcial"||$==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Tel√©fono del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(V,{id:"cliente-telefono",type:"tel",placeholder:"Ej: +52 55 1234 5678",value:Se,onChange:t=>Ns(t.target.value),className:H("Tel√©fono del Cliente")?"border-destructive":"",disabled:J==="recurrente"&&_e!==""}),J==="nuevo"&&Ee.some(t=>t.includes(Se)&&t.includes("tel√©fono"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Ee.find(t=>t.includes(Se)&&t.includes("tel√©fono"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"cliente-email",children:"Correo Electr√≥nico"}),($==="parcial"||$==="credito")&&e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Email del Cliente")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(V,{id:"cliente-email",type:"email",placeholder:"cliente@ejemplo.com",value:Pe,onChange:t=>bs(t.target.value),className:H("Email del Cliente")?"border-destructive":"",disabled:J==="recurrente"&&_e!==""}),J==="nuevo"&&Ee.some(t=>t.includes(Pe)&&t.includes("correo"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Ee.find(t=>t.includes(Pe)&&t.includes("correo"))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"cliente-rfc",children:"RFC (ID Fiscal) - Opcional"}),e.jsx(V,{id:"cliente-rfc",type:"text",placeholder:"RFC123456ABC1",value:$e,onChange:t=>ys(t.target.value.toUpperCase()),maxLength:13,disabled:J==="recurrente"&&_e!==""}),J==="nuevo"&&Ee.some(t=>t.includes($e)&&t.includes("RFC"))&&e.jsxs("div",{className:"flex items-center text-amber-600 bg-amber-50 p-2 rounded",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Ee.find(t=>t.includes($e)&&t.includes("RFC"))})]})]}),($==="parcial"||$==="credito")&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{htmlFor:"fecha-vencimiento",children:"Fecha de Vencimiento"}),e.jsx("span",{className:"text-destructive text-sm",children:"*"}),H("Fecha de Vencimiento")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsx(V,{id:"fecha-vencimiento",type:"date",value:ws,onChange:t=>Tt(t.target.value),className:H("Fecha de Vencimiento")?"border-destructive":"",min:new Date().toISOString().split("T")[0]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Fecha l√≠mite para el pago ",$==="parcial"?"del monto pendiente":"completo"]})]}),$==="contado"&&J&&e.jsxs("div",{className:"col-span-full space-y-2",children:[e.jsx(p,{htmlFor:"comentario-venta",children:"Comentarios de la venta (Opcional)"}),e.jsx(es,{id:"comentario-venta",placeholder:"Detalles adicionales sobre esta venta, preferencias del cliente, etc.",value:Cs,onChange:t=>Ys(t.target.value),rows:2}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Informaci√≥n √∫til para futuras ventas y an√°lisis del cliente"})]})]})]}),e.jsx(Re,{}),($==="contado"||$==="parcial")&&e.jsxs(e.Fragment,{children:[e.jsx(Re,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{className:"font-medium",children:"M√©todo de Pago"}),H("M√©todo de Pago")&&e.jsxs("div",{className:"flex items-center text-destructive",children:[e.jsx(R,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-xs",children:"Requerido"})]})]}),e.jsxs(be,{value:js,onValueChange:Pt,className:H("M√©todo de Pago")?"border border-destructive rounded-lg p-2":"",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{value:"efectivo",id:"efectivo"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Cn,{className:"h-4 w-4 text-green-600"}),e.jsxs(p,{htmlFor:"efectivo",className:"cursor-pointer",children:["Efectivo ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Caja)"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(A,{value:"tarjeta",id:"tarjeta"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_n,{className:"h-4 w-4 text-blue-800"}),e.jsxs(p,{htmlFor:"tarjeta",className:"cursor-pointer",children:["Tarjeta ",e.jsx("span",{className:"text-sm text-muted-foreground",children:"(se registra en Bancos)"})]})]})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"comentarios",children:"Comentarios de la venta (Opcional)"}),e.jsx(es,{id:"comentarios",placeholder:"Agrega cualquier comentario o nota sobre esta venta...",value:Cs,onChange:t=>Ys(t.target.value),rows:3,className:"resize-none"})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(L,{size:"lg",className:"px-8",onClick:an,disabled:Dt,children:[e.jsx(sa,{className:"mr-2 h-4 w-4"}),Dt?"Registrando...":"Registrar Ingreso"]})})]})]})]})}),e.jsx(Bs,{value:"resumen",className:"mt-6",children:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Registro Detallado de Ventas"}),e.jsx(oe,{children:"Historial completo de transacciones de ingresos"})]}),e.jsxs(Y,{children:[e.jsxs("div",{className:"mb-6 p-4 border rounded-lg bg-muted/30 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"filtro-fecha-inicio",children:"Fecha Inicio"}),e.jsx(V,{id:"filtro-fecha-inicio",type:"date",value:ke,onChange:t=>At(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"filtro-fecha-fin",children:"Fecha Fin"}),e.jsx(V,{id:"filtro-fecha-fin",type:"date",value:Ae,onChange:t=>Et(t.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"filtro-tipo",children:"Tipo de Ingreso"}),e.jsxs(pe,{value:ue,onValueChange:Vt,children:[e.jsx(je,{id:"filtro-tipo",children:e.jsx(ge,{placeholder:"Todos"})}),e.jsxs(fe,{children:[e.jsx(T,{value:"todos",children:"Todos"}),e.jsx(T,{value:"precargados",children:"Precargados"}),e.jsx(T,{value:"inventariados",children:"Inventariados"}),e.jsx(T,{value:"general",children:"General"}),e.jsx(T,{value:"otros",children:"Otros"}),e.jsx(T,{value:"asiento_directo",children:"Asientos Directos"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"filtro-cuenta",children:"Cuenta"}),e.jsxs(pe,{value:xe,onValueChange:Mt,children:[e.jsx(je,{id:"filtro-cuenta",children:e.jsx(ge,{placeholder:"Todas"})}),e.jsxs(fe,{children:[e.jsx(T,{value:"todas",children:"Todas"}),e.jsx(T,{value:"4001",children:"4001 - Ventas"}),e.jsx(T,{value:"4004",children:"4004 - Ventas Inventarios"}),e.jsx(T,{value:"4101",children:"4101 - Productos Financieros"}),e.jsx(T,{value:"4102",children:"4102 - Otros Productos"}),e.jsx(T,{value:"4103",children:"4103 - Ganancia en Venta de Activos"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"filtro-subcuenta",children:"Subcuenta"}),e.jsxs(pe,{value:te,onValueChange:Rt,children:[e.jsx(je,{id:"filtro-subcuenta",children:e.jsx(ge,{placeholder:"Todas"})}),e.jsxs(fe,{children:[e.jsx(T,{value:"todas",children:"Todas"}),e.jsx(T,{value:"sin-subcuenta",children:"Sin subcuenta"}),ee.map(t=>e.jsx(T,{value:t.id,children:t.nombre},t.id))]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 border-t",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>{At(""),Et(""),Vt("todos"),Mt("todas"),Rt("")},children:"Limpiar Filtros"}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Resultados: ",(()=>{const t=Ve.map(n=>{const s=n.detalle_asientos.find(d=>d.cuenta_codigo.startsWith("4")&&Number(d.haber)>0);return{created_at:n.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(s==null?void 0:s.cuenta_codigo)||"",subcuenta_id:s==null?void 0:s.subcuenta_id}});return[...b??[],...t??[]].map(ga).filter(n=>{const s=(!ke||new Date(n.created_at)>=new Date(ke))&&(!Ae||new Date(n.created_at)<=new Date(Ae+"T23:59:59")),d=!ue||ue==="todos"||n.tipo_ingreso===ue,c=!xe||xe==="todas"||n.cuenta_principal_codigo===xe,m=!te||te==="todas"||te==="sin-subcuenta"&&!n.subcuenta_id||n.subcuenta_id===te;return s&&d&&c&&m}).length})()]}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["Total: $",(()=>{const t=Ve.map(i=>{const n=i.detalle_asientos.find(s=>s.cuenta_codigo.startsWith("4")&&Number(s.haber)>0);return{created_at:i.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(n==null?void 0:n.cuenta_codigo)||"",subcuenta_id:n==null?void 0:n.subcuenta_id,monto_total:Number(n==null?void 0:n.haber)||0}}),l=[...b,...t].filter(i=>{const n=(!ke||new Date(i.created_at)>=new Date(ke))&&(!Ae||new Date(i.created_at)<=new Date(Ae+"T23:59:59")),s=!ue||ue==="todos"||i.tipo_ingreso===ue,d=!xe||xe==="todas"||i.cuenta_principal_codigo===xe,c=!te||te==="todas"||te==="sin-subcuenta"&&!i.subcuenta_id||i.subcuenta_id===te;return n&&s&&d&&c});return P(l.reduce((i,n)=>i+n.monto_total,0))})()]}),e.jsxs("p",{className:"text-sm font-medium text-green-600",children:["Neto: $",(()=>{const t=Ve.map(i=>{const n=i.detalle_asientos.find(s=>s.cuenta_codigo.startsWith("4")&&Number(s.haber)>0);return{created_at:i.fecha,tipo_ingreso:"asiento_directo",cuenta_principal_codigo:(n==null?void 0:n.cuenta_codigo)||"",subcuenta_id:n==null?void 0:n.subcuenta_id,monto_neto:Number(n==null?void 0:n.haber)||0}}),l=[...b,...t].filter(i=>{const n=(!ke||new Date(i.created_at)>=new Date(ke))&&(!Ae||new Date(i.created_at)<=new Date(Ae+"T23:59:59")),s=!ue||ue==="todos"||i.tipo_ingreso===ue,d=!xe||xe==="todas"||i.cuenta_principal_codigo===xe,c=!te||te==="todas"||te==="sin-subcuenta"&&!i.subcuenta_id||i.subcuenta_id===te;return n&&s&&d&&c});return P(l.reduce((i,n)=>i+n.monto_neto,0))})()]})]})]})]}),I?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando transacciones..."}):(()=>{const t=Ve.map(n=>{const s=n.detalle_asientos.find(d=>d.cuenta_codigo.startsWith("4")&&Number(d.haber)>0);return{id:n.id,descripcion:n.descripcion,monto_total:Number(s==null?void 0:s.haber)||0,monto_neto:Number(s==null?void 0:s.haber)||0,monto_descuento:0,monto_pagado:Number(s==null?void 0:s.haber)||0,monto_pendiente:0,tipo_ingreso:"asiento_directo",metodo_pago:"N/A",tipo_pago:"contado",cuenta_principal_codigo:(s==null?void 0:s.cuenta_codigo)||"",subcuenta_id:s==null?void 0:s.subcuenta_id,created_at:n.fecha,asiento_fecha:n.fecha,es_asiento_directo:!0,estado:"activo"}}),i=[...b,...t].filter(n=>{const s=(!ke||new Date(n.created_at)>=new Date(ke))&&(!Ae||new Date(n.created_at)<=new Date(Ae+"T23:59:59")),d=!ue||ue==="todos"||n.tipo_ingreso===ue,c=!xe||xe==="todas"||n.cuenta_principal_codigo===xe,m=!te||te==="todas"||te==="sin-subcuenta"&&!n.subcuenta_id||n.subcuenta_id===te;return s&&d&&c&&m}).filter(n=>!n.descripcion.includes("CANCELACI√ìN:")).map(n=>{const s=n.estado==="cancelado";let d=null;return s&&n.transaccion_cancelacion_id&&(d=b.find(c=>c.id===n.transaccion_cancelacion_id)),{...n,esCancelada:s,transaccionReversion:d}});return i.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay transacciones que coincidan con los filtros"}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm font-medium text-muted-foreground mb-4",children:["Mostrando ",i.length," transacci√≥n(es)"]}),e.jsx("div",{className:"space-y-3",children:i.map(n=>{var m,r,o,x,g;const s=n,d=n.esCancelada,c=!1;return e.jsxs("div",{className:`border rounded-lg p-4 ${d?"bg-red-50 dark:bg-red-950/20 border-red-300 dark:border-red-800":"hover:bg-muted/50"}`,children:[e.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[s.es_asiento_directo&&e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-purple-100 dark:bg-purple-900/30 flex-shrink-0 flex items-center justify-center",children:e.jsx(bt,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),!s.es_asiento_directo&&(s.tipo_ingreso==="precargados"||s.tipo_ingreso==="inventariados")&&(()=>{const j=s.descripcion.replace("Venta de ","").replace("Venta: ",""),y=[...se,...Ce].find(_=>_.nombre===s.descripcion||_.nombre===j||s.descripcion.includes(_.nombre));return y!=null&&y.imagen_url?e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0",children:e.jsx("img",{src:y.imagen_url,alt:y.nombre,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted flex-shrink-0 flex items-center justify-center",children:e.jsx(ye,{className:"w-5 h-5 text-muted-foreground"})})})(),e.jsxs("div",{className:"flex justify-between items-start flex-1",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("p",{className:"font-medium",children:s.descripcion}),s.es_asiento_directo&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-700 dark:text-purple-200",children:"üìã Asiento Directo"}),d&&e.jsx("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-200",children:"‚ùå Cancelada"}),c,e.jsxs(is,{onOpenChange:j=>{if(j){const f=String(s._id??s.id??"");tn(f)}else Fs(null)},children:[e.jsx(aa,{asChild:!0,children:e.jsx(L,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",children:e.jsx(bt,{className:"h-3 w-3"})})}),e.jsxs(cs,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ls,{children:[e.jsx(ds,{children:"Detalles de la Transacci√≥n"}),e.jsx(ms,{children:"Informaci√≥n completa y asientos contables en balanza"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Informaci√≥n General"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",s.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",s.tipo_ingreso]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"M√©todo de Pago:"})," ",s.metodo_pago||"N/A"]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo de Pago:"})," ",s.tipo_pago]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(s.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm",children:"Montos"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Total:"})," $",P(s.monto_total)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descuento:"})," $",P(s.monto_descuento)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Neto:"})," $",P(s.monto_neto)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pagado:"})," $",P(s.monto_pagado||0)]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pendiente:"})," $",P(s.monto_pendiente||0)]})]})]})]}),(s.cliente_nombre||s.cliente_telefono||s.cliente_email)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n del Cliente"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.cliente_nombre&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",s.cliente_nombre]}),s.cliente_telefono&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tel√©fono:"})," ",s.cliente_telefono]}),s.cliente_email&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",s.cliente_email]}),s.cliente_rfc&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"RFC:"})," ",s.cliente_rfc]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Informaci√≥n Contable"}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Cuenta Principal:"})," ",s.cuenta_principal_codigo," - ",s.cuenta_principal_codigo==="4001"?"Ventas":s.cuenta_principal_codigo==="4004"?"Otros Ingresos":""]}),s.subcuenta_id?e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," ",((m=s.subcuentas)==null?void 0:m.nombre)||(()=>{const j=ee.find(f=>f.id===s.subcuenta_id);return(j==null?void 0:j.nombre)||"Subcuenta no encontrada"})()]}):e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," Sin subcuenta asignada"]})]})]}),s.comentarios&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-sm mb-2",children:"Comentarios"}),e.jsx("div",{className:"p-3 bg-muted rounded-md",children:e.jsx("p",{className:"text-sm",children:s.comentarios})})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsx("h4",{className:"font-semibold text-sm mb-3",children:"Asientos en Balanza de Comprobaci√≥n"}),Oa?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando asientos contables..."}):Ue?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-muted rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"N√∫mero de Asiento:"})," ",Ue.numero_asiento]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(Ue.fecha).toLocaleDateString("es-ES")]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",Ue.descripcion]})]})}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Cuenta"}),e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:"Descripci√≥n"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Debe"}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:"Haber"})]})}),e.jsxs("tbody",{children:[(r=Ue.detalles)==null?void 0:r.map((j,f)=>e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"p-3 text-sm",children:[e.jsx("div",{className:"font-medium",children:j.cuenta_codigo}),e.jsx("div",{className:"text-xs text-muted-foreground",children:j.cuenta_nombre})]}),e.jsx("td",{className:"p-3 text-sm",children:j.descripcion}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:j.debe>0?`$${P(j.debe)}`:"-"}),e.jsx("td",{className:"p-3 text-sm text-right font-medium",children:j.haber>0?`$${P(j.haber)}`:"-"})]},f)),e.jsxs("tr",{className:"border-t-2 bg-muted/50 font-bold",children:[e.jsx("td",{colSpan:2,className:"p-3 text-sm",children:"TOTALES"}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",P((o=Ue.detalles)==null?void 0:o.reduce((j,f)=>j+Number(f.debe),0))]}),e.jsxs("td",{className:"p-3 text-sm text-right",children:["$",P((x=Ue.detalles)==null?void 0:x.reduce((j,f)=>j+Number(f.haber),0))]})]})]})]})}),e.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/30 rounded-md text-sm",children:[e.jsx("p",{className:"font-medium text-blue-700 dark:text-blue-300 mb-1",children:"üí° Informaci√≥n"}),e.jsx("p",{className:"text-blue-600 dark:text-blue-400",children:"Este asiento contable refleja c√≥mo esta transacci√≥n afecta a las diferentes cuentas en la balanza de comprobaci√≥n y posteriormente en los estados financieros."})]})]}):e.jsx("div",{className:"p-4 bg-muted/50 rounded-lg text-sm text-muted-foreground text-center",children:"No se encontraron asientos contables para esta transacci√≥n"})]})]})]})]})]}),s.comentarios&&e.jsxs("div",{className:"mt-1 p-2 bg-blue-50 dark:bg-blue-950/30 rounded text-xs",children:[e.jsx("span",{className:"font-medium text-blue-700 dark:text-blue-300",children:"üí¨ "}),e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:s.comentarios.length>50?`${s.comentarios.substring(0,50)}...`:s.comentarios})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mt-1",children:[e.jsx("span",{className:"capitalize",children:s.tipo_ingreso}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{className:"capitalize",children:s.metodo_pago}),e.jsx("span",{children:"‚Ä¢"}),e.jsx("span",{className:"capitalize",children:s.tipo_pago})]}),e.jsxs("div",{className:"mt-2 p-2 bg-muted/30 rounded-md",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Informaci√≥n Contable:"}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Cuenta Principal:"})," ",s.cuenta_principal_codigo,s.cuenta_principal_codigo==="4001"?" - Ventas":s.cuenta_principal_codigo==="4004"?" - Otros Ingresos":""]}),s.subcuenta_id?e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," ",((g=s.subcuentas)==null?void 0:g.nombre)||(()=>{const j=ee.find(f=>f.id===s.subcuenta_id);return(j==null?void 0:j.nombre)||"Subcuenta no encontrada"})()]}):e.jsxs("div",{className:"text-muted-foreground",children:[e.jsx("span",{className:"font-medium",children:"Subcuenta:"})," Sin subcuenta asignada"]})]})]})]}),e.jsxs("div",{className:"text-right ml-4 flex flex-col gap-2 items-end",children:[e.jsxs("p",{className:"font-bold text-primary",children:["$",P(s.monto_total)]}),s.monto_descuento>0&&e.jsxs("p",{className:"text-sm text-red-600",children:["-$",P(s.monto_descuento)," desc."]}),!d&&!c&&e.jsx(L,{variant:"outline",size:"sm",className:"mt-2 text-xs border-red-300 text-red-600 hover:bg-red-50 dark:border-red-800 dark:text-red-400 dark:hover:bg-red-950/30",onClick:()=>{dt(s),Ms(!0)},children:"‚ùå Cancelar"})]})]})]}),d&&s.motivo_cancelacion&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"p-3 bg-red-100 dark:bg-red-950/40 rounded-md border border-red-300 dark:border-red-800",children:[e.jsx("p",{className:"text-xs font-medium text-red-700 dark:text-red-300 mb-1",children:"üìã Motivo de cancelaci√≥n:"}),e.jsx("p",{className:"text-xs text-red-600 dark:text-red-400",children:s.motivo_cancelacion}),e.jsxs("p",{className:"text-xs text-red-500 dark:text-red-500 mt-1",children:["Cancelada el: ",new Date(s.fecha_cancelacion).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),n.transaccionReversion&&e.jsxs("div",{className:"p-3 bg-orange-100 dark:bg-orange-950/40 rounded-md border border-orange-300 dark:border-orange-800",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsx("span",{className:"text-xs font-medium text-orange-700 dark:text-orange-300",children:"‚Ü©Ô∏è Asiento de Reversi√≥n Generado"})}),e.jsxs("div",{className:"text-xs text-orange-600 dark:text-orange-400 space-y-1",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",n.transaccionReversion.descripcion]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Monto reversado:"})," $",P(Math.abs(n.transaccionReversion.monto_total))]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(n.transaccionReversion.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-muted-foreground",children:[e.jsx("span",{children:new Date(s.created_at).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}),e.jsxs("span",{className:"font-medium text-green-600",children:["Neto: $",P(we(s,"netas"))]})]})]},s.id)})})]})})()]})]})}),e.jsx(Bs,{value:"analitica",className:"mt-6",children:(()=>{const a=(()=>{const s=new Date;s.getMonth();const d=s.getFullYear();let c=b.filter(m=>m.estado!=="cancelado"&&!m.descripcion.includes("CANCELACI√ìN:"));if(X==="diario"){const m=me.toISOString().split("T")[0];c=c.filter(r=>r.asiento_fecha===m)}else if(X==="mensual"){const m=E.getMonth(),r=E.getFullYear();c=c.filter(o=>{const x=o.asiento_fecha;if(!x)return!1;const g=Ct(x);return g.getMonth()===m&&g.getFullYear()===r})}else c=c.filter(m=>{const r=m.asiento_fecha;return r?Ct(r).getFullYear()===d:!1});return O==="ventas"?c.filter(m=>m.cuenta_principal_codigo==="4001"):c.filter(m=>{var r;return((r=m.cuenta_principal_codigo)==null?void 0:r.startsWith("4"))&&m.cuenta_principal_codigo!=="4001"&&m.cuenta_principal_codigo!=="4003"})})(),i=(()=>{const s=a.filter(m=>m.tipo_pago==="contado"||m.tipo_pago==="parcial");if(s.length===0)return[];const d={};s.forEach(m=>{const r=m.metodo_pago==="efectivo"?"Efectivo":"Tarjeta";d[r]=(d[r]||0)+we(m,v)});const c=Object.values(d).reduce((m,r)=>m+r,0);return Object.entries(d).map(([m,r])=>({name:m,value:r,porcentaje:c>0?(r/c*100).toFixed(1):"0.0"}))})(),n=()=>O==="ventas"?a.length>0||M.ventasBrutas>0||M.descuentos>0:a.length>0||M.otrosIngresos>0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-bold text-foreground mb-4",children:"Highlights de Ingresos"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Resumen del D√≠a"})}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",F(as.ventasBrutas,C)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",F(as.descuentos,C)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",F(as.ventasNetas,C)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",F(as.otrosIngresos,C)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",F(as.totalIngresos,C)]})]})]})]}),e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Resumen del Mes"})}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",F(ns.ventasBrutas,C)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",F(ns.descuentos,C)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",F(ns.ventasNetas,C)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",F(ns.otrosIngresos,C)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",F(ns.totalIngresos,C)]})]})]})]}),e.jsxs(W,{children:[e.jsx(q,{className:"pb-3",children:e.jsx(G,{className:"text-lg font-semibold text-primary",children:"Resumen del A√±o"})}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Ventas Brutas:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",F(rs.ventasBrutas,C)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-destructive",children:"Descuentos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",F(rs.descuentos,C)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-semibold text-chart-2",children:"Ventas Netas:"}),e.jsxs("span",{className:"text-lg font-bold text-foreground",children:["$",F(rs.ventasNetas,C)]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-blue-600",children:"Otros Ingresos:"}),e.jsxs("span",{className:"font-semibold text-foreground",children:["$",F(rs.otrosIngresos,C)]})]}),e.jsx("div",{className:"h-px bg-border"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-bold text-primary",children:"Total Ingresos:"}),e.jsxs("span",{className:"text-xl font-bold text-primary",children:["$",F(rs.totalIngresos,C)]})]})]})]})]})]}),e.jsx("div",{className:"my-8 border-t-2 border-primary/20"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-xl font-bold text-foreground mb-6",children:["Anal√≠tica de ",O==="ventas"?"Ventas":"Otros Ingresos"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6",children:[e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Tipo de Ingreso"}),e.jsx(oe,{children:"Selecciona qu√© analizar"})]}),e.jsx(Y,{children:e.jsxs(be,{value:O,onValueChange:s=>Ta(s),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"ventas",id:"tipo-ventas"}),e.jsx(p,{htmlFor:"tipo-ventas",className:"cursor-pointer",children:"Ventas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"otros",id:"tipo-otros"}),e.jsx(p,{htmlFor:"tipo-otros",className:"cursor-pointer",children:"Otros Ingresos"})]})]})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Per√≠odo de An√°lisis"}),e.jsx(oe,{children:"Selecciona el per√≠odo"})]}),e.jsxs(Y,{className:"space-y-3",children:[e.jsxs(be,{value:X,onValueChange:s=>Fa(s),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"diario",id:"period-daily"}),e.jsx(p,{htmlFor:"period-daily",className:"cursor-pointer",children:"Diario"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"mensual",id:"period-monthly"}),e.jsx(p,{htmlFor:"period-monthly",className:"cursor-pointer",children:"Mensual"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"anual",id:"period-annual"}),e.jsx(p,{htmlFor:"period-annual",className:"cursor-pointer",children:"Anual"})]})]}),X==="diario"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(p,{className:"text-xs text-muted-foreground mb-2 block",children:"Fecha espec√≠fica"}),e.jsxs(na,{children:[e.jsx(ra,{asChild:!0,children:e.jsxs(L,{variant:"outline",className:oa("w-full justify-start text-left font-normal",!me&&"text-muted-foreground"),size:"sm",children:[e.jsx(ia,{className:"mr-2 h-4 w-4"}),ca(me,"PPP",{locale:ja})]})}),e.jsx(la,{className:"w-auto p-0",align:"start",children:e.jsx(da,{mode:"single",selected:me,onSelect:s=>s&&$a(s),initialFocus:!0,className:"pointer-events-auto"})})]})]}),X==="mensual"&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx(p,{className:"text-xs text-muted-foreground mb-2 block",children:"Mes espec√≠fico"}),e.jsxs(na,{children:[e.jsx(ra,{asChild:!0,children:e.jsxs(L,{variant:"outline",className:oa("w-full justify-start text-left font-normal",!E&&"text-muted-foreground"),size:"sm",children:[e.jsx(ia,{className:"mr-2 h-4 w-4"}),ca(E,"MMMM yyyy",{locale:ja})]})}),e.jsx(la,{className:"w-auto p-0",align:"start",children:e.jsx(da,{mode:"single",selected:E,onSelect:s=>s&&ka(s),initialFocus:!0,className:"pointer-events-auto"})})]})]})]})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Formato de Cifras"}),e.jsx(oe,{children:"Visualizaci√≥n de montos"})]}),e.jsx(Y,{children:e.jsxs(be,{value:C,onValueChange:s=>Da(s),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"general",id:"scale-general"}),e.jsx(p,{htmlFor:"scale-general",className:"cursor-pointer",children:"General"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"miles",id:"scale-thousands"}),e.jsx(p,{htmlFor:"scale-thousands",className:"cursor-pointer",children:"Miles (K)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"millones",id:"scale-millions"}),e.jsx(p,{htmlFor:"scale-millions",className:"cursor-pointer",children:"Millones (M)"})]})]})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"Tipo de M√©trica"}),e.jsx(oe,{children:"Datos a visualizar"})]}),e.jsx(Y,{children:e.jsxs(be,{value:v,onValueChange:s=>Ia(s),className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"brutas",id:"metric-brutas"}),e.jsx(p,{htmlFor:"metric-brutas",className:"cursor-pointer",children:"Ventas Brutas"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"descuentos",id:"metric-descuentos"}),e.jsx(p,{htmlFor:"metric-descuentos",className:"cursor-pointer",children:"Descuentos"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{value:"netas",id:"metric-netas"}),e.jsx(p,{htmlFor:"metric-netas",className:"cursor-pointer",children:"Ventas Netas"})]})]})})]})]}),e.jsxs(W,{className:"mb-6",children:[e.jsxs(q,{children:[e.jsxs(G,{children:["Evoluci√≥n de ",v==="descuentos"?"Descuentos":O==="otros"?"Otros Ingresos":v==="brutas"?"Ventas Brutas":"Ventas Netas"]}),e.jsxs(oe,{children:[v==="descuentos"?"Descuentos aplicados":O==="otros"?"Otros ingresos":v==="brutas"?"Ventas brutas":"Ventas netas"," - ",X==="diario"?"del d√≠a":X==="mensual"?"por d√≠a del mes":"por mes del a√±o"]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"Cargando datos..."}):M.detallesPorPeriodo.length===0?e.jsx("div",{className:"h-80 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"}):e.jsx("div",{className:"h-80",children:e.jsx(xs,{width:"100%",height:"100%",children:e.jsxs(Sn,{data:M.detallesPorPeriodo.map(s=>({periodo:s.periodo,ventas:s.ventasBrutas,descuentos:s.descuentos,neto:s.ventasNetas,otrosIngresos:s.otrosIngresos})),children:[e.jsx(ma,{strokeDasharray:"3 3"}),e.jsx(ua,{dataKey:"periodo",tick:{fill:"#000000"}}),e.jsx(xa,{tickFormatter:s=>F(s,C),tick:{fill:"#000000"}}),e.jsx(hs,{formatter:s=>[`$${F(Number(s),C)}`,""],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}}),e.jsx(Pn,{}),v==="descuentos"&&e.jsx(Us,{type:"monotone",dataKey:"descuentos",stroke:"hsl(180 60% 70%)",name:"Descuentos",strokeWidth:2,children:e.jsx(ps,{dataKey:"descuentos",position:"top",formatter:s=>`$${F(s,C)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),v==="brutas"&&O==="ventas"&&e.jsx(Us,{type:"monotone",dataKey:"ventas",stroke:"hsl(180 50% 55%)",name:"Ventas Brutas",strokeWidth:2,children:e.jsx(ps,{dataKey:"ventas",position:"top",formatter:s=>`$${F(s,C)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),v==="netas"&&O==="ventas"&&e.jsx(Us,{type:"monotone",dataKey:"neto",stroke:"hsl(180 45% 45%)",name:"Ventas Netas",strokeWidth:2,children:e.jsx(ps,{dataKey:"neto",position:"top",formatter:s=>`$${F(s,C)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})}),O==="otros"&&v!=="descuentos"&&e.jsx(Us,{type:"monotone",dataKey:"otrosIngresos",stroke:"hsl(140 50% 50%)",name:"Otros Ingresos",strokeWidth:2,children:e.jsx(ps,{dataKey:"otrosIngresos",position:"top",formatter:s=>`$${F(s,C)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})})]})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:[v==="brutas"?"Ventas Brutas":v==="descuentos"?"Descuentos":"Ventas Netas"," por Tipo"]}),e.jsxs(oe,{children:["Distribuci√≥n de ",v==="brutas"?"ventas brutas":v==="descuentos"?"descuentos":"ventas netas"," por categor√≠a"]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):n()?O==="otros"&&v==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(xs,{width:"100%",height:"100%",children:e.jsxs(ha,{children:[e.jsx(pa,{data:(()=>{const s=O==="ventas"?v==="brutas"?M.ventasBrutas:v==="descuentos"?M.descuentos:M.ventasNetas:M.otrosIngresos;if(a.length===0&&s>0)return[{tipo:"Otros Ingresos",monto:s,porcentaje:"100.0"}];const d=a.reduce((m,r)=>(m[r.tipo_ingreso]=(m[r.tipo_ingreso]||0)+we(r,v),m),{}),c=Object.values(d).reduce((m,r)=>m+r,0);return Object.entries(d).map(([m,r])=>({tipo:m.charAt(0).toUpperCase()+m.slice(1),monto:r,porcentaje:c>0?(r/c*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({tipo:s,porcentaje:d,monto:c})=>`${s}
${d}%
$${F(c,C)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:Object.keys(a.reduce((s,d)=>(s[d.tipo_ingreso]=!0,s),{})).map((s,d)=>{const c=["hsl(180 50% 55%)","hsl(180 45% 45%)","hsl(180 55% 65%)","hsl(180 40% 40%)"];return e.jsx(Ws,{fill:c[d%4]},`cell-${d}`)})}),e.jsx(hs,{formatter:s=>[`$${F(Number(s),C)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:["Estado de Pagos - ",v==="brutas"?"Ventas Brutas":v==="descuentos"?"Descuentos":"Ventas Netas"]}),e.jsx(oe,{children:"Distribuci√≥n por estado de pago"})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):n()?O==="otros"&&v==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(xs,{width:"100%",height:"100%",children:e.jsxs(ha,{children:[e.jsxs(pa,{data:(()=>{const s=O==="ventas"?v==="brutas"?M.ventasBrutas:v==="descuentos"?M.descuentos:M.ventasNetas:M.otrosIngresos;if(a.length===0&&s>0)return[{estado:"Pagado Total",monto:s,porcentaje:"100.0"}];const d=a.reduce((m,r)=>{let o="Por Cobrar";return r.tipo_pago==="contado"||r.monto_pagado&&r.monto_pendiente===0?o="Pagado Total":(r.tipo_pago==="parcial"||r.monto_pagado>0&&r.monto_pendiente>0)&&(o="Pago Parcial"),m[o]=(m[o]||0)+we(r,v),m},{}),c=Object.values(d).reduce((m,r)=>m+r,0);return Object.entries(d).map(([m,r])=>({estado:m,monto:r,porcentaje:c>0?(r/c*100).toFixed(1):"0.0"}))})(),cx:"50%",cy:"50%",labelLine:!1,label:({estado:s,porcentaje:d,monto:c})=>`${s}
${d}%
$${F(c,C)}`,innerRadius:60,outerRadius:80,fill:"#8884d8",dataKey:"monto",children:[e.jsx(Ws,{fill:"hsl(180 50% 55%)"}),e.jsx(Ws,{fill:"hsl(180 55% 65%)"}),e.jsx(Ws,{fill:"hsl(180 45% 45%)"})]}),e.jsx(hs,{formatter:s=>[`$${F(Number(s),C)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(W,{children:[e.jsxs(q,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(G,{children:[v==="brutas"?"Ventas Brutas":v==="descuentos"?"Descuentos":"Ventas Netas"," por ",Ze==="subcuenta"?"Subcuenta":"Cuenta"]}),e.jsxs(oe,{children:["Distribuci√≥n por ",Ze==="subcuenta"?"subcuentas":"cuentas"," contables"]})]}),e.jsxs(pe,{value:Ze,onValueChange:s=>Ra(s),children:[e.jsx(je,{className:"w-[150px]",children:e.jsx(ge,{})}),e.jsxs(fe,{children:[e.jsx(T,{value:"subcuenta",children:"Por Subcuenta"}),e.jsx(T,{value:"cuenta",children:"Por Cuenta"})]})]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):n()?O==="otros"&&v==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):e.jsx("div",{className:"h-64",children:e.jsx(xs,{width:"100%",height:"100%",children:e.jsxs(Fn,{data:(()=>{const s=O==="ventas"?v==="brutas"?M.ventasBrutas:v==="descuentos"?M.descuentos:M.ventasNetas:M.otrosIngresos;if(a.length===0&&s>0)return[{subcuenta:"Sin detalle",monto:s}];const d=a.reduce((r,o)=>{var g;let x;if(Ze==="subcuenta")x=o.subcuenta_id?((g=ee.find(j=>j.id===o.subcuenta_id))==null?void 0:g.nombre)||"Subcuenta desconocida":"Sin subcuenta asignada";else{const j=Q.find(f=>f.codigo===o.cuenta_principal_codigo);x=j?`${o.cuenta_principal_codigo} - ${j.nombre}`:o.cuenta_principal_codigo||"Sin cuenta"}return r[x]=(r[x]||0)+we(o,v),r},{}),c=Object.values(d).reduce((r,o)=>r+o,0);if(s-c>.01){const r={};Ve.forEach(o=>{const x=o.detalle_asientos.find(S=>S.cuenta_codigo.startsWith("4")&&Number(S.haber)>0);if(!x)return;const g=Number(x.haber)||0,j=x.cuenta_codigo,f=Q.find(S=>S.codigo===j),y=(f==null?void 0:f.nombre)||"Otros ingresos";let _;if(Ze==="cuenta")_=`${j} - ${y}`;else if(Ze==="subcuenta"){const S=x.subcuenta_id,z=ee.find(B=>B.id===S);_=(z==null?void 0:z.nombre)||"Sin subcuenta asignada"}else _=y;r[_]=(r[_]||0)+g}),Object.entries(r).forEach(([o,x])=>{d[o]=(d[o]||0)+x})}return Object.entries(d).map(([r,o])=>({subcuenta:r,monto:o}))})(),layout:"vertical",children:[e.jsx(ma,{strokeDasharray:"3 3"}),e.jsx(ua,{type:"number",tickFormatter:s=>F(s,C),tick:{fill:"#000000"},domain:[0,s=>s*1.2]}),e.jsx(xa,{type:"category",dataKey:"subcuenta",width:150,tick:{fill:"#000000"}}),e.jsx(hs,{formatter:s=>[`$${F(Number(s),C)}`,"Monto"],contentStyle:{backgroundColor:"#ffffff",border:"1px solid #ccc",borderRadius:"4px",color:"#000000"},itemStyle:{color:"#000000",fontWeight:"bold"},labelStyle:{color:"#000000",fontWeight:"bold"},wrapperStyle:{zIndex:1e3}}),e.jsx(Dn,{dataKey:"monto",fill:"hsl(180 50% 55%)",children:e.jsx(ps,{dataKey:"monto",position:"right",formatter:s=>`$${F(s,C)}`,style:{fill:"#000000",fontWeight:"bold",fontSize:"12px"}})})]})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsx(G,{children:"M√©todos de Pago Recibidos"}),e.jsxs(oe,{children:["Distribuci√≥n de ",v==="brutas"?"ventas brutas":v==="descuentos"?"descuentos":"ventas netas"," por m√©todo de pago"]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"Cargando gr√°fico..."}):n()?O==="otros"&&v==="descuentos"?e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay descuentos en otros ingresos"}):i.length===0?e.jsxs("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:["No hay transacciones con m√©todo de pago en este per√≠odo",e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-2 block",children:"Las ventas a cr√©dito no tienen m√©todo de pago asignado"})]}):e.jsx("div",{className:"h-64",children:e.jsx(xs,{width:"100%",height:"100%",children:e.jsx(In,{data:i,dataKey:"value",aspectRatio:4/3,stroke:"#fff",fill:"#8884d8",content:e.jsx(En,{}),children:e.jsx(hs,{content:e.jsx(Vn,{scaleFormat:C})})})})}):e.jsx("div",{className:"h-64 flex items-center justify-center text-muted-foreground",children:"No hay datos para mostrar"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:[v==="brutas"?"Ventas Brutas":v==="descuentos"?"Descuentos":"Ventas Netas"," por Producto"]}),e.jsxs(oe,{children:["Ranking de productos ",v==="descuentos"?"con m√°s descuentos":"m√°s vendidos"]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):n()?e.jsx("div",{className:"space-y-3",children:(()=>{if(O==="otros"&&v==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const s=O==="ventas"?v==="brutas"?M.ventasBrutas:v==="descuentos"?M.descuentos:M.ventasNetas:M.otrosIngresos;if(a.length===0&&s>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(ye,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin detalle de producto"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",F(s,C)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(ye,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",F(s,C)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const d={};a.forEach(r=>{if(r.tipo_ingreso==="inventariados"&&r.descripcion.startsWith("Venta de ")){const o=r.descripcion.replace("Venta de ","").trim(),x=De.find(g=>g.nombre.toLowerCase()===o.toLowerCase());d[o]||(d[o]={nombre:o,transacciones:0,monto:0,imagen:x==null?void 0:x.imagen_url,tieneAsignacion:!0}),d[o].transacciones+=1,d[o].monto+=we(r,v)}}),a.forEach(r=>{if(r.tipo_ingreso==="precargados"){let o=[];r.descripcion.startsWith("Venta: ")?o=r.descripcion.replace("Venta: ","").split(", ").map(y=>{const _=y.match(/^(.+?) \(x(\d+)\)$/);return _?{nombre:_[1].trim(),cantidad:parseInt(_[2])}:{nombre:y.trim(),cantidad:1}}):r.descripcion.startsWith("Venta de ")?o=[{nombre:r.descripcion.replace("Venta de ","").trim(),cantidad:1}]:o=[{nombre:r.descripcion,cantidad:1}];const x=we(r,v),g=[];let j=0;o.forEach(({nombre:f,cantidad:y})=>{const _=se.find(z=>z.nombre.toLowerCase()===f.toLowerCase()),S=(_==null?void 0:_.precio)||0;g.push({nombre:f,cantidad:y,precioBase:S}),j+=S*y}),g.forEach(({nombre:f,cantidad:y,precioBase:_})=>{const S=se.find(le=>le.nombre.toLowerCase()===f.toLowerCase()),z=_*y,B=j>0?z/j:1/g.length,U=x*B;d[f]||(d[f]={nombre:f,transacciones:0,monto:0,imagen:S==null?void 0:S.imagen_url,tieneAsignacion:!!S}),d[f].transacciones+=1,d[f].monto+=U})}if(r.tipo_ingreso==="general"||r.tipo_ingreso==="inventariados"&&!r.descripcion.startsWith("Venta de")){const o="Ingresos sin producto asignado";d[o]||(d[o]={nombre:o,transacciones:0,monto:0,tieneAsignacion:!1}),d[o].transacciones+=1,d[o].monto+=we(r,v)}if(r.tipo_ingreso==="otros"){const o=r.descripcion||"Otros ingresos";d[o]||(d[o]={nombre:o,transacciones:0,monto:0,tieneAsignacion:!1}),d[o].transacciones+=1,d[o].monto+=we(r,v)}});const c=Object.values(d).sort((r,o)=>o.monto-r.monto);if(c.reduce((r,o)=>r+o.monto,0),O==="otros"){const r=a.filter(x=>x.tipo_ingreso==="otros").reduce((x,g)=>x+we(g,v),0);if(s-r>.01){const x={};Ve.forEach(g=>{var z;const j=g.detalle_asientos.find(B=>B.cuenta_codigo.startsWith("4")&&Number(B.haber)>0);if(!j)return;const f=Number(j.haber)||0,y=j.cuenta_codigo,_=Q.find(B=>B.codigo===y);let S;(z=g.numero_asiento)!=null&&z.startsWith("BAJA-")?S=(_==null?void 0:_.nombre)||"Ganancia en Venta de Activos":S=g.descripcion||(_==null?void 0:_.nombre)||"Otros ingresos",x[S]||(x[S]={monto:0,count:0}),x[S].monto+=f,x[S].count+=1}),Object.entries(x).forEach(([g,j])=>{j.monto>.01&&c.push({nombre:g,transacciones:j.count,monto:j.monto,tieneAsignacion:!1})})}}const m=c.slice(0,10);return e.jsxs(e.Fragment,{children:[m.map(r=>{const o=c.reduce((g,j)=>g+j.monto,0),x=o>0?(r.monto/o*100).toFixed(1):"0.0";return e.jsxs("div",{className:`flex items-center gap-3 p-3 border rounded-lg ${r.tieneAsignacion?"":"border-amber-500/50 bg-amber-50/50 dark:bg-amber-950/20"}`,children:[r.imagen?e.jsx("img",{src:r.imagen,alt:r.nombre,className:"w-12 h-12 rounded-md object-cover flex-shrink-0"}):e.jsx("div",{className:`w-12 h-12 rounded-md flex items-center justify-center flex-shrink-0 ${r.tieneAsignacion?"bg-muted":"bg-amber-100 dark:bg-amber-900/30"}`,children:e.jsx(ye,{className:`w-5 h-5 ${r.tieneAsignacion?"text-muted-foreground":"text-amber-600 dark:text-amber-400"}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium truncate",children:r.nombre}),!r.tieneAsignacion&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-amber-100 text-amber-800 dark:bg-amber-900/50 dark:text-amber-200 flex-shrink-0",children:"Sin asignar"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.transacciones," ",r.transacciones===1?"transacci√≥n":"transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",F(r.monto,C)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[x,"%"]})})]},r.nombre)}),(()=>{const r=c.reduce((o,x)=>o+x.monto,0);return r>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-md bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(ye,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c.reduce((o,x)=>o+x.transacciones,0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",F(r,C)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]}),e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{children:[v==="brutas"?"Ventas Brutas":v==="descuentos"?"Descuentos":"Ventas Netas"," por Cliente"]}),e.jsxs(oe,{children:["Ranking de ",v==="descuentos"?"clientes con m√°s descuentos":"mejores clientes"]})]}),e.jsx(Y,{children:I?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Cargando datos..."}):n()?e.jsx("div",{className:"space-y-3",children:(()=>{if(O==="otros"&&v==="descuentos")return e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay descuentos en otros ingresos"});const s=O==="ventas"?v==="brutas"?M.ventasBrutas:v==="descuentos"?M.descuentos:M.ventasNetas:M.otrosIngresos;if(a.length===0&&s>0)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(us,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:"Sin cliente asignado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Otros Ingresos"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",F(s,C)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:"100%"})})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(us,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"1 registro"})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",F(s,C)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]})]});const d=a.reduce((o,x)=>{const g=x.cliente_nombre||"Sin cliente asignado";return o[g]||(o[g]={nombre:g,transacciones:0,monto:0,email:x.cliente_email,telefono:x.cliente_telefono}),o[g].transacciones+=1,o[g].monto+=we(x,v),o},{}),c=Object.values(d).sort((o,x)=>x.monto-o.monto),m=c.reduce((o,x)=>o+x.monto,0);if(O==="otros"){const o=s-m;if(o>.01){const x=c.find(g=>g.nombre==="Sin cliente asignado");x?(x.monto+=o,x.transacciones+=Ve.length):c.push({nombre:"Sin cliente asignado",transacciones:Ve.length,monto:o}),c.sort((g,j)=>j.monto-g.monto)}}const r=c.slice(0,10);return e.jsxs(e.Fragment,{children:[r.map(o=>{const x=c.reduce((j,f)=>j+f.monto,0),g=x>0?(o.monto/x*100).toFixed(1):"0.0";return e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(us,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:o.nombre}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-0.5",children:[e.jsxs("p",{children:[o.transacciones," ",o.transacciones===1?"compra":"compras"]}),o.telefono&&e.jsx("p",{className:"text-xs",children:o.telefono}),o.email&&e.jsx("p",{className:"text-xs truncate",children:o.email})]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-foreground",children:["$",F(o.monto,C)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:"px-2 py-1 bg-primary/10 text-primary rounded text-sm font-semibold",children:[g,"%"]})})]},o.nombre)}),(()=>{const o=c.reduce((x,g)=>x+g.monto,0);return o>0?e.jsxs("div",{className:"flex items-center gap-3 p-3 border-2 border-primary rounded-lg bg-primary/5",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center flex-shrink-0",children:e.jsx(us,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-bold text-foreground",children:"TOTAL GENERAL"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[c.reduce((x,g)=>x+g.transacciones,0)," transacciones"]})]}),e.jsx("div",{className:"text-right flex-shrink-0",children:e.jsxs("p",{className:"font-bold text-lg text-primary",children:["$",F(o,C)]})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"px-2 py-1 bg-primary text-primary-foreground rounded text-sm font-bold",children:"100%"})})]}):null})()]})})()}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay datos para mostrar"})})]})]})]})]})})()}),e.jsx(Bs,{value:"catalogo",className:"mt-6",children:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{className:"flex items-center justify-between",children:["Cat√°logo de Productos",e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(L,{variant:"outline",size:"sm",onClick:()=>{fa(),ae({title:"Actualizado",description:"La lista de productos se ha actualizado correctamente"})},children:[e.jsx(Tn,{className:"mr-2 h-4 w-4"}),"Actualizar"]}),e.jsxs(is,{open:La,onOpenChange:it,children:[e.jsx(aa,{asChild:!0,children:e.jsxs(L,{children:[e.jsx(yt,{className:"mr-2 h-4 w-4"}),"Nuevo Producto"]})}),e.jsxs(cs,{className:"sm:max-w-[425px]",children:[e.jsxs(ls,{children:[e.jsx(ds,{children:"Agregar Nuevo Producto"}),e.jsx(ms,{children:"Completa la informaci√≥n del producto para agregarlo al cat√°logo."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"product-name",className:"text-right",children:"Nombre"}),e.jsx(V,{id:"product-name",value:ct,onChange:t=>zt(t.target.value),className:"col-span-3",placeholder:"Nombre del producto"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"product-image",className:"text-right",children:"Imagen"}),e.jsx(V,{id:"product-image",type:"file",accept:"image/*",onChange:t=>{var a;return Gt(((a=t.target.files)==null?void 0:a[0])||null)},className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"product-price",className:"text-right",children:"Precio"}),e.jsx(V,{id:"product-price",type:"number",value:lt,onChange:t=>Lt(t.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"product-account",className:"text-right",children:"Cuenta"}),e.jsxs("div",{className:"col-span-3 flex items-center p-2 border rounded-md bg-muted/50",children:[e.jsx("span",{className:"text-sm font-medium",children:"4001 - Ventas"}),e.jsx("span",{className:"text-xs text-muted-foreground ml-2",children:"(cuenta fija)"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(pe,{value:Wt,onValueChange:t=>qt(t==="none"?"":t),children:[e.jsx(je,{className:"col-span-3",children:e.jsx(ge,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(fe,{children:[e.jsx(T,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),ee.filter(t=>t.cuenta_madre_codigo==="4001").map(t=>e.jsx(T,{value:t.id,children:t.nombre},t.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(es,{id:"product-description",value:Bt,onChange:t=>Ut(t.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]})]}),e.jsxs(zs,{children:[e.jsx(L,{type:"button",variant:"outline",onClick:()=>it(!1),children:"Cancelar"}),e.jsx(L,{onClick:on,disabled:Es,children:Es?"Guardando...":"Guardar Producto"})]})]})]}),e.jsx(is,{open:qa,onOpenChange:Os,children:e.jsxs(cs,{className:"sm:max-w-[425px]",children:[e.jsxs(ls,{children:[e.jsx(ds,{children:"Editar Producto"}),e.jsx(ms,{children:"Modifica la informaci√≥n del producto."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"edit-product-name",className:"text-right",children:"Nombre *"}),e.jsx(V,{id:"edit-product-name",value:xt,onChange:t=>ht(t.target.value),className:"col-span-3",placeholder:"Ej: Consultor√≠a, Producto X"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"edit-product-price",className:"text-right",children:"Precio *"}),e.jsx(V,{id:"edit-product-price",type:"number",value:pt,onChange:t=>jt(t.target.value),className:"col-span-3",placeholder:"0.00"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"edit-product-image",className:"text-right",children:"Imagen"}),e.jsxs("div",{className:"col-span-3 space-y-2",children:[e.jsx(V,{id:"edit-product-image",type:"file",accept:"image/*",onChange:cn}),Jt&&e.jsx("div",{className:"aspect-square w-24 mx-auto",children:e.jsx("img",{src:Jt,alt:"Preview",className:"w-full h-full object-cover rounded-md"})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"edit-product-description",className:"text-right",children:"Descripci√≥n"}),e.jsx(es,{id:"edit-product-description",value:Ht,onChange:t=>gt(t.target.value),className:"col-span-3",placeholder:"Descripci√≥n opcional del producto",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(p,{htmlFor:"edit-product-subcuenta",className:"text-right",children:"Subcuenta"}),e.jsxs(pe,{value:Qt||"none",onValueChange:t=>Xt(t==="none"?"":t),children:[e.jsx(je,{className:"col-span-3",children:e.jsx(ge,{placeholder:"Sin subcuenta (usar cuenta principal)"})}),e.jsxs(fe,{children:[e.jsx(T,{value:"none",children:"Sin subcuenta (usar cuenta principal)"}),ee.filter(t=>t.cuenta_madre_codigo==="4001").map(t=>e.jsx(T,{value:t.id,children:t.nombre},t.id))]})]})]})]}),e.jsxs(zs,{children:[e.jsx(L,{type:"button",variant:"outline",onClick:()=>Os(!1),children:"Cancelar"}),e.jsx(L,{onClick:ln,disabled:Es,children:Es?"Actualizando...":"Actualizar Producto"})]})]})})]})]}),e.jsx(oe,{children:"Gestiona el cat√°logo de productos y servicios con cuentas contables asignadas"})]}),e.jsxs(Y,{children:[e.jsxs(Oe,{className:"mb-6",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsxs(ze,{children:[e.jsx("strong",{children:"Recomendaci√≥n:"}),' Asignar subcuentas a cada producto ayuda a llevar un mejor control contable. La cuenta predeterminada es "4001 - Ventas".']})]}),e.jsx("div",{className:"space-y-6",children:qs?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):se.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay productos de servicios registrados a√∫n"}):e.jsxs("div",{className:"space-y-6",children:[ee.filter(t=>t.cuenta_madre_codigo==="4001").map(t=>{const a=se.filter(l=>l.subcuenta_id===t.id);return a.length===0?null:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{className:"text-lg flex items-center",children:[e.jsx(ye,{className:"mr-2 h-5 w-5"}),"Subcuenta: ",t.nombre]}),e.jsxs(oe,{children:[a.length," producto",a.length!==1?"s":""]})]}),e.jsx(Y,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(l=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[l.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:l.imagen_url,alt:l.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:l.nombre}),l.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:l.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",l.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>ea(l),className:"flex-1",children:"Editar"}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>_t.mutate(l.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},l.id))})})]},t.id)}),(()=>{const t=se.filter(a=>!a.subcuenta_id);return t.length===0?null:e.jsxs(W,{children:[e.jsxs(q,{children:[e.jsxs(G,{className:"text-lg flex items-center",children:[e.jsx(ta,{className:"mr-2 h-5 w-5"}),"Cuenta General: 4001 - Ventas"]}),e.jsxs(oe,{children:[t.length," producto",t.length!==1?"s":""," sin subcuenta espec√≠fica"]})]}),e.jsx(Y,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map(a=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[a.imagen_url&&e.jsx("div",{className:"aspect-square w-full max-w-24 mx-auto",children:e.jsx("img",{src:a.imagen_url,alt:a.nombre,className:"w-full h-full object-cover rounded-md"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold",children:a.nombre}),a.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground",children:a.descripcion}),e.jsxs("p",{className:"text-lg font-bold text-primary",children:["$",a.precio.toFixed(2)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{variant:"outline",size:"sm",onClick:()=>ea(a),className:"flex-1",children:"Editar"}),e.jsx(L,{variant:"outline",size:"sm",onClick:()=>_t.mutate(a.id),className:"flex-1 text-destructive hover:text-destructive",children:"Eliminar"})]})]},a.id))})})]})})()]})})]})]})})]}),e.jsx(is,{open:Wa,onOpenChange:Ms,children:e.jsxs(cs,{children:[e.jsxs(ls,{children:[e.jsx(ds,{children:"‚ùå Cancelar Transacci√≥n"}),e.jsx(ms,{children:"Esta acci√≥n crear√° un asiento contable de reversi√≥n. La transacci√≥n original quedar√° marcada como cancelada pero mantendr√° toda su trazabilidad."})]}),e.jsxs("div",{className:"space-y-4",children:[Ke&&e.jsxs("div",{className:"p-3 bg-muted rounded-md",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Transacci√≥n a cancelar:"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Descripci√≥n:"})," ",Ke.descripcion]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Monto:"})," $",P(Ke.monto_total)]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(Ke.created_at).toLocaleDateString("es-ES")]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"motivo-cancelacion",children:"Motivo de la Cancelaci√≥n *"}),e.jsx(es,{id:"motivo-cancelacion",placeholder:"Ej: Error en registro, cliente cancel√≥ pedido, etc.",value:Rs,onChange:t=>mt(t.target.value),rows:3})]}),e.jsxs(Oe,{children:[e.jsx(R,{className:"h-4 w-4"}),e.jsxs(ze,{className:"text-xs",children:[e.jsx("strong",{children:"¬øQu√© suceder√°?"}),e.jsxs("ul",{className:"list-disc ml-4 mt-1 space-y-1",children:[e.jsx("li",{children:"Se crear√° un asiento de reversi√≥n autom√°ticamente"}),e.jsx("li",{children:'La transacci√≥n original se marcar√° como "cancelada"'}),e.jsx("li",{children:"Si es venta de inventario, el stock se restaurar√°"}),e.jsx("li",{children:"Ambas transacciones quedar√°n visibles para auditor√≠a"})]})]})]})]}),e.jsxs(zs,{children:[e.jsx(L,{variant:"outline",onClick:()=>{Ms(!1),mt(""),dt(null)},disabled:ut,children:"Cancelar"}),e.jsx(L,{variant:"destructive",onClick:nn,disabled:ut||!Rs.trim(),children:ut?"Cancelando...":"Confirmar Cancelaci√≥n"})]})]})})]})]})};export{zn as default};
